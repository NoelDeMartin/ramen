{"version":3,"file":"index-B_VAUyOD.js","sources":["../../node_modules/.pnpm/oauth4webapi@2.17.0/node_modules/oauth4webapi/build/index.js"],"sourcesContent":["let USER_AGENT;\nif (typeof navigator === 'undefined' || !navigator.userAgent?.startsWith?.('Mozilla/5.0 ')) {\n    const NAME = 'oauth4webapi';\n    const VERSION = 'v2.17.0';\n    USER_AGENT = `${NAME}/${VERSION}`;\n}\nfunction looseInstanceOf(input, expected) {\n    if (input == null) {\n        return false;\n    }\n    try {\n        return (input instanceof expected ||\n            Object.getPrototypeOf(input)[Symbol.toStringTag] === expected.prototype[Symbol.toStringTag]);\n    }\n    catch {\n        return false;\n    }\n}\nexport const clockSkew = Symbol();\nexport const clockTolerance = Symbol();\nexport const customFetch = Symbol();\nexport const modifyAssertion = Symbol();\nexport const jweDecrypt = Symbol();\nexport const jwksCache = Symbol();\nexport const useMtlsAlias = Symbol();\nconst encoder = new TextEncoder();\nconst decoder = new TextDecoder();\nfunction buf(input) {\n    if (typeof input === 'string') {\n        return encoder.encode(input);\n    }\n    return decoder.decode(input);\n}\nconst CHUNK_SIZE = 0x8000;\nfunction encodeBase64Url(input) {\n    if (input instanceof ArrayBuffer) {\n        input = new Uint8Array(input);\n    }\n    const arr = [];\n    for (let i = 0; i < input.byteLength; i += CHUNK_SIZE) {\n        arr.push(String.fromCharCode.apply(null, input.subarray(i, i + CHUNK_SIZE)));\n    }\n    return btoa(arr.join('')).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n}\nfunction decodeBase64Url(input) {\n    try {\n        const binary = atob(input.replace(/-/g, '+').replace(/_/g, '/').replace(/\\s/g, ''));\n        const bytes = new Uint8Array(binary.length);\n        for (let i = 0; i < binary.length; i++) {\n            bytes[i] = binary.charCodeAt(i);\n        }\n        return bytes;\n    }\n    catch (cause) {\n        throw new OPE('The input to be decoded is not correctly encoded.', { cause });\n    }\n}\nfunction b64u(input) {\n    if (typeof input === 'string') {\n        return decodeBase64Url(input);\n    }\n    return encodeBase64Url(input);\n}\nclass LRU {\n    constructor(maxSize) {\n        this.cache = new Map();\n        this._cache = new Map();\n        this.maxSize = maxSize;\n    }\n    get(key) {\n        let v = this.cache.get(key);\n        if (v) {\n            return v;\n        }\n        if ((v = this._cache.get(key))) {\n            this.update(key, v);\n            return v;\n        }\n        return undefined;\n    }\n    has(key) {\n        return this.cache.has(key) || this._cache.has(key);\n    }\n    set(key, value) {\n        if (this.cache.has(key)) {\n            this.cache.set(key, value);\n        }\n        else {\n            this.update(key, value);\n        }\n        return this;\n    }\n    delete(key) {\n        if (this.cache.has(key)) {\n            return this.cache.delete(key);\n        }\n        if (this._cache.has(key)) {\n            return this._cache.delete(key);\n        }\n        return false;\n    }\n    update(key, value) {\n        this.cache.set(key, value);\n        if (this.cache.size >= this.maxSize) {\n            this._cache = this.cache;\n            this.cache = new Map();\n        }\n    }\n}\nexport class UnsupportedOperationError extends Error {\n    constructor(message) {\n        super(message ?? 'operation not supported');\n        this.name = this.constructor.name;\n        Error.captureStackTrace?.(this, this.constructor);\n    }\n}\nexport class OperationProcessingError extends Error {\n    constructor(message, options) {\n        super(message, options);\n        this.name = this.constructor.name;\n        Error.captureStackTrace?.(this, this.constructor);\n    }\n}\nconst OPE = OperationProcessingError;\nconst dpopNonces = new LRU(100);\nfunction isCryptoKey(key) {\n    return key instanceof CryptoKey;\n}\nfunction isPrivateKey(key) {\n    return isCryptoKey(key) && key.type === 'private';\n}\nfunction isPublicKey(key) {\n    return isCryptoKey(key) && key.type === 'public';\n}\nconst SUPPORTED_JWS_ALGS = [\n    'PS256',\n    'ES256',\n    'RS256',\n    'PS384',\n    'ES384',\n    'RS384',\n    'PS512',\n    'ES512',\n    'RS512',\n    'EdDSA',\n];\nfunction processDpopNonce(response) {\n    try {\n        const nonce = response.headers.get('dpop-nonce');\n        if (nonce) {\n            dpopNonces.set(new URL(response.url).origin, nonce);\n        }\n    }\n    catch { }\n    return response;\n}\nfunction normalizeTyp(value) {\n    return value.toLowerCase().replace(/^application\\//, '');\n}\nfunction isJsonObject(input) {\n    if (input === null || typeof input !== 'object' || Array.isArray(input)) {\n        return false;\n    }\n    return true;\n}\nfunction prepareHeaders(input) {\n    if (looseInstanceOf(input, Headers)) {\n        input = Object.fromEntries(input.entries());\n    }\n    const headers = new Headers(input);\n    if (USER_AGENT && !headers.has('user-agent')) {\n        headers.set('user-agent', USER_AGENT);\n    }\n    if (headers.has('authorization')) {\n        throw new TypeError('\"options.headers\" must not include the \"authorization\" header name');\n    }\n    if (headers.has('dpop')) {\n        throw new TypeError('\"options.headers\" must not include the \"dpop\" header name');\n    }\n    return headers;\n}\nfunction signal(value) {\n    if (typeof value === 'function') {\n        value = value();\n    }\n    if (!(value instanceof AbortSignal)) {\n        throw new TypeError('\"options.signal\" must return or be an instance of AbortSignal');\n    }\n    return value;\n}\nexport async function discoveryRequest(issuerIdentifier, options) {\n    if (!(issuerIdentifier instanceof URL)) {\n        throw new TypeError('\"issuerIdentifier\" must be an instance of URL');\n    }\n    if (issuerIdentifier.protocol !== 'https:' && issuerIdentifier.protocol !== 'http:') {\n        throw new TypeError('\"issuer.protocol\" must be \"https:\" or \"http:\"');\n    }\n    const url = new URL(issuerIdentifier.href);\n    switch (options?.algorithm) {\n        case undefined:\n        case 'oidc':\n            url.pathname = `${url.pathname}/.well-known/openid-configuration`.replace('//', '/');\n            break;\n        case 'oauth2':\n            if (url.pathname === '/') {\n                url.pathname = '.well-known/oauth-authorization-server';\n            }\n            else {\n                url.pathname = `.well-known/oauth-authorization-server/${url.pathname}`.replace('//', '/');\n            }\n            break;\n        default:\n            throw new TypeError('\"options.algorithm\" must be \"oidc\" (default), or \"oauth2\"');\n    }\n    const headers = prepareHeaders(options?.headers);\n    headers.set('accept', 'application/json');\n    return (options?.[customFetch] || fetch)(url.href, {\n        headers: Object.fromEntries(headers.entries()),\n        method: 'GET',\n        redirect: 'manual',\n        signal: options?.signal ? signal(options.signal) : null,\n    }).then(processDpopNonce);\n}\nfunction validateString(input) {\n    return typeof input === 'string' && input.length !== 0;\n}\nexport async function processDiscoveryResponse(expectedIssuerIdentifier, response) {\n    if (!(expectedIssuerIdentifier instanceof URL)) {\n        throw new TypeError('\"expectedIssuer\" must be an instance of URL');\n    }\n    if (!looseInstanceOf(response, Response)) {\n        throw new TypeError('\"response\" must be an instance of Response');\n    }\n    if (response.status !== 200) {\n        throw new OPE('\"response\" is not a conform Authorization Server Metadata response');\n    }\n    assertReadableResponse(response);\n    let json;\n    try {\n        json = await response.json();\n    }\n    catch (cause) {\n        throw new OPE('failed to parse \"response\" body as JSON', { cause });\n    }\n    if (!isJsonObject(json)) {\n        throw new OPE('\"response\" body must be a top level object');\n    }\n    if (!validateString(json.issuer)) {\n        throw new OPE('\"response\" body \"issuer\" property must be a non-empty string');\n    }\n    if (new URL(json.issuer).href !== expectedIssuerIdentifier.href) {\n        throw new OPE('\"response\" body \"issuer\" does not match \"expectedIssuer\"');\n    }\n    return json;\n}\nfunction randomBytes() {\n    return b64u(crypto.getRandomValues(new Uint8Array(32)));\n}\nexport function generateRandomCodeVerifier() {\n    return randomBytes();\n}\nexport function generateRandomState() {\n    return randomBytes();\n}\nexport function generateRandomNonce() {\n    return randomBytes();\n}\nexport async function calculatePKCECodeChallenge(codeVerifier) {\n    if (!validateString(codeVerifier)) {\n        throw new TypeError('\"codeVerifier\" must be a non-empty string');\n    }\n    return b64u(await crypto.subtle.digest('SHA-256', buf(codeVerifier)));\n}\nfunction getKeyAndKid(input) {\n    if (input instanceof CryptoKey) {\n        return { key: input };\n    }\n    if (!(input?.key instanceof CryptoKey)) {\n        return {};\n    }\n    if (input.kid !== undefined && !validateString(input.kid)) {\n        throw new TypeError('\"kid\" must be a non-empty string');\n    }\n    return {\n        key: input.key,\n        kid: input.kid,\n        modifyAssertion: input[modifyAssertion],\n    };\n}\nfunction formUrlEncode(token) {\n    return encodeURIComponent(token).replace(/%20/g, '+');\n}\nfunction clientSecretBasic(clientId, clientSecret) {\n    const username = formUrlEncode(clientId);\n    const password = formUrlEncode(clientSecret);\n    const credentials = btoa(`${username}:${password}`);\n    return `Basic ${credentials}`;\n}\nfunction psAlg(key) {\n    switch (key.algorithm.hash.name) {\n        case 'SHA-256':\n            return 'PS256';\n        case 'SHA-384':\n            return 'PS384';\n        case 'SHA-512':\n            return 'PS512';\n        default:\n            throw new UnsupportedOperationError('unsupported RsaHashedKeyAlgorithm hash name');\n    }\n}\nfunction rsAlg(key) {\n    switch (key.algorithm.hash.name) {\n        case 'SHA-256':\n            return 'RS256';\n        case 'SHA-384':\n            return 'RS384';\n        case 'SHA-512':\n            return 'RS512';\n        default:\n            throw new UnsupportedOperationError('unsupported RsaHashedKeyAlgorithm hash name');\n    }\n}\nfunction esAlg(key) {\n    switch (key.algorithm.namedCurve) {\n        case 'P-256':\n            return 'ES256';\n        case 'P-384':\n            return 'ES384';\n        case 'P-521':\n            return 'ES512';\n        default:\n            throw new UnsupportedOperationError('unsupported EcKeyAlgorithm namedCurve');\n    }\n}\nfunction keyToJws(key) {\n    switch (key.algorithm.name) {\n        case 'RSA-PSS':\n            return psAlg(key);\n        case 'RSASSA-PKCS1-v1_5':\n            return rsAlg(key);\n        case 'ECDSA':\n            return esAlg(key);\n        case 'Ed25519':\n        case 'Ed448':\n            return 'EdDSA';\n        default:\n            throw new UnsupportedOperationError('unsupported CryptoKey algorithm name');\n    }\n}\nfunction getClockSkew(client) {\n    const skew = client?.[clockSkew];\n    return typeof skew === 'number' && Number.isFinite(skew) ? skew : 0;\n}\nfunction getClockTolerance(client) {\n    const tolerance = client?.[clockTolerance];\n    return typeof tolerance === 'number' && Number.isFinite(tolerance) && Math.sign(tolerance) !== -1\n        ? tolerance\n        : 30;\n}\nfunction epochTime() {\n    return Math.floor(Date.now() / 1000);\n}\nfunction clientAssertion(as, client) {\n    const now = epochTime() + getClockSkew(client);\n    return {\n        jti: randomBytes(),\n        aud: [as.issuer, as.token_endpoint],\n        exp: now + 60,\n        iat: now,\n        nbf: now,\n        iss: client.client_id,\n        sub: client.client_id,\n    };\n}\nasync function privateKeyJwt(as, client, key, kid, modifyAssertion) {\n    const header = { alg: keyToJws(key), kid };\n    const payload = clientAssertion(as, client);\n    modifyAssertion?.(header, payload);\n    return jwt(header, payload, key);\n}\nfunction assertAs(as) {\n    if (typeof as !== 'object' || as === null) {\n        throw new TypeError('\"as\" must be an object');\n    }\n    if (!validateString(as.issuer)) {\n        throw new TypeError('\"as.issuer\" property must be a non-empty string');\n    }\n    return true;\n}\nfunction assertClient(client) {\n    if (typeof client !== 'object' || client === null) {\n        throw new TypeError('\"client\" must be an object');\n    }\n    if (!validateString(client.client_id)) {\n        throw new TypeError('\"client.client_id\" property must be a non-empty string');\n    }\n    return true;\n}\nfunction assertClientSecret(clientSecret) {\n    if (!validateString(clientSecret)) {\n        throw new TypeError('\"client.client_secret\" property must be a non-empty string');\n    }\n    return clientSecret;\n}\nfunction assertNoClientPrivateKey(clientAuthMethod, clientPrivateKey) {\n    if (clientPrivateKey !== undefined) {\n        throw new TypeError(`\"options.clientPrivateKey\" property must not be provided when ${clientAuthMethod} client authentication method is used.`);\n    }\n}\nfunction assertNoClientSecret(clientAuthMethod, clientSecret) {\n    if (clientSecret !== undefined) {\n        throw new TypeError(`\"client.client_secret\" property must not be provided when ${clientAuthMethod} client authentication method is used.`);\n    }\n}\nasync function clientAuthentication(as, client, body, headers, clientPrivateKey) {\n    body.delete('client_secret');\n    body.delete('client_assertion_type');\n    body.delete('client_assertion');\n    switch (client.token_endpoint_auth_method) {\n        case undefined:\n        case 'client_secret_basic': {\n            assertNoClientPrivateKey('client_secret_basic', clientPrivateKey);\n            headers.set('authorization', clientSecretBasic(client.client_id, assertClientSecret(client.client_secret)));\n            break;\n        }\n        case 'client_secret_post': {\n            assertNoClientPrivateKey('client_secret_post', clientPrivateKey);\n            body.set('client_id', client.client_id);\n            body.set('client_secret', assertClientSecret(client.client_secret));\n            break;\n        }\n        case 'private_key_jwt': {\n            assertNoClientSecret('private_key_jwt', client.client_secret);\n            if (clientPrivateKey === undefined) {\n                throw new TypeError('\"options.clientPrivateKey\" must be provided when \"client.token_endpoint_auth_method\" is \"private_key_jwt\"');\n            }\n            const { key, kid, modifyAssertion } = getKeyAndKid(clientPrivateKey);\n            if (!isPrivateKey(key)) {\n                throw new TypeError('\"options.clientPrivateKey.key\" must be a private CryptoKey');\n            }\n            body.set('client_id', client.client_id);\n            body.set('client_assertion_type', 'urn:ietf:params:oauth:client-assertion-type:jwt-bearer');\n            body.set('client_assertion', await privateKeyJwt(as, client, key, kid, modifyAssertion));\n            break;\n        }\n        case 'tls_client_auth':\n        case 'self_signed_tls_client_auth':\n        case 'none': {\n            assertNoClientSecret(client.token_endpoint_auth_method, client.client_secret);\n            assertNoClientPrivateKey(client.token_endpoint_auth_method, clientPrivateKey);\n            body.set('client_id', client.client_id);\n            break;\n        }\n        default:\n            throw new UnsupportedOperationError('unsupported client token_endpoint_auth_method');\n    }\n}\nasync function jwt(header, payload, key) {\n    if (!key.usages.includes('sign')) {\n        throw new TypeError('CryptoKey instances used for signing assertions must include \"sign\" in their \"usages\"');\n    }\n    const input = `${b64u(buf(JSON.stringify(header)))}.${b64u(buf(JSON.stringify(payload)))}`;\n    const signature = b64u(await crypto.subtle.sign(keyToSubtle(key), key, buf(input)));\n    return `${input}.${signature}`;\n}\nexport async function issueRequestObject(as, client, parameters, privateKey) {\n    assertAs(as);\n    assertClient(client);\n    parameters = new URLSearchParams(parameters);\n    const { key, kid, modifyAssertion } = getKeyAndKid(privateKey);\n    if (!isPrivateKey(key)) {\n        throw new TypeError('\"privateKey.key\" must be a private CryptoKey');\n    }\n    parameters.set('client_id', client.client_id);\n    const now = epochTime() + getClockSkew(client);\n    const claims = {\n        ...Object.fromEntries(parameters.entries()),\n        jti: randomBytes(),\n        aud: as.issuer,\n        exp: now + 60,\n        iat: now,\n        nbf: now,\n        iss: client.client_id,\n    };\n    let resource;\n    if (parameters.has('resource') &&\n        (resource = parameters.getAll('resource')) &&\n        resource.length > 1) {\n        claims.resource = resource;\n    }\n    {\n        let value = parameters.get('max_age');\n        if (value !== null) {\n            claims.max_age = parseInt(value, 10);\n            if (!Number.isFinite(claims.max_age)) {\n                throw new OPE('\"max_age\" parameter must be a number');\n            }\n        }\n    }\n    {\n        let value = parameters.get('claims');\n        if (value !== null) {\n            try {\n                claims.claims = JSON.parse(value);\n            }\n            catch (cause) {\n                throw new OPE('failed to parse the \"claims\" parameter as JSON', { cause });\n            }\n            if (!isJsonObject(claims.claims)) {\n                throw new OPE('\"claims\" parameter must be a JSON with a top level object');\n            }\n        }\n    }\n    {\n        let value = parameters.get('authorization_details');\n        if (value !== null) {\n            try {\n                claims.authorization_details = JSON.parse(value);\n            }\n            catch (cause) {\n                throw new OPE('failed to parse the \"authorization_details\" parameter as JSON', { cause });\n            }\n            if (!Array.isArray(claims.authorization_details)) {\n                throw new OPE('\"authorization_details\" parameter must be a JSON with a top level array');\n            }\n        }\n    }\n    const header = {\n        alg: keyToJws(key),\n        typ: 'oauth-authz-req+jwt',\n        kid,\n    };\n    modifyAssertion?.(header, claims);\n    return jwt(header, claims, key);\n}\nasync function dpopProofJwt(headers, options, url, htm, clockSkew, accessToken) {\n    const { privateKey, publicKey, nonce = dpopNonces.get(url.origin) } = options;\n    if (!isPrivateKey(privateKey)) {\n        throw new TypeError('\"DPoP.privateKey\" must be a private CryptoKey');\n    }\n    if (!isPublicKey(publicKey)) {\n        throw new TypeError('\"DPoP.publicKey\" must be a public CryptoKey');\n    }\n    if (nonce !== undefined && !validateString(nonce)) {\n        throw new TypeError('\"DPoP.nonce\" must be a non-empty string or undefined');\n    }\n    if (!publicKey.extractable) {\n        throw new TypeError('\"DPoP.publicKey.extractable\" must be true');\n    }\n    const now = epochTime() + clockSkew;\n    const header = {\n        alg: keyToJws(privateKey),\n        typ: 'dpop+jwt',\n        jwk: await publicJwk(publicKey),\n    };\n    const payload = {\n        iat: now,\n        jti: randomBytes(),\n        htm,\n        nonce,\n        htu: `${url.origin}${url.pathname}`,\n        ath: accessToken ? b64u(await crypto.subtle.digest('SHA-256', buf(accessToken))) : undefined,\n    };\n    options[modifyAssertion]?.(header, payload);\n    headers.set('dpop', await jwt(header, payload, privateKey));\n}\nlet jwkCache;\nasync function getSetPublicJwkCache(key) {\n    const { kty, e, n, x, y, crv } = await crypto.subtle.exportKey('jwk', key);\n    const jwk = { kty, e, n, x, y, crv };\n    jwkCache.set(key, jwk);\n    return jwk;\n}\nasync function publicJwk(key) {\n    jwkCache || (jwkCache = new WeakMap());\n    return jwkCache.get(key) || getSetPublicJwkCache(key);\n}\nfunction validateEndpoint(value, endpoint, useMtlsAlias) {\n    if (typeof value !== 'string') {\n        if (useMtlsAlias) {\n            throw new TypeError(`\"as.mtls_endpoint_aliases.${endpoint}\" must be a string`);\n        }\n        throw new TypeError(`\"as.${endpoint}\" must be a string`);\n    }\n    return new URL(value);\n}\nfunction resolveEndpoint(as, endpoint, useMtlsAlias = false) {\n    if (useMtlsAlias && as.mtls_endpoint_aliases && endpoint in as.mtls_endpoint_aliases) {\n        return validateEndpoint(as.mtls_endpoint_aliases[endpoint], endpoint, useMtlsAlias);\n    }\n    return validateEndpoint(as[endpoint], endpoint, useMtlsAlias);\n}\nfunction alias(client, options) {\n    if (client.use_mtls_endpoint_aliases || options?.[useMtlsAlias]) {\n        return true;\n    }\n    return false;\n}\nexport async function pushedAuthorizationRequest(as, client, parameters, options) {\n    assertAs(as);\n    assertClient(client);\n    const url = resolveEndpoint(as, 'pushed_authorization_request_endpoint', alias(client, options));\n    const body = new URLSearchParams(parameters);\n    body.set('client_id', client.client_id);\n    const headers = prepareHeaders(options?.headers);\n    headers.set('accept', 'application/json');\n    if (options?.DPoP !== undefined) {\n        await dpopProofJwt(headers, options.DPoP, url, 'POST', getClockSkew(client));\n    }\n    return authenticatedRequest(as, client, 'POST', url, body, headers, options);\n}\nexport function isOAuth2Error(input) {\n    const value = input;\n    if (typeof value !== 'object' || Array.isArray(value) || value === null) {\n        return false;\n    }\n    return value.error !== undefined;\n}\nfunction unquote(value) {\n    if (value.length >= 2 && value[0] === '\"' && value[value.length - 1] === '\"') {\n        return value.slice(1, -1);\n    }\n    return value;\n}\nconst SPLIT_REGEXP = /((?:,|, )?[0-9a-zA-Z!#$%&'*+-.^_`|~]+=)/;\nconst SCHEMES_REGEXP = /(?:^|, ?)([0-9a-zA-Z!#$%&'*+\\-.^_`|~]+)(?=$|[ ,])/g;\nfunction wwwAuth(scheme, params) {\n    const arr = params.split(SPLIT_REGEXP).slice(1);\n    if (!arr.length) {\n        return { scheme: scheme.toLowerCase(), parameters: {} };\n    }\n    arr[arr.length - 1] = arr[arr.length - 1].replace(/,$/, '');\n    const parameters = {};\n    for (let i = 1; i < arr.length; i += 2) {\n        const idx = i;\n        if (arr[idx][0] === '\"') {\n            while (arr[idx].slice(-1) !== '\"' && ++i < arr.length) {\n                arr[idx] += arr[i];\n            }\n        }\n        const key = arr[idx - 1].replace(/^(?:, ?)|=$/g, '').toLowerCase();\n        parameters[key] = unquote(arr[idx]);\n    }\n    return {\n        scheme: scheme.toLowerCase(),\n        parameters,\n    };\n}\nexport function parseWwwAuthenticateChallenges(response) {\n    if (!looseInstanceOf(response, Response)) {\n        throw new TypeError('\"response\" must be an instance of Response');\n    }\n    const header = response.headers.get('www-authenticate');\n    if (header === null) {\n        return undefined;\n    }\n    const result = [];\n    for (const { 1: scheme, index } of header.matchAll(SCHEMES_REGEXP)) {\n        result.push([scheme, index]);\n    }\n    if (!result.length) {\n        return undefined;\n    }\n    const challenges = result.map(([scheme, indexOf], i, others) => {\n        const next = others[i + 1];\n        let parameters;\n        if (next) {\n            parameters = header.slice(indexOf, next[1]);\n        }\n        else {\n            parameters = header.slice(indexOf);\n        }\n        return wwwAuth(scheme, parameters);\n    });\n    return challenges;\n}\nexport async function processPushedAuthorizationResponse(as, client, response) {\n    assertAs(as);\n    assertClient(client);\n    if (!looseInstanceOf(response, Response)) {\n        throw new TypeError('\"response\" must be an instance of Response');\n    }\n    if (response.status !== 201) {\n        let err;\n        if ((err = await handleOAuthBodyError(response))) {\n            return err;\n        }\n        throw new OPE('\"response\" is not a conform Pushed Authorization Request Endpoint response');\n    }\n    assertReadableResponse(response);\n    let json;\n    try {\n        json = await response.json();\n    }\n    catch (cause) {\n        throw new OPE('failed to parse \"response\" body as JSON', { cause });\n    }\n    if (!isJsonObject(json)) {\n        throw new OPE('\"response\" body must be a top level object');\n    }\n    if (!validateString(json.request_uri)) {\n        throw new OPE('\"response\" body \"request_uri\" property must be a non-empty string');\n    }\n    if (typeof json.expires_in !== 'number' || json.expires_in <= 0) {\n        throw new OPE('\"response\" body \"expires_in\" property must be a positive number');\n    }\n    return json;\n}\nexport async function protectedResourceRequest(accessToken, method, url, headers, body, options) {\n    if (!validateString(accessToken)) {\n        throw new TypeError('\"accessToken\" must be a non-empty string');\n    }\n    if (!(url instanceof URL)) {\n        throw new TypeError('\"url\" must be an instance of URL');\n    }\n    headers = prepareHeaders(headers);\n    if (options?.DPoP === undefined) {\n        headers.set('authorization', `Bearer ${accessToken}`);\n    }\n    else {\n        await dpopProofJwt(headers, options.DPoP, url, method.toUpperCase(), getClockSkew({ [clockSkew]: options?.[clockSkew] }), accessToken);\n        headers.set('authorization', `DPoP ${accessToken}`);\n    }\n    return (options?.[customFetch] || fetch)(url.href, {\n        body,\n        headers: Object.fromEntries(headers.entries()),\n        method,\n        redirect: 'manual',\n        signal: options?.signal ? signal(options.signal) : null,\n    }).then(processDpopNonce);\n}\nexport async function userInfoRequest(as, client, accessToken, options) {\n    assertAs(as);\n    assertClient(client);\n    const url = resolveEndpoint(as, 'userinfo_endpoint', alias(client, options));\n    const headers = prepareHeaders(options?.headers);\n    if (client.userinfo_signed_response_alg) {\n        headers.set('accept', 'application/jwt');\n    }\n    else {\n        headers.set('accept', 'application/json');\n        headers.append('accept', 'application/jwt');\n    }\n    return protectedResourceRequest(accessToken, 'GET', url, headers, null, {\n        ...options,\n        [clockSkew]: getClockSkew(client),\n    });\n}\nlet jwksMap;\nfunction setJwksCache(as, jwks, uat, cache) {\n    jwksMap || (jwksMap = new WeakMap());\n    jwksMap.set(as, {\n        jwks,\n        uat,\n        get age() {\n            return epochTime() - this.uat;\n        },\n    });\n    if (cache) {\n        Object.assign(cache, { jwks: structuredClone(jwks), uat });\n    }\n}\nfunction isFreshJwksCache(input) {\n    if (typeof input !== 'object' || input === null) {\n        return false;\n    }\n    if (!('uat' in input) || typeof input.uat !== 'number' || epochTime() - input.uat >= 300) {\n        return false;\n    }\n    if (!('jwks' in input) ||\n        !isJsonObject(input.jwks) ||\n        !Array.isArray(input.jwks.keys) ||\n        !Array.prototype.every.call(input.jwks.keys, isJsonObject)) {\n        return false;\n    }\n    return true;\n}\nfunction clearJwksCache(as, cache) {\n    jwksMap?.delete(as);\n    delete cache?.jwks;\n    delete cache?.uat;\n}\nasync function getPublicSigKeyFromIssuerJwksUri(as, options, header) {\n    const { alg, kid } = header;\n    checkSupportedJwsAlg(alg);\n    if (!jwksMap?.has(as) && isFreshJwksCache(options?.[jwksCache])) {\n        setJwksCache(as, options?.[jwksCache].jwks, options?.[jwksCache].uat);\n    }\n    let jwks;\n    let age;\n    if (jwksMap?.has(as)) {\n        ;\n        ({ jwks, age } = jwksMap.get(as));\n        if (age >= 300) {\n            clearJwksCache(as, options?.[jwksCache]);\n            return getPublicSigKeyFromIssuerJwksUri(as, options, header);\n        }\n    }\n    else {\n        jwks = await jwksRequest(as, options).then(processJwksResponse);\n        age = 0;\n        setJwksCache(as, jwks, epochTime(), options?.[jwksCache]);\n    }\n    let kty;\n    switch (alg.slice(0, 2)) {\n        case 'RS':\n        case 'PS':\n            kty = 'RSA';\n            break;\n        case 'ES':\n            kty = 'EC';\n            break;\n        case 'Ed':\n            kty = 'OKP';\n            break;\n        default:\n            throw new UnsupportedOperationError();\n    }\n    const candidates = jwks.keys.filter((jwk) => {\n        if (jwk.kty !== kty) {\n            return false;\n        }\n        if (kid !== undefined && kid !== jwk.kid) {\n            return false;\n        }\n        if (jwk.alg !== undefined && alg !== jwk.alg) {\n            return false;\n        }\n        if (jwk.use !== undefined && jwk.use !== 'sig') {\n            return false;\n        }\n        if (jwk.key_ops?.includes('verify') === false) {\n            return false;\n        }\n        switch (true) {\n            case alg === 'ES256' && jwk.crv !== 'P-256':\n            case alg === 'ES384' && jwk.crv !== 'P-384':\n            case alg === 'ES512' && jwk.crv !== 'P-521':\n            case alg === 'EdDSA' && !(jwk.crv === 'Ed25519' || jwk.crv === 'Ed448'):\n                return false;\n        }\n        return true;\n    });\n    const { 0: jwk, length } = candidates;\n    if (!length) {\n        if (age >= 60) {\n            clearJwksCache(as, options?.[jwksCache]);\n            return getPublicSigKeyFromIssuerJwksUri(as, options, header);\n        }\n        throw new OPE('error when selecting a JWT verification key, no applicable keys found');\n    }\n    if (length !== 1) {\n        throw new OPE('error when selecting a JWT verification key, multiple applicable keys found, a \"kid\" JWT Header Parameter is required');\n    }\n    const key = await importJwk(alg, jwk);\n    if (key.type !== 'public') {\n        throw new OPE('jwks_uri must only contain public keys');\n    }\n    return key;\n}\nexport const skipSubjectCheck = Symbol();\nfunction getContentType(response) {\n    return response.headers.get('content-type')?.split(';')[0];\n}\nexport async function processUserInfoResponse(as, client, expectedSubject, response) {\n    assertAs(as);\n    assertClient(client);\n    if (!looseInstanceOf(response, Response)) {\n        throw new TypeError('\"response\" must be an instance of Response');\n    }\n    if (response.status !== 200) {\n        throw new OPE('\"response\" is not a conform UserInfo Endpoint response');\n    }\n    let json;\n    if (getContentType(response) === 'application/jwt') {\n        assertReadableResponse(response);\n        const { claims, jwt } = await validateJwt(await response.text(), checkSigningAlgorithm.bind(undefined, client.userinfo_signed_response_alg, as.userinfo_signing_alg_values_supported), noSignatureCheck, getClockSkew(client), getClockTolerance(client), client[jweDecrypt])\n            .then(validateOptionalAudience.bind(undefined, client.client_id))\n            .then(validateOptionalIssuer.bind(undefined, as.issuer));\n        jwtResponseBodies.set(response, jwt);\n        json = claims;\n    }\n    else {\n        if (client.userinfo_signed_response_alg) {\n            throw new OPE('JWT UserInfo Response expected');\n        }\n        assertReadableResponse(response);\n        try {\n            json = await response.json();\n        }\n        catch (cause) {\n            throw new OPE('failed to parse \"response\" body as JSON', { cause });\n        }\n    }\n    if (!isJsonObject(json)) {\n        throw new OPE('\"response\" body must be a top level object');\n    }\n    if (!validateString(json.sub)) {\n        throw new OPE('\"response\" body \"sub\" property must be a non-empty string');\n    }\n    switch (expectedSubject) {\n        case skipSubjectCheck:\n            break;\n        default:\n            if (!validateString(expectedSubject)) {\n                throw new OPE('\"expectedSubject\" must be a non-empty string');\n            }\n            if (json.sub !== expectedSubject) {\n                throw new OPE('unexpected \"response\" body \"sub\" value');\n            }\n    }\n    return json;\n}\nasync function authenticatedRequest(as, client, method, url, body, headers, options) {\n    await clientAuthentication(as, client, body, headers, options?.clientPrivateKey);\n    headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');\n    return (options?.[customFetch] || fetch)(url.href, {\n        body,\n        headers: Object.fromEntries(headers.entries()),\n        method,\n        redirect: 'manual',\n        signal: options?.signal ? signal(options.signal) : null,\n    }).then(processDpopNonce);\n}\nasync function tokenEndpointRequest(as, client, grantType, parameters, options) {\n    const url = resolveEndpoint(as, 'token_endpoint', alias(client, options));\n    parameters.set('grant_type', grantType);\n    const headers = prepareHeaders(options?.headers);\n    headers.set('accept', 'application/json');\n    if (options?.DPoP !== undefined) {\n        await dpopProofJwt(headers, options.DPoP, url, 'POST', getClockSkew(client));\n    }\n    return authenticatedRequest(as, client, 'POST', url, parameters, headers, options);\n}\nexport async function refreshTokenGrantRequest(as, client, refreshToken, options) {\n    assertAs(as);\n    assertClient(client);\n    if (!validateString(refreshToken)) {\n        throw new TypeError('\"refreshToken\" must be a non-empty string');\n    }\n    const parameters = new URLSearchParams(options?.additionalParameters);\n    parameters.set('refresh_token', refreshToken);\n    return tokenEndpointRequest(as, client, 'refresh_token', parameters, options);\n}\nconst idTokenClaims = new WeakMap();\nconst jwtResponseBodies = new WeakMap();\nexport function getValidatedIdTokenClaims(ref) {\n    if (!ref.id_token) {\n        return undefined;\n    }\n    const claims = idTokenClaims.get(ref);\n    if (!claims) {\n        throw new TypeError('\"ref\" was already garbage collected or did not resolve from the proper sources');\n    }\n    return claims[0];\n}\nexport async function validateIdTokenSignature(as, ref, options) {\n    assertAs(as);\n    if (!idTokenClaims.has(ref)) {\n        throw new OPE('\"ref\" does not contain an ID Token to verify the signature of');\n    }\n    const { 0: protectedHeader, 1: payload, 2: encodedSignature, } = idTokenClaims.get(ref)[1].split('.');\n    const header = JSON.parse(buf(b64u(protectedHeader)));\n    if (header.alg.startsWith('HS')) {\n        throw new UnsupportedOperationError();\n    }\n    let key;\n    key = await getPublicSigKeyFromIssuerJwksUri(as, options, header);\n    await validateJwsSignature(protectedHeader, payload, key, b64u(encodedSignature));\n}\nasync function validateJwtResponseSignature(as, ref, options) {\n    assertAs(as);\n    if (!jwtResponseBodies.has(ref)) {\n        throw new OPE('\"ref\" does not contain a processed JWT Response to verify the signature of');\n    }\n    const { 0: protectedHeader, 1: payload, 2: encodedSignature, } = jwtResponseBodies.get(ref).split('.');\n    const header = JSON.parse(buf(b64u(protectedHeader)));\n    if (header.alg.startsWith('HS')) {\n        throw new UnsupportedOperationError();\n    }\n    let key;\n    key = await getPublicSigKeyFromIssuerJwksUri(as, options, header);\n    await validateJwsSignature(protectedHeader, payload, key, b64u(encodedSignature));\n}\nexport function validateJwtUserInfoSignature(as, ref, options) {\n    return validateJwtResponseSignature(as, ref, options);\n}\nexport function validateJwtIntrospectionSignature(as, ref, options) {\n    return validateJwtResponseSignature(as, ref, options);\n}\nasync function processGenericAccessTokenResponse(as, client, response, ignoreIdToken = false, ignoreRefreshToken = false) {\n    assertAs(as);\n    assertClient(client);\n    if (!looseInstanceOf(response, Response)) {\n        throw new TypeError('\"response\" must be an instance of Response');\n    }\n    if (response.status !== 200) {\n        let err;\n        if ((err = await handleOAuthBodyError(response))) {\n            return err;\n        }\n        throw new OPE('\"response\" is not a conform Token Endpoint response');\n    }\n    assertReadableResponse(response);\n    let json;\n    try {\n        json = await response.json();\n    }\n    catch (cause) {\n        throw new OPE('failed to parse \"response\" body as JSON', { cause });\n    }\n    if (!isJsonObject(json)) {\n        throw new OPE('\"response\" body must be a top level object');\n    }\n    if (!validateString(json.access_token)) {\n        throw new OPE('\"response\" body \"access_token\" property must be a non-empty string');\n    }\n    if (!validateString(json.token_type)) {\n        throw new OPE('\"response\" body \"token_type\" property must be a non-empty string');\n    }\n    json.token_type = json.token_type.toLowerCase();\n    if (json.token_type !== 'dpop' && json.token_type !== 'bearer') {\n        throw new UnsupportedOperationError('unsupported `token_type` value');\n    }\n    if (json.expires_in !== undefined &&\n        (typeof json.expires_in !== 'number' || json.expires_in <= 0)) {\n        throw new OPE('\"response\" body \"expires_in\" property must be a positive number');\n    }\n    if (!ignoreRefreshToken &&\n        json.refresh_token !== undefined &&\n        !validateString(json.refresh_token)) {\n        throw new OPE('\"response\" body \"refresh_token\" property must be a non-empty string');\n    }\n    if (json.scope !== undefined && typeof json.scope !== 'string') {\n        throw new OPE('\"response\" body \"scope\" property must be a string');\n    }\n    if (!ignoreIdToken) {\n        if (json.id_token !== undefined && !validateString(json.id_token)) {\n            throw new OPE('\"response\" body \"id_token\" property must be a non-empty string');\n        }\n        if (json.id_token) {\n            const { claims, jwt } = await validateJwt(json.id_token, checkSigningAlgorithm.bind(undefined, client.id_token_signed_response_alg, as.id_token_signing_alg_values_supported), noSignatureCheck, getClockSkew(client), getClockTolerance(client), client[jweDecrypt])\n                .then(validatePresence.bind(undefined, ['aud', 'exp', 'iat', 'iss', 'sub']))\n                .then(validateIssuer.bind(undefined, as.issuer))\n                .then(validateAudience.bind(undefined, client.client_id));\n            if (Array.isArray(claims.aud) && claims.aud.length !== 1) {\n                if (claims.azp === undefined) {\n                    throw new OPE('ID Token \"aud\" (audience) claim includes additional untrusted audiences');\n                }\n                if (claims.azp !== client.client_id) {\n                    throw new OPE('unexpected ID Token \"azp\" (authorized party) claim value');\n                }\n            }\n            if (claims.auth_time !== undefined &&\n                (!Number.isFinite(claims.auth_time) || Math.sign(claims.auth_time) !== 1)) {\n                throw new OPE('ID Token \"auth_time\" (authentication time) must be a positive number');\n            }\n            idTokenClaims.set(json, [claims, jwt]);\n        }\n    }\n    return json;\n}\nexport async function processRefreshTokenResponse(as, client, response) {\n    return processGenericAccessTokenResponse(as, client, response);\n}\nfunction validateOptionalAudience(expected, result) {\n    if (result.claims.aud !== undefined) {\n        return validateAudience(expected, result);\n    }\n    return result;\n}\nfunction validateAudience(expected, result) {\n    if (Array.isArray(result.claims.aud)) {\n        if (!result.claims.aud.includes(expected)) {\n            throw new OPE('unexpected JWT \"aud\" (audience) claim value');\n        }\n    }\n    else if (result.claims.aud !== expected) {\n        throw new OPE('unexpected JWT \"aud\" (audience) claim value');\n    }\n    return result;\n}\nfunction validateOptionalIssuer(expected, result) {\n    if (result.claims.iss !== undefined) {\n        return validateIssuer(expected, result);\n    }\n    return result;\n}\nfunction validateIssuer(expected, result) {\n    if (result.claims.iss !== expected) {\n        throw new OPE('unexpected JWT \"iss\" (issuer) claim value');\n    }\n    return result;\n}\nconst branded = new WeakSet();\nfunction brand(searchParams) {\n    branded.add(searchParams);\n    return searchParams;\n}\nexport async function authorizationCodeGrantRequest(as, client, callbackParameters, redirectUri, codeVerifier, options) {\n    assertAs(as);\n    assertClient(client);\n    if (!branded.has(callbackParameters)) {\n        throw new TypeError('\"callbackParameters\" must be an instance of URLSearchParams obtained from \"validateAuthResponse()\", or \"validateJwtAuthResponse()');\n    }\n    if (!validateString(redirectUri)) {\n        throw new TypeError('\"redirectUri\" must be a non-empty string');\n    }\n    if (!validateString(codeVerifier)) {\n        throw new TypeError('\"codeVerifier\" must be a non-empty string');\n    }\n    const code = getURLSearchParameter(callbackParameters, 'code');\n    if (!code) {\n        throw new OPE('no authorization code in \"callbackParameters\"');\n    }\n    const parameters = new URLSearchParams(options?.additionalParameters);\n    parameters.set('redirect_uri', redirectUri);\n    parameters.set('code_verifier', codeVerifier);\n    parameters.set('code', code);\n    return tokenEndpointRequest(as, client, 'authorization_code', parameters, options);\n}\nconst jwtClaimNames = {\n    aud: 'audience',\n    c_hash: 'code hash',\n    client_id: 'client id',\n    exp: 'expiration time',\n    iat: 'issued at',\n    iss: 'issuer',\n    jti: 'jwt id',\n    nonce: 'nonce',\n    s_hash: 'state hash',\n    sub: 'subject',\n    ath: 'access token hash',\n    htm: 'http method',\n    htu: 'http uri',\n    cnf: 'confirmation',\n};\nfunction validatePresence(required, result) {\n    for (const claim of required) {\n        if (result.claims[claim] === undefined) {\n            throw new OPE(`JWT \"${claim}\" (${jwtClaimNames[claim]}) claim missing`);\n        }\n    }\n    return result;\n}\nexport const expectNoNonce = Symbol();\nexport const skipAuthTimeCheck = Symbol();\nexport async function processAuthorizationCodeOpenIDResponse(as, client, response, expectedNonce, maxAge) {\n    const result = await processGenericAccessTokenResponse(as, client, response);\n    if (isOAuth2Error(result)) {\n        return result;\n    }\n    if (!validateString(result.id_token)) {\n        throw new OPE('\"response\" body \"id_token\" property must be a non-empty string');\n    }\n    maxAge ?? (maxAge = client.default_max_age ?? skipAuthTimeCheck);\n    const claims = getValidatedIdTokenClaims(result);\n    if ((client.require_auth_time || maxAge !== skipAuthTimeCheck) &&\n        claims.auth_time === undefined) {\n        throw new OPE('ID Token \"auth_time\" (authentication time) claim missing');\n    }\n    if (maxAge !== skipAuthTimeCheck) {\n        if (typeof maxAge !== 'number' || maxAge < 0) {\n            throw new TypeError('\"maxAge\" must be a non-negative number');\n        }\n        const now = epochTime() + getClockSkew(client);\n        const tolerance = getClockTolerance(client);\n        if (claims.auth_time + maxAge < now - tolerance) {\n            throw new OPE('too much time has elapsed since the last End-User authentication');\n        }\n    }\n    switch (expectedNonce) {\n        case undefined:\n        case expectNoNonce:\n            if (claims.nonce !== undefined) {\n                throw new OPE('unexpected ID Token \"nonce\" claim value');\n            }\n            break;\n        default:\n            if (!validateString(expectedNonce)) {\n                throw new TypeError('\"expectedNonce\" must be a non-empty string');\n            }\n            if (claims.nonce === undefined) {\n                throw new OPE('ID Token \"nonce\" claim missing');\n            }\n            if (claims.nonce !== expectedNonce) {\n                throw new OPE('unexpected ID Token \"nonce\" claim value');\n            }\n    }\n    return result;\n}\nexport async function processAuthorizationCodeOAuth2Response(as, client, response) {\n    const result = await processGenericAccessTokenResponse(as, client, response, true);\n    if (isOAuth2Error(result)) {\n        return result;\n    }\n    if (result.id_token !== undefined) {\n        if (typeof result.id_token === 'string' && result.id_token.length) {\n            throw new OPE('Unexpected ID Token returned, use processAuthorizationCodeOpenIDResponse() for OpenID Connect callback processing');\n        }\n        delete result.id_token;\n    }\n    return result;\n}\nfunction checkJwtType(expected, result) {\n    if (typeof result.header.typ !== 'string' || normalizeTyp(result.header.typ) !== expected) {\n        throw new OPE('unexpected JWT \"typ\" header parameter value');\n    }\n    return result;\n}\nexport async function clientCredentialsGrantRequest(as, client, parameters, options) {\n    assertAs(as);\n    assertClient(client);\n    return tokenEndpointRequest(as, client, 'client_credentials', new URLSearchParams(parameters), options);\n}\nexport async function genericTokenEndpointRequest(as, client, grantType, parameters, options) {\n    assertAs(as);\n    assertClient(client);\n    if (!validateString(grantType)) {\n        throw new TypeError('\"grantType\" must be a non-empty string');\n    }\n    return tokenEndpointRequest(as, client, grantType, new URLSearchParams(parameters), options);\n}\nexport async function processClientCredentialsResponse(as, client, response) {\n    const result = await processGenericAccessTokenResponse(as, client, response, true, true);\n    if (isOAuth2Error(result)) {\n        return result;\n    }\n    return result;\n}\nexport async function revocationRequest(as, client, token, options) {\n    assertAs(as);\n    assertClient(client);\n    if (!validateString(token)) {\n        throw new TypeError('\"token\" must be a non-empty string');\n    }\n    const url = resolveEndpoint(as, 'revocation_endpoint', alias(client, options));\n    const body = new URLSearchParams(options?.additionalParameters);\n    body.set('token', token);\n    const headers = prepareHeaders(options?.headers);\n    headers.delete('accept');\n    return authenticatedRequest(as, client, 'POST', url, body, headers, options);\n}\nexport async function processRevocationResponse(response) {\n    if (!looseInstanceOf(response, Response)) {\n        throw new TypeError('\"response\" must be an instance of Response');\n    }\n    if (response.status !== 200) {\n        let err;\n        if ((err = await handleOAuthBodyError(response))) {\n            return err;\n        }\n        throw new OPE('\"response\" is not a conform Revocation Endpoint response');\n    }\n    return undefined;\n}\nfunction assertReadableResponse(response) {\n    if (response.bodyUsed) {\n        throw new TypeError('\"response\" body has been used already');\n    }\n}\nexport async function introspectionRequest(as, client, token, options) {\n    assertAs(as);\n    assertClient(client);\n    if (!validateString(token)) {\n        throw new TypeError('\"token\" must be a non-empty string');\n    }\n    const url = resolveEndpoint(as, 'introspection_endpoint', alias(client, options));\n    const body = new URLSearchParams(options?.additionalParameters);\n    body.set('token', token);\n    const headers = prepareHeaders(options?.headers);\n    if (options?.requestJwtResponse ?? client.introspection_signed_response_alg) {\n        headers.set('accept', 'application/token-introspection+jwt');\n    }\n    else {\n        headers.set('accept', 'application/json');\n    }\n    return authenticatedRequest(as, client, 'POST', url, body, headers, options);\n}\nexport async function processIntrospectionResponse(as, client, response) {\n    assertAs(as);\n    assertClient(client);\n    if (!looseInstanceOf(response, Response)) {\n        throw new TypeError('\"response\" must be an instance of Response');\n    }\n    if (response.status !== 200) {\n        let err;\n        if ((err = await handleOAuthBodyError(response))) {\n            return err;\n        }\n        throw new OPE('\"response\" is not a conform Introspection Endpoint response');\n    }\n    let json;\n    if (getContentType(response) === 'application/token-introspection+jwt') {\n        assertReadableResponse(response);\n        const { claims, jwt } = await validateJwt(await response.text(), checkSigningAlgorithm.bind(undefined, client.introspection_signed_response_alg, as.introspection_signing_alg_values_supported), noSignatureCheck, getClockSkew(client), getClockTolerance(client), client[jweDecrypt])\n            .then(checkJwtType.bind(undefined, 'token-introspection+jwt'))\n            .then(validatePresence.bind(undefined, ['aud', 'iat', 'iss']))\n            .then(validateIssuer.bind(undefined, as.issuer))\n            .then(validateAudience.bind(undefined, client.client_id));\n        jwtResponseBodies.set(response, jwt);\n        json = claims.token_introspection;\n        if (!isJsonObject(json)) {\n            throw new OPE('JWT \"token_introspection\" claim must be a JSON object');\n        }\n    }\n    else {\n        assertReadableResponse(response);\n        try {\n            json = await response.json();\n        }\n        catch (cause) {\n            throw new OPE('failed to parse \"response\" body as JSON', { cause });\n        }\n        if (!isJsonObject(json)) {\n            throw new OPE('\"response\" body must be a top level object');\n        }\n    }\n    if (typeof json.active !== 'boolean') {\n        throw new OPE('\"response\" body \"active\" property must be a boolean');\n    }\n    return json;\n}\nasync function jwksRequest(as, options) {\n    assertAs(as);\n    const url = resolveEndpoint(as, 'jwks_uri');\n    const headers = prepareHeaders(options?.headers);\n    headers.set('accept', 'application/json');\n    headers.append('accept', 'application/jwk-set+json');\n    return (options?.[customFetch] || fetch)(url.href, {\n        headers: Object.fromEntries(headers.entries()),\n        method: 'GET',\n        redirect: 'manual',\n        signal: options?.signal ? signal(options.signal) : null,\n    }).then(processDpopNonce);\n}\nasync function processJwksResponse(response) {\n    if (!looseInstanceOf(response, Response)) {\n        throw new TypeError('\"response\" must be an instance of Response');\n    }\n    if (response.status !== 200) {\n        throw new OPE('\"response\" is not a conform JSON Web Key Set response');\n    }\n    assertReadableResponse(response);\n    let json;\n    try {\n        json = await response.json();\n    }\n    catch (cause) {\n        throw new OPE('failed to parse \"response\" body as JSON', { cause });\n    }\n    if (!isJsonObject(json)) {\n        throw new OPE('\"response\" body must be a top level object');\n    }\n    if (!Array.isArray(json.keys)) {\n        throw new OPE('\"response\" body \"keys\" property must be an array');\n    }\n    if (!Array.prototype.every.call(json.keys, isJsonObject)) {\n        throw new OPE('\"response\" body \"keys\" property members must be JWK formatted objects');\n    }\n    return json;\n}\nasync function handleOAuthBodyError(response) {\n    if (response.status > 399 && response.status < 500) {\n        assertReadableResponse(response);\n        try {\n            const json = await response.json();\n            if (isJsonObject(json) && typeof json.error === 'string' && json.error.length) {\n                if (json.error_description !== undefined && typeof json.error_description !== 'string') {\n                    delete json.error_description;\n                }\n                if (json.error_uri !== undefined && typeof json.error_uri !== 'string') {\n                    delete json.error_uri;\n                }\n                if (json.algs !== undefined && typeof json.algs !== 'string') {\n                    delete json.algs;\n                }\n                if (json.scope !== undefined && typeof json.scope !== 'string') {\n                    delete json.scope;\n                }\n                return json;\n            }\n        }\n        catch { }\n    }\n    return undefined;\n}\nfunction checkSupportedJwsAlg(alg) {\n    if (!SUPPORTED_JWS_ALGS.includes(alg)) {\n        throw new UnsupportedOperationError('unsupported JWS \"alg\" identifier');\n    }\n    return alg;\n}\nfunction checkRsaKeyAlgorithm(algorithm) {\n    if (typeof algorithm.modulusLength !== 'number' || algorithm.modulusLength < 2048) {\n        throw new OPE(`${algorithm.name} modulusLength must be at least 2048 bits`);\n    }\n}\nfunction ecdsaHashName(namedCurve) {\n    switch (namedCurve) {\n        case 'P-256':\n            return 'SHA-256';\n        case 'P-384':\n            return 'SHA-384';\n        case 'P-521':\n            return 'SHA-512';\n        default:\n            throw new UnsupportedOperationError();\n    }\n}\nfunction keyToSubtle(key) {\n    switch (key.algorithm.name) {\n        case 'ECDSA':\n            return {\n                name: key.algorithm.name,\n                hash: ecdsaHashName(key.algorithm.namedCurve),\n            };\n        case 'RSA-PSS': {\n            checkRsaKeyAlgorithm(key.algorithm);\n            switch (key.algorithm.hash.name) {\n                case 'SHA-256':\n                case 'SHA-384':\n                case 'SHA-512':\n                    return {\n                        name: key.algorithm.name,\n                        saltLength: parseInt(key.algorithm.hash.name.slice(-3), 10) >> 3,\n                    };\n                default:\n                    throw new UnsupportedOperationError();\n            }\n        }\n        case 'RSASSA-PKCS1-v1_5':\n            checkRsaKeyAlgorithm(key.algorithm);\n            return key.algorithm.name;\n        case 'Ed448':\n        case 'Ed25519':\n            return key.algorithm.name;\n    }\n    throw new UnsupportedOperationError();\n}\nconst noSignatureCheck = Symbol();\nasync function validateJwsSignature(protectedHeader, payload, key, signature) {\n    const input = `${protectedHeader}.${payload}`;\n    const verified = await crypto.subtle.verify(keyToSubtle(key), key, signature, buf(input));\n    if (!verified) {\n        throw new OPE('JWT signature verification failed');\n    }\n}\nasync function validateJwt(jws, checkAlg, getKey, clockSkew, clockTolerance, decryptJwt) {\n    let { 0: protectedHeader, 1: payload, 2: encodedSignature, length } = jws.split('.');\n    if (length === 5) {\n        if (decryptJwt !== undefined) {\n            jws = await decryptJwt(jws);\n            ({ 0: protectedHeader, 1: payload, 2: encodedSignature, length } = jws.split('.'));\n        }\n        else {\n            throw new UnsupportedOperationError('JWE structure JWTs are not supported');\n        }\n    }\n    if (length !== 3) {\n        throw new OPE('Invalid JWT');\n    }\n    let header;\n    try {\n        header = JSON.parse(buf(b64u(protectedHeader)));\n    }\n    catch (cause) {\n        throw new OPE('failed to parse JWT Header body as base64url encoded JSON', { cause });\n    }\n    if (!isJsonObject(header)) {\n        throw new OPE('JWT Header must be a top level object');\n    }\n    checkAlg(header);\n    if (header.crit !== undefined) {\n        throw new OPE('unexpected JWT \"crit\" header parameter');\n    }\n    const signature = b64u(encodedSignature);\n    let key;\n    if (getKey !== noSignatureCheck) {\n        key = await getKey(header);\n        await validateJwsSignature(protectedHeader, payload, key, signature);\n    }\n    let claims;\n    try {\n        claims = JSON.parse(buf(b64u(payload)));\n    }\n    catch (cause) {\n        throw new OPE('failed to parse JWT Payload body as base64url encoded JSON', { cause });\n    }\n    if (!isJsonObject(claims)) {\n        throw new OPE('JWT Payload must be a top level object');\n    }\n    const now = epochTime() + clockSkew;\n    if (claims.exp !== undefined) {\n        if (typeof claims.exp !== 'number') {\n            throw new OPE('unexpected JWT \"exp\" (expiration time) claim type');\n        }\n        if (claims.exp <= now - clockTolerance) {\n            throw new OPE('unexpected JWT \"exp\" (expiration time) claim value, timestamp is <= now()');\n        }\n    }\n    if (claims.iat !== undefined) {\n        if (typeof claims.iat !== 'number') {\n            throw new OPE('unexpected JWT \"iat\" (issued at) claim type');\n        }\n    }\n    if (claims.iss !== undefined) {\n        if (typeof claims.iss !== 'string') {\n            throw new OPE('unexpected JWT \"iss\" (issuer) claim type');\n        }\n    }\n    if (claims.nbf !== undefined) {\n        if (typeof claims.nbf !== 'number') {\n            throw new OPE('unexpected JWT \"nbf\" (not before) claim type');\n        }\n        if (claims.nbf > now + clockTolerance) {\n            throw new OPE('unexpected JWT \"nbf\" (not before) claim value, timestamp is > now()');\n        }\n    }\n    if (claims.aud !== undefined) {\n        if (typeof claims.aud !== 'string' && !Array.isArray(claims.aud)) {\n            throw new OPE('unexpected JWT \"aud\" (audience) claim type');\n        }\n    }\n    return { header, claims, signature, key, jwt: jws };\n}\nexport async function validateJwtAuthResponse(as, client, parameters, expectedState, options) {\n    assertAs(as);\n    assertClient(client);\n    if (parameters instanceof URL) {\n        parameters = parameters.searchParams;\n    }\n    if (!(parameters instanceof URLSearchParams)) {\n        throw new TypeError('\"parameters\" must be an instance of URLSearchParams, or URL');\n    }\n    const response = getURLSearchParameter(parameters, 'response');\n    if (!response) {\n        throw new OPE('\"parameters\" does not contain a JARM response');\n    }\n    const { claims } = await validateJwt(response, checkSigningAlgorithm.bind(undefined, client.authorization_signed_response_alg, as.authorization_signing_alg_values_supported), getPublicSigKeyFromIssuerJwksUri.bind(undefined, as, options), getClockSkew(client), getClockTolerance(client), client[jweDecrypt])\n        .then(validatePresence.bind(undefined, ['aud', 'exp', 'iss']))\n        .then(validateIssuer.bind(undefined, as.issuer))\n        .then(validateAudience.bind(undefined, client.client_id));\n    const result = new URLSearchParams();\n    for (const [key, value] of Object.entries(claims)) {\n        if (typeof value === 'string' && key !== 'aud') {\n            result.set(key, value);\n        }\n    }\n    return validateAuthResponse(as, client, result, expectedState);\n}\nasync function idTokenHash(alg, data, key) {\n    let algorithm;\n    switch (alg) {\n        case 'RS256':\n        case 'PS256':\n        case 'ES256':\n            algorithm = 'SHA-256';\n            break;\n        case 'RS384':\n        case 'PS384':\n        case 'ES384':\n            algorithm = 'SHA-384';\n            break;\n        case 'RS512':\n        case 'PS512':\n        case 'ES512':\n            algorithm = 'SHA-512';\n            break;\n        case 'EdDSA':\n            if (key.algorithm.name === 'Ed25519') {\n                algorithm = 'SHA-512';\n                break;\n            }\n            throw new UnsupportedOperationError();\n        default:\n            throw new UnsupportedOperationError();\n    }\n    const digest = await crypto.subtle.digest(algorithm, buf(data));\n    return b64u(digest.slice(0, digest.byteLength / 2));\n}\nasync function idTokenHashMatches(data, actual, alg, key) {\n    const expected = await idTokenHash(alg, data, key);\n    return actual === expected;\n}\nexport async function validateDetachedSignatureResponse(as, client, parameters, expectedNonce, expectedState, maxAge, options) {\n    assertAs(as);\n    assertClient(client);\n    if (parameters instanceof URL) {\n        if (!parameters.hash.length) {\n            throw new TypeError('\"parameters\" as an instance of URL must contain a hash (fragment) with the Authorization Response parameters');\n        }\n        parameters = new URLSearchParams(parameters.hash.slice(1));\n    }\n    if (!(parameters instanceof URLSearchParams)) {\n        throw new TypeError('\"parameters\" must be an instance of URLSearchParams');\n    }\n    parameters = new URLSearchParams(parameters);\n    const id_token = getURLSearchParameter(parameters, 'id_token');\n    parameters.delete('id_token');\n    switch (expectedState) {\n        case undefined:\n        case expectNoState:\n            break;\n        default:\n            if (!validateString(expectedState)) {\n                throw new TypeError('\"expectedState\" must be a non-empty string');\n            }\n    }\n    const result = validateAuthResponse({\n        ...as,\n        authorization_response_iss_parameter_supported: false,\n    }, client, parameters, expectedState);\n    if (isOAuth2Error(result)) {\n        return result;\n    }\n    if (!id_token) {\n        throw new OPE('\"parameters\" does not contain an ID Token');\n    }\n    const code = getURLSearchParameter(parameters, 'code');\n    if (!code) {\n        throw new OPE('\"parameters\" does not contain an Authorization Code');\n    }\n    const requiredClaims = [\n        'aud',\n        'exp',\n        'iat',\n        'iss',\n        'sub',\n        'nonce',\n        'c_hash',\n    ];\n    if (typeof expectedState === 'string') {\n        requiredClaims.push('s_hash');\n    }\n    const { claims, header, key } = await validateJwt(id_token, checkSigningAlgorithm.bind(undefined, client.id_token_signed_response_alg, as.id_token_signing_alg_values_supported), getPublicSigKeyFromIssuerJwksUri.bind(undefined, as, options), getClockSkew(client), getClockTolerance(client), client[jweDecrypt])\n        .then(validatePresence.bind(undefined, requiredClaims))\n        .then(validateIssuer.bind(undefined, as.issuer))\n        .then(validateAudience.bind(undefined, client.client_id));\n    const clockSkew = getClockSkew(client);\n    const now = epochTime() + clockSkew;\n    if (claims.iat < now - 3600) {\n        throw new OPE('unexpected JWT \"iat\" (issued at) claim value, it is too far in the past');\n    }\n    if (typeof claims.c_hash !== 'string' ||\n        (await idTokenHashMatches(code, claims.c_hash, header.alg, key)) !== true) {\n        throw new OPE('invalid ID Token \"c_hash\" (code hash) claim value');\n    }\n    if (claims.s_hash !== undefined && typeof expectedState !== 'string') {\n        throw new OPE('could not verify ID Token \"s_hash\" (state hash) claim value');\n    }\n    if (typeof expectedState === 'string' &&\n        (typeof claims.s_hash !== 'string' ||\n            (await idTokenHashMatches(expectedState, claims.s_hash, header.alg, key)) !== true)) {\n        throw new OPE('invalid ID Token \"s_hash\" (state hash) claim value');\n    }\n    if (claims.auth_time !== undefined &&\n        (!Number.isFinite(claims.auth_time) || Math.sign(claims.auth_time) !== 1)) {\n        throw new OPE('ID Token \"auth_time\" (authentication time) must be a positive number');\n    }\n    maxAge ?? (maxAge = client.default_max_age ?? skipAuthTimeCheck);\n    if ((client.require_auth_time || maxAge !== skipAuthTimeCheck) &&\n        claims.auth_time === undefined) {\n        throw new OPE('ID Token \"auth_time\" (authentication time) claim missing');\n    }\n    if (maxAge !== skipAuthTimeCheck) {\n        if (typeof maxAge !== 'number' || maxAge < 0) {\n            throw new TypeError('\"maxAge\" must be a non-negative number');\n        }\n        const now = epochTime() + getClockSkew(client);\n        const tolerance = getClockTolerance(client);\n        if (claims.auth_time + maxAge < now - tolerance) {\n            throw new OPE('too much time has elapsed since the last End-User authentication');\n        }\n    }\n    if (!validateString(expectedNonce)) {\n        throw new TypeError('\"expectedNonce\" must be a non-empty string');\n    }\n    if (claims.nonce !== expectedNonce) {\n        throw new OPE('unexpected ID Token \"nonce\" claim value');\n    }\n    if (Array.isArray(claims.aud) && claims.aud.length !== 1) {\n        if (claims.azp === undefined) {\n            throw new OPE('ID Token \"aud\" (audience) claim includes additional untrusted audiences');\n        }\n        if (claims.azp !== client.client_id) {\n            throw new OPE('unexpected ID Token \"azp\" (authorized party) claim value');\n        }\n    }\n    return result;\n}\nfunction checkSigningAlgorithm(client, issuer, header) {\n    if (client !== undefined) {\n        if (header.alg !== client) {\n            throw new OPE('unexpected JWT \"alg\" header parameter');\n        }\n        return;\n    }\n    if (Array.isArray(issuer)) {\n        if (!issuer.includes(header.alg)) {\n            throw new OPE('unexpected JWT \"alg\" header parameter');\n        }\n        return;\n    }\n    if (header.alg !== 'RS256') {\n        throw new OPE('unexpected JWT \"alg\" header parameter');\n    }\n}\nfunction getURLSearchParameter(parameters, name) {\n    const { 0: value, length } = parameters.getAll(name);\n    if (length > 1) {\n        throw new OPE(`\"${name}\" parameter must be provided only once`);\n    }\n    return value;\n}\nexport const skipStateCheck = Symbol();\nexport const expectNoState = Symbol();\nexport function validateAuthResponse(as, client, parameters, expectedState) {\n    assertAs(as);\n    assertClient(client);\n    if (parameters instanceof URL) {\n        parameters = parameters.searchParams;\n    }\n    if (!(parameters instanceof URLSearchParams)) {\n        throw new TypeError('\"parameters\" must be an instance of URLSearchParams, or URL');\n    }\n    if (getURLSearchParameter(parameters, 'response')) {\n        throw new OPE('\"parameters\" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()');\n    }\n    const iss = getURLSearchParameter(parameters, 'iss');\n    const state = getURLSearchParameter(parameters, 'state');\n    if (!iss && as.authorization_response_iss_parameter_supported) {\n        throw new OPE('response parameter \"iss\" (issuer) missing');\n    }\n    if (iss && iss !== as.issuer) {\n        throw new OPE('unexpected \"iss\" (issuer) response parameter value');\n    }\n    switch (expectedState) {\n        case undefined:\n        case expectNoState:\n            if (state !== undefined) {\n                throw new OPE('unexpected \"state\" response parameter encountered');\n            }\n            break;\n        case skipStateCheck:\n            break;\n        default:\n            if (!validateString(expectedState)) {\n                throw new OPE('\"expectedState\" must be a non-empty string');\n            }\n            if (state === undefined) {\n                throw new OPE('response parameter \"state\" missing');\n            }\n            if (state !== expectedState) {\n                throw new OPE('unexpected \"state\" response parameter value');\n            }\n    }\n    const error = getURLSearchParameter(parameters, 'error');\n    if (error) {\n        return {\n            error,\n            error_description: getURLSearchParameter(parameters, 'error_description'),\n            error_uri: getURLSearchParameter(parameters, 'error_uri'),\n        };\n    }\n    const id_token = getURLSearchParameter(parameters, 'id_token');\n    const token = getURLSearchParameter(parameters, 'token');\n    if (id_token !== undefined || token !== undefined) {\n        throw new UnsupportedOperationError('implicit and hybrid flows are not supported');\n    }\n    return brand(new URLSearchParams(parameters));\n}\nfunction algToSubtle(alg, crv) {\n    switch (alg) {\n        case 'PS256':\n        case 'PS384':\n        case 'PS512':\n            return { name: 'RSA-PSS', hash: `SHA-${alg.slice(-3)}` };\n        case 'RS256':\n        case 'RS384':\n        case 'RS512':\n            return { name: 'RSASSA-PKCS1-v1_5', hash: `SHA-${alg.slice(-3)}` };\n        case 'ES256':\n        case 'ES384':\n            return { name: 'ECDSA', namedCurve: `P-${alg.slice(-3)}` };\n        case 'ES512':\n            return { name: 'ECDSA', namedCurve: 'P-521' };\n        case 'EdDSA': {\n            switch (crv) {\n                case 'Ed25519':\n                case 'Ed448':\n                    return crv;\n                default:\n                    throw new UnsupportedOperationError();\n            }\n        }\n        default:\n            throw new UnsupportedOperationError();\n    }\n}\nasync function importJwk(alg, jwk) {\n    const { ext, key_ops, use, ...key } = jwk;\n    return crypto.subtle.importKey('jwk', key, algToSubtle(alg, jwk.crv), true, ['verify']);\n}\nexport async function deviceAuthorizationRequest(as, client, parameters, options) {\n    assertAs(as);\n    assertClient(client);\n    const url = resolveEndpoint(as, 'device_authorization_endpoint', alias(client, options));\n    const body = new URLSearchParams(parameters);\n    body.set('client_id', client.client_id);\n    const headers = prepareHeaders(options?.headers);\n    headers.set('accept', 'application/json');\n    return authenticatedRequest(as, client, 'POST', url, body, headers, options);\n}\nexport async function processDeviceAuthorizationResponse(as, client, response) {\n    assertAs(as);\n    assertClient(client);\n    if (!looseInstanceOf(response, Response)) {\n        throw new TypeError('\"response\" must be an instance of Response');\n    }\n    if (response.status !== 200) {\n        let err;\n        if ((err = await handleOAuthBodyError(response))) {\n            return err;\n        }\n        throw new OPE('\"response\" is not a conform Device Authorization Endpoint response');\n    }\n    assertReadableResponse(response);\n    let json;\n    try {\n        json = await response.json();\n    }\n    catch (cause) {\n        throw new OPE('failed to parse \"response\" body as JSON', { cause });\n    }\n    if (!isJsonObject(json)) {\n        throw new OPE('\"response\" body must be a top level object');\n    }\n    if (!validateString(json.device_code)) {\n        throw new OPE('\"response\" body \"device_code\" property must be a non-empty string');\n    }\n    if (!validateString(json.user_code)) {\n        throw new OPE('\"response\" body \"user_code\" property must be a non-empty string');\n    }\n    if (!validateString(json.verification_uri)) {\n        throw new OPE('\"response\" body \"verification_uri\" property must be a non-empty string');\n    }\n    if (typeof json.expires_in !== 'number' || json.expires_in <= 0) {\n        throw new OPE('\"response\" body \"expires_in\" property must be a positive number');\n    }\n    if (json.verification_uri_complete !== undefined &&\n        !validateString(json.verification_uri_complete)) {\n        throw new OPE('\"response\" body \"verification_uri_complete\" property must be a non-empty string');\n    }\n    if (json.interval !== undefined && (typeof json.interval !== 'number' || json.interval <= 0)) {\n        throw new OPE('\"response\" body \"interval\" property must be a positive number');\n    }\n    return json;\n}\nexport async function deviceCodeGrantRequest(as, client, deviceCode, options) {\n    assertAs(as);\n    assertClient(client);\n    if (!validateString(deviceCode)) {\n        throw new TypeError('\"deviceCode\" must be a non-empty string');\n    }\n    const parameters = new URLSearchParams(options?.additionalParameters);\n    parameters.set('device_code', deviceCode);\n    return tokenEndpointRequest(as, client, 'urn:ietf:params:oauth:grant-type:device_code', parameters, options);\n}\nexport async function processDeviceCodeResponse(as, client, response) {\n    return processGenericAccessTokenResponse(as, client, response);\n}\nexport async function generateKeyPair(alg, options) {\n    if (!validateString(alg)) {\n        throw new TypeError('\"alg\" must be a non-empty string');\n    }\n    const algorithm = algToSubtle(alg, alg === 'EdDSA' ? (options?.crv ?? 'Ed25519') : undefined);\n    if (alg.startsWith('PS') || alg.startsWith('RS')) {\n        Object.assign(algorithm, {\n            modulusLength: options?.modulusLength ?? 2048,\n            publicExponent: new Uint8Array([0x01, 0x00, 0x01]),\n        });\n    }\n    return crypto.subtle.generateKey(algorithm, options?.extractable ?? false, [\n        'sign',\n        'verify',\n    ]);\n}\nfunction normalizeHtu(htu) {\n    const url = new URL(htu);\n    url.search = '';\n    url.hash = '';\n    return url.href;\n}\nasync function validateDPoP(as, request, accessToken, accessTokenClaims, options) {\n    const header = request.headers.get('dpop');\n    if (header === null) {\n        throw new OPE('operation indicated DPoP use but the request has no DPoP HTTP Header');\n    }\n    if (request.headers.get('authorization')?.toLowerCase().startsWith('dpop ') === false) {\n        throw new OPE(`operation indicated DPoP use but the request's Authorization HTTP Header scheme is not DPoP`);\n    }\n    if (typeof accessTokenClaims.cnf?.jkt !== 'string') {\n        throw new OPE('operation indicated DPoP use but the JWT Access Token has no jkt confirmation claim');\n    }\n    const clockSkew = getClockSkew(options);\n    const proof = await validateJwt(header, checkSigningAlgorithm.bind(undefined, undefined, as?.dpop_signing_alg_values_supported || SUPPORTED_JWS_ALGS), async ({ jwk, alg }) => {\n        if (!jwk) {\n            throw new OPE('DPoP Proof is missing the jwk header parameter');\n        }\n        const key = await importJwk(alg, jwk);\n        if (key.type !== 'public') {\n            throw new OPE('DPoP Proof jwk header parameter must contain a public key');\n        }\n        return key;\n    }, clockSkew, getClockTolerance(options), undefined)\n        .then(checkJwtType.bind(undefined, 'dpop+jwt'))\n        .then(validatePresence.bind(undefined, ['iat', 'jti', 'ath', 'htm', 'htu']));\n    const now = epochTime() + clockSkew;\n    const diff = Math.abs(now - proof.claims.iat);\n    if (diff > 300) {\n        throw new OPE('DPoP Proof iat is not recent enough');\n    }\n    if (proof.claims.htm !== request.method) {\n        throw new OPE('DPoP Proof htm mismatch');\n    }\n    if (typeof proof.claims.htu !== 'string' ||\n        normalizeHtu(proof.claims.htu) !== normalizeHtu(request.url)) {\n        throw new OPE('DPoP Proof htu mismatch');\n    }\n    {\n        const expected = b64u(await crypto.subtle.digest('SHA-256', encoder.encode(accessToken)));\n        if (proof.claims.ath !== expected) {\n            throw new OPE('DPoP Proof ath mismatch');\n        }\n    }\n    {\n        let components;\n        switch (proof.header.jwk.kty) {\n            case 'EC':\n                components = {\n                    crv: proof.header.jwk.crv,\n                    kty: proof.header.jwk.kty,\n                    x: proof.header.jwk.x,\n                    y: proof.header.jwk.y,\n                };\n                break;\n            case 'OKP':\n                components = {\n                    crv: proof.header.jwk.crv,\n                    kty: proof.header.jwk.kty,\n                    x: proof.header.jwk.x,\n                };\n                break;\n            case 'RSA':\n                components = {\n                    e: proof.header.jwk.e,\n                    kty: proof.header.jwk.kty,\n                    n: proof.header.jwk.n,\n                };\n                break;\n            default:\n                throw new UnsupportedOperationError();\n        }\n        const expected = b64u(await crypto.subtle.digest('SHA-256', encoder.encode(JSON.stringify(components))));\n        if (accessTokenClaims.cnf.jkt !== expected) {\n            throw new OPE('JWT Access Token confirmation mismatch');\n        }\n    }\n}\nexport async function validateJwtAccessToken(as, request, expectedAudience, options) {\n    assertAs(as);\n    if (!looseInstanceOf(request, Request)) {\n        throw new TypeError('\"request\" must be an instance of Request');\n    }\n    if (!validateString(expectedAudience)) {\n        throw new OPE('\"expectedAudience\" must be a non-empty string');\n    }\n    const authorization = request.headers.get('authorization');\n    if (authorization === null) {\n        throw new OPE('\"request\" is missing an Authorization HTTP Header');\n    }\n    let { 0: scheme, 1: accessToken, length } = authorization.split(' ');\n    scheme = scheme.toLowerCase();\n    switch (scheme) {\n        case 'dpop':\n        case 'bearer':\n            break;\n        default:\n            throw new UnsupportedOperationError('unsupported Authorization HTTP Header scheme');\n    }\n    if (length !== 2) {\n        throw new OPE('invalid Authorization HTTP Header format');\n    }\n    const requiredClaims = [\n        'iss',\n        'exp',\n        'aud',\n        'sub',\n        'iat',\n        'jti',\n        'client_id',\n    ];\n    if (options?.requireDPoP || scheme === 'dpop' || request.headers.has('dpop')) {\n        requiredClaims.push('cnf');\n    }\n    const { claims } = await validateJwt(accessToken, checkSigningAlgorithm.bind(undefined, undefined, SUPPORTED_JWS_ALGS), getPublicSigKeyFromIssuerJwksUri.bind(undefined, as, options), getClockSkew(options), getClockTolerance(options), undefined)\n        .then(checkJwtType.bind(undefined, 'at+jwt'))\n        .then(validatePresence.bind(undefined, requiredClaims))\n        .then(validateIssuer.bind(undefined, as.issuer))\n        .then(validateAudience.bind(undefined, expectedAudience));\n    for (const claim of ['client_id', 'jti', 'sub']) {\n        if (typeof claims[claim] !== 'string') {\n            throw new OPE(`unexpected JWT \"${claim}\" claim type`);\n        }\n    }\n    if ('cnf' in claims) {\n        if (!isJsonObject(claims.cnf)) {\n            throw new OPE('unexpected JWT \"cnf\" (confirmation) claim value');\n        }\n        const { 0: cnf, length } = Object.keys(claims.cnf);\n        if (length) {\n            if (length !== 1) {\n                throw new UnsupportedOperationError('multiple confirmation claims are not supported');\n            }\n            if (cnf !== 'jkt') {\n                throw new UnsupportedOperationError('unsupported JWT Confirmation method');\n            }\n        }\n    }\n    if (options?.requireDPoP ||\n        scheme === 'dpop' ||\n        claims.cnf?.jkt !== undefined ||\n        request.headers.has('dpop')) {\n        await validateDPoP(as, request, accessToken, claims, options);\n    }\n    return claims;\n}\nexport const experimentalCustomFetch = customFetch;\nexport const experimental_customFetch = customFetch;\nexport const experimentalUseMtlsAlias = useMtlsAlias;\nexport const experimental_useMtlsAlias = useMtlsAlias;\nexport const experimental_validateDetachedSignatureResponse = (...args) => validateDetachedSignatureResponse(...args);\nexport const experimental_validateJwtAccessToken = (...args) => validateJwtAccessToken(...args);\nexport const validateJwtUserinfoSignature = (...args) => validateJwtUserInfoSignature(...args);\nexport const experimental_jwksCache = jwksCache;\n"],"names":["USER_AGENT","_a","_b","looseInstanceOf","input","expected","clockSkew","clockTolerance","customFetch","modifyAssertion","jweDecrypt","jwksCache","useMtlsAlias","encoder","decoder","buf","CHUNK_SIZE","encodeBase64Url","arr","i","decodeBase64Url","binary","bytes","cause","OPE","b64u","LRU","maxSize","key","v","value","UnsupportedOperationError","message","OperationProcessingError","options","dpopNonces","isCryptoKey","isPrivateKey","isPublicKey","SUPPORTED_JWS_ALGS","processDpopNonce","response","nonce","normalizeTyp","isJsonObject","prepareHeaders","headers","signal","discoveryRequest","issuerIdentifier","url","validateString","processDiscoveryResponse","expectedIssuerIdentifier","assertReadableResponse","json","randomBytes","generateRandomCodeVerifier","generateRandomState","generateRandomNonce","calculatePKCECodeChallenge","codeVerifier","getKeyAndKid","formUrlEncode","token","clientSecretBasic","clientId","clientSecret","username","password","psAlg","rsAlg","esAlg","keyToJws","getClockSkew","client","skew","getClockTolerance","tolerance","epochTime","clientAssertion","as","now","privateKeyJwt","kid","header","payload","jwt","assertAs","assertClient","assertClientSecret","assertNoClientPrivateKey","clientAuthMethod","clientPrivateKey","assertNoClientSecret","clientAuthentication","body","signature","keyToSubtle","issueRequestObject","parameters","privateKey","claims","resource","dpopProofJwt","htm","accessToken","publicKey","publicJwk","jwkCache","getSetPublicJwkCache","kty","e","n","x","y","crv","jwk","validateEndpoint","endpoint","resolveEndpoint","alias","pushedAuthorizationRequest","authenticatedRequest","isOAuth2Error","unquote","SPLIT_REGEXP","SCHEMES_REGEXP","wwwAuth","scheme","params","idx","parseWwwAuthenticateChallenges","result","index","indexOf","others","next","processPushedAuthorizationResponse","err","handleOAuthBodyError","protectedResourceRequest","method","userInfoRequest","jwksMap","setJwksCache","jwks","uat","cache","isFreshJwksCache","clearJwksCache","getPublicSigKeyFromIssuerJwksUri","alg","checkSupportedJwsAlg","age","jwksRequest","processJwksResponse","candidates","length","importJwk","skipSubjectCheck","getContentType","processUserInfoResponse","expectedSubject","validateJwt","checkSigningAlgorithm","noSignatureCheck","validateOptionalAudience","validateOptionalIssuer","jwtResponseBodies","tokenEndpointRequest","grantType","refreshTokenGrantRequest","refreshToken","idTokenClaims","getValidatedIdTokenClaims","ref","validateIdTokenSignature","protectedHeader","encodedSignature","validateJwsSignature","validateJwtResponseSignature","validateJwtUserInfoSignature","validateJwtIntrospectionSignature","processGenericAccessTokenResponse","ignoreIdToken","ignoreRefreshToken","validatePresence","validateIssuer","validateAudience","processRefreshTokenResponse","branded","brand","searchParams","authorizationCodeGrantRequest","callbackParameters","redirectUri","code","getURLSearchParameter","jwtClaimNames","required","claim","expectNoNonce","skipAuthTimeCheck","processAuthorizationCodeOpenIDResponse","expectedNonce","maxAge","processAuthorizationCodeOAuth2Response","checkJwtType","clientCredentialsGrantRequest","genericTokenEndpointRequest","processClientCredentialsResponse","revocationRequest","processRevocationResponse","introspectionRequest","processIntrospectionResponse","checkRsaKeyAlgorithm","algorithm","ecdsaHashName","namedCurve","jws","checkAlg","getKey","decryptJwt","validateJwtAuthResponse","expectedState","validateAuthResponse","idTokenHash","data","digest","idTokenHashMatches","actual","validateDetachedSignatureResponse","id_token","expectNoState","requiredClaims","issuer","name","skipStateCheck","iss","state","error","algToSubtle","ext","key_ops","use","deviceAuthorizationRequest","processDeviceAuthorizationResponse","deviceCodeGrantRequest","deviceCode","processDeviceCodeResponse","generateKeyPair","normalizeHtu","htu","validateDPoP","request","accessTokenClaims","proof","components","validateJwtAccessToken","expectedAudience","authorization","cnf","experimentalCustomFetch","experimental_customFetch","experimentalUseMtlsAlias","experimental_useMtlsAlias","experimental_validateDetachedSignatureResponse","args","experimental_validateJwtAccessToken","validateJwtUserinfoSignature","experimental_jwksCache"],"mappings":"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","x_google_ignoreList":[0]}