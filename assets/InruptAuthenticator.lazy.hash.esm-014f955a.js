import{g as Ai,c as xi}from"./index-9f42eb17.js";const Mt=crypto,Or=s=>s instanceof CryptoKey,_t=new TextEncoder,Bt=new TextDecoder;function Fn(...s){const i=s.reduce((d,{length:v})=>d+v,0),u=new Uint8Array(i);let o=0;for(const d of s)u.set(d,o),o+=d.length;return u}const Pi=s=>{let i=s;typeof i=="string"&&(i=_t.encode(i));const u=32768,o=[];for(let d=0;d<i.length;d+=u)o.push(String.fromCharCode.apply(null,i.subarray(d,d+u)));return btoa(o.join(""))},cr=s=>Pi(s).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),ki=s=>{const i=atob(s),u=new Uint8Array(i.length);for(let o=0;o<i.length;o++)u[o]=i.charCodeAt(o);return u},Ct=s=>{let i=s;i instanceof Uint8Array&&(i=Bt.decode(i)),i=i.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return ki(i)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class qe extends Error{constructor(i,u){var o;super(i,u),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(o=Error.captureStackTrace)==null||o.call(Error,this,this.constructor)}}qe.code="ERR_JOSE_GENERIC";class yt extends qe{constructor(i,u,o="unspecified",d="unspecified"){super(i,{cause:{claim:o,reason:d,payload:u}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=o,this.reason=d,this.payload=u}}yt.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class Tr extends qe{constructor(i,u,o="unspecified",d="unspecified"){super(i,{cause:{claim:o,reason:d,payload:u}}),this.code="ERR_JWT_EXPIRED",this.claim=o,this.reason=d,this.payload=u}}Tr.code="ERR_JWT_EXPIRED";class An extends qe{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}An.code="ERR_JOSE_ALG_NOT_ALLOWED";class at extends qe{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}at.code="ERR_JOSE_NOT_SUPPORTED";class Ti extends qe{constructor(i="decryption operation failed",u){super(i,u),this.code="ERR_JWE_DECRYPTION_FAILED"}}Ti.code="ERR_JWE_DECRYPTION_FAILED";class Ri extends qe{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}Ri.code="ERR_JWE_INVALID";class Re extends qe{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}Re.code="ERR_JWS_INVALID";class fr extends qe{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}fr.code="ERR_JWT_INVALID";class Ci extends qe{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}Ci.code="ERR_JWK_INVALID";class Hr extends qe{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}Hr.code="ERR_JWKS_INVALID";class Br extends qe{constructor(i="no applicable key found in the JSON Web Key Set",u){super(i,u),this.code="ERR_JWKS_NO_MATCHING_KEY"}}Br.code="ERR_JWKS_NO_MATCHING_KEY";class xn extends qe{constructor(i="multiple matching keys found in the JSON Web Key Set",u){super(i,u),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}xn.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class Pn extends qe{constructor(i="request timed out",u){super(i,u),this.code="ERR_JWKS_TIMEOUT"}}Pn.code="ERR_JWKS_TIMEOUT";class kn extends qe{constructor(i="signature verification failed",u){super(i,u),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}kn.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";function Ft(s,i="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${i} must be ${s}`)}function ar(s,i){return s.name===i}function br(s){return parseInt(s.name.slice(4),10)}function Ii(s){switch(s){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Ui(s,i){if(i.length&&!i.some(u=>s.usages.includes(u))){let u="CryptoKey does not support this operation, its usages must include ";if(i.length>2){const o=i.pop();u+=`one of ${i.join(", ")}, or ${o}.`}else i.length===2?u+=`one of ${i[0]} or ${i[1]}.`:u+=`${i[0]}.`;throw new TypeError(u)}}function Di(s,i,...u){switch(i){case"HS256":case"HS384":case"HS512":{if(!ar(s.algorithm,"HMAC"))throw Ft("HMAC");const o=parseInt(i.slice(2),10);if(br(s.algorithm.hash)!==o)throw Ft(`SHA-${o}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!ar(s.algorithm,"RSASSA-PKCS1-v1_5"))throw Ft("RSASSA-PKCS1-v1_5");const o=parseInt(i.slice(2),10);if(br(s.algorithm.hash)!==o)throw Ft(`SHA-${o}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!ar(s.algorithm,"RSA-PSS"))throw Ft("RSA-PSS");const o=parseInt(i.slice(2),10);if(br(s.algorithm.hash)!==o)throw Ft(`SHA-${o}`,"algorithm.hash");break}case"EdDSA":{if(s.algorithm.name!=="Ed25519"&&s.algorithm.name!=="Ed448")throw Ft("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!ar(s.algorithm,"ECDSA"))throw Ft("ECDSA");const o=Ii(i);if(s.algorithm.namedCurve!==o)throw Ft(o,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Ui(s,u)}function Tn(s,i,...u){var o;if(u=u.filter(Boolean),u.length>2){const d=u.pop();s+=`one of type ${u.join(", ")}, or ${d}.`}else u.length===2?s+=`one of type ${u[0]} or ${u[1]}.`:s+=`of type ${u[0]}.`;return i==null?s+=` Received ${i}`:typeof i=="function"&&i.name?s+=` Received function ${i.name}`:typeof i=="object"&&i!=null&&(o=i.constructor)!=null&&o.name&&(s+=` Received an instance of ${i.constructor.name}`),s}const Rr=(s,...i)=>Tn("Key must be ",s,...i);function Rn(s,i,...u){return Tn(`Key for the ${s} algorithm must be `,i,...u)}const Cn=s=>Or(s)?!0:(s==null?void 0:s[Symbol.toStringTag])==="KeyObject",Qt=["CryptoKey"],Li=(...s)=>{const i=s.filter(Boolean);if(i.length===0||i.length===1)return!0;let u;for(const o of i){const d=Object.keys(o);if(!u||u.size===0){u=new Set(d);continue}for(const v of d){if(u.has(v))return!1;u.add(v)}}return!0},In=Li;function Ni(s){return typeof s=="object"&&s!==null}function At(s){if(!Ni(s)||Object.prototype.toString.call(s)!=="[object Object]")return!1;if(Object.getPrototypeOf(s)===null)return!0;let i=s;for(;Object.getPrototypeOf(i)!==null;)i=Object.getPrototypeOf(i);return Object.getPrototypeOf(s)===i}const Un=(s,i)=>{if(s.startsWith("RS")||s.startsWith("PS")){const{modulusLength:u}=i.algorithm;if(typeof u!="number"||u<2048)throw new TypeError(`${s} requires key modulusLength to be 2048 bits or larger`)}};function jt(s){return At(s)&&typeof s.kty=="string"}function Oi(s){return s.kty!=="oct"&&typeof s.d=="string"}function Hi(s){return s.kty!=="oct"&&typeof s.d>"u"}function Bi(s){return jt(s)&&s.kty==="oct"&&typeof s.k=="string"}function Mi(s){let i,u;switch(s.kty){case"RSA":{switch(s.alg){case"PS256":case"PS384":case"PS512":i={name:"RSA-PSS",hash:`SHA-${s.alg.slice(-3)}`},u=s.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":i={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${s.alg.slice(-3)}`},u=s.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":i={name:"RSA-OAEP",hash:`SHA-${parseInt(s.alg.slice(-3),10)||1}`},u=s.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new at('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(s.alg){case"ES256":i={name:"ECDSA",namedCurve:"P-256"},u=s.d?["sign"]:["verify"];break;case"ES384":i={name:"ECDSA",namedCurve:"P-384"},u=s.d?["sign"]:["verify"];break;case"ES512":i={name:"ECDSA",namedCurve:"P-521"},u=s.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":i={name:"ECDH",namedCurve:s.crv},u=s.d?["deriveBits"]:[];break;default:throw new at('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(s.alg){case"EdDSA":i={name:s.crv},u=s.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":i={name:s.crv},u=s.d?["deriveBits"]:[];break;default:throw new at('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new at('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:i,keyUsages:u}}const ji=async s=>{if(!s.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:i,keyUsages:u}=Mi(s),o=[i,s.ext??!1,s.key_ops??u],d={...s};return delete d.alg,delete d.use,Mt.subtle.importKey("jwk",d,...o)},Dn=ji,Ln=s=>Ct(s);let Lt,Nt;const Nn=s=>(s==null?void 0:s[Symbol.toStringTag])==="KeyObject",lr=async(s,i,u,o,d=!1)=>{let v=s.get(i);if(v!=null&&v[o])return v[o];const h=await Dn({...u,alg:o});return d&&Object.freeze(i),v?v[o]=h:s.set(i,{[o]:h}),h},Ki=(s,i)=>{if(Nn(s)){let u=s.export({format:"jwk"});return delete u.d,delete u.dp,delete u.dq,delete u.p,delete u.q,delete u.qi,u.k?Ln(u.k):(Nt||(Nt=new WeakMap),lr(Nt,s,u,i))}return jt(s)?s.k?Ct(s.k):(Nt||(Nt=new WeakMap),lr(Nt,s,s,i,!0)):s},Vi=(s,i)=>{if(Nn(s)){let u=s.export({format:"jwk"});return u.k?Ln(u.k):(Lt||(Lt=new WeakMap),lr(Lt,s,u,i))}return jt(s)?s.k?Ct(s.k):(Lt||(Lt=new WeakMap),lr(Lt,s,s,i,!0)):s},un={normalizePublicKey:Ki,normalizePrivateKey:Vi};async function On(s,i){if(!At(s))throw new TypeError("JWK must be an object");switch(i||(i=s.alg),s.kty){case"oct":if(typeof s.k!="string"||!s.k)throw new TypeError('missing "k" (Key Value) Parameter value');return Ct(s.k);case"RSA":if(s.oth!==void 0)throw new at('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return Dn({...s,alg:i});default:throw new at('Unsupported "kty" (Key Type) Parameter value')}}const Ot=s=>s==null?void 0:s[Symbol.toStringTag],Cr=(s,i,u)=>{var o,d;if(i.use!==void 0&&i.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(i.key_ops!==void 0&&((d=(o=i.key_ops).includes)==null?void 0:d.call(o,u))!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${u}`);if(i.alg!==void 0&&i.alg!==s)throw new TypeError(`Invalid key for this operation, when present its alg must be ${s}`);return!0},Ji=(s,i,u,o)=>{if(!(i instanceof Uint8Array)){if(o&&jt(i)){if(Bi(i)&&Cr(s,i,u))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Cn(i))throw new TypeError(Rn(s,i,...Qt,"Uint8Array",o?"JSON Web Key":null));if(i.type!=="secret")throw new TypeError(`${Ot(i)} instances for symmetric algorithms must be of type "secret"`)}},Wi=(s,i,u,o)=>{if(o&&jt(i))switch(u){case"sign":if(Oi(i)&&Cr(s,i,u))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(Hi(i)&&Cr(s,i,u))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Cn(i))throw new TypeError(Rn(s,i,...Qt,o?"JSON Web Key":null));if(i.type==="secret")throw new TypeError(`${Ot(i)} instances for asymmetric algorithms must not be of type "secret"`);if(u==="sign"&&i.type==="public")throw new TypeError(`${Ot(i)} instances for asymmetric algorithm signing must be of type "private"`);if(u==="decrypt"&&i.type==="public")throw new TypeError(`${Ot(i)} instances for asymmetric algorithm decryption must be of type "private"`);if(i.algorithm&&u==="verify"&&i.type==="private")throw new TypeError(`${Ot(i)} instances for asymmetric algorithm verifying must be of type "public"`);if(i.algorithm&&u==="encrypt"&&i.type==="private")throw new TypeError(`${Ot(i)} instances for asymmetric algorithm encryption must be of type "public"`)};function Hn(s,i,u,o){i.startsWith("HS")||i==="dir"||i.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(i)?Ji(i,u,o,s):Wi(i,u,o,s)}Hn.bind(void 0,!1);const Ir=Hn.bind(void 0,!0);function Bn(s,i,u,o,d){if(d.crit!==void 0&&(o==null?void 0:o.crit)===void 0)throw new s('"crit" (Critical) Header Parameter MUST be integrity protected');if(!o||o.crit===void 0)return new Set;if(!Array.isArray(o.crit)||o.crit.length===0||o.crit.some(h=>typeof h!="string"||h.length===0))throw new s('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let v;u!==void 0?v=new Map([...Object.entries(u),...i.entries()]):v=i;for(const h of o.crit){if(!v.has(h))throw new at(`Extension Header Parameter "${h}" is not recognized`);if(d[h]===void 0)throw new s(`Extension Header Parameter "${h}" is missing`);if(v.get(h)&&o[h]===void 0)throw new s(`Extension Header Parameter "${h}" MUST be integrity protected`)}return new Set(o.crit)}const qi=(s,i)=>{if(i!==void 0&&(!Array.isArray(i)||i.some(u=>typeof u!="string")))throw new TypeError(`"${s}" option must be an array of strings`);if(i)return new Set(i)},$i=qi,zi=async s=>{if(s instanceof Uint8Array)return{kty:"oct",k:cr(s)};if(!Or(s))throw new TypeError(Rr(s,...Qt,"Uint8Array"));if(!s.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const{ext:i,key_ops:u,alg:o,use:d,...v}=await Mt.subtle.exportKey("jwk",s);return v},Gi=zi;async function Mn(s){return Gi(s)}function jn(s,i){const u=`SHA-${s.slice(-3)}`;switch(s){case"HS256":case"HS384":case"HS512":return{hash:u,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:u,name:"RSA-PSS",saltLength:s.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:u,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:u,name:"ECDSA",namedCurve:i.namedCurve};case"EdDSA":return{name:i.name};default:throw new at(`alg ${s} is not supported either by JOSE or your javascript runtime`)}}async function Kn(s,i,u){if(u==="sign"&&(i=await un.normalizePrivateKey(i,s)),u==="verify"&&(i=await un.normalizePublicKey(i,s)),Or(i))return Di(i,s,u),i;if(i instanceof Uint8Array){if(!s.startsWith("HS"))throw new TypeError(Rr(i,...Qt));return Mt.subtle.importKey("raw",i,{hash:`SHA-${s.slice(-3)}`,name:"HMAC"},!1,[u])}throw new TypeError(Rr(i,...Qt,"Uint8Array","JSON Web Key"))}const Yi=async(s,i,u,o)=>{const d=await Kn(s,i,"verify");Un(s,d);const v=jn(s,d.algorithm);try{return await Mt.subtle.verify(v,d,u,o)}catch{return!1}},Xi=Yi;async function Qi(s,i,u){if(!At(s))throw new Re("Flattened JWS must be an object");if(s.protected===void 0&&s.header===void 0)throw new Re('Flattened JWS must have either of the "protected" or "header" members');if(s.protected!==void 0&&typeof s.protected!="string")throw new Re("JWS Protected Header incorrect type");if(s.payload===void 0)throw new Re("JWS Payload missing");if(typeof s.signature!="string")throw new Re("JWS Signature missing or incorrect type");if(s.header!==void 0&&!At(s.header))throw new Re("JWS Unprotected Header incorrect type");let o={};if(s.protected)try{const K=Ct(s.protected);o=JSON.parse(Bt.decode(K))}catch{throw new Re("JWS Protected Header is invalid")}if(!In(o,s.header))throw new Re("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const d={...o,...s.header},v=Bn(Re,new Map([["b64",!0]]),u==null?void 0:u.crit,o,d);let h=!0;if(v.has("b64")&&(h=o.b64,typeof h!="boolean"))throw new Re('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:w}=d;if(typeof w!="string"||!w)throw new Re('JWS "alg" (Algorithm) Header Parameter missing or invalid');const S=u&&$i("algorithms",u.algorithms);if(S&&!S.has(w))throw new An('"alg" (Algorithm) Header Parameter value not allowed');if(h){if(typeof s.payload!="string")throw new Re("JWS Payload must be a string")}else if(typeof s.payload!="string"&&!(s.payload instanceof Uint8Array))throw new Re("JWS Payload must be a string or an Uint8Array instance");let l=!1;typeof i=="function"?(i=await i(o,s),l=!0,Ir(w,i,"verify"),jt(i)&&(i=await On(i,w))):Ir(w,i,"verify");const f=Fn(_t.encode(s.protected??""),_t.encode("."),typeof s.payload=="string"?_t.encode(s.payload):s.payload);let c;try{c=Ct(s.signature)}catch{throw new Re("Failed to base64url decode the signature")}if(!await Xi(w,i,c,f))throw new kn;let I;if(h)try{I=Ct(s.payload)}catch{throw new Re("Failed to base64url decode the payload")}else typeof s.payload=="string"?I=_t.encode(s.payload):I=s.payload;const P={payload:I};return s.protected!==void 0&&(P.protectedHeader=o),s.header!==void 0&&(P.unprotectedHeader=s.header),l?{...P,key:i}:P}async function Zi(s,i,u){if(s instanceof Uint8Array&&(s=Bt.decode(s)),typeof s!="string")throw new Re("Compact JWS must be a string or Uint8Array");const{0:o,1:d,2:v,length:h}=s.split(".");if(h!==3)throw new Re("Invalid Compact JWS");const w=await Qi({payload:d,protected:o,signature:v},i,u),S={payload:w.payload,protectedHeader:w.protectedHeader};return typeof i=="function"?{...S,key:w.key}:S}const xt=s=>Math.floor(s.getTime()/1e3),Vn=60,Jn=Vn*60,Mr=Jn*24,eo=Mr*7,to=Mr*365.25,ro=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Xt=s=>{const i=ro.exec(s);if(!i||i[4]&&i[1])throw new TypeError("Invalid time period format");const u=parseFloat(i[2]),o=i[3].toLowerCase();let d;switch(o){case"sec":case"secs":case"second":case"seconds":case"s":d=Math.round(u);break;case"minute":case"minutes":case"min":case"mins":case"m":d=Math.round(u*Vn);break;case"hour":case"hours":case"hr":case"hrs":case"h":d=Math.round(u*Jn);break;case"day":case"days":case"d":d=Math.round(u*Mr);break;case"week":case"weeks":case"w":d=Math.round(u*eo);break;default:d=Math.round(u*to);break}return i[1]==="-"||i[4]==="ago"?-d:d},cn=s=>s.toLowerCase().replace(/^application\//,""),no=(s,i)=>typeof s=="string"?i.includes(s):Array.isArray(s)?i.some(Set.prototype.has.bind(new Set(s))):!1,io=(s,i,u={})=>{let o;try{o=JSON.parse(Bt.decode(i))}catch{}if(!At(o))throw new fr("JWT Claims Set must be a top-level JSON object");const{typ:d}=u;if(d&&(typeof s.typ!="string"||cn(s.typ)!==cn(d)))throw new yt('unexpected "typ" JWT header value',o,"typ","check_failed");const{requiredClaims:v=[],issuer:h,subject:w,audience:S,maxTokenAge:l}=u,f=[...v];l!==void 0&&f.push("iat"),S!==void 0&&f.push("aud"),w!==void 0&&f.push("sub"),h!==void 0&&f.push("iss");for(const P of new Set(f.reverse()))if(!(P in o))throw new yt(`missing required "${P}" claim`,o,P,"missing");if(h&&!(Array.isArray(h)?h:[h]).includes(o.iss))throw new yt('unexpected "iss" claim value',o,"iss","check_failed");if(w&&o.sub!==w)throw new yt('unexpected "sub" claim value',o,"sub","check_failed");if(S&&!no(o.aud,typeof S=="string"?[S]:S))throw new yt('unexpected "aud" claim value',o,"aud","check_failed");let c;switch(typeof u.clockTolerance){case"string":c=Xt(u.clockTolerance);break;case"number":c=u.clockTolerance;break;case"undefined":c=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:b}=u,I=xt(b||new Date);if((o.iat!==void 0||l)&&typeof o.iat!="number")throw new yt('"iat" claim must be a number',o,"iat","invalid");if(o.nbf!==void 0){if(typeof o.nbf!="number")throw new yt('"nbf" claim must be a number',o,"nbf","invalid");if(o.nbf>I+c)throw new yt('"nbf" claim timestamp check failed',o,"nbf","check_failed")}if(o.exp!==void 0){if(typeof o.exp!="number")throw new yt('"exp" claim must be a number',o,"exp","invalid");if(o.exp<=I-c)throw new Tr('"exp" claim timestamp check failed',o,"exp","check_failed")}if(l){const P=I-o.iat,K=typeof l=="number"?l:Xt(l);if(P-c>K)throw new Tr('"iat" claim timestamp check failed (too far in the past)',o,"iat","check_failed");if(P<0-c)throw new yt('"iat" claim timestamp check failed (it should be in the past)',o,"iat","check_failed")}return o};async function oo(s,i,u){var h;const o=await Zi(s,i,u);if((h=o.protectedHeader.crit)!=null&&h.includes("b64")&&o.protectedHeader.b64===!1)throw new fr("JWTs MUST NOT use unencoded payload");const v={payload:io(o.protectedHeader,o.payload,u),protectedHeader:o.protectedHeader};return typeof i=="function"?{...v,key:o.key}:v}const so=async(s,i,u)=>{const o=await Kn(s,i,"sign");Un(s,o);const d=await Mt.subtle.sign(jn(s,o.algorithm),o,u);return new Uint8Array(d)},ao=so;class uo{constructor(i){if(!(i instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=i}setProtectedHeader(i){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=i,this}setUnprotectedHeader(i){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=i,this}async sign(i,u){if(!this._protectedHeader&&!this._unprotectedHeader)throw new Re("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!In(this._protectedHeader,this._unprotectedHeader))throw new Re("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o={...this._protectedHeader,...this._unprotectedHeader},d=Bn(Re,new Map([["b64",!0]]),u==null?void 0:u.crit,this._protectedHeader,o);let v=!0;if(d.has("b64")&&(v=this._protectedHeader.b64,typeof v!="boolean"))throw new Re('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:h}=o;if(typeof h!="string"||!h)throw new Re('JWS "alg" (Algorithm) Header Parameter missing or invalid');Ir(h,i,"sign");let w=this._payload;v&&(w=_t.encode(cr(w)));let S;this._protectedHeader?S=_t.encode(cr(JSON.stringify(this._protectedHeader))):S=_t.encode("");const l=Fn(S,_t.encode("."),w),f=await ao(h,i,l),c={signature:cr(f),payload:""};return v&&(c.payload=Bt.decode(w)),this._unprotectedHeader&&(c.header=this._unprotectedHeader),this._protectedHeader&&(c.protected=Bt.decode(S)),c}}class co{constructor(i){this._flattened=new uo(i)}setProtectedHeader(i){return this._flattened.setProtectedHeader(i),this}async sign(i,u){const o=await this._flattened.sign(i,u);if(o.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${o.protected}.${o.payload}.${o.signature}`}}function Rt(s,i){if(!Number.isFinite(i))throw new TypeError(`Invalid ${s} input`);return i}class ho{constructor(i={}){if(!At(i))throw new TypeError("JWT Claims Set MUST be an object");this._payload=i}setIssuer(i){return this._payload={...this._payload,iss:i},this}setSubject(i){return this._payload={...this._payload,sub:i},this}setAudience(i){return this._payload={...this._payload,aud:i},this}setJti(i){return this._payload={...this._payload,jti:i},this}setNotBefore(i){return typeof i=="number"?this._payload={...this._payload,nbf:Rt("setNotBefore",i)}:i instanceof Date?this._payload={...this._payload,nbf:Rt("setNotBefore",xt(i))}:this._payload={...this._payload,nbf:xt(new Date)+Xt(i)},this}setExpirationTime(i){return typeof i=="number"?this._payload={...this._payload,exp:Rt("setExpirationTime",i)}:i instanceof Date?this._payload={...this._payload,exp:Rt("setExpirationTime",xt(i))}:this._payload={...this._payload,exp:xt(new Date)+Xt(i)},this}setIssuedAt(i){return typeof i>"u"?this._payload={...this._payload,iat:xt(new Date)}:i instanceof Date?this._payload={...this._payload,iat:Rt("setIssuedAt",xt(i))}:typeof i=="string"?this._payload={...this._payload,iat:Rt("setIssuedAt",xt(new Date)+Xt(i))}:this._payload={...this._payload,iat:Rt("setIssuedAt",i)},this}}class lo extends ho{setProtectedHeader(i){return this._protectedHeader=i,this}async sign(i,u){var d;const o=new co(_t.encode(JSON.stringify(this._payload)));if(o.setProtectedHeader(this._protectedHeader),Array.isArray((d=this._protectedHeader)==null?void 0:d.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new fr("JWTs MUST NOT use unencoded payload");return o.sign(i,u)}}function fo(s){switch(typeof s=="string"&&s.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new at('Unsupported "alg" value for a JSON Web Key Set')}}function go(s){return s&&typeof s=="object"&&Array.isArray(s.keys)&&s.keys.every(po)}function po(s){return At(s)}function Wn(s){return typeof structuredClone=="function"?structuredClone(s):JSON.parse(JSON.stringify(s))}class yo{constructor(i){if(this._cached=new WeakMap,!go(i))throw new Hr("JSON Web Key Set malformed");this._jwks=Wn(i)}async getKey(i,u){const{alg:o,kid:d}={...i,...u==null?void 0:u.header},v=fo(o),h=this._jwks.keys.filter(l=>{let f=v===l.kty;if(f&&typeof d=="string"&&(f=d===l.kid),f&&typeof l.alg=="string"&&(f=o===l.alg),f&&typeof l.use=="string"&&(f=l.use==="sig"),f&&Array.isArray(l.key_ops)&&(f=l.key_ops.includes("verify")),f&&o==="EdDSA"&&(f=l.crv==="Ed25519"||l.crv==="Ed448"),f)switch(o){case"ES256":f=l.crv==="P-256";break;case"ES256K":f=l.crv==="secp256k1";break;case"ES384":f=l.crv==="P-384";break;case"ES512":f=l.crv==="P-521";break}return f}),{0:w,length:S}=h;if(S===0)throw new Br;if(S!==1){const l=new xn,{_cached:f}=this;throw l[Symbol.asyncIterator]=async function*(){for(const c of h)try{yield await hn(f,c,o)}catch{}},l}return hn(this._cached,w,o)}}async function hn(s,i,u){const o=s.get(i)||s.set(i,{}).get(i);if(o[u]===void 0){const d=await On({...i,ext:!0},u);if(d instanceof Uint8Array||d.type!=="public")throw new Hr("JSON Web Key Set members must be public keys");o[u]=d}return o[u]}function ln(s){const i=new yo(s),u=async(o,d)=>i.getKey(o,d);return Object.defineProperties(u,{jwks:{value:()=>Wn(i._jwks),enumerable:!0,configurable:!1,writable:!1}}),u}const vo=async(s,i,u)=>{let o,d,v=!1;typeof AbortController=="function"&&(o=new AbortController,d=setTimeout(()=>{v=!0,o.abort()},i));const h=await fetch(s.href,{signal:o?o.signal:void 0,redirect:"manual",headers:u.headers}).catch(w=>{throw v?new Pn:w});if(d!==void 0&&clearTimeout(d),h.status!==200)throw new qe("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await h.json()}catch{throw new qe("Failed to parse the JSON Web Key Set HTTP response as JSON")}},mo=vo;function _o(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}let Ur;var ur,En;(typeof navigator>"u"||!((En=(ur=navigator.userAgent)==null?void 0:ur.startsWith)!=null&&En.call(ur,"Mozilla/5.0 ")))&&(Ur="jose/v5.9.6");const Er=Symbol();function So(s,i){return!(typeof s!="object"||s===null||!("uat"in s)||typeof s.uat!="number"||Date.now()-s.uat>=i||!("jwks"in s)||!At(s.jwks)||!Array.isArray(s.jwks.keys)||!Array.prototype.every.call(s.jwks.keys,At))}class wo{constructor(i,u){if(!(i instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(i.href),this._options={agent:u==null?void 0:u.agent,headers:u==null?void 0:u.headers},this._timeoutDuration=typeof(u==null?void 0:u.timeoutDuration)=="number"?u==null?void 0:u.timeoutDuration:5e3,this._cooldownDuration=typeof(u==null?void 0:u.cooldownDuration)=="number"?u==null?void 0:u.cooldownDuration:3e4,this._cacheMaxAge=typeof(u==null?void 0:u.cacheMaxAge)=="number"?u==null?void 0:u.cacheMaxAge:6e5,(u==null?void 0:u[Er])!==void 0&&(this._cache=u==null?void 0:u[Er],So(u==null?void 0:u[Er],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=ln(this._cache.jwks)))}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(i,u){(!this._local||!this.fresh())&&await this.reload();try{return await this._local(i,u)}catch(o){if(o instanceof Br&&this.coolingDown()===!1)return await this.reload(),this._local(i,u);throw o}}async reload(){this._pendingFetch&&_o()&&(this._pendingFetch=void 0);const i=new Headers(this._options.headers);Ur&&!i.has("User-Agent")&&(i.set("User-Agent",Ur),this._options.headers=Object.fromEntries(i.entries())),this._pendingFetch||(this._pendingFetch=mo(this._url,this._timeoutDuration,this._options).then(u=>{this._local=ln(u),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=u),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(u=>{throw this._pendingFetch=void 0,u})),await this._pendingFetch}}function bo(s,i){const u=new wo(s,i),o=async(d,v)=>u.getKey(d,v);return Object.defineProperties(o,{coolingDown:{get:()=>u.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>u.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>u.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!u._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>{var d;return(d=u._local)==null?void 0:d.jwks()},enumerable:!0,configurable:!1,writable:!1}}),o}function Fr(s){const i=(s==null?void 0:s.modulusLength)??2048;if(typeof i!="number"||i<2048)throw new at("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return i}async function Eo(s,i){let u,o;switch(s){case"PS256":case"PS384":case"PS512":u={name:"RSA-PSS",hash:`SHA-${s.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:Fr(i)},o=["sign","verify"];break;case"RS256":case"RS384":case"RS512":u={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${s.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:Fr(i)},o=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":u={name:"RSA-OAEP",hash:`SHA-${parseInt(s.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:Fr(i)},o=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":u={name:"ECDSA",namedCurve:"P-256"},o=["sign","verify"];break;case"ES384":u={name:"ECDSA",namedCurve:"P-384"},o=["sign","verify"];break;case"ES512":u={name:"ECDSA",namedCurve:"P-521"},o=["sign","verify"];break;case"EdDSA":{o=["sign","verify"];const d=(i==null?void 0:i.crv)??"Ed25519";switch(d){case"Ed25519":case"Ed448":u={name:d};break;default:throw new at("Invalid or unsupported crv option provided")}break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{o=["deriveKey","deriveBits"];const d=(i==null?void 0:i.crv)??"P-256";switch(d){case"P-256":case"P-384":case"P-521":{u={name:"ECDH",namedCurve:d};break}case"X25519":case"X448":u={name:d};break;default:throw new at("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new at('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return Mt.subtle.generateKey(u,(i==null?void 0:i.extractable)??!1,o)}async function Fo(s,i){return Eo(s,i)}const We=[];for(let s=0;s<256;++s)We.push((s+256).toString(16).slice(1));function Ao(s,i=0){return(We[s[i+0]]+We[s[i+1]]+We[s[i+2]]+We[s[i+3]]+"-"+We[s[i+4]]+We[s[i+5]]+"-"+We[s[i+6]]+We[s[i+7]]+"-"+We[s[i+8]]+We[s[i+9]]+"-"+We[s[i+10]]+We[s[i+11]]+We[s[i+12]]+We[s[i+13]]+We[s[i+14]]+We[s[i+15]]).toLowerCase()}let Ar;const xo=new Uint8Array(16);function Po(){if(!Ar){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ar=crypto.getRandomValues.bind(crypto)}return Ar(xo)}const ko=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),dn={randomUUID:ko};function jr(s,i,u){if(dn.randomUUID&&!i&&!s)return dn.randomUUID();s=s||{};const o=s.random||(s.rng||Po)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,i){u=u||0;for(let d=0;d<16;++d)i[u+d]=o[d];return i}return Ao(o)}const qn="solidClientAuthn:",dr=["ES256","RS256"],je={ERROR:"error",LOGIN:"login",LOGOUT:"logout",NEW_REFRESH_TOKEN:"newRefreshToken",SESSION_EXPIRED:"sessionExpired",SESSION_EXTENDED:"sessionExtended",SESSION_RESTORED:"sessionRestore",TIMEOUT_SET:"timeoutSet"},fn=5,To="openid",Ro="offline_access",Co="webid",$n=[To,Ro,Co].join(" ");class Io{constructor(i){this.handleables=i,this.handleables=i}async getProperHandler(i){const u=await Promise.all(this.handleables.map(o=>o.canHandle(...i)));for(let o=0;o<u.length;o+=1)if(u[o])return this.handleables[o];return null}async canHandle(...i){return await this.getProperHandler(i)!==null}async handle(...i){const u=await this.getProperHandler(i);if(u)return u.handle(...i);throw new Error(`[${this.constructor.name}] cannot find a suitable handler for: ${i.map(o=>{try{return JSON.stringify(o)}catch{return o.toString()}}).join(", ")}`)}}async function zn(s,i,u,o){let d,v;try{const{payload:h}=await oo(s,bo(new URL(i)),{issuer:u,audience:o});d=h}catch(h){throw new Error(`Token verification failed: ${h.stack}`)}if(typeof d.azp=="string"&&(v=d.azp),typeof d.webid=="string")return{webId:d.webid,clientId:v};if(typeof d.sub!="string")throw new Error(`The token ${JSON.stringify(d)} is invalid: it has no 'webid' claim and no 'sub' claim.`);try{return new URL(d.sub),{webId:d.sub,clientId:v}}catch(h){throw new Error(`The token has no 'webid' claim, and its 'sub' claim of [${d.sub}] is invalid as a URL - error [${h}].`)}}function Gn(s){try{const i=new URL(s),u=!i.searchParams.has("code")&&!i.searchParams.has("state"),o=i.hash==="";return u&&o}catch{return!1}}function Yn(s){const i=new URL(s);return i.searchParams.delete("state"),i.searchParams.delete("code"),i.searchParams.delete("error"),i.searchParams.delete("error_description"),i.searchParams.delete("iss"),i}function Uo(s,i){return typeof s=="boolean"?!!s:!!i}class Do{constructor(i,u){this.storageUtility=i,this.redirector=u,this.parametersGuard=o=>o.issuerConfiguration.grantTypesSupported!==void 0&&o.issuerConfiguration.grantTypesSupported.indexOf("authorization_code")>-1&&o.redirectUrl!==void 0,this.storageUtility=i,this.redirector=u}async canHandle(i){return this.parametersGuard(i)}async handleRedirect({oidcLoginOptions:i,state:u,codeVerifier:o,targetUrl:d}){if(!this.parametersGuard(i))throw new Error("The authorization code grant requires a redirectUrl.");await Promise.all([this.storageUtility.setForUser(u,{sessionId:i.sessionId}),this.storageUtility.setForUser(i.sessionId,{codeVerifier:o,issuer:i.issuer.toString(),redirectUrl:i.redirectUrl,dpop:(!!i.dpop).toString(),keepAlive:Uo(i.keepAlive,!0).toString()})]),this.redirector.redirect(d,{handleRedirect:i.handleRedirect})}}class Lo{constructor(i){this.sessionInfoManager=i,this.sessionInfoManager=i}async canHandle(){return!0}async handle(i){await this.sessionInfoManager.clear(i)}}class No{constructor(i){this.redirector=i,this.redirector=i}async canHandle(i,u){return(u==null?void 0:u.logoutType)==="idp"}async handle(i,u){if((u==null?void 0:u.logoutType)!=="idp")throw new Error("Attempting to call idp logout handler to perform app logout");if(u.toLogoutUrl===void 0)throw new Error("Cannot perform IDP logout. Did you log in using the OIDC authentication flow?");this.redirector.redirect(u.toLogoutUrl(u),{handleRedirect:u.handleRedirect})}}class Oo{constructor(i,u){this.handlers=[new Lo(i),new No(u)]}async canHandle(){return!0}async handle(i,u){for(const o of this.handlers)await o.canHandle(i,u)&&await o.handle(i,u)}}function Xn(){return{isLoggedIn:!1,sessionId:jr(),fetch:(...s)=>fetch(...s)}}async function Qn(s,i){await Promise.all([i.deleteAllUserData(s,{secure:!1}),i.deleteAllUserData(s,{secure:!0})])}class Ho{constructor(i){this.storageUtility=i,this.storageUtility=i}update(i,u){throw new Error("Not Implemented")}get(i){throw new Error("Not implemented")}async getAll(){throw new Error("Not implemented")}async clear(i){return Qn(i,this.storageUtility)}async register(i){throw new Error("Not implemented")}async getRegisteredSessionIdAll(){throw new Error("Not implemented")}async clearAll(){throw new Error("Not implemented")}}function Bo({endSessionEndpoint:s,idTokenHint:i,postLogoutRedirectUri:u,state:o}){const d=new URL(s);return i!==void 0&&d.searchParams.append("id_token_hint",i),u!==void 0&&(d.searchParams.append("post_logout_redirect_uri",u),o!==void 0&&d.searchParams.append("state",o)),d.toString()}function Mo({endSessionEndpoint:s,idTokenHint:i}){if(s!==void 0)return function({state:o,postLogoutUrl:d}){return Bo({endSessionEndpoint:s,idTokenHint:i,state:o,postLogoutRedirectUri:d})}}function jo(s){return typeof s=="string"&&["DPoP","Bearer"].includes(s)}function Zn(s){try{return new URL(s),!0}catch{return!1}}function Ko(s,i){var u;return(u=i.find(o=>s.includes(o)))!==null&&u!==void 0?u:null}function Vo(s){return s.clientId!==void 0&&!Zn(s.clientId)}function Jo(s,i){return i.scopesSupported.includes("webid")&&s.clientId!==void 0&&Zn(s.clientId)}function Wo(s){return typeof s=="string"&&["dynamic","static","solid-oidc"].includes(s)}async function qo(s,i,u,o){let d;if(Jo(s,i))d={clientId:s.clientId,clientName:s.clientName,clientType:"solid-oidc"};else if(Vo(s))d={clientId:s.clientId,clientSecret:s.clientSecret,clientName:s.clientName,clientType:"static"};else return o.getClient({sessionId:s.sessionId,clientName:s.clientName,redirectUrl:s.redirectUrl},i);const v={clientId:d.clientId,clientType:d.clientType};return d.clientType==="static"&&(v.clientSecret=d.clientSecret),d.clientName&&(v.clientName=d.clientName),await u.setForUser(s.sessionId,v),d}const gn=(s,i)=>fetch(s,i);let $o=class{constructor(i,u,o,d,v){this.loginHandler=i,this.redirectHandler=u,this.logoutHandler=o,this.sessionInfoManager=d,this.issuerConfigFetcher=v,this.fetch=gn,this.logout=async(h,w)=>{await this.logoutHandler.handle(h,(w==null?void 0:w.logoutType)==="idp"?{...w,toLogoutUrl:this.boundLogout}:w),this.fetch=gn,delete this.boundLogout},this.getSessionInfo=async h=>this.sessionInfoManager.get(h),this.getAllSessionInfo=async()=>this.sessionInfoManager.getAll(),this.loginHandler=i,this.redirectHandler=u,this.logoutHandler=o,this.sessionInfoManager=d,this.issuerConfigFetcher=v}};async function ei(s,i,u){try{const[o,d,v,h,w]=await Promise.all([i.getForUser(s,"issuer",{errorIfNull:!0}),i.getForUser(s,"codeVerifier"),i.getForUser(s,"redirectUrl"),i.getForUser(s,"dpop",{errorIfNull:!0}),i.getForUser(s,"keepAlive")]);await i.deleteForUser(s,"codeVerifier");const S=await u.fetchConfig(o);return{codeVerifier:d,redirectUrl:v,issuerConfig:S,dpop:h==="true",keepAlive:typeof w=="string"?w==="true":!0}}catch(o){throw new Error(`Failed to retrieve OIDC context from storage associated with session [${s}]: ${o}`)}}async function zo(s,i,u,o,d,v,h,w){v!==void 0&&await s.setForUser(i,{refreshToken:v},{secure:h}),u!==void 0&&await s.setForUser(i,{webId:u},{secure:h}),o!==void 0&&await s.setForUser(i,{clientId:o},{secure:h}),d!==void 0&&await s.setForUser(i,{isLoggedIn:d},{secure:h}),w!==void 0&&await s.setForUser(i,{publicKey:JSON.stringify(w.publicKey),privateKey:JSON.stringify(await Mn(w.privateKey))},{secure:h})}class Go{constructor(i,u){this.secureStorage=i,this.insecureStorage=u,this.secureStorage=i,this.insecureStorage=u}getKey(i){return`solidClientAuthenticationUser:${i}`}async getUserData(i,u){const o=await(u?this.secureStorage:this.insecureStorage).get(this.getKey(i));if(o===void 0)return{};try{return JSON.parse(o)}catch{throw new Error(`Data for user [${i}] in [${u?"secure":"unsecure"}] storage is corrupted - expected valid JSON, but got: ${o}`)}}async setUserData(i,u,o){await(o?this.secureStorage:this.insecureStorage).set(this.getKey(i),JSON.stringify(u))}async get(i,u){const o=await(u!=null&&u.secure?this.secureStorage:this.insecureStorage).get(i);if(o===void 0&&(u!=null&&u.errorIfNull))throw new Error(`[${i}] is not stored`);return o}async set(i,u,o){return(o!=null&&o.secure?this.secureStorage:this.insecureStorage).set(i,u)}async delete(i,u){return(u!=null&&u.secure?this.secureStorage:this.insecureStorage).delete(i)}async getForUser(i,u,o){const d=await this.getUserData(i,o==null?void 0:o.secure);let v;if((!d||!d[u])&&(v=void 0),v=d[u],v===void 0&&(o!=null&&o.errorIfNull))throw new Error(`Field [${u}] for user [${i}] is not stored`);return v||void 0}async setForUser(i,u,o){let d;try{d=await this.getUserData(i,o==null?void 0:o.secure)}catch{d={}}await this.setUserData(i,{...d,...u},o==null?void 0:o.secure)}async deleteForUser(i,u,o){const d=await this.getUserData(i,o==null?void 0:o.secure);delete d[u],await this.setUserData(i,d,o==null?void 0:o.secure)}async deleteAllUserData(i,u){await(u!=null&&u.secure?this.secureStorage:this.insecureStorage).delete(this.getKey(i))}}class Yo{constructor(){this.map={}}async get(i){return this.map[i]||void 0}async set(i,u){this.map[i]=u}async delete(i){delete this.map[i]}}class Dr extends Error{constructor(i){super(i)}}class Yt extends Error{constructor(i){super(`Invalid response from OIDC provider: missing fields ${i}`),this.missingFields=i}}class ti extends Error{constructor(i,u,o){super(i),this.error=u,this.errorDescription=o}}function Xo(s){const i=new URL(s);return new URL(i.pathname,i.origin).toString()}async function Kr(s,i,u){return new lo({htu:Xo(s),htm:i.toUpperCase(),jti:jr()}).setProtectedHeader({alg:dr[0],jwk:u.publicKey,typ:"dpop+jwt"}).setIssuedAt().sign(u.privateKey,{})}async function Qo(){const{privateKey:s,publicKey:i}=await Fo(dr[0]),u={privateKey:s,publicKey:await Mn(i)};return[u.publicKey.alg]=dr,u}const ri=600;function Zo(s){return[401,403].includes(s)}async function es(s,i,u,o){var d;const v=new Headers(o==null?void 0:o.headers);return v.set("Authorization",`DPoP ${i}`),v.set("DPoP",await Kr(s,(d=o==null?void 0:o.method)!==null&&d!==void 0?d:"get",u)),{...o,headers:v}}async function ts(s,i,u,o){if(u!==void 0)return es(s,i,u,o);const d=new Headers(o==null?void 0:o.headers);return d.set("Authorization",`Bearer ${i}`),{...o,headers:d}}async function pn(s,i,u,o){return fetch(i,await ts(i.toString(),s,o,u))}async function rs(s,i,u){var o;const d=await s.tokenRefresher.refresh(s.sessionId,s.refreshToken,i);return u==null||u.emit(je.SESSION_EXTENDED,(o=d.expiresIn)!==null&&o!==void 0?o:ri),typeof d.refreshToken=="string"&&(u==null||u.emit(je.NEW_REFRESH_TOKEN,d.refreshToken)),{accessToken:d.accessToken,refreshToken:d.refreshToken,expiresIn:d.expiresIn}}const xr=s=>s!==void 0?s-fn>0?s-fn:s:ri;async function ns(s,i){var u;let o=s,d;const v=i==null?void 0:i.refreshOptions;if(v!==void 0){const h=async()=>{var w,S,l,f;try{const{accessToken:c,refreshToken:b,expiresIn:I}=await rs(v,i.dpopKey,i.eventEmitter);o=c,b!==void 0&&(v.refreshToken=b),clearTimeout(d),d=setTimeout(h,xr(I)*1e3),(w=i.eventEmitter)===null||w===void 0||w.emit(je.TIMEOUT_SET,d)}catch(c){c instanceof ti&&((S=i==null?void 0:i.eventEmitter)===null||S===void 0||S.emit(je.ERROR,c.error,c.errorDescription),(l=i==null?void 0:i.eventEmitter)===null||l===void 0||l.emit(je.SESSION_EXPIRED)),c instanceof Yt&&c.missingFields.includes("access_token")&&((f=i==null?void 0:i.eventEmitter)===null||f===void 0||f.emit(je.SESSION_EXPIRED))}};d=setTimeout(h,xr(i.expiresIn)*1e3),(u=i.eventEmitter)===null||u===void 0||u.emit(je.TIMEOUT_SET,d)}else if(i!==void 0&&i.eventEmitter!==void 0){const h=setTimeout(()=>{i.eventEmitter.emit(je.SESSION_EXPIRED)},xr(i.expiresIn)*1e3);i.eventEmitter.emit(je.TIMEOUT_SET,h)}return async(h,w)=>{let S=await pn(o,h,w,i==null?void 0:i.dpopKey);const l=!S.ok&&!Zo(S.status);return S.ok||l||S.url!==h&&(i==null?void 0:i.dpopKey)!==void 0&&(S=await pn(o,S.url,w,i.dpopKey)),S}}var Vr={exports:{}},Ht=typeof Reflect=="object"?Reflect:null,yn=Ht&&typeof Ht.apply=="function"?Ht.apply:function(i,u,o){return Function.prototype.apply.call(i,u,o)},hr;Ht&&typeof Ht.ownKeys=="function"?hr=Ht.ownKeys:Object.getOwnPropertySymbols?hr=function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:hr=function(i){return Object.getOwnPropertyNames(i)};function is(s){console&&console.warn&&console.warn(s)}var ni=Number.isNaN||function(i){return i!==i};function be(){be.init.call(this)}Vr.exports=be;Vr.exports.once=us;be.EventEmitter=be;be.prototype._events=void 0;be.prototype._eventsCount=0;be.prototype._maxListeners=void 0;var vn=10;function gr(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(be,"defaultMaxListeners",{enumerable:!0,get:function(){return vn},set:function(s){if(typeof s!="number"||s<0||ni(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");vn=s}});be.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};be.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||ni(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this};function ii(s){return s._maxListeners===void 0?be.defaultMaxListeners:s._maxListeners}be.prototype.getMaxListeners=function(){return ii(this)};be.prototype.emit=function(i){for(var u=[],o=1;o<arguments.length;o++)u.push(arguments[o]);var d=i==="error",v=this._events;if(v!==void 0)d=d&&v.error===void 0;else if(!d)return!1;if(d){var h;if(u.length>0&&(h=u[0]),h instanceof Error)throw h;var w=new Error("Unhandled error."+(h?" ("+h.message+")":""));throw w.context=h,w}var S=v[i];if(S===void 0)return!1;if(typeof S=="function")yn(S,this,u);else for(var l=S.length,f=ci(S,l),o=0;o<l;++o)yn(f[o],this,u);return!0};function oi(s,i,u,o){var d,v,h;if(gr(u),v=s._events,v===void 0?(v=s._events=Object.create(null),s._eventsCount=0):(v.newListener!==void 0&&(s.emit("newListener",i,u.listener?u.listener:u),v=s._events),h=v[i]),h===void 0)h=v[i]=u,++s._eventsCount;else if(typeof h=="function"?h=v[i]=o?[u,h]:[h,u]:o?h.unshift(u):h.push(u),d=ii(s),d>0&&h.length>d&&!h.warned){h.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+h.length+" "+String(i)+" listeners added. Use emitter.setMaxListeners() to increase limit");w.name="MaxListenersExceededWarning",w.emitter=s,w.type=i,w.count=h.length,is(w)}return s}be.prototype.addListener=function(i,u){return oi(this,i,u,!1)};be.prototype.on=be.prototype.addListener;be.prototype.prependListener=function(i,u){return oi(this,i,u,!0)};function os(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function si(s,i,u){var o={fired:!1,wrapFn:void 0,target:s,type:i,listener:u},d=os.bind(o);return d.listener=u,o.wrapFn=d,d}be.prototype.once=function(i,u){return gr(u),this.on(i,si(this,i,u)),this};be.prototype.prependOnceListener=function(i,u){return gr(u),this.prependListener(i,si(this,i,u)),this};be.prototype.removeListener=function(i,u){var o,d,v,h,w;if(gr(u),d=this._events,d===void 0)return this;if(o=d[i],o===void 0)return this;if(o===u||o.listener===u)--this._eventsCount===0?this._events=Object.create(null):(delete d[i],d.removeListener&&this.emit("removeListener",i,o.listener||u));else if(typeof o!="function"){for(v=-1,h=o.length-1;h>=0;h--)if(o[h]===u||o[h].listener===u){w=o[h].listener,v=h;break}if(v<0)return this;v===0?o.shift():ss(o,v),o.length===1&&(d[i]=o[0]),d.removeListener!==void 0&&this.emit("removeListener",i,w||u)}return this};be.prototype.off=be.prototype.removeListener;be.prototype.removeAllListeners=function(i){var u,o,d;if(o=this._events,o===void 0)return this;if(o.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):o[i]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete o[i]),this;if(arguments.length===0){var v=Object.keys(o),h;for(d=0;d<v.length;++d)h=v[d],h!=="removeListener"&&this.removeAllListeners(h);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(u=o[i],typeof u=="function")this.removeListener(i,u);else if(u!==void 0)for(d=u.length-1;d>=0;d--)this.removeListener(i,u[d]);return this};function ai(s,i,u){var o=s._events;if(o===void 0)return[];var d=o[i];return d===void 0?[]:typeof d=="function"?u?[d.listener||d]:[d]:u?as(d):ci(d,d.length)}be.prototype.listeners=function(i){return ai(this,i,!0)};be.prototype.rawListeners=function(i){return ai(this,i,!1)};be.listenerCount=function(s,i){return typeof s.listenerCount=="function"?s.listenerCount(i):ui.call(s,i)};be.prototype.listenerCount=ui;function ui(s){var i=this._events;if(i!==void 0){var u=i[s];if(typeof u=="function")return 1;if(u!==void 0)return u.length}return 0}be.prototype.eventNames=function(){return this._eventsCount>0?hr(this._events):[]};function ci(s,i){for(var u=new Array(i),o=0;o<i;++o)u[o]=s[o];return u}function ss(s,i){for(;i+1<s.length;i++)s[i]=s[i+1];s.pop()}function as(s){for(var i=new Array(s.length),u=0;u<i.length;++u)i[u]=s[u].listener||s[u];return i}function us(s,i){return new Promise(function(u,o){function d(h){s.removeListener(i,v),o(h)}function v(){typeof s.removeListener=="function"&&s.removeListener("error",d),u([].slice.call(arguments))}hi(s,i,v,{once:!0}),i!=="error"&&cs(s,d,{once:!0})})}function cs(s,i,u){typeof s.on=="function"&&hi(s,"error",i,u)}function hi(s,i,u,o){if(typeof s.on=="function")o.once?s.once(i,u):s.on(i,u);else if(typeof s.addEventListener=="function")s.addEventListener(i,function d(v){o.once&&s.removeEventListener(i,d),u(v)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}var hs=Vr.exports;const ls=Ai(hs);var li={exports:{}};(function(s,i){(function(o,d){s.exports=d()})(xi,function(){return function(u){var o={};function d(v){if(o[v])return o[v].exports;var h=o[v]={i:v,l:!1,exports:{}};return u[v].call(h.exports,h,h.exports,d),h.l=!0,h.exports}return d.m=u,d.c=o,d.d=function(v,h,w){d.o(v,h)||Object.defineProperty(v,h,{enumerable:!0,get:w})},d.r=function(v){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(v,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(v,"__esModule",{value:!0})},d.t=function(v,h){if(1&h&&(v=d(v)),8&h||4&h&&typeof v=="object"&&v&&v.__esModule)return v;var w=Object.create(null);if(d.r(w),Object.defineProperty(w,"default",{enumerable:!0,value:v}),2&h&&typeof v!="string")for(var S in v)d.d(w,S,(function(l){return v[l]}).bind(null,S));return w},d.n=function(v){var h=v&&v.__esModule?function(){return v.default}:function(){return v};return d.d(h,"a",h),h},d.o=function(v,h){return Object.prototype.hasOwnProperty.call(v,h)},d.p="",d(d.s=22)}([function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0});var v=function(){function l(f,c){for(var b=0;b<c.length;b++){var I=c[b];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(f,I.key,I)}}return function(f,c,b){return c&&l(f.prototype,c),b&&l(f,b),f}}(),h={debug:function(){},info:function(){},warn:function(){},error:function(){}},w=void 0,S=void 0;(o.Log=function(){function l(){(function(c,b){if(!(c instanceof b))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.reset=function(){S=3,w=h},l.debug=function(){if(S>=4){for(var c=arguments.length,b=Array(c),I=0;I<c;I++)b[I]=arguments[I];w.debug.apply(w,Array.from(b))}},l.info=function(){if(S>=3){for(var c=arguments.length,b=Array(c),I=0;I<c;I++)b[I]=arguments[I];w.info.apply(w,Array.from(b))}},l.warn=function(){if(S>=2){for(var c=arguments.length,b=Array(c),I=0;I<c;I++)b[I]=arguments[I];w.warn.apply(w,Array.from(b))}},l.error=function(){if(S>=1){for(var c=arguments.length,b=Array(c),I=0;I<c;I++)b[I]=arguments[I];w.error.apply(w,Array.from(b))}},v(l,null,[{key:"NONE",get:function(){return 0}},{key:"ERROR",get:function(){return 1}},{key:"WARN",get:function(){return 2}},{key:"INFO",get:function(){return 3}},{key:"DEBUG",get:function(){return 4}},{key:"level",get:function(){return S},set:function(c){if(!(0<=c&&c<=4))throw new Error("Invalid log level");S=c}},{key:"logger",get:function(){return w},set:function(c){if(!c.debug&&c.info&&(c.debug=c.info),!(c.debug&&c.info&&c.warn&&c.error))throw new Error("Invalid logger");w=c}}]),l}()).reset()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0});var v=function(){function l(f,c){for(var b=0;b<c.length;b++){var I=c[b];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(f,I.key,I)}}return function(f,c,b){return c&&l(f.prototype,c),b&&l(f,b),f}}(),h={setInterval:function(l){function f(c,b){return l.apply(this,arguments)}return f.toString=function(){return l.toString()},f}(function(l,f){return setInterval(l,f)}),clearInterval:function(l){function f(c){return l.apply(this,arguments)}return f.toString=function(){return l.toString()},f}(function(l){return clearInterval(l)})},w=!1,S=null;o.Global=function(){function l(){(function(c,b){if(!(c instanceof b))throw new TypeError("Cannot call a class as a function")})(this,l)}return l._testing=function(){w=!0},l.setXMLHttpRequest=function(c){S=c},v(l,null,[{key:"location",get:function(){if(!w)return location}},{key:"localStorage",get:function(){if(!w&&typeof window<"u")return localStorage}},{key:"sessionStorage",get:function(){if(!w&&typeof window<"u")return sessionStorage}},{key:"XMLHttpRequest",get:function(){if(!w&&typeof window<"u")return S||XMLHttpRequest}},{key:"timer",get:function(){if(!w)return h}}]),l}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.MetadataService=void 0;var v=function(){function f(c,b){for(var I=0;I<b.length;I++){var P=b[I];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(c,P.key,P)}}return function(c,b,I){return b&&f(c.prototype,b),I&&f(c,I),c}}(),h=d(0),w=d(7);function S(f,c){if(!(f instanceof c))throw new TypeError("Cannot call a class as a function")}var l=".well-known/openid-configuration";o.MetadataService=function(){function f(c){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:w.JsonService;if(S(this,f),!c)throw h.Log.error("MetadataService: No settings passed to MetadataService"),new Error("settings");this._settings=c,this._jsonService=new b(["application/jwk-set+json"])}return f.prototype.resetSigningKeys=function(){this._settings=this._settings||{},this._settings.signingKeys=void 0},f.prototype.getMetadata=function(){var b=this;return this._settings.metadata?(h.Log.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(h.Log.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then(function(I){h.Log.debug("MetadataService.getMetadata: json received");var P=b._settings.metadataSeed||{};return b._settings.metadata=Object.assign({},P,I),b._settings.metadata})):(h.Log.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))},f.prototype.getIssuer=function(){return this._getMetadataProperty("issuer")},f.prototype.getAuthorizationEndpoint=function(){return this._getMetadataProperty("authorization_endpoint")},f.prototype.getUserInfoEndpoint=function(){return this._getMetadataProperty("userinfo_endpoint")},f.prototype.getTokenEndpoint=function(){var b=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return this._getMetadataProperty("token_endpoint",b)},f.prototype.getCheckSessionIframe=function(){return this._getMetadataProperty("check_session_iframe",!0)},f.prototype.getEndSessionEndpoint=function(){return this._getMetadataProperty("end_session_endpoint",!0)},f.prototype.getRevocationEndpoint=function(){return this._getMetadataProperty("revocation_endpoint",!0)},f.prototype.getKeysEndpoint=function(){return this._getMetadataProperty("jwks_uri",!0)},f.prototype._getMetadataProperty=function(b){var I=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return h.Log.debug("MetadataService.getMetadataProperty for: "+b),this.getMetadata().then(function(P){if(h.Log.debug("MetadataService.getMetadataProperty: metadata recieved"),P[b]===void 0){if(I===!0)return void h.Log.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+b);throw h.Log.error("MetadataService.getMetadataProperty: Metadata does not contain property "+b),new Error("Metadata does not contain property "+b)}return P[b]})},f.prototype.getSigningKeys=function(){var b=this;return this._settings.signingKeys?(h.Log.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then(function(I){return h.Log.debug("MetadataService.getSigningKeys: jwks_uri received",I),b._jsonService.getJson(I).then(function(P){if(h.Log.debug("MetadataService.getSigningKeys: key set received",P),!P.keys)throw h.Log.error("MetadataService.getSigningKeys: Missing keys on keyset"),new Error("Missing keys on keyset");return b._settings.signingKeys=P.keys,b._settings.signingKeys})})},v(f,[{key:"metadataUrl",get:function(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(l)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=l))),this._metadataUrl}}]),f}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.UrlUtility=void 0;var v=d(0),h=d(1);o.UrlUtility=function(){function w(){(function(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")})(this,w)}return w.addQueryParam=function(l,f,c){return l.indexOf("?")<0&&(l+="?"),l[l.length-1]!=="?"&&(l+="&"),l+=encodeURIComponent(f),l+="=",l+=encodeURIComponent(c)},w.parseUrlFragment=function(l){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#",c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:h.Global;typeof l!="string"&&(l=c.location.href);var b=l.lastIndexOf(f);b>=0&&(l=l.substr(b+1)),f==="?"&&(b=l.indexOf("#"))>=0&&(l=l.substr(0,b));for(var I,P={},K=/([^&=]+)=([^&]*)/g,L=0;I=K.exec(l);)if(P[decodeURIComponent(I[1])]=decodeURIComponent(I[2].replace(/\+/g," ")),L++>50)return v.Log.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",l),{error:"Response exceeded expected number of parameters"};for(var k in P)return P;return{}},w}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.JoseUtil=void 0;var v=d(26),h=function(S){return S&&S.__esModule?S:{default:S}}(d(33));o.JoseUtil=(0,h.default)({jws:v.jws,KeyUtil:v.KeyUtil,X509:v.X509,crypto:v.crypto,hextob64u:v.hextob64u,b64tohex:v.b64tohex,AllowedSigningAlgs:v.AllowedSigningAlgs})},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.OidcClientSettings=void 0;var v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},h=function(){function k(R,B){for(var J=0;J<B.length;J++){var G=B[J];G.enumerable=G.enumerable||!1,G.configurable=!0,"value"in G&&(G.writable=!0),Object.defineProperty(R,G.key,G)}}return function(R,B,J){return B&&k(R.prototype,B),J&&k(R,J),R}}(),w=d(0),S=d(23),l=d(6),f=d(24),c=d(2);function b(k,R){if(!(k instanceof R))throw new TypeError("Cannot call a class as a function")}var I=".well-known/openid-configuration",P="id_token",K="openid",L="client_secret_post";o.OidcClientSettings=function(){function k(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},B=R.authority,J=R.metadataUrl,G=R.metadata,$=R.signingKeys,j=R.metadataSeed,re=R.client_id,ie=R.client_secret,M=R.response_type,oe=M===void 0?P:M,_e=R.scope,me=_e===void 0?K:_e,$e=R.redirect_uri,Ie=R.post_logout_redirect_uri,ze=R.client_authentication,Le=ze===void 0?L:ze,Ge=R.prompt,fe=R.display,ye=R.max_age,Ve=R.ui_locales,Ye=R.acr_values,tt=R.resource,rt=R.response_mode,ut=R.filterProtocolClaims,St=ut===void 0||ut,Xe=R.loadUserInfo,nt=Xe===void 0||Xe,Ke=R.staleStateAge,xe=Ke===void 0?900:Ke,V=R.clockSkew,p=V===void 0?300:V,y=R.clockService,N=y===void 0?new S.ClockService:y,W=R.userInfoJwtIssuer,X=W===void 0?"OP":W,te=R.mergeClaims,ce=te!==void 0&&te,de=R.stateStore,Se=de===void 0?new l.WebStorageStateStore:de,ve=R.ResponseValidatorCtor,we=ve===void 0?f.ResponseValidator:ve,it=R.MetadataServiceCtor,dt=it===void 0?c.MetadataService:it,he=R.extraQueryParams,Te=he===void 0?{}:he,pe=R.extraTokenParams,ct=pe===void 0?{}:pe;b(this,k),this._authority=B,this._metadataUrl=J,this._metadata=G,this._metadataSeed=j,this._signingKeys=$,this._client_id=re,this._client_secret=ie,this._response_type=oe,this._scope=me,this._redirect_uri=$e,this._post_logout_redirect_uri=Ie,this._client_authentication=Le,this._prompt=Ge,this._display=fe,this._max_age=ye,this._ui_locales=Ve,this._acr_values=Ye,this._resource=tt,this._response_mode=rt,this._filterProtocolClaims=!!St,this._loadUserInfo=!!nt,this._staleStateAge=xe,this._clockSkew=p,this._clockService=N,this._userInfoJwtIssuer=X,this._mergeClaims=!!ce,this._stateStore=Se,this._validator=new we(this),this._metadataService=new dt(this),this._extraQueryParams=(Te===void 0?"undefined":v(Te))==="object"?Te:{},this._extraTokenParams=(ct===void 0?"undefined":v(ct))==="object"?ct:{}}return k.prototype.getEpochTime=function(){return this._clockService.getEpochTime()},h(k,[{key:"client_id",get:function(){return this._client_id},set:function(B){if(this._client_id)throw w.Log.error("OidcClientSettings.set_client_id: client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=B}},{key:"client_secret",get:function(){return this._client_secret}},{key:"response_type",get:function(){return this._response_type}},{key:"scope",get:function(){return this._scope}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function(){return this._post_logout_redirect_uri}},{key:"client_authentication",get:function(){return this._client_authentication}},{key:"prompt",get:function(){return this._prompt}},{key:"display",get:function(){return this._display}},{key:"max_age",get:function(){return this._max_age}},{key:"ui_locales",get:function(){return this._ui_locales}},{key:"acr_values",get:function(){return this._acr_values}},{key:"resource",get:function(){return this._resource}},{key:"response_mode",get:function(){return this._response_mode}},{key:"authority",get:function(){return this._authority},set:function(B){if(this._authority)throw w.Log.error("OidcClientSettings.set_authority: authority has already been assigned."),new Error("authority has already been assigned.");this._authority=B}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(I)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=I)),this._metadataUrl}},{key:"metadata",get:function(){return this._metadata},set:function(B){this._metadata=B}},{key:"metadataSeed",get:function(){return this._metadataSeed},set:function(B){this._metadataSeed=B}},{key:"signingKeys",get:function(){return this._signingKeys},set:function(B){this._signingKeys=B}},{key:"filterProtocolClaims",get:function(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function(){return this._loadUserInfo}},{key:"staleStateAge",get:function(){return this._staleStateAge}},{key:"clockSkew",get:function(){return this._clockSkew}},{key:"userInfoJwtIssuer",get:function(){return this._userInfoJwtIssuer}},{key:"mergeClaims",get:function(){return this._mergeClaims}},{key:"stateStore",get:function(){return this._stateStore}},{key:"validator",get:function(){return this._validator}},{key:"metadataService",get:function(){return this._metadataService}},{key:"extraQueryParams",get:function(){return this._extraQueryParams},set:function(B){(B===void 0?"undefined":v(B))==="object"?this._extraQueryParams=B:this._extraQueryParams={}}},{key:"extraTokenParams",get:function(){return this._extraTokenParams},set:function(B){(B===void 0?"undefined":v(B))==="object"?this._extraTokenParams=B:this._extraTokenParams={}}}]),k}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.WebStorageStateStore=void 0;var v=d(0),h=d(1);function w(S,l){if(!(S instanceof l))throw new TypeError("Cannot call a class as a function")}o.WebStorageStateStore=function(){function S(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=l.prefix,c=f===void 0?"oidc.":f,b=l.store,I=b===void 0?h.Global.localStorage:b;w(this,S),this._store=I,this._prefix=c}return S.prototype.set=function(f,c){return v.Log.debug("WebStorageStateStore.set",f),f=this._prefix+f,this._store.setItem(f,c),Promise.resolve()},S.prototype.get=function(f){v.Log.debug("WebStorageStateStore.get",f),f=this._prefix+f;var c=this._store.getItem(f);return Promise.resolve(c)},S.prototype.remove=function(f){v.Log.debug("WebStorageStateStore.remove",f),f=this._prefix+f;var c=this._store.getItem(f);return this._store.removeItem(f),Promise.resolve(c)},S.prototype.getAllKeys=function(){v.Log.debug("WebStorageStateStore.getAllKeys");for(var f=[],c=0;c<this._store.length;c++){var b=this._store.key(c);b.indexOf(this._prefix)===0&&f.push(b.substr(this._prefix.length))}return Promise.resolve(f)},S}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.JsonService=void 0;var v=d(0),h=d(1);function w(S,l){if(!(S instanceof l))throw new TypeError("Cannot call a class as a function")}o.JsonService=function(){function S(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:h.Global.XMLHttpRequest,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;w(this,S),l&&Array.isArray(l)?this._contentTypes=l.slice():this._contentTypes=[],this._contentTypes.push("application/json"),c&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=f,this._jwtHandler=c}return S.prototype.getJson=function(f,c){var b=this;if(!f)throw v.Log.error("JsonService.getJson: No url passed"),new Error("url");return v.Log.debug("JsonService.getJson, url: ",f),new Promise(function(I,P){var K=new b._XMLHttpRequest;K.open("GET",f);var L=b._contentTypes,k=b._jwtHandler;K.onload=function(){if(v.Log.debug("JsonService.getJson: HTTP response received, status",K.status),K.status===200){var R=K.getResponseHeader("Content-Type");if(R){var B=L.find(function(J){if(R.startsWith(J))return!0});if(B=="application/jwt")return void k(K).then(I,P);if(B)try{return void I(JSON.parse(K.responseText))}catch(J){return v.Log.error("JsonService.getJson: Error parsing JSON response",J.message),void P(J)}}P(Error("Invalid response Content-Type: "+R+", from URL: "+f))}else P(Error(K.statusText+" ("+K.status+")"))},K.onerror=function(){v.Log.error("JsonService.getJson: network error"),P(Error("Network Error"))},c&&(v.Log.debug("JsonService.getJson: token passed, setting Authorization header"),K.setRequestHeader("Authorization","Bearer "+c)),K.send()})},S.prototype.postForm=function(f,c,b){var I=this;if(!f)throw v.Log.error("JsonService.postForm: No url passed"),new Error("url");return v.Log.debug("JsonService.postForm, url: ",f),new Promise(function(P,K){var L=new I._XMLHttpRequest;L.open("POST",f);var k=I._contentTypes;L.onload=function(){if(v.Log.debug("JsonService.postForm: HTTP response received, status",L.status),L.status!==200){if(L.status===400&&($=L.getResponseHeader("Content-Type"))&&k.find(function(j){if($.startsWith(j))return!0}))try{var G=JSON.parse(L.responseText);if(G&&G.error)return v.Log.error("JsonService.postForm: Error from server: ",G.error),void K(new Error(G.error))}catch(j){return v.Log.error("JsonService.postForm: Error parsing JSON response",j.message),void K(j)}K(Error(L.statusText+" ("+L.status+")"))}else{var $;if(($=L.getResponseHeader("Content-Type"))&&k.find(function(j){if($.startsWith(j))return!0}))try{return void P(JSON.parse(L.responseText))}catch(j){return v.Log.error("JsonService.postForm: Error parsing JSON response",j.message),void K(j)}K(Error("Invalid response Content-Type: "+$+", from URL: "+f))}},L.onerror=function(){v.Log.error("JsonService.postForm: network error"),K(Error("Network Error"))};var R="";for(var B in c){var J=c[B];J&&(R.length>0&&(R+="&"),R+=encodeURIComponent(B),R+="=",R+=encodeURIComponent(J))}L.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),b!==void 0&&L.setRequestHeader("Authorization","Basic "+btoa(b)),L.send(R)})},S}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.SigninRequest=void 0;var v=d(0),h=d(3),w=d(13);o.SigninRequest=function(){function S(l){var f=l.url,c=l.client_id,b=l.redirect_uri,I=l.response_type,P=l.scope,K=l.authority,L=l.data,k=l.prompt,R=l.display,B=l.max_age,J=l.ui_locales,G=l.id_token_hint,$=l.login_hint,j=l.acr_values,re=l.resource,ie=l.response_mode,M=l.request,oe=l.request_uri,_e=l.extraQueryParams,me=l.request_type,$e=l.client_secret,Ie=l.extraTokenParams,ze=l.skipUserInfo;if(function(tt,rt){if(!(tt instanceof rt))throw new TypeError("Cannot call a class as a function")}(this,S),!f)throw v.Log.error("SigninRequest.ctor: No url passed"),new Error("url");if(!c)throw v.Log.error("SigninRequest.ctor: No client_id passed"),new Error("client_id");if(!b)throw v.Log.error("SigninRequest.ctor: No redirect_uri passed"),new Error("redirect_uri");if(!I)throw v.Log.error("SigninRequest.ctor: No response_type passed"),new Error("response_type");if(!P)throw v.Log.error("SigninRequest.ctor: No scope passed"),new Error("scope");if(!K)throw v.Log.error("SigninRequest.ctor: No authority passed"),new Error("authority");var Le=S.isOidc(I),Ge=S.isCode(I);ie||(ie=S.isCode(I)?"query":null),this.state=new w.SigninState({nonce:Le,data:L,client_id:c,authority:K,redirect_uri:b,code_verifier:Ge,request_type:me,response_mode:ie,client_secret:$e,scope:P,extraTokenParams:Ie,skipUserInfo:ze}),f=h.UrlUtility.addQueryParam(f,"client_id",c),f=h.UrlUtility.addQueryParam(f,"redirect_uri",b),f=h.UrlUtility.addQueryParam(f,"response_type",I),f=h.UrlUtility.addQueryParam(f,"scope",P),f=h.UrlUtility.addQueryParam(f,"state",this.state.id),Le&&(f=h.UrlUtility.addQueryParam(f,"nonce",this.state.nonce)),Ge&&(f=h.UrlUtility.addQueryParam(f,"code_challenge",this.state.code_challenge),f=h.UrlUtility.addQueryParam(f,"code_challenge_method","S256"));var fe={prompt:k,display:R,max_age:B,ui_locales:J,id_token_hint:G,login_hint:$,acr_values:j,resource:re,request:M,request_uri:oe,response_mode:ie};for(var ye in fe)fe[ye]&&(f=h.UrlUtility.addQueryParam(f,ye,fe[ye]));for(var Ve in _e)f=h.UrlUtility.addQueryParam(f,Ve,_e[Ve]);this.url=f}return S.isOidc=function(f){return!!f.split(/\s+/g).filter(function(c){return c==="id_token"})[0]},S.isOAuth=function(f){return!!f.split(/\s+/g).filter(function(c){return c==="token"})[0]},S.isCode=function(f){return!!f.split(/\s+/g).filter(function(c){return c==="code"})[0]},S}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.State=void 0;var v=function(){function l(f,c){for(var b=0;b<c.length;b++){var I=c[b];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(f,I.key,I)}}return function(f,c,b){return c&&l(f.prototype,c),b&&l(f,b),f}}(),h=d(0),w=function(f){return f&&f.__esModule?f:{default:f}}(d(14));function S(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")}o.State=function(){function l(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=f.id,b=f.data,I=f.created,P=f.request_type;S(this,l),this._id=c||(0,w.default)(),this._data=b,this._created=typeof I=="number"&&I>0?I:parseInt(Date.now()/1e3),this._request_type=P}return l.prototype.toStorageString=function(){return h.Log.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})},l.fromStorageString=function(c){return h.Log.debug("State.fromStorageString"),new l(JSON.parse(c))},l.clearStaleState=function(c,b){var I=Date.now()/1e3-b;return c.getAllKeys().then(function(P){h.Log.debug("State.clearStaleState: got keys",P);for(var K=[],L=function(J){var G=P[J];R=c.get(G).then(function($){var j=!1;if($)try{var re=l.fromStorageString($);h.Log.debug("State.clearStaleState: got item from key: ",G,re.created),re.created<=I&&(j=!0)}catch(ie){h.Log.error("State.clearStaleState: Error parsing state for key",G,ie.message),j=!0}else h.Log.debug("State.clearStaleState: no item in storage for key: ",G),j=!0;if(j)return h.Log.debug("State.clearStaleState: removed item for key: ",G),c.remove(G)}),K.push(R)},k=0;k<P.length;k++){var R;L(k)}return h.Log.debug("State.clearStaleState: waiting on promise count:",K.length),Promise.all(K)})},v(l,[{key:"id",get:function(){return this._id}},{key:"data",get:function(){return this._data}},{key:"created",get:function(){return this._created}},{key:"request_type",get:function(){return this._request_type}}]),l}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.OidcClient=void 0;var v=function(){function L(k,R){for(var B=0;B<R.length;B++){var J=R[B];J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(k,J.key,J)}}return function(k,R,B){return R&&L(k.prototype,R),B&&L(k,B),k}}(),h=d(0),w=d(5),S=d(12),l=d(8),f=d(34),c=d(35),b=d(36),I=d(13),P=d(9);function K(L,k){if(!(L instanceof k))throw new TypeError("Cannot call a class as a function")}o.OidcClient=function(){function L(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};K(this,L),k instanceof w.OidcClientSettings?this._settings=k:this._settings=new w.OidcClientSettings(k)}return L.prototype.createSigninRequest=function(){var R=this,B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},J=B.response_type,G=B.scope,$=B.redirect_uri,j=B.data,re=B.state,ie=B.prompt,M=B.display,oe=B.max_age,_e=B.ui_locales,me=B.id_token_hint,$e=B.login_hint,Ie=B.acr_values,ze=B.resource,Le=B.request,Ge=B.request_uri,fe=B.response_mode,ye=B.extraQueryParams,Ve=B.extraTokenParams,Ye=B.request_type,tt=B.skipUserInfo,rt=arguments[1];h.Log.debug("OidcClient.createSigninRequest");var ut=this._settings.client_id;J=J||this._settings.response_type,G=G||this._settings.scope,$=$||this._settings.redirect_uri,ie=ie||this._settings.prompt,M=M||this._settings.display,oe=oe||this._settings.max_age,_e=_e||this._settings.ui_locales,Ie=Ie||this._settings.acr_values,ze=ze||this._settings.resource,fe=fe||this._settings.response_mode,ye=ye||this._settings.extraQueryParams,Ve=Ve||this._settings.extraTokenParams;var St=this._settings.authority;return l.SigninRequest.isCode(J)&&J!=="code"?Promise.reject(new Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then(function(Xe){h.Log.debug("OidcClient.createSigninRequest: Received authorization endpoint",Xe);var nt=new l.SigninRequest({url:Xe,client_id:ut,redirect_uri:$,response_type:J,scope:G,data:j||re,authority:St,prompt:ie,display:M,max_age:oe,ui_locales:_e,id_token_hint:me,login_hint:$e,acr_values:Ie,resource:ze,request:Le,request_uri:Ge,extraQueryParams:ye,extraTokenParams:Ve,request_type:Ye,response_mode:fe,client_secret:R._settings.client_secret,skipUserInfo:tt}),Ke=nt.state;return(rt=rt||R._stateStore).set(Ke.id,Ke.toStorageString()).then(function(){return nt})})},L.prototype.readSigninResponseState=function(R,B){var J=arguments.length>2&&arguments[2]!==void 0&&arguments[2];h.Log.debug("OidcClient.readSigninResponseState");var G=this._settings.response_mode==="query"||!this._settings.response_mode&&l.SigninRequest.isCode(this._settings.response_type),$=G?"?":"#",j=new f.SigninResponse(R,$);if(!j.state)return h.Log.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(new Error("No state in response"));B=B||this._stateStore;var re=J?B.remove.bind(B):B.get.bind(B);return re(j.state).then(function(ie){if(!ie)throw h.Log.error("OidcClient.readSigninResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:I.SigninState.fromStorageString(ie),response:j}})},L.prototype.processSigninResponse=function(R,B){var J=this;return h.Log.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(R,B,!0).then(function(G){var $=G.state,j=G.response;return h.Log.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),J._validator.validateSigninResponse($,j)})},L.prototype.createSignoutRequest=function(){var R=this,B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},J=B.id_token_hint,G=B.data,$=B.state,j=B.post_logout_redirect_uri,re=B.extraQueryParams,ie=B.request_type,M=arguments[1];return h.Log.debug("OidcClient.createSignoutRequest"),j=j||this._settings.post_logout_redirect_uri,re=re||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then(function(oe){if(!oe)throw h.Log.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),new Error("no end session endpoint");h.Log.debug("OidcClient.createSignoutRequest: Received end session endpoint",oe);var _e=new c.SignoutRequest({url:oe,id_token_hint:J,post_logout_redirect_uri:j,data:G||$,extraQueryParams:re,request_type:ie}),me=_e.state;return me&&(h.Log.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(M=M||R._stateStore).set(me.id,me.toStorageString())),_e})},L.prototype.readSignoutResponseState=function(R,B){var J=arguments.length>2&&arguments[2]!==void 0&&arguments[2];h.Log.debug("OidcClient.readSignoutResponseState");var G=new b.SignoutResponse(R);if(!G.state)return h.Log.debug("OidcClient.readSignoutResponseState: No state in response"),G.error?(h.Log.warn("OidcClient.readSignoutResponseState: Response was error: ",G.error),Promise.reject(new S.ErrorResponse(G))):Promise.resolve({state:void 0,response:G});var $=G.state;B=B||this._stateStore;var j=J?B.remove.bind(B):B.get.bind(B);return j($).then(function(re){if(!re)throw h.Log.error("OidcClient.readSignoutResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:P.State.fromStorageString(re),response:G}})},L.prototype.processSignoutResponse=function(R,B){var J=this;return h.Log.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(R,B,!0).then(function(G){var $=G.state,j=G.response;return $?(h.Log.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),J._validator.validateSignoutResponse($,j)):(h.Log.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),j)})},L.prototype.clearStaleState=function(R){return h.Log.debug("OidcClient.clearStaleState"),R=R||this._stateStore,P.State.clearStaleState(R,this.settings.staleStateAge)},v(L,[{key:"_stateStore",get:function(){return this.settings.stateStore}},{key:"_validator",get:function(){return this.settings.validator}},{key:"_metadataService",get:function(){return this.settings.metadataService}},{key:"settings",get:function(){return this._settings}},{key:"metadataService",get:function(){return this._metadataService}}]),L}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.TokenClient=void 0;var v=d(7),h=d(2),w=d(0);function S(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")}o.TokenClient=function(){function l(f){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:v.JsonService,b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:h.MetadataService;if(S(this,l),!f)throw w.Log.error("TokenClient.ctor: No settings passed"),new Error("settings");this._settings=f,this._jsonService=new c,this._metadataService=new b(this._settings)}return l.prototype.exchangeCode=function(){var c=this,b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(b=Object.assign({},b)).grant_type=b.grant_type||"authorization_code",b.client_id=b.client_id||this._settings.client_id,b.client_secret=b.client_secret||this._settings.client_secret,b.redirect_uri=b.redirect_uri||this._settings.redirect_uri;var I=void 0,P=b._client_authentication||this._settings._client_authentication;return delete b._client_authentication,b.code?b.redirect_uri?b.code_verifier?b.client_id?b.client_secret||P!="client_secret_basic"?(P=="client_secret_basic"&&(I=b.client_id+":"+b.client_secret,delete b.client_id,delete b.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(K){return w.Log.debug("TokenClient.exchangeCode: Received token endpoint"),c._jsonService.postForm(K,b,I).then(function(L){return w.Log.debug("TokenClient.exchangeCode: response received"),L})})):(w.Log.error("TokenClient.exchangeCode: No client_secret passed"),Promise.reject(new Error("A client_secret is required"))):(w.Log.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(w.Log.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(new Error("A code_verifier is required"))):(w.Log.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(new Error("A redirect_uri is required"))):(w.Log.error("TokenClient.exchangeCode: No code passed"),Promise.reject(new Error("A code is required")))},l.prototype.exchangeRefreshToken=function(){var c=this,b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(b=Object.assign({},b)).grant_type=b.grant_type||"refresh_token",b.client_id=b.client_id||this._settings.client_id,b.client_secret=b.client_secret||this._settings.client_secret;var I=void 0,P=b._client_authentication||this._settings._client_authentication;return delete b._client_authentication,b.refresh_token?b.client_id?(P=="client_secret_basic"&&(I=b.client_id+":"+b.client_secret,delete b.client_id,delete b.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(K){return w.Log.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),c._jsonService.postForm(K,b,I).then(function(L){return w.Log.debug("TokenClient.exchangeRefreshToken: response received"),L})})):(w.Log.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(w.Log.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(new Error("A refresh_token is required")))},l}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.ErrorResponse=void 0;var v=d(0);function h(S,l){if(!(S instanceof l))throw new TypeError("Cannot call a class as a function")}function w(S,l){if(!S)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!l||typeof l!="object"&&typeof l!="function"?S:l}o.ErrorResponse=function(S){function l(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=f.error,b=f.error_description,I=f.error_uri,P=f.state,K=f.session_state;if(h(this,l),!c)throw v.Log.error("No error passed to ErrorResponse"),new Error("error");var L=w(this,S.call(this,b||c));return L.name="ErrorResponse",L.error=c,L.error_description=b,L.error_uri=I,L.state=P,L.session_state=K,L}return function(c,b){if(typeof b!="function"&&b!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof b);c.prototype=Object.create(b&&b.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(c,b):c.__proto__=b)}(l,S),l}(Error)},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.SigninState=void 0;var v=function(){function b(I,P){for(var K=0;K<P.length;K++){var L=P[K];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(I,L.key,L)}}return function(I,P,K){return P&&b(I.prototype,P),K&&b(I,K),I}}(),h=d(0),w=d(9),S=d(4),l=function(I){return I&&I.__esModule?I:{default:I}}(d(14));function f(b,I){if(!(b instanceof I))throw new TypeError("Cannot call a class as a function")}function c(b,I){if(!b)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!I||typeof I!="object"&&typeof I!="function"?b:I}o.SigninState=function(b){function I(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},K=P.nonce,L=P.authority,k=P.client_id,R=P.redirect_uri,B=P.code_verifier,J=P.response_mode,G=P.client_secret,$=P.scope,j=P.extraTokenParams,re=P.skipUserInfo;f(this,I);var ie=c(this,b.call(this,arguments[0]));if(K===!0?ie._nonce=(0,l.default)():K&&(ie._nonce=K),B===!0?ie._code_verifier=(0,l.default)()+(0,l.default)()+(0,l.default)():B&&(ie._code_verifier=B),ie.code_verifier){var M=S.JoseUtil.hashString(ie.code_verifier,"SHA256");ie._code_challenge=S.JoseUtil.hexToBase64Url(M)}return ie._redirect_uri=R,ie._authority=L,ie._client_id=k,ie._response_mode=J,ie._client_secret=G,ie._scope=$,ie._extraTokenParams=j,ie._skipUserInfo=re,ie}return function(K,L){if(typeof L!="function"&&L!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof L);K.prototype=Object.create(L&&L.prototype,{constructor:{value:K,enumerable:!1,writable:!0,configurable:!0}}),L&&(Object.setPrototypeOf?Object.setPrototypeOf(K,L):K.__proto__=L)}(I,b),I.prototype.toStorageString=function(){return h.Log.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})},I.fromStorageString=function(K){return h.Log.debug("SigninState.fromStorageString"),new I(JSON.parse(K))},v(I,[{key:"nonce",get:function(){return this._nonce}},{key:"authority",get:function(){return this._authority}},{key:"client_id",get:function(){return this._client_id}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"code_verifier",get:function(){return this._code_verifier}},{key:"code_challenge",get:function(){return this._code_challenge}},{key:"response_mode",get:function(){return this._response_mode}},{key:"client_secret",get:function(){return this._client_secret}},{key:"scope",get:function(){return this._scope}},{key:"extraTokenParams",get:function(){return this._extraTokenParams}},{key:"skipUserInfo",get:function(){return this._skipUserInfo}}]),I}(w.State)},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(){return(v!="undefined"&&v!==null&&v.getRandomValues!==void 0?h:w)().replace(/-/g,"")};var v=typeof window<"u"?window.crypto||window.msCrypto:null;function h(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(S){return(S^v.getRandomValues(new Uint8Array(1))[0]&15>>S/4).toString(16)})}function w(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(S){return(S^16*Math.random()>>S/4).toString(16)})}u.exports=o.default},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.User=void 0;var v=function(){function w(S,l){for(var f=0;f<l.length;f++){var c=l[f];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(S,c.key,c)}}return function(S,l,f){return l&&w(S.prototype,l),f&&w(S,f),S}}(),h=d(0);o.User=function(){function w(S){var l=S.id_token,f=S.session_state,c=S.access_token,b=S.refresh_token,I=S.token_type,P=S.scope,K=S.profile,L=S.expires_at,k=S.state;(function(B,J){if(!(B instanceof J))throw new TypeError("Cannot call a class as a function")})(this,w),this.id_token=l,this.session_state=f,this.access_token=c,this.refresh_token=b,this.token_type=I,this.scope=P,this.profile=K,this.expires_at=L,this.state=k}return w.prototype.toStorageString=function(){return h.Log.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})},w.fromStorageString=function(l){return h.Log.debug("User.fromStorageString"),new w(JSON.parse(l))},v(w,[{key:"expires_in",get:function(){if(this.expires_at){var l=parseInt(Date.now()/1e3);return this.expires_at-l}},set:function(l){var f=parseInt(l);if(typeof f=="number"&&f>0){var c=parseInt(Date.now()/1e3);this.expires_at=c+f}}},{key:"expired",get:function(){var l=this.expires_in;if(l!==void 0)return l<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}}]),w}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.AccessTokenEvents=void 0;var v=d(0),h=d(46);function w(S,l){if(!(S instanceof l))throw new TypeError("Cannot call a class as a function")}o.AccessTokenEvents=function(){function S(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=l.accessTokenExpiringNotificationTime,c=f===void 0?60:f,b=l.accessTokenExpiringTimer,I=b===void 0?new h.Timer("Access token expiring"):b,P=l.accessTokenExpiredTimer,K=P===void 0?new h.Timer("Access token expired"):P;w(this,S),this._accessTokenExpiringNotificationTime=c,this._accessTokenExpiring=I,this._accessTokenExpired=K}return S.prototype.load=function(f){if(f.access_token&&f.expires_in!==void 0){var c=f.expires_in;if(v.Log.debug("AccessTokenEvents.load: access token present, remaining duration:",c),c>0){var b=c-this._accessTokenExpiringNotificationTime;b<=0&&(b=1),v.Log.debug("AccessTokenEvents.load: registering expiring timer in:",b),this._accessTokenExpiring.init(b)}else v.Log.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();var I=c+1;v.Log.debug("AccessTokenEvents.load: registering expired timer in:",I),this._accessTokenExpired.init(I)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},S.prototype.unload=function(){v.Log.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},S.prototype.addAccessTokenExpiring=function(f){this._accessTokenExpiring.addHandler(f)},S.prototype.removeAccessTokenExpiring=function(f){this._accessTokenExpiring.removeHandler(f)},S.prototype.addAccessTokenExpired=function(f){this._accessTokenExpired.addHandler(f)},S.prototype.removeAccessTokenExpired=function(f){this._accessTokenExpired.removeHandler(f)},S}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.Event=void 0;var v=d(0);o.Event=function(){function h(w){(function(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")})(this,h),this._name=w,this._callbacks=[]}return h.prototype.addHandler=function(S){this._callbacks.push(S)},h.prototype.removeHandler=function(S){var l=this._callbacks.findIndex(function(f){return f===S});l>=0&&this._callbacks.splice(l,1)},h.prototype.raise=function(){v.Log.debug("Event: Raising event: "+this._name);for(var S=0;S<this._callbacks.length;S++){var l;(l=this._callbacks)[S].apply(l,arguments)}},h}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.SessionMonitor=void 0;var v=function(){function f(c,b){for(var I=0;I<b.length;I++){var P=b[I];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(c,P.key,P)}}return function(c,b,I){return b&&f(c.prototype,b),I&&f(c,I),c}}(),h=d(0),w=d(19),S=d(1);function l(f,c){if(!(f instanceof c))throw new TypeError("Cannot call a class as a function")}o.SessionMonitor=function(){function f(c){var b=this,I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:w.CheckSessionIFrame,P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:S.Global.timer;if(l(this,f),!c)throw h.Log.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=c,this._CheckSessionIFrameCtor=I,this._timer=P,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),Promise.resolve(this._userManager.getUser().then(function(K){K?b._start(K):b._settings.monitorAnonymousSession&&b._userManager.querySessionStatus().then(function(L){var k={session_state:L.session_state};L.sub&&L.sid&&(k.profile={sub:L.sub,sid:L.sid}),b._start(k)}).catch(function(L){h.Log.error("SessionMonitor ctor: error from querySessionStatus:",L.message)})}).catch(function(K){h.Log.error("SessionMonitor ctor: error from getUser:",K.message)}))}return f.prototype._start=function(b){var I=this,P=b.session_state;P&&(b.profile?(this._sub=b.profile.sub,this._sid=b.profile.sid,h.Log.debug("SessionMonitor._start: session_state:",P,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,h.Log.debug("SessionMonitor._start: session_state:",P,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(P):this._metadataService.getCheckSessionIframe().then(function(K){if(K){h.Log.debug("SessionMonitor._start: Initializing check session iframe");var L=I._client_id,k=I._checkSessionInterval,R=I._stopCheckSessionOnError;I._checkSessionIFrame=new I._CheckSessionIFrameCtor(I._callback.bind(I),L,K,k,R),I._checkSessionIFrame.load().then(function(){I._checkSessionIFrame.start(P)})}else h.Log.warn("SessionMonitor._start: No check session iframe found in the metadata")}).catch(function(K){h.Log.error("SessionMonitor._start: Error from getCheckSessionIframe:",K.message)}))},f.prototype._stop=function(){var b=this;if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(h.Log.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession)var I=this._timer.setInterval(function(){b._timer.clearInterval(I),b._userManager.querySessionStatus().then(function(P){var K={session_state:P.session_state};P.sub&&P.sid&&(K.profile={sub:P.sub,sid:P.sid}),b._start(K)}).catch(function(P){h.Log.error("SessionMonitor: error from querySessionStatus:",P.message)})},1e3)},f.prototype._callback=function(){var b=this;this._userManager.querySessionStatus().then(function(I){var P=!0;I?I.sub===b._sub?(P=!1,b._checkSessionIFrame.start(I.session_state),I.sid===b._sid?h.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",I.session_state):(h.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",I.session_state),b._userManager.events._raiseUserSessionChanged())):h.Log.debug("SessionMonitor._callback: Different subject signed into OP:",I.sub):h.Log.debug("SessionMonitor._callback: Subject no longer signed into OP"),P&&(b._sub?(h.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),b._userManager.events._raiseUserSignedOut()):(h.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),b._userManager.events._raiseUserSignedIn()))}).catch(function(I){b._sub&&(h.Log.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",I.message),b._userManager.events._raiseUserSignedOut())})},v(f,[{key:"_settings",get:function(){return this._userManager.settings}},{key:"_metadataService",get:function(){return this._userManager.metadataService}},{key:"_client_id",get:function(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function(){return this._settings.checkSessionInterval}},{key:"_stopCheckSessionOnError",get:function(){return this._settings.stopCheckSessionOnError}}]),f}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.CheckSessionIFrame=void 0;var v=d(0);function h(w,S){if(!(w instanceof S))throw new TypeError("Cannot call a class as a function")}o.CheckSessionIFrame=function(){function w(S,l,f,c){var b=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];h(this,w),this._callback=S,this._client_id=l,this._url=f,this._interval=c||2e3,this._stopOnError=b;var I=f.indexOf("/",f.indexOf("//")+2);this._frame_origin=f.substr(0,I),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.width=0,this._frame.height=0,this._frame.src=f}return w.prototype.load=function(){var l=this;return new Promise(function(f){l._frame.onload=function(){f()},window.document.body.appendChild(l._frame),l._boundMessageEvent=l._message.bind(l),window.addEventListener("message",l._boundMessageEvent,!1)})},w.prototype._message=function(l){l.origin===this._frame_origin&&l.source===this._frame.contentWindow&&(l.data==="error"?(v.Log.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):l.data==="changed"?(v.Log.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):v.Log.debug("CheckSessionIFrame: "+l.data+" message from check session op iframe"))},w.prototype.start=function(l){var f=this;if(this._session_state!==l){v.Log.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=l;var c=function(){f._frame.contentWindow.postMessage(f._client_id+" "+f._session_state,f._frame_origin)};c(),this._timer=window.setInterval(c,this._interval)}},w.prototype.stop=function(){this._session_state=null,this._timer&&(v.Log.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)},w}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.TokenRevocationClient=void 0;var v=d(0),h=d(2),w=d(1);function S(c,b){if(!(c instanceof b))throw new TypeError("Cannot call a class as a function")}var l="access_token",f="refresh_token";o.TokenRevocationClient=function(){function c(b){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:w.Global.XMLHttpRequest,P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:h.MetadataService;if(S(this,c),!b)throw v.Log.error("TokenRevocationClient.ctor: No settings provided"),new Error("No settings provided.");this._settings=b,this._XMLHttpRequestCtor=I,this._metadataService=new P(this._settings)}return c.prototype.revoke=function(I,P){var K=this,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"access_token";if(!I)throw v.Log.error("TokenRevocationClient.revoke: No token provided"),new Error("No token provided.");if(L!==l&&L!=f)throw v.Log.error("TokenRevocationClient.revoke: Invalid token type"),new Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then(function(k){if(k){v.Log.debug("TokenRevocationClient.revoke: Revoking "+L);var R=K._settings.client_id,B=K._settings.client_secret;return K._revoke(k,R,B,I,L)}if(P)throw v.Log.error("TokenRevocationClient.revoke: Revocation not supported"),new Error("Revocation not supported")})},c.prototype._revoke=function(I,P,K,L,k){var R=this;return new Promise(function(B,J){var G=new R._XMLHttpRequestCtor;G.open("POST",I),G.onload=function(){v.Log.debug("TokenRevocationClient.revoke: HTTP response received, status",G.status),G.status===200?B():J(Error(G.statusText+" ("+G.status+")"))},G.onerror=function(){v.Log.debug("TokenRevocationClient.revoke: Network Error."),J("Network Error")};var $="client_id="+encodeURIComponent(P);K&&($+="&client_secret="+encodeURIComponent(K)),$+="&token_type_hint="+encodeURIComponent(k),$+="&token="+encodeURIComponent(L),G.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),G.send($)})},c}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.CordovaPopupWindow=void 0;var v=function(){function w(S,l){for(var f=0;f<l.length;f++){var c=l[f];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(S,c.key,c)}}return function(S,l,f){return l&&w(S.prototype,l),f&&w(S,f),S}}(),h=d(0);o.CordovaPopupWindow=function(){function w(S){var l=this;(function(c,b){if(!(c instanceof b))throw new TypeError("Cannot call a class as a function")})(this,w),this._promise=new Promise(function(f,c){l._resolve=f,l._reject=c}),this.features=S.popupWindowFeatures||"location=no,toolbar=no,zoom=no",this.target=S.popupWindowTarget||"_blank",this.redirect_uri=S.startUrl,h.Log.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}return w.prototype._isInAppBrowserInstalled=function(l){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some(function(f){return l.hasOwnProperty(f)})},w.prototype.navigate=function(l){if(l&&l.url){if(!window.cordova)return this._error("cordova is undefined");var f=window.cordova.require("cordova/plugin_list").metadata;if(this._isInAppBrowserInstalled(f)===!1)return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(l.url,this.target,this.features),this._popup?(h.Log.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise},w.prototype._loadStartCallback=function(l){l.url.indexOf(this.redirect_uri)===0&&this._success({url:l.url})},w.prototype._exitCallback=function(l){this._error(l)},w.prototype._success=function(l){this._cleanup(),h.Log.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(l)},w.prototype._error=function(l){this._cleanup(),h.Log.error(l),this._reject(new Error(l))},w.prototype.close=function(){this._cleanup()},w.prototype._cleanup=function(){this._popup&&(h.Log.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null},v(w,[{key:"promise",get:function(){return this._promise}}]),w}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0});var v=d(0),h=d(10),w=d(5),S=d(6),l=d(37),f=d(38),c=d(16),b=d(2),I=d(48),P=d(49),K=d(19),L=d(20),k=d(18),R=d(1),B=d(15),J=d(50);o.default={Version:J.Version,Log:v.Log,OidcClient:h.OidcClient,OidcClientSettings:w.OidcClientSettings,WebStorageStateStore:S.WebStorageStateStore,InMemoryWebStorage:l.InMemoryWebStorage,UserManager:f.UserManager,AccessTokenEvents:c.AccessTokenEvents,MetadataService:b.MetadataService,CordovaPopupNavigator:I.CordovaPopupNavigator,CordovaIFrameNavigator:P.CordovaIFrameNavigator,CheckSessionIFrame:K.CheckSessionIFrame,TokenRevocationClient:L.TokenRevocationClient,SessionMonitor:k.SessionMonitor,Global:R.Global,User:B.User},u.exports=o.default},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.ClockService=function(){function v(){(function(w,S){if(!(w instanceof S))throw new TypeError("Cannot call a class as a function")})(this,v)}return v.prototype.getEpochTime=function(){return Promise.resolve(Date.now()/1e3|0)},v}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.ResponseValidator=void 0;var v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},h=d(0),w=d(2),S=d(25),l=d(11),f=d(12),c=d(4);function b(P,K){if(!(P instanceof K))throw new TypeError("Cannot call a class as a function")}var I=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"];o.ResponseValidator=function(){function P(K){var L=arguments.length>1&&arguments[1]!==void 0?arguments[1]:w.MetadataService,k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:S.UserInfoService,R=arguments.length>3&&arguments[3]!==void 0?arguments[3]:c.JoseUtil,B=arguments.length>4&&arguments[4]!==void 0?arguments[4]:l.TokenClient;if(b(this,P),!K)throw h.Log.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),new Error("settings");this._settings=K,this._metadataService=new L(this._settings),this._userInfoService=new k(this._settings),this._joseUtil=R,this._tokenClient=new B(this._settings)}return P.prototype.validateSigninResponse=function(L,k){var R=this;return h.Log.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(L,k).then(function(B){return h.Log.debug("ResponseValidator.validateSigninResponse: state processed"),R._validateTokens(L,B).then(function(J){return h.Log.debug("ResponseValidator.validateSigninResponse: tokens validated"),R._processClaims(L,J).then(function(G){return h.Log.debug("ResponseValidator.validateSigninResponse: claims processed"),G})})})},P.prototype.validateSignoutResponse=function(L,k){return L.id!==k.state?(h.Log.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(new Error("State does not match"))):(h.Log.debug("ResponseValidator.validateSignoutResponse: state validated"),k.state=L.data,k.error?(h.Log.warn("ResponseValidator.validateSignoutResponse: Response was error",k.error),Promise.reject(new f.ErrorResponse(k))):Promise.resolve(k))},P.prototype._processSigninParams=function(L,k){if(L.id!==k.state)return h.Log.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(new Error("State does not match"));if(!L.client_id)return h.Log.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!L.authority)return h.Log.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==L.authority)return h.Log.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=L.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==L.client_id)return h.Log.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=L.client_id;return h.Log.debug("ResponseValidator._processSigninParams: state validated"),k.state=L.data,k.error?(h.Log.warn("ResponseValidator._processSigninParams: Response was error",k.error),Promise.reject(new f.ErrorResponse(k))):L.nonce&&!k.id_token?(h.Log.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!L.nonce&&k.id_token?(h.Log.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):L.code_verifier&&!k.code?(h.Log.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(new Error("No code in response"))):!L.code_verifier&&k.code?(h.Log.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(new Error("Unexpected code in response"))):(k.scope||(k.scope=L.scope),Promise.resolve(k))},P.prototype._processClaims=function(L,k){var R=this;if(k.isOpenIdConnect){if(h.Log.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),k.profile=this._filterProtocolClaims(k.profile),L.skipUserInfo!==!0&&this._settings.loadUserInfo&&k.access_token)return h.Log.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(k.access_token).then(function(B){return h.Log.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),B.sub!==k.profile.sub?(h.Log.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in id_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in id_token"))):(k.profile=R._mergeClaims(k.profile,B),h.Log.debug("ResponseValidator._processClaims: user info claims received, updated profile:",k.profile),k)});h.Log.debug("ResponseValidator._processClaims: not loading user info")}else h.Log.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(k)},P.prototype._mergeClaims=function(L,k){var R=Object.assign({},L);for(var B in k){var J=k[B];Array.isArray(J)||(J=[J]);for(var G=0;G<J.length;G++){var $=J[G];R[B]?Array.isArray(R[B])?R[B].indexOf($)<0&&R[B].push($):R[B]!==$&&(($===void 0?"undefined":v($))==="object"&&this._settings.mergeClaims?R[B]=this._mergeClaims(R[B],$):R[B]=[R[B],$]):R[B]=$}}return R},P.prototype._filterProtocolClaims=function(L){h.Log.debug("ResponseValidator._filterProtocolClaims, incoming claims:",L);var k=Object.assign({},L);return this._settings._filterProtocolClaims?(I.forEach(function(R){delete k[R]}),h.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",k)):h.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),k},P.prototype._validateTokens=function(L,k){return k.code?(h.Log.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(L,k)):k.id_token?k.access_token?(h.Log.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(L,k)):(h.Log.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(L,k)):(h.Log.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(k))},P.prototype._processCode=function(L,k){var R=this,B={client_id:L.client_id,client_secret:L.client_secret,code:k.code,redirect_uri:L.redirect_uri,code_verifier:L.code_verifier};return L.extraTokenParams&&v(L.extraTokenParams)==="object"&&Object.assign(B,L.extraTokenParams),this._tokenClient.exchangeCode(B).then(function(J){for(var G in J)k[G]=J[G];return k.id_token?(h.Log.debug("ResponseValidator._processCode: token response successful, processing id_token"),R._validateIdTokenAttributes(L,k)):(h.Log.debug("ResponseValidator._processCode: token response successful, returning response"),k)})},P.prototype._validateIdTokenAttributes=function(L,k){var R=this;return this._metadataService.getIssuer().then(function(B){var J=L.client_id,G=R._settings.clockSkew;return h.Log.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",G),R._settings.getEpochTime().then(function($){return R._joseUtil.validateJwtAttributes(k.id_token,B,J,G,$).then(function(j){return L.nonce&&L.nonce!==j.nonce?(h.Log.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):j.sub?(k.profile=j,k):(h.Log.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})})},P.prototype._validateIdTokenAndAccessToken=function(L,k){var R=this;return this._validateIdToken(L,k).then(function(B){return R._validateAccessToken(B)})},P.prototype._getSigningKeyForJwt=function(L){var k=this;return this._metadataService.getSigningKeys().then(function(R){var B=L.header.kid;if(!R)return h.Log.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));h.Log.debug("ResponseValidator._validateIdToken: Received signing keys");var J=void 0;if(B)J=R.filter(function(G){return G.kid===B})[0];else{if((R=k._filterByAlg(R,L.header.alg)).length>1)return h.Log.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));J=R[0]}return Promise.resolve(J)})},P.prototype._getSigningKeyForJwtWithSingleRetry=function(L){var k=this;return this._getSigningKeyForJwt(L).then(function(R){return R?Promise.resolve(R):(k._metadataService.resetSigningKeys(),k._getSigningKeyForJwt(L))})},P.prototype._validateIdToken=function(L,k){var R=this;if(!L.nonce)return h.Log.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(new Error("No nonce on state"));var B=this._joseUtil.parseJwt(k.id_token);return B&&B.header&&B.payload?L.nonce!==B.payload.nonce?(h.Log.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):this._metadataService.getIssuer().then(function(J){return h.Log.debug("ResponseValidator._validateIdToken: Received issuer"),R._getSigningKeyForJwtWithSingleRetry(B).then(function(G){if(!G)return h.Log.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var $=L.client_id,j=R._settings.clockSkew;return h.Log.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",j),R._joseUtil.validateJwt(k.id_token,G,J,$,j).then(function(){return h.Log.debug("ResponseValidator._validateIdToken: JWT validation successful"),B.payload.sub?(k.profile=B.payload,k):(h.Log.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})}):(h.Log.error("ResponseValidator._validateIdToken: Failed to parse id_token",B),Promise.reject(new Error("Failed to parse id_token")))},P.prototype._filterByAlg=function(L,k){var R=null;if(k.startsWith("RS"))R="RSA";else if(k.startsWith("PS"))R="PS";else{if(!k.startsWith("ES"))return h.Log.debug("ResponseValidator._filterByAlg: alg not supported: ",k),[];R="EC"}return h.Log.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",R),L=L.filter(function(B){return B.kty===R}),h.Log.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",R,L.length),L},P.prototype._validateAccessToken=function(L){if(!L.profile)return h.Log.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!L.profile.at_hash)return h.Log.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!L.id_token)return h.Log.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(new Error("No id_token"));var k=this._joseUtil.parseJwt(L.id_token);if(!k||!k.header)return h.Log.error("ResponseValidator._validateAccessToken: Failed to parse id_token",k),Promise.reject(new Error("Failed to parse id_token"));var R=k.header.alg;if(!R||R.length!==5)return h.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",R),Promise.reject(new Error("Unsupported alg: "+R));var B=R.substr(2,3);if(!B)return h.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",R,B),Promise.reject(new Error("Unsupported alg: "+R));if((B=parseInt(B))!==256&&B!==384&&B!==512)return h.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",R,B),Promise.reject(new Error("Unsupported alg: "+R));var J="sha"+B,G=this._joseUtil.hashString(L.access_token,J);if(!G)return h.Log.error("ResponseValidator._validateAccessToken: access_token hash failed:",J),Promise.reject(new Error("Failed to validate at_hash"));var $=G.substr(0,G.length/2),j=this._joseUtil.hexToBase64Url($);return j!==L.profile.at_hash?(h.Log.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",j,L.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):(h.Log.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(L))},P}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.UserInfoService=void 0;var v=d(7),h=d(2),w=d(0),S=d(4);function l(f,c){if(!(f instanceof c))throw new TypeError("Cannot call a class as a function")}o.UserInfoService=function(){function f(c){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:v.JsonService,I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:h.MetadataService,P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:S.JoseUtil;if(l(this,f),!c)throw w.Log.error("UserInfoService.ctor: No settings passed"),new Error("settings");this._settings=c,this._jsonService=new b(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new I(this._settings),this._joseUtil=P}return f.prototype.getClaims=function(b){var I=this;return b?this._metadataService.getUserInfoEndpoint().then(function(P){return w.Log.debug("UserInfoService.getClaims: received userinfo url",P),I._jsonService.getJson(P,b).then(function(K){return w.Log.debug("UserInfoService.getClaims: claims received",K),K})}):(w.Log.error("UserInfoService.getClaims: No token passed"),Promise.reject(new Error("A token is required")))},f.prototype._getClaimsFromJwt=function(b){var I=this;try{var P=this._joseUtil.parseJwt(b.responseText);if(!P||!P.header||!P.payload)return w.Log.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",P),Promise.reject(new Error("Failed to parse id_token"));var K=P.header.kid,L=void 0;switch(this._settings.userInfoJwtIssuer){case"OP":L=this._metadataService.getIssuer();break;case"ANY":L=Promise.resolve(P.payload.iss);break;default:L=Promise.resolve(this._settings.userInfoJwtIssuer)}return L.then(function(k){return w.Log.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+k),I._metadataService.getSigningKeys().then(function(R){if(!R)return w.Log.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));w.Log.debug("UserInfoService._getClaimsFromJwt: Received signing keys");var B=void 0;if(K)B=R.filter(function($){return $.kid===K})[0];else{if((R=I._filterByAlg(R,P.header.alg)).length>1)return w.Log.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));B=R[0]}if(!B)return w.Log.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var J=I._settings.client_id,G=I._settings.clockSkew;return w.Log.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",G),I._joseUtil.validateJwt(b.responseText,B,k,J,G,void 0,!0).then(function(){return w.Log.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),P.payload})})})}catch(k){return w.Log.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",k.message),void reject(k)}},f.prototype._filterByAlg=function(b,I){var P=null;if(I.startsWith("RS"))P="RSA";else if(I.startsWith("PS"))P="PS";else{if(!I.startsWith("ES"))return w.Log.debug("UserInfoService._filterByAlg: alg not supported: ",I),[];P="EC"}return w.Log.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",P),b=b.filter(function(K){return K.kty===P}),w.Log.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",P,b.length),b},f}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.AllowedSigningAlgs=o.b64tohex=o.hextob64u=o.crypto=o.X509=o.KeyUtil=o.jws=void 0;var v=d(27);o.jws=v.jws,o.KeyUtil=v.KEYUTIL,o.X509=v.X509,o.crypto=v.crypto,o.hextob64u=v.hextob64u,o.b64tohex=v.b64tohex,o.AllowedSigningAlgs=["RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"]},function(u,o,d){(function(v){Object.defineProperty(o,"__esModule",{value:!0});var h,w,S,l,f,c,b,I,P,K,L,k=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R={userAgent:!1},B={},J=J||(h=Math,S=(w={}).lib={},l=S.Base=function(){function t(){}return{extend:function(r){t.prototype=this;var n=new t;return r&&n.mixIn(r),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var r=this.extend();return r.init.apply(r,arguments),r},init:function(){},mixIn:function(r){for(var n in r)r.hasOwnProperty(n)&&(this[n]=r[n]);r.hasOwnProperty("toString")&&(this.toString=r.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),f=S.WordArray=l.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r??4*e.length},toString:function(e){return(e||b).stringify(this)},concat:function(e){var r=this.words,n=e.words,a=this.sigBytes,g=e.sigBytes;if(this.clamp(),a%4)for(var _=0;_<g;_++){var x=n[_>>>2]>>>24-_%4*8&255;r[a+_>>>2]|=x<<24-(a+_)%4*8}else for(_=0;_<g;_+=4)r[a+_>>>2]=n[_>>>2];return this.sigBytes+=g,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=h.ceil(r/4)},clone:function(){var e=l.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var r=[],n=0;n<e;n+=4)r.push(4294967296*h.random()|0);return new f.init(r,e)}}),c=w.enc={},b=c.Hex={stringify:function(e){for(var r=e.words,n=e.sigBytes,a=[],g=0;g<n;g++){var _=r[g>>>2]>>>24-g%4*8&255;a.push((_>>>4).toString(16)),a.push((15&_).toString(16))}return a.join("")},parse:function(e){for(var r=e.length,n=[],a=0;a<r;a+=2)n[a>>>3]|=parseInt(e.substr(a,2),16)<<24-a%8*4;return new f.init(n,r/2)}},I=c.Latin1={stringify:function(e){for(var r=e.words,n=e.sigBytes,a=[],g=0;g<n;g++){var _=r[g>>>2]>>>24-g%4*8&255;a.push(String.fromCharCode(_))}return a.join("")},parse:function(e){for(var r=e.length,n=[],a=0;a<r;a++)n[a>>>2]|=(255&e.charCodeAt(a))<<24-a%4*8;return new f.init(n,r)}},P=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(I.stringify(e)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(e){return I.parse(unescape(encodeURIComponent(e)))}},K=S.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=P.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var r=this._data,n=r.words,a=r.sigBytes,g=this.blockSize,_=a/(4*g),x=(_=e?h.ceil(_):h.max((0|_)-this._minBufferSize,0))*g,F=h.min(4*x,a);if(x){for(var A=0;A<x;A+=g)this._doProcessBlock(n,A);var T=n.splice(0,x);r.sigBytes-=F}return new f.init(T,F)},clone:function(){var e=l.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),S.Hasher=K.extend({cfg:l.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){K.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(r,n){return new e.init(n).finalize(r)}},_createHmacHelper:function(e){return function(r,n){return new L.HMAC.init(e,n).finalize(r)}}}),L=w.algo={},w);(function(t){var e,r=(e=J).lib,n=r.Base,a=r.WordArray;(e=e.x64={}).Word=n.extend({init:function(_,x){this.high=_,this.low=x}}),e.WordArray=n.extend({init:function(_,x){_=this.words=_||[],this.sigBytes=x??8*_.length},toX32:function(){for(var _=this.words,x=_.length,F=[],A=0;A<x;A++){var T=_[A];F.push(T.high),F.push(T.low)}return a.create(F,this.sigBytes)},clone:function(){for(var _=n.clone.call(this),x=_.words=this.words.slice(0),F=x.length,A=0;A<F;A++)x[A]=x[A].clone();return _}})})(),function(){var t=J,e=t.lib.WordArray;t.enc.Base64={stringify:function(n){var a=n.words,g=n.sigBytes,_=this._map;n.clamp(),n=[];for(var x=0;x<g;x+=3)for(var F=(a[x>>>2]>>>24-x%4*8&255)<<16|(a[x+1>>>2]>>>24-(x+1)%4*8&255)<<8|a[x+2>>>2]>>>24-(x+2)%4*8&255,A=0;4>A&&x+.75*A<g;A++)n.push(_.charAt(F>>>6*(3-A)&63));if(a=_.charAt(64))for(;n.length%4;)n.push(a);return n.join("")},parse:function(n){var a=n.length,g=this._map;(_=g.charAt(64))&&(_=n.indexOf(_))!=-1&&(a=_);for(var _=[],x=0,F=0;F<a;F++)if(F%4){var A=g.indexOf(n.charAt(F-1))<<F%4*2,T=g.indexOf(n.charAt(F))>>>6-F%4*2;_[x>>>2]|=(A|T)<<24-x%4*8,x++}return e.create(_,x)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(t){for(var e=J,r=(a=e.lib).WordArray,n=a.Hasher,a=e.algo,g=[],_=[],x=function(Q){return 4294967296*(Q-(0|Q))|0},F=2,A=0;64>A;){var T;e:{T=F;for(var U=t.sqrt(T),H=2;H<=U;H++)if(!(T%H)){T=!1;break e}T=!0}T&&(8>A&&(g[A]=x(t.pow(F,.5))),_[A]=x(t.pow(F,1/3)),A++),F++}var q=[];a=a.SHA256=n.extend({_doReset:function(){this._hash=new r.init(g.slice(0))},_doProcessBlock:function(Q,Z){for(var m=this._hash.words,C=m[0],D=m[1],O=m[2],Y=m[3],ee=m[4],ue=m[5],ne=m[6],ge=m[7],ae=0;64>ae;ae++){if(16>ae)q[ae]=0|Q[Z+ae];else{var le=q[ae-15],Ee=q[ae-2];q[ae]=((le<<25|le>>>7)^(le<<14|le>>>18)^le>>>3)+q[ae-7]+((Ee<<15|Ee>>>17)^(Ee<<13|Ee>>>19)^Ee>>>10)+q[ae-16]}le=ge+((ee<<26|ee>>>6)^(ee<<21|ee>>>11)^(ee<<7|ee>>>25))+(ee&ue^~ee&ne)+_[ae]+q[ae],Ee=((C<<30|C>>>2)^(C<<19|C>>>13)^(C<<10|C>>>22))+(C&D^C&O^D&O),ge=ne,ne=ue,ue=ee,ee=Y+le|0,Y=O,O=D,D=C,C=le+Ee|0}m[0]=m[0]+C|0,m[1]=m[1]+D|0,m[2]=m[2]+O|0,m[3]=m[3]+Y|0,m[4]=m[4]+ee|0,m[5]=m[5]+ue|0,m[6]=m[6]+ne|0,m[7]=m[7]+ge|0},_doFinalize:function(){var Q=this._data,Z=Q.words,m=8*this._nDataBytes,C=8*Q.sigBytes;return Z[C>>>5]|=128<<24-C%32,Z[14+(C+64>>>9<<4)]=t.floor(m/4294967296),Z[15+(C+64>>>9<<4)]=m,Q.sigBytes=4*Z.length,this._process(),this._hash},clone:function(){var Q=n.clone.call(this);return Q._hash=this._hash.clone(),Q}}),e.SHA256=n._createHelper(a),e.HmacSHA256=n._createHmacHelper(a)}(Math),function(){function t(){return n.create.apply(n,arguments)}for(var e=J,r=e.lib.Hasher,n=(g=e.x64).Word,a=g.WordArray,g=e.algo,_=[t(1116352408,3609767458),t(1899447441,602891725),t(3049323471,3964484399),t(3921009573,2173295548),t(961987163,4081628472),t(1508970993,3053834265),t(2453635748,2937671579),t(2870763221,3664609560),t(3624381080,2734883394),t(310598401,1164996542),t(607225278,1323610764),t(1426881987,3590304994),t(1925078388,4068182383),t(2162078206,991336113),t(2614888103,633803317),t(3248222580,3479774868),t(3835390401,2666613458),t(4022224774,944711139),t(264347078,2341262773),t(604807628,2007800933),t(770255983,1495990901),t(1249150122,1856431235),t(1555081692,3175218132),t(1996064986,2198950837),t(2554220882,3999719339),t(2821834349,766784016),t(2952996808,2566594879),t(3210313671,3203337956),t(3336571891,1034457026),t(3584528711,2466948901),t(113926993,3758326383),t(338241895,168717936),t(666307205,1188179964),t(773529912,1546045734),t(1294757372,1522805485),t(1396182291,2643833823),t(1695183700,2343527390),t(1986661051,1014477480),t(2177026350,1206759142),t(2456956037,344077627),t(2730485921,1290863460),t(2820302411,3158454273),t(3259730800,3505952657),t(3345764771,106217008),t(3516065817,3606008344),t(3600352804,1432725776),t(4094571909,1467031594),t(275423344,851169720),t(430227734,3100823752),t(506948616,1363258195),t(659060556,3750685593),t(883997877,3785050280),t(958139571,3318307427),t(1322822218,3812723403),t(1537002063,2003034995),t(1747873779,3602036899),t(1955562222,1575990012),t(2024104815,1125592928),t(2227730452,2716904306),t(2361852424,442776044),t(2428436474,593698344),t(2756734187,3733110249),t(3204031479,2999351573),t(3329325298,3815920427),t(3391569614,3928383900),t(3515267271,566280711),t(3940187606,3454069534),t(4118630271,4000239992),t(116418474,1914138554),t(174292421,2731055270),t(289380356,3203993006),t(460393269,320620315),t(685471733,587496836),t(852142971,1086792851),t(1017036298,365543100),t(1126000580,2618297676),t(1288033470,3409855158),t(1501505948,4234509866),t(1607167915,987167468),t(1816402316,1246189591)],x=[],F=0;80>F;F++)x[F]=t();g=g.SHA512=r.extend({_doReset:function(){this._hash=new a.init([new n.init(1779033703,4089235720),new n.init(3144134277,2227873595),new n.init(1013904242,4271175723),new n.init(2773480762,1595750129),new n.init(1359893119,2917565137),new n.init(2600822924,725511199),new n.init(528734635,4215389547),new n.init(1541459225,327033209)])},_doProcessBlock:function(T,U){for(var H=(D=this._hash.words)[0],q=D[1],z=D[2],Q=D[3],Z=D[4],m=D[5],C=D[6],D=D[7],O=H.high,Y=H.low,ee=q.high,ue=q.low,ne=z.high,ge=z.low,ae=Q.high,le=Q.low,Ee=Z.high,Pe=Z.low,Ae=m.high,st=m.low,Qe=C.high,Ze=C.low,Ue=D.high,Be=D.low,Je=O,et=Y,Jt=ee,It=ue,Wt=ne,Ut=ge,_r=ae,qt=le,gt=Ee,lt=Pe,or=Ae,$t=st,sr=Qe,zt=Ze,Sr=Ue,Gt=Be,pt=0;80>pt;pt++){var Pt=x[pt];if(16>pt)var bt=Pt.high=0|T[U+2*pt],ke=Pt.low=0|T[U+2*pt+1];else{bt=((ke=(bt=x[pt-15]).high)>>>1|(Et=bt.low)<<31)^(ke>>>8|Et<<24)^ke>>>7;var Et=(Et>>>1|ke<<31)^(Et>>>8|ke<<24)^(Et>>>7|ke<<25),Dt=((ke=(Dt=x[pt-2]).high)>>>19|(Me=Dt.low)<<13)^(ke<<3|Me>>>29)^ke>>>6,Me=(Me>>>19|ke<<13)^(Me<<3|ke>>>29)^(Me>>>6|ke<<26),wr=(ke=x[pt-7]).high,kt=(Tt=x[pt-16]).high,Tt=Tt.low;bt=(bt=(bt=bt+wr+((ke=Et+ke.low)>>>0<Et>>>0?1:0))+Dt+((ke=ke+Me)>>>0<Me>>>0?1:0))+kt+((ke=ke+Tt)>>>0<Tt>>>0?1:0),Pt.high=bt,Pt.low=ke}wr=gt&or^~gt&sr,Tt=lt&$t^~lt&zt,Pt=Je&Jt^Je&Wt^Jt&Wt;var Ei=et&It^et&Ut^It&Ut,Fi=(Et=(Je>>>28|et<<4)^(Je<<30|et>>>2)^(Je<<25|et>>>7),Dt=(et>>>28|Je<<4)^(et<<30|Je>>>2)^(et<<25|Je>>>7),(Me=_[pt]).high),an=Me.low;kt=Sr+((gt>>>14|lt<<18)^(gt>>>18|lt<<14)^(gt<<23|lt>>>9))+((Me=Gt+((lt>>>14|gt<<18)^(lt>>>18|gt<<14)^(lt<<23|gt>>>9)))>>>0<Gt>>>0?1:0),Sr=sr,Gt=zt,sr=or,zt=$t,or=gt,$t=lt,gt=_r+(kt=(kt=(kt=kt+wr+((Me=Me+Tt)>>>0<Tt>>>0?1:0))+Fi+((Me=Me+an)>>>0<an>>>0?1:0))+bt+((Me=Me+ke)>>>0<ke>>>0?1:0))+((lt=qt+Me|0)>>>0<qt>>>0?1:0)|0,_r=Wt,qt=Ut,Wt=Jt,Ut=It,Jt=Je,It=et,Je=kt+(Pt=Et+Pt+((ke=Dt+Ei)>>>0<Dt>>>0?1:0))+((et=Me+ke|0)>>>0<Me>>>0?1:0)|0}Y=H.low=Y+et,H.high=O+Je+(Y>>>0<et>>>0?1:0),ue=q.low=ue+It,q.high=ee+Jt+(ue>>>0<It>>>0?1:0),ge=z.low=ge+Ut,z.high=ne+Wt+(ge>>>0<Ut>>>0?1:0),le=Q.low=le+qt,Q.high=ae+_r+(le>>>0<qt>>>0?1:0),Pe=Z.low=Pe+lt,Z.high=Ee+gt+(Pe>>>0<lt>>>0?1:0),st=m.low=st+$t,m.high=Ae+or+(st>>>0<$t>>>0?1:0),Ze=C.low=Ze+zt,C.high=Qe+sr+(Ze>>>0<zt>>>0?1:0),Be=D.low=Be+Gt,D.high=Ue+Sr+(Be>>>0<Gt>>>0?1:0)},_doFinalize:function(){var T=this._data,U=T.words,H=8*this._nDataBytes,q=8*T.sigBytes;return U[q>>>5]|=128<<24-q%32,U[30+(q+128>>>10<<5)]=Math.floor(H/4294967296),U[31+(q+128>>>10<<5)]=H,T.sigBytes=4*U.length,this._process(),this._hash.toX32()},clone:function(){var T=r.clone.call(this);return T._hash=this._hash.clone(),T},blockSize:32}),e.SHA512=r._createHelper(g),e.HmacSHA512=r._createHmacHelper(g)}(),function(){var t=J,e=(a=t.x64).Word,r=a.WordArray,n=(a=t.algo).SHA512,a=a.SHA384=n.extend({_doReset:function(){this._hash=new r.init([new e.init(3418070365,3238371032),new e.init(1654270250,914150663),new e.init(2438529370,812702999),new e.init(355462360,4144912697),new e.init(1731405415,4290775857),new e.init(2394180231,1750603025),new e.init(3675008525,1694076839),new e.init(1203062813,3204075428)])},_doFinalize:function(){var _=n._doFinalize.call(this);return _.sigBytes-=16,_}});t.SHA384=n._createHelper(a),t.HmacSHA384=n._createHmacHelper(a)}();/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */var G,$="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function j(t){var e,r,n="";for(e=0;e+3<=t.length;e+=3)r=parseInt(t.substring(e,e+3),16),n+=$.charAt(r>>6)+$.charAt(63&r);for(e+1==t.length?(r=parseInt(t.substring(e,e+1),16),n+=$.charAt(r<<2)):e+2==t.length&&(r=parseInt(t.substring(e,e+2),16),n+=$.charAt(r>>2)+$.charAt((3&r)<<4)),"=";(3&n.length)>0;)n+="=";return n}function re(t){var e,r,n,a="",g=0;for(e=0;e<t.length&&t.charAt(e)!="=";++e)(n=$.indexOf(t.charAt(e)))<0||(g==0?(a+=Ie(n>>2),r=3&n,g=1):g==1?(a+=Ie(r<<2|n>>4),r=15&n,g=2):g==2?(a+=Ie(r),a+=Ie(n>>2),r=3&n,g=3):(a+=Ie(r<<2|n>>4),a+=Ie(15&n),g=0));return g==1&&(a+=Ie(r<<2)),a}function ie(t){var e,r=re(t),n=new Array;for(e=0;2*e<r.length;++e)n[e]=parseInt(r.substring(2*e,2*e+2),16);return n}function M(t,e,r){t!=null&&(typeof t=="number"?this.fromNumber(t,e,r):e==null&&typeof t!="string"?this.fromString(t,256):this.fromString(t,e))}function oe(){return new M(null)}R.appName=="Microsoft Internet Explorer"?(M.prototype.am=function(e,r,n,a,g,_){for(var x=32767&r,F=r>>15;--_>=0;){var A=32767&this[e],T=this[e++]>>15,U=F*A+T*x;g=((A=x*A+((32767&U)<<15)+n[a]+(1073741823&g))>>>30)+(U>>>15)+F*T+(g>>>30),n[a++]=1073741823&A}return g},G=30):R.appName!="Netscape"?(M.prototype.am=function(e,r,n,a,g,_){for(;--_>=0;){var x=r*this[e++]+n[a]+g;g=Math.floor(x/67108864),n[a++]=67108863&x}return g},G=26):(M.prototype.am=function(e,r,n,a,g,_){for(var x=16383&r,F=r>>14;--_>=0;){var A=16383&this[e],T=this[e++]>>14,U=F*A+T*x;g=((A=x*A+((16383&U)<<14)+n[a]+g)>>28)+(U>>14)+F*T,n[a++]=268435455&A}return g},G=28),M.prototype.DB=G,M.prototype.DM=(1<<G)-1,M.prototype.DV=1<<G,M.prototype.FV=Math.pow(2,52),M.prototype.F1=52-G,M.prototype.F2=2*G-52;var _e,me,$e=new Array;for(_e="0".charCodeAt(0),me=0;me<=9;++me)$e[_e++]=me;for(_e="a".charCodeAt(0),me=10;me<36;++me)$e[_e++]=me;for(_e="A".charCodeAt(0),me=10;me<36;++me)$e[_e++]=me;function Ie(t){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(t)}function ze(t,e){var r=$e[t.charCodeAt(e)];return r??-1}function Le(t){var e=oe();return e.fromInt(t),e}function Ge(t){var e,r=1;return(e=t>>>16)!=0&&(t=e,r+=16),(e=t>>8)!=0&&(t=e,r+=8),(e=t>>4)!=0&&(t=e,r+=4),(e=t>>2)!=0&&(t=e,r+=2),(e=t>>1)!=0&&(t=e,r+=1),r}function fe(t){this.m=t}function ye(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function Ve(t,e){return t&e}function Ye(t,e){return t|e}function tt(t,e){return t^e}function rt(t,e){return t&~e}function ut(t){if(t==0)return-1;var e=0;return!(65535&t)&&(t>>=16,e+=16),!(255&t)&&(t>>=8,e+=8),!(15&t)&&(t>>=4,e+=4),!(3&t)&&(t>>=2,e+=2),!(1&t)&&++e,e}function St(t){for(var e=0;t!=0;)t&=t-1,++e;return e}function Xe(){}function nt(t){return t}function Ke(t){this.r2=oe(),this.q3=oe(),M.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}fe.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},fe.prototype.revert=function(e){return e},fe.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},fe.prototype.mulTo=function(e,r,n){e.multiplyTo(r,n),this.reduce(n)},fe.prototype.sqrTo=function(e,r){e.squareTo(r),this.reduce(r)},ye.prototype.convert=function(e){var r=oe();return e.abs().dlShiftTo(this.m.t,r),r.divRemTo(this.m,null,r),e.s<0&&r.compareTo(M.ZERO)>0&&this.m.subTo(r,r),r},ye.prototype.revert=function(e){var r=oe();return e.copyTo(r),this.reduce(r),r},ye.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var r=0;r<this.m.t;++r){var n=32767&e[r],a=n*this.mpl+((n*this.mph+(e[r]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[n=r+this.m.t]+=this.m.am(0,a,e,r,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},ye.prototype.mulTo=function(e,r,n){e.multiplyTo(r,n),this.reduce(n)},ye.prototype.sqrTo=function(e,r){e.squareTo(r),this.reduce(r)},M.prototype.copyTo=function(e){for(var r=this.t-1;r>=0;--r)e[r]=this[r];e.t=this.t,e.s=this.s},M.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},M.prototype.fromString=function(e,r){var n;if(r==16)n=4;else if(r==8)n=3;else if(r==256)n=8;else if(r==2)n=1;else if(r==32)n=5;else{if(r!=4)return void this.fromRadix(e,r);n=2}this.t=0,this.s=0;for(var a=e.length,g=!1,_=0;--a>=0;){var x=n==8?255&e[a]:ze(e,a);x<0?e.charAt(a)=="-"&&(g=!0):(g=!1,_==0?this[this.t++]=x:_+n>this.DB?(this[this.t-1]|=(x&(1<<this.DB-_)-1)<<_,this[this.t++]=x>>this.DB-_):this[this.t-1]|=x<<_,(_+=n)>=this.DB&&(_-=this.DB))}n==8&&128&e[0]&&(this.s=-1,_>0&&(this[this.t-1]|=(1<<this.DB-_)-1<<_)),this.clamp(),g&&M.ZERO.subTo(this,this)},M.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},M.prototype.dlShiftTo=function(e,r){var n;for(n=this.t-1;n>=0;--n)r[n+e]=this[n];for(n=e-1;n>=0;--n)r[n]=0;r.t=this.t+e,r.s=this.s},M.prototype.drShiftTo=function(e,r){for(var n=e;n<this.t;++n)r[n-e]=this[n];r.t=Math.max(this.t-e,0),r.s=this.s},M.prototype.lShiftTo=function(e,r){var n,a=e%this.DB,g=this.DB-a,_=(1<<g)-1,x=Math.floor(e/this.DB),F=this.s<<a&this.DM;for(n=this.t-1;n>=0;--n)r[n+x+1]=this[n]>>g|F,F=(this[n]&_)<<a;for(n=x-1;n>=0;--n)r[n]=0;r[x]=F,r.t=this.t+x+1,r.s=this.s,r.clamp()},M.prototype.rShiftTo=function(e,r){r.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)r.t=0;else{var a=e%this.DB,g=this.DB-a,_=(1<<a)-1;r[0]=this[n]>>a;for(var x=n+1;x<this.t;++x)r[x-n-1]|=(this[x]&_)<<g,r[x-n]=this[x]>>a;a>0&&(r[this.t-n-1]|=(this.s&_)<<g),r.t=this.t-n,r.clamp()}},M.prototype.subTo=function(e,r){for(var n=0,a=0,g=Math.min(e.t,this.t);n<g;)a+=this[n]-e[n],r[n++]=a&this.DM,a>>=this.DB;if(e.t<this.t){for(a-=e.s;n<this.t;)a+=this[n],r[n++]=a&this.DM,a>>=this.DB;a+=this.s}else{for(a+=this.s;n<e.t;)a-=e[n],r[n++]=a&this.DM,a>>=this.DB;a-=e.s}r.s=a<0?-1:0,a<-1?r[n++]=this.DV+a:a>0&&(r[n++]=a),r.t=n,r.clamp()},M.prototype.multiplyTo=function(e,r){var n=this.abs(),a=e.abs(),g=n.t;for(r.t=g+a.t;--g>=0;)r[g]=0;for(g=0;g<a.t;++g)r[g+n.t]=n.am(0,a[g],r,g,0,n.t);r.s=0,r.clamp(),this.s!=e.s&&M.ZERO.subTo(r,r)},M.prototype.squareTo=function(e){for(var r=this.abs(),n=e.t=2*r.t;--n>=0;)e[n]=0;for(n=0;n<r.t-1;++n){var a=r.am(n,r[n],e,2*n,0,1);(e[n+r.t]+=r.am(n+1,2*r[n],e,2*n+1,a,r.t-n-1))>=r.DV&&(e[n+r.t]-=r.DV,e[n+r.t+1]=1)}e.t>0&&(e[e.t-1]+=r.am(n,r[n],e,2*n,0,1)),e.s=0,e.clamp()},M.prototype.divRemTo=function(e,r,n){var a=e.abs();if(!(a.t<=0)){var g=this.abs();if(g.t<a.t)return r!=null&&r.fromInt(0),void(n!=null&&this.copyTo(n));n==null&&(n=oe());var _=oe(),x=this.s,F=e.s,A=this.DB-Ge(a[a.t-1]);A>0?(a.lShiftTo(A,_),g.lShiftTo(A,n)):(a.copyTo(_),g.copyTo(n));var T=_.t,U=_[T-1];if(U!=0){var H=U*(1<<this.F1)+(T>1?_[T-2]>>this.F2:0),q=this.FV/H,z=(1<<this.F1)/H,Q=1<<this.F2,Z=n.t,m=Z-T,C=r??oe();for(_.dlShiftTo(m,C),n.compareTo(C)>=0&&(n[n.t++]=1,n.subTo(C,n)),M.ONE.dlShiftTo(T,C),C.subTo(_,_);_.t<T;)_[_.t++]=0;for(;--m>=0;){var D=n[--Z]==U?this.DM:Math.floor(n[Z]*q+(n[Z-1]+Q)*z);if((n[Z]+=_.am(0,D,n,m,0,T))<D)for(_.dlShiftTo(m,C),n.subTo(C,n);n[Z]<--D;)n.subTo(C,n)}r!=null&&(n.drShiftTo(T,r),x!=F&&M.ZERO.subTo(r,r)),n.t=T,n.clamp(),A>0&&n.rShiftTo(A,n),x<0&&M.ZERO.subTo(n,n)}}},M.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(!(1&e))return 0;var r=3&e;return(r=(r=(r=(r=r*(2-(15&e)*r)&15)*(2-(255&e)*r)&255)*(2-((65535&e)*r&65535))&65535)*(2-e*r%this.DV)%this.DV)>0?this.DV-r:-r},M.prototype.isEven=function(){return(this.t>0?1&this[0]:this.s)==0},M.prototype.exp=function(e,r){if(e>4294967295||e<1)return M.ONE;var n=oe(),a=oe(),g=r.convert(this),_=Ge(e)-1;for(g.copyTo(n);--_>=0;)if(r.sqrTo(n,a),(e&1<<_)>0)r.mulTo(a,g,n);else{var x=n;n=a,a=x}return r.revert(n)},M.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var r;if(e==16)r=4;else if(e==8)r=3;else if(e==2)r=1;else if(e==32)r=5;else{if(e!=4)return this.toRadix(e);r=2}var n,a=(1<<r)-1,g=!1,_="",x=this.t,F=this.DB-x*this.DB%r;if(x-- >0)for(F<this.DB&&(n=this[x]>>F)>0&&(g=!0,_=Ie(n));x>=0;)F<r?(n=(this[x]&(1<<F)-1)<<r-F,n|=this[--x]>>(F+=this.DB-r)):(n=this[x]>>(F-=r)&a,F<=0&&(F+=this.DB,--x)),n>0&&(g=!0),g&&(_+=Ie(n));return g?_:"0"},M.prototype.negate=function(){var e=oe();return M.ZERO.subTo(this,e),e},M.prototype.abs=function(){return this.s<0?this.negate():this},M.prototype.compareTo=function(e){var r=this.s-e.s;if(r!=0)return r;var n=this.t;if((r=n-e.t)!=0)return this.s<0?-r:r;for(;--n>=0;)if((r=this[n]-e[n])!=0)return r;return 0},M.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+Ge(this[this.t-1]^this.s&this.DM)},M.prototype.mod=function(e){var r=oe();return this.abs().divRemTo(e,null,r),this.s<0&&r.compareTo(M.ZERO)>0&&e.subTo(r,r),r},M.prototype.modPowInt=function(e,r){var n;return n=e<256||r.isEven()?new fe(r):new ye(r),this.exp(e,n)},M.ZERO=Le(0),M.ONE=Le(1),Xe.prototype.convert=nt,Xe.prototype.revert=nt,Xe.prototype.mulTo=function(e,r,n){e.multiplyTo(r,n)},Xe.prototype.sqrTo=function(e,r){e.squareTo(r)},Ke.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var r=oe();return e.copyTo(r),this.reduce(r),r},Ke.prototype.revert=function(e){return e},Ke.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},Ke.prototype.mulTo=function(e,r,n){e.multiplyTo(r,n),this.reduce(n)},Ke.prototype.sqrTo=function(e,r){e.squareTo(r),this.reduce(r)};var xe=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],V=(1<<26)/xe[xe.length-1];/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function p(){this.i=0,this.j=0,this.S=new Array}M.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},M.prototype.toRadix=function(e){if(e==null&&(e=10),this.signum()==0||e<2||e>36)return"0";var r=this.chunkSize(e),n=Math.pow(e,r),a=Le(n),g=oe(),_=oe(),x="";for(this.divRemTo(a,g,_);g.signum()>0;)x=(n+_.intValue()).toString(e).substr(1)+x,g.divRemTo(a,g,_);return _.intValue().toString(e)+x},M.prototype.fromRadix=function(e,r){this.fromInt(0),r==null&&(r=10);for(var n=this.chunkSize(r),a=Math.pow(r,n),g=!1,_=0,x=0,F=0;F<e.length;++F){var A=ze(e,F);A<0?e.charAt(F)=="-"&&this.signum()==0&&(g=!0):(x=r*x+A,++_>=n&&(this.dMultiply(a),this.dAddOffset(x,0),_=0,x=0))}_>0&&(this.dMultiply(Math.pow(r,_)),this.dAddOffset(x,0)),g&&M.ZERO.subTo(this,this)},M.prototype.fromNumber=function(e,r,n){if(typeof r=="number")if(e<2)this.fromInt(1);else for(this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(M.ONE.shiftLeft(e-1),Ye,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(r);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(M.ONE.shiftLeft(e-1),this);else{var a=new Array,g=7&e;a.length=1+(e>>3),r.nextBytes(a),g>0?a[0]&=(1<<g)-1:a[0]=0,this.fromString(a,256)}},M.prototype.bitwiseTo=function(e,r,n){var a,g,_=Math.min(e.t,this.t);for(a=0;a<_;++a)n[a]=r(this[a],e[a]);if(e.t<this.t){for(g=e.s&this.DM,a=_;a<this.t;++a)n[a]=r(this[a],g);n.t=this.t}else{for(g=this.s&this.DM,a=_;a<e.t;++a)n[a]=r(g,e[a]);n.t=e.t}n.s=r(this.s,e.s),n.clamp()},M.prototype.changeBit=function(e,r){var n=M.ONE.shiftLeft(e);return this.bitwiseTo(n,r,n),n},M.prototype.addTo=function(e,r){for(var n=0,a=0,g=Math.min(e.t,this.t);n<g;)a+=this[n]+e[n],r[n++]=a&this.DM,a>>=this.DB;if(e.t<this.t){for(a+=e.s;n<this.t;)a+=this[n],r[n++]=a&this.DM,a>>=this.DB;a+=this.s}else{for(a+=this.s;n<e.t;)a+=e[n],r[n++]=a&this.DM,a>>=this.DB;a+=e.s}r.s=a<0?-1:0,a>0?r[n++]=a:a<-1&&(r[n++]=this.DV+a),r.t=n,r.clamp()},M.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},M.prototype.dAddOffset=function(e,r){if(e!=0){for(;this.t<=r;)this[this.t++]=0;for(this[r]+=e;this[r]>=this.DV;)this[r]-=this.DV,++r>=this.t&&(this[this.t++]=0),++this[r]}},M.prototype.multiplyLowerTo=function(e,r,n){var a,g=Math.min(this.t+e.t,r);for(n.s=0,n.t=g;g>0;)n[--g]=0;for(a=n.t-this.t;g<a;++g)n[g+this.t]=this.am(0,e[g],n,g,0,this.t);for(a=Math.min(e.t,r);g<a;++g)this.am(0,e[g],n,g,0,r-g);n.clamp()},M.prototype.multiplyUpperTo=function(e,r,n){--r;var a=n.t=this.t+e.t-r;for(n.s=0;--a>=0;)n[a]=0;for(a=Math.max(r-this.t,0);a<e.t;++a)n[this.t+a-r]=this.am(r-a,e[a],n,0,0,this.t+a-r);n.clamp(),n.drShiftTo(1,n)},M.prototype.modInt=function(e){if(e<=0)return 0;var r=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(r==0)n=this[0]%e;else for(var a=this.t-1;a>=0;--a)n=(r*n+this[a])%e;return n},M.prototype.millerRabin=function(e){var r=this.subtract(M.ONE),n=r.getLowestSetBit();if(n<=0)return!1;var a=r.shiftRight(n);(e=e+1>>1)>xe.length&&(e=xe.length);for(var g=oe(),_=0;_<e;++_){g.fromInt(xe[Math.floor(Math.random()*xe.length)]);var x=g.modPow(a,this);if(x.compareTo(M.ONE)!=0&&x.compareTo(r)!=0){for(var F=1;F++<n&&x.compareTo(r)!=0;)if((x=x.modPowInt(2,this)).compareTo(M.ONE)==0)return!1;if(x.compareTo(r)!=0)return!1}}return!0},M.prototype.clone=function(){var e=oe();return this.copyTo(e),e},M.prototype.intValue=function(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},M.prototype.byteValue=function(){return this.t==0?this.s:this[0]<<24>>24},M.prototype.shortValue=function(){return this.t==0?this.s:this[0]<<16>>16},M.prototype.signum=function(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1},M.prototype.toByteArray=function(){var e=this.t,r=new Array;r[0]=this.s;var n,a=this.DB-e*this.DB%8,g=0;if(e-- >0)for(a<this.DB&&(n=this[e]>>a)!=(this.s&this.DM)>>a&&(r[g++]=n|this.s<<this.DB-a);e>=0;)a<8?(n=(this[e]&(1<<a)-1)<<8-a,n|=this[--e]>>(a+=this.DB-8)):(n=this[e]>>(a-=8)&255,a<=0&&(a+=this.DB,--e)),128&n&&(n|=-256),g==0&&(128&this.s)!=(128&n)&&++g,(g>0||n!=this.s)&&(r[g++]=n);return r},M.prototype.equals=function(e){return this.compareTo(e)==0},M.prototype.min=function(e){return this.compareTo(e)<0?this:e},M.prototype.max=function(e){return this.compareTo(e)>0?this:e},M.prototype.and=function(e){var r=oe();return this.bitwiseTo(e,Ve,r),r},M.prototype.or=function(e){var r=oe();return this.bitwiseTo(e,Ye,r),r},M.prototype.xor=function(e){var r=oe();return this.bitwiseTo(e,tt,r),r},M.prototype.andNot=function(e){var r=oe();return this.bitwiseTo(e,rt,r),r},M.prototype.not=function(){for(var e=oe(),r=0;r<this.t;++r)e[r]=this.DM&~this[r];return e.t=this.t,e.s=~this.s,e},M.prototype.shiftLeft=function(e){var r=oe();return e<0?this.rShiftTo(-e,r):this.lShiftTo(e,r),r},M.prototype.shiftRight=function(e){var r=oe();return e<0?this.lShiftTo(-e,r):this.rShiftTo(e,r),r},M.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(this[e]!=0)return e*this.DB+ut(this[e]);return this.s<0?this.t*this.DB:-1},M.prototype.bitCount=function(){for(var e=0,r=this.s&this.DM,n=0;n<this.t;++n)e+=St(this[n]^r);return e},M.prototype.testBit=function(e){var r=Math.floor(e/this.DB);return r>=this.t?this.s!=0:(this[r]&1<<e%this.DB)!=0},M.prototype.setBit=function(e){return this.changeBit(e,Ye)},M.prototype.clearBit=function(e){return this.changeBit(e,rt)},M.prototype.flipBit=function(e){return this.changeBit(e,tt)},M.prototype.add=function(e){var r=oe();return this.addTo(e,r),r},M.prototype.subtract=function(e){var r=oe();return this.subTo(e,r),r},M.prototype.multiply=function(e){var r=oe();return this.multiplyTo(e,r),r},M.prototype.divide=function(e){var r=oe();return this.divRemTo(e,r,null),r},M.prototype.remainder=function(e){var r=oe();return this.divRemTo(e,null,r),r},M.prototype.divideAndRemainder=function(e){var r=oe(),n=oe();return this.divRemTo(e,r,n),new Array(r,n)},M.prototype.modPow=function(e,r){var n,a,g=e.bitLength(),_=Le(1);if(g<=0)return _;n=g<18?1:g<48?3:g<144?4:g<768?5:6,a=g<8?new fe(r):r.isEven()?new Ke(r):new ye(r);var x=new Array,F=3,A=n-1,T=(1<<n)-1;if(x[1]=a.convert(this),n>1){var U=oe();for(a.sqrTo(x[1],U);F<=T;)x[F]=oe(),a.mulTo(U,x[F-2],x[F]),F+=2}var H,q,z=e.t-1,Q=!0,Z=oe();for(g=Ge(e[z])-1;z>=0;){for(g>=A?H=e[z]>>g-A&T:(H=(e[z]&(1<<g+1)-1)<<A-g,z>0&&(H|=e[z-1]>>this.DB+g-A)),F=n;!(1&H);)H>>=1,--F;if((g-=F)<0&&(g+=this.DB,--z),Q)x[H].copyTo(_),Q=!1;else{for(;F>1;)a.sqrTo(_,Z),a.sqrTo(Z,_),F-=2;F>0?a.sqrTo(_,Z):(q=_,_=Z,Z=q),a.mulTo(Z,x[H],_)}for(;z>=0&&!(e[z]&1<<g);)a.sqrTo(_,Z),q=_,_=Z,Z=q,--g<0&&(g=this.DB-1,--z)}return a.revert(_)},M.prototype.modInverse=function(e){var r=e.isEven();if(this.isEven()&&r||e.signum()==0)return M.ZERO;for(var n=e.clone(),a=this.clone(),g=Le(1),_=Le(0),x=Le(0),F=Le(1);n.signum()!=0;){for(;n.isEven();)n.rShiftTo(1,n),r?(g.isEven()&&_.isEven()||(g.addTo(this,g),_.subTo(e,_)),g.rShiftTo(1,g)):_.isEven()||_.subTo(e,_),_.rShiftTo(1,_);for(;a.isEven();)a.rShiftTo(1,a),r?(x.isEven()&&F.isEven()||(x.addTo(this,x),F.subTo(e,F)),x.rShiftTo(1,x)):F.isEven()||F.subTo(e,F),F.rShiftTo(1,F);n.compareTo(a)>=0?(n.subTo(a,n),r&&g.subTo(x,g),_.subTo(F,_)):(a.subTo(n,a),r&&x.subTo(g,x),F.subTo(_,F))}return a.compareTo(M.ONE)!=0?M.ZERO:F.compareTo(e)>=0?F.subtract(e):F.signum()<0?(F.addTo(e,F),F.signum()<0?F.add(e):F):F},M.prototype.pow=function(e){return this.exp(e,new Xe)},M.prototype.gcd=function(e){var r=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(r.compareTo(n)<0){var a=r;r=n,n=a}var g=r.getLowestSetBit(),_=n.getLowestSetBit();if(_<0)return r;for(g<_&&(_=g),_>0&&(r.rShiftTo(_,r),n.rShiftTo(_,n));r.signum()>0;)(g=r.getLowestSetBit())>0&&r.rShiftTo(g,r),(g=n.getLowestSetBit())>0&&n.rShiftTo(g,n),r.compareTo(n)>=0?(r.subTo(n,r),r.rShiftTo(1,r)):(n.subTo(r,n),n.rShiftTo(1,n));return _>0&&n.lShiftTo(_,n),n},M.prototype.isProbablePrime=function(e){var r,n=this.abs();if(n.t==1&&n[0]<=xe[xe.length-1]){for(r=0;r<xe.length;++r)if(n[0]==xe[r])return!0;return!1}if(n.isEven())return!1;for(r=1;r<xe.length;){for(var a=xe[r],g=r+1;g<xe.length&&a<V;)a*=xe[g++];for(a=n.modInt(a);r<g;)if(a%xe[r++]==0)return!1}return n.millerRabin(e)},M.prototype.square=function(){var e=oe();return this.squareTo(e),e},p.prototype.init=function(e){var r,n,a;for(r=0;r<256;++r)this.S[r]=r;for(n=0,r=0;r<256;++r)n=n+this.S[r]+e[r%e.length]&255,a=this.S[r],this.S[r]=this.S[n],this.S[n]=a;this.i=0,this.j=0},p.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var y,N,W;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function X(){(function(e){N[W++]^=255&e,N[W++]^=e>>8&255,N[W++]^=e>>16&255,N[W++]^=e>>24&255,W>=256&&(W-=256)})(new Date().getTime())}if(N==null){var te;if(N=new Array,W=0,B!==void 0&&(B.crypto!==void 0||B.msCrypto!==void 0)){var ce=B.crypto||B.msCrypto;if(ce.getRandomValues){var de=new Uint8Array(32);for(ce.getRandomValues(de),te=0;te<32;++te)N[W++]=de[te]}else if(R.appName=="Netscape"&&R.appVersion<"5"){var Se=B.crypto.random(32);for(te=0;te<Se.length;++te)N[W++]=255&Se.charCodeAt(te)}}for(;W<256;)te=Math.floor(65536*Math.random()),N[W++]=te>>>8,N[W++]=255&te;W=0,X()}function ve(){if(y==null){for(X(),(y=function(){return new p}()).init(N),W=0;W<N.length;++W)N[W]=0;W=0}return y.next()}function we(){}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function it(t,e){return new M(t,e)}function dt(t,e,r){for(var n="",a=0;n.length<e;)n+=r(String.fromCharCode.apply(String,t.concat([(4278190080&a)>>24,(16711680&a)>>16,(65280&a)>>8,255&a]))),a+=1;return n}function he(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Te(t,e){this.x=e,this.q=t}function pe(t,e,r,n){this.curve=t,this.x=e,this.y=r,this.z=n??M.ONE,this.zinv=null}function ct(t,e,r){this.q=t,this.a=this.fromBigInteger(e),this.b=this.fromBigInteger(r),this.infinity=new pe(this,null,null)}we.prototype.nextBytes=function(e){var r;for(r=0;r<e.length;++r)e[r]=ve()},he.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},he.prototype.setPublic=function(e,r){if(this.isPublic=!0,this.isPrivate=!1,typeof e!="string")this.n=e,this.e=r;else{if(!(e!=null&&r!=null&&e.length>0&&r.length>0))throw"Invalid RSA public key";this.n=it(e,16),this.e=parseInt(r,16)}},he.prototype.encrypt=function(e){var r=function(_,x){if(x<_.length+11)throw"Message too long for RSA";for(var F=new Array,A=_.length-1;A>=0&&x>0;){var T=_.charCodeAt(A--);T<128?F[--x]=T:T>127&&T<2048?(F[--x]=63&T|128,F[--x]=T>>6|192):(F[--x]=63&T|128,F[--x]=T>>6&63|128,F[--x]=T>>12|224)}F[--x]=0;for(var U=new we,H=new Array;x>2;){for(H[0]=0;H[0]==0;)U.nextBytes(H);F[--x]=H[0]}return F[--x]=2,F[--x]=0,new M(F)}(e,this.n.bitLength()+7>>3);if(r==null)return null;var n=this.doPublic(r);if(n==null)return null;var a=n.toString(16);return 1&a.length?"0"+a:a},he.prototype.encryptOAEP=function(e,r,n){var a=function(F,A,T,U){var H=E.crypto.MessageDigest,q=E.crypto.Util,z=null;if(T||(T="sha1"),typeof T=="string"&&(z=H.getCanonicalAlgName(T),U=H.getHashLength(z),T=function(ne){return ht(q.hashHex(vt(ne),z))}),F.length+2*U+2>A)throw"Message too long for RSA";var Q,Z="";for(Q=0;Q<A-F.length-2*U-2;Q+=1)Z+="\0";var m=T("")+Z+""+F,C=new Array(U);new we().nextBytes(C);var D=dt(C,m.length,T),O=[];for(Q=0;Q<m.length;Q+=1)O[Q]=m.charCodeAt(Q)^D.charCodeAt(Q);var Y=dt(O,C.length,T),ee=[0];for(Q=0;Q<C.length;Q+=1)ee[Q+1]=C[Q]^Y.charCodeAt(Q);return new M(ee.concat(O))}(e,this.n.bitLength()+7>>3,r,n);if(a==null)return null;var g=this.doPublic(a);if(g==null)return null;var _=g.toString(16);return 1&_.length?"0"+_:_},he.prototype.type="RSA",Te.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.x.equals(e.x)},Te.prototype.toBigInteger=function(){return this.x},Te.prototype.negate=function(){return new Te(this.q,this.x.negate().mod(this.q))},Te.prototype.add=function(e){return new Te(this.q,this.x.add(e.toBigInteger()).mod(this.q))},Te.prototype.subtract=function(e){return new Te(this.q,this.x.subtract(e.toBigInteger()).mod(this.q))},Te.prototype.multiply=function(e){return new Te(this.q,this.x.multiply(e.toBigInteger()).mod(this.q))},Te.prototype.square=function(){return new Te(this.q,this.x.square().mod(this.q))},Te.prototype.divide=function(e){return new Te(this.q,this.x.multiply(e.toBigInteger().modInverse(this.q)).mod(this.q))},pe.prototype.getX=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},pe.prototype.getY=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},pe.prototype.equals=function(e){return e==this||(this.isInfinity()?e.isInfinity():e.isInfinity()?this.isInfinity():!!e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(M.ZERO)&&e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(M.ZERO))},pe.prototype.isInfinity=function(){return this.x==null&&this.y==null||this.z.equals(M.ZERO)&&!this.y.toBigInteger().equals(M.ZERO)},pe.prototype.negate=function(){return new pe(this.curve,this.x,this.y.negate(),this.z)},pe.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var r=e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q),n=e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q);if(M.ZERO.equals(n))return M.ZERO.equals(r)?this.twice():this.curve.getInfinity();var a=new M("3"),g=this.x.toBigInteger(),_=this.y.toBigInteger(),x=(e.x.toBigInteger(),e.y.toBigInteger(),n.square()),F=x.multiply(n),A=g.multiply(x),T=r.square().multiply(this.z),U=T.subtract(A.shiftLeft(1)).multiply(e.z).subtract(F).multiply(n).mod(this.curve.q),H=A.multiply(a).multiply(r).subtract(_.multiply(F)).subtract(T.multiply(r)).multiply(e.z).add(r.multiply(F)).mod(this.curve.q),q=F.multiply(this.z).multiply(e.z).mod(this.curve.q);return new pe(this.curve,this.curve.fromBigInteger(U),this.curve.fromBigInteger(H),q)},pe.prototype.twice=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var e=new M("3"),r=this.x.toBigInteger(),n=this.y.toBigInteger(),a=n.multiply(this.z),g=a.multiply(n).mod(this.curve.q),_=this.curve.a.toBigInteger(),x=r.square().multiply(e);M.ZERO.equals(_)||(x=x.add(this.z.square().multiply(_)));var F=(x=x.mod(this.curve.q)).square().subtract(r.shiftLeft(3).multiply(g)).shiftLeft(1).multiply(a).mod(this.curve.q),A=x.multiply(e).multiply(r).subtract(g.shiftLeft(1)).shiftLeft(2).multiply(g).subtract(x.square().multiply(x)).mod(this.curve.q),T=a.square().multiply(a).shiftLeft(3).mod(this.curve.q);return new pe(this.curve,this.curve.fromBigInteger(F),this.curve.fromBigInteger(A),T)},pe.prototype.multiply=function(e){if(this.isInfinity())return this;if(e.signum()==0)return this.curve.getInfinity();var r,n=e,a=n.multiply(new M("3")),g=this.negate(),_=this,x=this.curve.q.subtract(e),F=x.multiply(new M("3")),A=new pe(this.curve,this.x,this.y),T=A.negate();for(r=a.bitLength()-2;r>0;--r){_=_.twice();var U=a.testBit(r);U!=n.testBit(r)&&(_=_.add(U?this:g))}for(r=F.bitLength()-2;r>0;--r){A=A.twice();var H=F.testBit(r);H!=x.testBit(r)&&(A=A.add(H?A:T))}return _},pe.prototype.multiplyTwo=function(e,r,n){var a;a=e.bitLength()>n.bitLength()?e.bitLength()-1:n.bitLength()-1;for(var g=this.curve.getInfinity(),_=this.add(r);a>=0;)g=g.twice(),e.testBit(a)?g=n.testBit(a)?g.add(_):g.add(this):n.testBit(a)&&(g=g.add(r)),--a;return g},ct.prototype.getQ=function(){return this.q},ct.prototype.getA=function(){return this.a},ct.prototype.getB=function(){return this.b},ct.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.a.equals(e.a)&&this.b.equals(e.b)},ct.prototype.getInfinity=function(){return this.infinity},ct.prototype.fromBigInteger=function(e){return new Te(this.q,e)},ct.prototype.decodePointHex=function(e){switch(parseInt(e.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var r=(e.length-2)/2,n=e.substr(2,r),a=e.substr(r+2,r);return new pe(this,this.fromBigInteger(new M(n,16)),this.fromBigInteger(new M(a,16)));default:return null}},Te.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},pe.prototype.getEncoded=function(t){var e=function(_,x){var F=_.toByteArrayUnsigned();if(x<F.length)F=F.slice(F.length-x);else for(;x>F.length;)F.unshift(0);return F},r=this.getX().toBigInteger(),n=this.getY().toBigInteger(),a=e(r,32);return t?n.isEven()?a.unshift(2):a.unshift(3):(a.unshift(4),a=a.concat(e(n,32))),a},pe.decodeFrom=function(t,e){e[0];var r=e.length-1,n=e.slice(1,1+r/2),a=e.slice(1+r/2,1+r);n.unshift(0),a.unshift(0);var g=new M(n),_=new M(a);return new pe(t,t.fromBigInteger(g),t.fromBigInteger(_))},pe.decodeFromHex=function(t,e){e.substr(0,2);var r=e.length-2,n=e.substr(2,r/2),a=e.substr(2+r/2,r/2),g=new M(n,16),_=new M(a,16);return new pe(t,t.fromBigInteger(g),t.fromBigInteger(_))},pe.prototype.add2D=function(t){if(this.isInfinity())return t;if(t.isInfinity())return this;if(this.x.equals(t.x))return this.y.equals(t.y)?this.twice():this.curve.getInfinity();var e=t.x.subtract(this.x),r=t.y.subtract(this.y).divide(e),n=r.square().subtract(this.x).subtract(t.x),a=r.multiply(this.x.subtract(n)).subtract(this.y);return new pe(this.curve,n,a)},pe.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var t=this.curve.fromBigInteger(M.valueOf(2)),e=this.curve.fromBigInteger(M.valueOf(3)),r=this.x.square().multiply(e).add(this.curve.a).divide(this.y.multiply(t)),n=r.square().subtract(this.x.multiply(t)),a=r.multiply(this.x.subtract(n)).subtract(this.y);return new pe(this.curve,n,a)},pe.prototype.multiply2D=function(t){if(this.isInfinity())return this;if(t.signum()==0)return this.curve.getInfinity();var e,r=t,n=r.multiply(new M("3")),a=this.negate(),g=this;for(e=n.bitLength()-2;e>0;--e){g=g.twice();var _=n.testBit(e);_!=r.testBit(e)&&(g=g.add2D(_?this:a))}return g},pe.prototype.isOnCurve=function(){var t=this.getX().toBigInteger(),e=this.getY().toBigInteger(),r=this.curve.getA().toBigInteger(),n=this.curve.getB().toBigInteger(),a=this.curve.getQ(),g=e.multiply(e).mod(a),_=t.multiply(t).multiply(t).add(r.multiply(t)).add(n).mod(a);return g.equals(_)},pe.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},pe.prototype.validate=function(){var t=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var e=this.getX().toBigInteger(),r=this.getY().toBigInteger();if(e.compareTo(M.ONE)<0||e.compareTo(t.subtract(M.ONE))>0)throw new Error("x coordinate out of bounds");if(r.compareTo(M.ONE)<0||r.compareTo(t.subtract(M.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(t).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};/*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
 */var Wr=function(){var t=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),e=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),r={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function n(_,x,F){return x?r[x]:String.fromCharCode(parseInt(F,16))}var a=new String(""),g=Object.hasOwnProperty;return function(_,x){var F,A,T=_.match(t),U=T[0],H=!1;U==="{"?F={}:U==="["?F=[]:(F=[],H=!0);for(var q=[F],z=1-H,Q=T.length;z<Q;++z){var Z;switch((U=T[z]).charCodeAt(0)){default:(Z=q[0])[A||Z.length]=+U,A=void 0;break;case 34:if((U=U.substring(1,U.length-1)).indexOf("\\")!==-1&&(U=U.replace(e,n)),Z=q[0],!A){if(!(Z instanceof Array)){A=U||a;break}A=Z.length}Z[A]=U,A=void 0;break;case 91:Z=q[0],q.unshift(Z[A||Z.length]=[]),A=void 0;break;case 93:q.shift();break;case 102:(Z=q[0])[A||Z.length]=!1,A=void 0;break;case 110:(Z=q[0])[A||Z.length]=null,A=void 0;break;case 116:(Z=q[0])[A||Z.length]=!0,A=void 0;break;case 123:Z=q[0],q.unshift(Z[A||Z.length]={}),A=void 0;break;case 125:q.shift()}}if(H){if(q.length!==1)throw new Error;F=F[0]}else if(q.length)throw new Error;return x&&(F=function m(C,D){var O=C[D];if(O&&(O===void 0?"undefined":k(O))==="object"){var Y=null;for(var ee in O)if(g.call(O,ee)&&O!==C){var ue=m(O,ee);ue!==void 0?O[ee]=ue:(Y||(Y=[]),Y.push(ee))}if(Y)for(var ne=Y.length;--ne>=0;)delete O[Y[ne]]}return x.call(C,D,O)}({"":F},"")),F}}();E!==void 0&&E||(o.KJUR=E={}),E.asn1!==void 0&&E.asn1||(E.asn1={}),E.asn1.ASN1Util=new function(){this.integerToByteHex=function(t){var e=t.toString(16);return e.length%2==1&&(e="0"+e),e},this.bigIntToMinTwosComplementsHex=function(t){var e=t.toString(16);if(e.substr(0,1)!="-")e.length%2==1?e="0"+e:e.match(/^[0-7]/)||(e="00"+e);else{var r=e.substr(1).length;r%2==1?r+=1:e.match(/^[0-7]/)||(r+=2);for(var n="",a=0;a<r;a++)n+="f";e=new M(n,16).xor(t).add(M.ONE).toString(16).replace(/^-/,"")}return e},this.getPEMStringFromHex=function(t,e){return ot(t,e)},this.newObject=function(t){var e=E.asn1,r=e.ASN1Object,n=e.DERBoolean,a=e.DERInteger,g=e.DERBitString,_=e.DEROctetString,x=e.DERNull,F=e.DERObjectIdentifier,A=e.DEREnumerated,T=e.DERUTF8String,U=e.DERNumericString,H=e.DERPrintableString,q=e.DERTeletexString,z=e.DERIA5String,Q=e.DERUTCTime,Z=e.DERGeneralizedTime,m=e.DERVisibleString,C=e.DERBMPString,D=e.DERSequence,O=e.DERSet,Y=e.DERTaggedObject,ee=e.ASN1Util.newObject;if(t instanceof e.ASN1Object)return t;var ue=Object.keys(t);if(ue.length!=1)throw new Error("key of param shall be only one.");var ne=ue[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+ne+":")==-1)throw new Error("undefined key: "+ne);if(ne=="bool")return new n(t[ne]);if(ne=="int")return new a(t[ne]);if(ne=="bitstr")return new g(t[ne]);if(ne=="octstr")return new _(t[ne]);if(ne=="null")return new x(t[ne]);if(ne=="oid")return new F(t[ne]);if(ne=="enum")return new A(t[ne]);if(ne=="utf8str")return new T(t[ne]);if(ne=="numstr")return new U(t[ne]);if(ne=="prnstr")return new H(t[ne]);if(ne=="telstr")return new q(t[ne]);if(ne=="ia5str")return new z(t[ne]);if(ne=="utctime")return new Q(t[ne]);if(ne=="gentime")return new Z(t[ne]);if(ne=="visstr")return new m(t[ne]);if(ne=="bmpstr")return new C(t[ne]);if(ne=="asn1")return new r(t[ne]);if(ne=="seq"){for(var ge=t[ne],ae=[],le=0;le<ge.length;le++){var Ee=ee(ge[le]);ae.push(Ee)}return new D({array:ae})}if(ne=="set"){for(ge=t[ne],ae=[],le=0;le<ge.length;le++)Ee=ee(ge[le]),ae.push(Ee);return new O({array:ae})}if(ne=="tag"){var Pe=t[ne];if(Object.prototype.toString.call(Pe)==="[object Array]"&&Pe.length==3){var Ae=ee(Pe[2]);return new Y({tag:Pe[0],explicit:Pe[1],obj:Ae})}return new Y(Pe)}},this.jsonToASN1HEX=function(t){return this.newObject(t).getEncodedHex()}},E.asn1.ASN1Util.oidHexToInt=function(t){for(var e="",r=parseInt(t.substr(0,2),16),n=(e=Math.floor(r/40)+"."+r%40,""),a=2;a<t.length;a+=2){var g=("00000000"+parseInt(t.substr(a,2),16).toString(2)).slice(-8);n+=g.substr(1,7),g.substr(0,1)=="0"&&(e=e+"."+new M(n,2).toString(10),n="")}return e},E.asn1.ASN1Util.oidIntToHex=function(t){var e=function(F){var A=F.toString(16);return A.length==1&&(A="0"+A),A},r=function(F){var A="",T=new M(F,10).toString(2),U=7-T.length%7;U==7&&(U=0);for(var H="",q=0;q<U;q++)H+="0";for(T=H+T,q=0;q<T.length-1;q+=7){var z=T.substr(q,7);q!=T.length-7&&(z="1"+z),A+=e(parseInt(z,2))}return A};if(!t.match(/^[0-9.]+$/))throw"malformed oid string: "+t;var n="",a=t.split("."),g=40*parseInt(a[0])+parseInt(a[1]);n+=e(g),a.splice(0,2);for(var _=0;_<a.length;_++)n+=r(a[_]);return n},E.asn1.ASN1Object=function(t){this.params=null,this.getLengthHexFromValue=function(){if(this.hV===void 0||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n=0,v="+this.hV);var e=this.hV.length/2,r=e.toString(16);if(r.length%2==1&&(r="0"+r),e<128)return r;var n=r.length/2;if(n>15)throw"ASN.1 length too long to represent by 8x: n = "+e.toString(16);return(128+n).toString(16)+r},this.getEncodedHex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(e){this.params=e},t!=null&&t.tlv!=null&&(this.hTLV=t.tlv,this.isModified=!1)},E.asn1.DERAbstractString=function(t){E.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=pr(this.s).toLowerCase()},this.setStringHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(typeof t=="string"?this.setString(t):t.str!==void 0?this.setString(t.str):t.hex!==void 0&&this.setStringHex(t.hex))},Ce(E.asn1.DERAbstractString,E.asn1.ASN1Object),E.asn1.DERAbstractTime=function(t){E.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(e){var r=e.getTime()+6e4*e.getTimezoneOffset();return new Date(r)},this.formatDate=function(e,r,n){var a=this.zeroPadding,g=this.localDateToUTC(e),_=String(g.getFullYear());r=="utc"&&(_=_.substr(2,2));var x=_+a(String(g.getMonth()+1),2)+a(String(g.getDate()),2)+a(String(g.getHours()),2)+a(String(g.getMinutes()),2)+a(String(g.getSeconds()),2);if(n===!0){var F=g.getMilliseconds();if(F!=0){var A=a(String(F),3);x=x+"."+(A=A.replace(/[0]+$/,""))}}return x+"Z"},this.zeroPadding=function(e,r){return e.length>=r?e:new Array(r-e.length+1).join("0")+e},this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=wt(e)},this.setByDateValue=function(e,r,n,a,g,_){var x=new Date(Date.UTC(e,r-1,n,a,g,_,0));this.setByDate(x)},this.getFreshValueHex=function(){return this.hV}},Ce(E.asn1.DERAbstractTime,E.asn1.ASN1Object),E.asn1.DERAbstractStructured=function(t){E.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array=e},this.appendASN1Object=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array.push(e)},this.asn1Array=new Array,t!==void 0&&t.array!==void 0&&(this.asn1Array=t.array)},Ce(E.asn1.DERAbstractStructured,E.asn1.ASN1Object),E.asn1.DERBoolean=function(t){E.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=t==0?"010100":"0101ff"},Ce(E.asn1.DERBoolean,E.asn1.ASN1Object),E.asn1.DERInteger=function(t){E.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=E.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var r=new M(String(e),10);this.setByBigInteger(r)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(t.bigint!==void 0?this.setByBigInteger(t.bigint):t.int!==void 0?this.setByInteger(t.int):typeof t=="number"?this.setByInteger(t):t.hex!==void 0&&this.setValueHex(t.hex))},Ce(E.asn1.DERInteger,E.asn1.ASN1Object),E.asn1.DERBitString=function(t){if(t!==void 0&&t.obj!==void 0){var e=E.asn1.ASN1Util.newObject(t.obj);t.hex="00"+e.getEncodedHex()}E.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(r){this.hTLV=null,this.isModified=!0,this.hV=r},this.setUnusedBitsAndHexValue=function(r,n){if(r<0||7<r)throw"unused bits shall be from 0 to 7: u = "+r;var a="0"+r;this.hTLV=null,this.isModified=!0,this.hV=a+n},this.setByBinaryString=function(r){var n=8-(r=r.replace(/0+$/,"")).length%8;n==8&&(n=0);for(var a=0;a<=n;a++)r+="0";var g="";for(a=0;a<r.length-1;a+=8){var _=r.substr(a,8),x=parseInt(_,2).toString(16);x.length==1&&(x="0"+x),g+=x}this.hTLV=null,this.isModified=!0,this.hV="0"+n+g},this.setByBooleanArray=function(r){for(var n="",a=0;a<r.length;a++)r[a]==1?n+="1":n+="0";this.setByBinaryString(n)},this.newFalseArray=function(r){for(var n=new Array(r),a=0;a<r;a++)n[a]=!1;return n},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(typeof t=="string"&&t.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(t):t.hex!==void 0?this.setHexValueIncludingUnusedBits(t.hex):t.bin!==void 0?this.setByBinaryString(t.bin):t.array!==void 0&&this.setByBooleanArray(t.array))},Ce(E.asn1.DERBitString,E.asn1.ASN1Object),E.asn1.DEROctetString=function(t){if(t!==void 0&&t.obj!==void 0){var e=E.asn1.ASN1Util.newObject(t.obj);t.hex=e.getEncodedHex()}E.asn1.DEROctetString.superclass.constructor.call(this,t),this.hT="04"},Ce(E.asn1.DEROctetString,E.asn1.DERAbstractString),E.asn1.DERNull=function(){E.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},Ce(E.asn1.DERNull,E.asn1.ASN1Object),E.asn1.DERObjectIdentifier=function(t){E.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueOidString=function(e){var r=function(a){var g=function(H){var q=H.toString(16);return q.length==1&&(q="0"+q),q},_=function(H){var q="",z=parseInt(H,10).toString(2),Q=7-z.length%7;Q==7&&(Q=0);for(var Z="",m=0;m<Q;m++)Z+="0";for(z=Z+z,m=0;m<z.length-1;m+=7){var C=z.substr(m,7);m!=z.length-7&&(C="1"+C),q+=g(parseInt(C,2))}return q};try{if(!a.match(/^[0-9.]+$/))return null;var x="",F=a.split("."),A=40*parseInt(F[0],10)+parseInt(F[1],10);x+=g(A),F.splice(0,2);for(var T=0;T<F.length;T++)x+=_(F[T]);return x}catch{return null}}(e);if(r==null)throw new Error("malformed oid string: "+e);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=r},this.setValueName=function(e){var r=E.asn1.x509.OID.name2oid(e);if(r==="")throw new Error("DERObjectIdentifier oidName undefined: "+e);this.setValueOidString(r)},this.setValueNameOrOid=function(e){e.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(e):this.setValueName(e)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(e){typeof e=="string"?this.setValueNameOrOid(e):e.oid!==void 0?this.setValueNameOrOid(e.oid):e.name!==void 0?this.setValueNameOrOid(e.name):e.hex!==void 0&&this.setValueHex(e.hex)},t!==void 0&&this.setByParam(t)},Ce(E.asn1.DERObjectIdentifier,E.asn1.ASN1Object),E.asn1.DEREnumerated=function(t){E.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=E.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var r=new M(String(e),10);this.setByBigInteger(r)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(t.int!==void 0?this.setByInteger(t.int):typeof t=="number"?this.setByInteger(t):t.hex!==void 0&&this.setValueHex(t.hex))},Ce(E.asn1.DEREnumerated,E.asn1.ASN1Object),E.asn1.DERUTF8String=function(t){E.asn1.DERUTF8String.superclass.constructor.call(this,t),this.hT="0c"},Ce(E.asn1.DERUTF8String,E.asn1.DERAbstractString),E.asn1.DERNumericString=function(t){E.asn1.DERNumericString.superclass.constructor.call(this,t),this.hT="12"},Ce(E.asn1.DERNumericString,E.asn1.DERAbstractString),E.asn1.DERPrintableString=function(t){E.asn1.DERPrintableString.superclass.constructor.call(this,t),this.hT="13"},Ce(E.asn1.DERPrintableString,E.asn1.DERAbstractString),E.asn1.DERTeletexString=function(t){E.asn1.DERTeletexString.superclass.constructor.call(this,t),this.hT="14"},Ce(E.asn1.DERTeletexString,E.asn1.DERAbstractString),E.asn1.DERIA5String=function(t){E.asn1.DERIA5String.superclass.constructor.call(this,t),this.hT="16"},Ce(E.asn1.DERIA5String,E.asn1.DERAbstractString),E.asn1.DERVisibleString=function(t){E.asn1.DERIA5String.superclass.constructor.call(this,t),this.hT="1a"},Ce(E.asn1.DERVisibleString,E.asn1.DERAbstractString),E.asn1.DERBMPString=function(t){E.asn1.DERBMPString.superclass.constructor.call(this,t),this.hT="1e"},Ce(E.asn1.DERBMPString,E.asn1.DERAbstractString),E.asn1.DERUTCTime=function(t){E.asn1.DERUTCTime.superclass.constructor.call(this,t),this.hT="17",this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"utc"),this.hV=wt(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=wt(this.s)),this.hV},t!==void 0&&(t.str!==void 0?this.setString(t.str):typeof t=="string"&&t.match(/^[0-9]{12}Z$/)?this.setString(t):t.hex!==void 0?this.setStringHex(t.hex):t.date!==void 0&&this.setByDate(t.date))},Ce(E.asn1.DERUTCTime,E.asn1.DERAbstractTime),E.asn1.DERGeneralizedTime=function(t){E.asn1.DERGeneralizedTime.superclass.constructor.call(this,t),this.hT="18",this.withMillis=!1,this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=wt(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=wt(this.s)),this.hV},t!==void 0&&(t.str!==void 0?this.setString(t.str):typeof t=="string"&&t.match(/^[0-9]{14}Z$/)?this.setString(t):t.hex!==void 0?this.setStringHex(t.hex):t.date!==void 0&&this.setByDate(t.date),t.millis===!0&&(this.withMillis=!0))},Ce(E.asn1.DERGeneralizedTime,E.asn1.DERAbstractTime),E.asn1.DERSequence=function(t){E.asn1.DERSequence.superclass.constructor.call(this,t),this.hT="30",this.getFreshValueHex=function(){for(var e="",r=0;r<this.asn1Array.length;r++)e+=this.asn1Array[r].getEncodedHex();return this.hV=e,this.hV}},Ce(E.asn1.DERSequence,E.asn1.DERAbstractStructured),E.asn1.DERSet=function(t){E.asn1.DERSet.superclass.constructor.call(this,t),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var e=new Array,r=0;r<this.asn1Array.length;r++){var n=this.asn1Array[r];e.push(n.getEncodedHex())}return this.sortFlag==1&&e.sort(),this.hV=e.join(""),this.hV},t!==void 0&&t.sortflag!==void 0&&t.sortflag==0&&(this.sortFlag=!1)},Ce(E.asn1.DERSet,E.asn1.DERAbstractStructured),E.asn1.DERTaggedObject=function(t){E.asn1.DERTaggedObject.superclass.constructor.call(this);var e=E.asn1;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(r,n,a){this.hT=n,this.isExplicit=r,this.asn1Object=a,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=a.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,n),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(r){r.tag!=null&&(this.hT=r.tag),r.explicit!=null&&(this.isExplicit=r.explicit),r.tage!=null&&(this.hT=r.tage,this.isExplicit=!0),r.tagi!=null&&(this.hT=r.tagi,this.isExplicit=!1),r.obj!=null&&(r.obj instanceof e.ASN1Object?(this.asn1Object=r.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)):k(r.obj)=="object"&&(this.asn1Object=e.ASN1Util.newObject(r.obj),this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},t!=null&&this.setByParam(t)},Ce(E.asn1.DERTaggedObject,E.asn1.ASN1Object);var E,Kt,ft,se=new function(){};function qr(t){for(var e=new Array,r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}function $r(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e}function er(t){for(var e="",r=0;r<t.length;r++){var n=t[r].toString(16);n.length==1&&(n="0"+n),e+=n}return e}function wt(t){return er(qr(t))}function tr(t){return t=(t=(t=t.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function Vt(t){return t.length%4==2?t+="==":t.length%4==3&&(t+="="),t=(t=t.replace(/-/g,"+")).replace(/_/g,"/")}function Ne(t){return t.length%2==1&&(t="0"+t),tr(j(t))}function Fe(t){return re(Vt(t))}function pr(t){return rr(ir(t))}function Oe(t){return decodeURIComponent(nr(t))}function ht(t){for(var e="",r=0;r<t.length-1;r+=2)e+=String.fromCharCode(parseInt(t.substr(r,2),16));return e}function vt(t){for(var e="",r=0;r<t.length;r++)e+=("0"+t.charCodeAt(r).toString(16)).slice(-2);return e}function zr(t){return j(t)}function Gr(t){var e=zr(t).replace(/(.{64})/g,`$1\r
`);return e=e.replace(/\r\n$/,"")}function Yr(t){return re(t.replace(/[^0-9A-Za-z\/+=]*/g,""))}function ot(t,e){return"-----BEGIN "+e+`-----\r
`+Gr(t)+`\r
-----END `+e+`-----\r
`}function mt(t,e){if(t.indexOf("-----BEGIN ")==-1)throw"can't find PEM header: "+e;return Yr(t=e!==void 0?(t=t.replace(new RegExp("^[^]*-----BEGIN "+e+"-----"),"")).replace(new RegExp("-----END "+e+"-----[^]*$"),""):(t=t.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function yr(t){var e,r,n,a,g,_,x,F,A,T,U;if(U=t.match(/^(\d{2}|\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return F=U[1],e=parseInt(F),F.length===2&&(50<=e&&e<100?e=1900+e:0<=e&&e<50&&(e=2e3+e)),r=parseInt(U[2])-1,n=parseInt(U[3]),a=parseInt(U[4]),g=parseInt(U[5]),_=parseInt(U[6]),x=0,(A=U[7])!==""&&(T=(A.substr(1)+"00").substr(0,3),x=parseInt(T)),Date.UTC(e,r,n,a,g,_,x);throw"unsupported zulu format: "+t}function Xr(t){return~~(yr(t)/1e3)}function rr(t){return t.replace(/%/g,"")}function nr(t){return t.replace(/(..)/g,"%$1")}function Qr(t){var e="malformed IPv6 address";if(!t.match(/^[0-9A-Fa-f:]+$/))throw e;var r=(t=t.toLowerCase()).split(":").length-1;if(r<2)throw e;var n=":".repeat(7-r+2),a=(t=t.replace("::",n)).split(":");if(a.length!=8)throw e;for(var g=0;g<8;g++)a[g]=("0000"+a[g]).slice(-4);return a.join("")}function Zr(t){if(!t.match(/^[0-9A-Fa-f]{32}$/))throw"malformed IPv6 address octet";for(var e=(t=t.toLowerCase()).match(/.{1,4}/g),r=0;r<8;r++)e[r]=e[r].replace(/^0+/,""),e[r]==""&&(e[r]="0");var n=(t=":"+e.join(":")+":").match(/:(0:){2,}/g);if(n===null)return t.slice(1,-1);var a="";for(r=0;r<n.length;r++)n[r].length>a.length&&(a=n[r]);return(t=t.replace(a,"::")).slice(1,-1)}function vr(t){var e="malformed hex value";if(!t.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw e;if(t.length!=8)return t.length==32?Zr(t):t;try{return parseInt(t.substr(0,2),16)+"."+parseInt(t.substr(2,2),16)+"."+parseInt(t.substr(4,2),16)+"."+parseInt(t.substr(6,2),16)}catch{throw e}}function en(t){return t.match(/.{4}/g).map(function(r){var n=parseInt(r.substr(0,2),16),a=parseInt(r.substr(2),16);if(n==0&a<128)return String.fromCharCode(a);if(n<8){var g=128|63&a;return Oe((192|(7&n)<<3|(192&a)>>6).toString(16)+g.toString(16))}g=128|(15&n)<<2|(192&a)>>6;var _=128|63&a;return Oe((224|(240&n)>>4).toString(16)+g.toString(16)+_.toString(16))}).join("")}function ir(t){for(var e=encodeURIComponent(t),r="",n=0;n<e.length;n++)e[n]=="%"?(r+=e.substr(n,3),n+=2):r=r+"%"+wt(e[n]);return r}function tn(t){return!(t.length%2!=0||!t.match(/^[0-9a-f]+$/)&&!t.match(/^[0-9A-F]+$/))}function mr(t){return t.length%2==1?"0"+t:t.substr(0,1)>"7"?"00"+t:t}se.getLblen=function(t,e){if(t.substr(e+2,1)!="8")return 1;var r=parseInt(t.substr(e+3,1));return r==0?-1:0<r&&r<10?r+1:-2},se.getL=function(t,e){var r=se.getLblen(t,e);return r<1?"":t.substr(e+2,2*r)},se.getVblen=function(t,e){var r;return(r=se.getL(t,e))==""?-1:(r.substr(0,1)==="8"?new M(r.substr(2),16):new M(r,16)).intValue()},se.getVidx=function(t,e){var r=se.getLblen(t,e);return r<0?r:e+2*(r+1)},se.getV=function(t,e){var r=se.getVidx(t,e),n=se.getVblen(t,e);return t.substr(r,2*n)},se.getTLV=function(t,e){return t.substr(e,2)+se.getL(t,e)+se.getV(t,e)},se.getTLVblen=function(t,e){return 2+2*se.getLblen(t,e)+2*se.getVblen(t,e)},se.getNextSiblingIdx=function(t,e){return se.getVidx(t,e)+2*se.getVblen(t,e)},se.getChildIdx=function(t,e){var r,n,a,g=se,_=[];r=g.getVidx(t,e),n=2*g.getVblen(t,e),t.substr(e,2)=="03"&&(r+=2,n-=2),a=0;for(var x=r;a<=n;){var F=g.getTLVblen(t,x);if((a+=F)<=n&&_.push(x),x+=F,a>=n)break}return _},se.getNthChildIdx=function(t,e,r){return se.getChildIdx(t,e)[r]},se.getIdxbyList=function(t,e,r,n){var a,g,_=se;return r.length==0?n!==void 0&&t.substr(e,2)!==n?-1:e:(a=r.shift())>=(g=_.getChildIdx(t,e)).length?-1:_.getIdxbyList(t,g[a],r,n)},se.getIdxbyListEx=function(t,e,r,n){var a,g,_=se;if(r.length==0)return n!==void 0&&t.substr(e,2)!==n?-1:e;a=r.shift(),g=_.getChildIdx(t,e);for(var x=0,F=0;F<g.length;F++){var A=t.substr(g[F],2);if(typeof a=="number"&&!_.isContextTag(A)&&x==a||typeof a=="string"&&_.isContextTag(A,a))return _.getIdxbyListEx(t,g[F],r,n);_.isContextTag(A)||x++}return-1},se.getTLVbyList=function(t,e,r,n){var a=se,g=a.getIdxbyList(t,e,r,n);return g==-1||g>=t.length?null:a.getTLV(t,g)},se.getTLVbyListEx=function(t,e,r,n){var a=se,g=a.getIdxbyListEx(t,e,r,n);return g==-1?null:a.getTLV(t,g)},se.getVbyList=function(t,e,r,n,a){var g,_,x=se;return(g=x.getIdxbyList(t,e,r,n))==-1||g>=t.length?null:(_=x.getV(t,g),a===!0&&(_=_.substr(2)),_)},se.getVbyListEx=function(t,e,r,n,a){var g,_,x=se;return(g=x.getIdxbyListEx(t,e,r,n))==-1?null:(_=x.getV(t,g),t.substr(g,2)=="03"&&a!==!1&&(_=_.substr(2)),_)},se.getInt=function(t,e,r){r==null&&(r=-1);try{var n=t.substr(e,2);if(n!="02"&&n!="03")return r;var a=se.getV(t,e);return n=="02"?parseInt(a,16):function(_){try{var x=_.substr(0,2);if(x=="00")return parseInt(_.substr(2),16);var F=parseInt(x,16),A=_.substr(2),T=parseInt(A,16).toString(2);return T=="0"&&(T="00000000"),T=T.slice(0,0-F),parseInt(T,2)}catch{return-1}}(a)}catch{return r}},se.getOID=function(t,e,r){r==null&&(r=null);try{return t.substr(e,2)!="06"?r:function(a){if(!tn(a))return null;try{var g=[],_=a.substr(0,2),x=parseInt(_,16);g[0]=new String(Math.floor(x/40)),g[1]=new String(x%40);for(var F=a.substr(2),A=[],T=0;T<F.length/2;T++)A.push(parseInt(F.substr(2*T,2),16));var U=[],H="";for(T=0;T<A.length;T++)128&A[T]?H+=rn((127&A[T]).toString(2),7):(H+=rn((127&A[T]).toString(2),7),U.push(new String(parseInt(H,2))),H="");var q=g.join(".");return U.length>0&&(q=q+"."+U.join(".")),q}catch{return null}}(se.getV(t,e))}catch{return r}},se.getOIDName=function(t,e,r){r==null&&(r=null);try{var n=se.getOID(t,e,r);if(n==r)return r;var a=E.asn1.x509.OID.oid2name(n);return a==""?n:a}catch{return r}},se.getString=function(t,e,r){r==null&&(r=null);try{return ht(se.getV(t,e))}catch{return r}},se.hextooidstr=function(t){var e=function(H,q){return H.length>=q?H:new Array(q-H.length+1).join("0")+H},r=[],n=t.substr(0,2),a=parseInt(n,16);r[0]=new String(Math.floor(a/40)),r[1]=new String(a%40);for(var g=t.substr(2),_=[],x=0;x<g.length/2;x++)_.push(parseInt(g.substr(2*x,2),16));var F=[],A="";for(x=0;x<_.length;x++)128&_[x]?A+=e((127&_[x]).toString(2),7):(A+=e((127&_[x]).toString(2),7),F.push(new String(parseInt(A,2))),A="");var T=r.join(".");return F.length>0&&(T=T+"."+F.join(".")),T},se.dump=function(t,e,r,n){var a=se,g=a.getV,_=a.dump,x=a.getChildIdx,F=t;t instanceof E.asn1.ASN1Object&&(F=t.getEncodedHex());var A=function(ne,ge){return ne.length<=2*ge?ne:ne.substr(0,ge)+"..(total "+ne.length/2+"bytes).."+ne.substr(ne.length-ge,ge)};e===void 0&&(e={ommit_long_octet:32}),r===void 0&&(r=0),n===void 0&&(n="");var T,U=e.ommit_long_octet;if((T=F.substr(r,2))=="01")return(H=g(F,r))=="00"?n+`BOOLEAN FALSE
`:n+`BOOLEAN TRUE
`;if(T=="02")return n+"INTEGER "+A(H=g(F,r),U)+`
`;if(T=="03"){var H=g(F,r);if(a.isASN1HEX(H.substr(2))){var q=n+`BITSTRING, encapsulates
`;return q+=_(H.substr(2),e,0,n+"  ")}return n+"BITSTRING "+A(H,U)+`
`}if(T=="04")return H=g(F,r),a.isASN1HEX(H)?(q=n+`OCTETSTRING, encapsulates
`,q+=_(H,e,0,n+"  ")):n+"OCTETSTRING "+A(H,U)+`
`;if(T=="05")return n+`NULL
`;if(T=="06"){var z=g(F,r),Q=E.asn1.ASN1Util.oidHexToInt(z),Z=E.asn1.x509.OID.oid2name(Q),m=Q.replace(/\./g," ");return Z!=""?n+"ObjectIdentifier "+Z+" ("+m+`)
`:n+"ObjectIdentifier ("+m+`)
`}if(T=="0a")return n+"ENUMERATED "+parseInt(g(F,r))+`
`;if(T=="0c")return n+"UTF8String '"+Oe(g(F,r))+`'
`;if(T=="13")return n+"PrintableString '"+Oe(g(F,r))+`'
`;if(T=="14")return n+"TeletexString '"+Oe(g(F,r))+`'
`;if(T=="16")return n+"IA5String '"+Oe(g(F,r))+`'
`;if(T=="17")return n+"UTCTime "+Oe(g(F,r))+`
`;if(T=="18")return n+"GeneralizedTime "+Oe(g(F,r))+`
`;if(T=="1a")return n+"VisualString '"+Oe(g(F,r))+`'
`;if(T=="1e")return n+"BMPString '"+en(g(F,r))+`'
`;if(T=="30"){if(F.substr(r,4)=="3000")return n+`SEQUENCE {}
`;q=n+`SEQUENCE
`;var C=e;if(((Y=x(F,r)).length==2||Y.length==3)&&F.substr(Y[0],2)=="06"&&F.substr(Y[Y.length-1],2)=="04"){Z=a.oidname(g(F,Y[0]));var D=JSON.parse(JSON.stringify(e));D.x509ExtName=Z,C=D}for(var O=0;O<Y.length;O++)q+=_(F,C,Y[O],n+"  ");return q}if(T=="31"){q=n+`SET
`;var Y=x(F,r);for(O=0;O<Y.length;O++)q+=_(F,e,Y[O],n+"  ");return q}if(128&(T=parseInt(T,16))){var ee=31&T;if(32&T){for(q=n+"["+ee+`]
`,Y=x(F,r),O=0;O<Y.length;O++)q+=_(F,e,Y[O],n+"  ");return q}if(H=g(F,r),se.isASN1HEX(H)){var q=n+"["+ee+`]
`;return q+=_(H,e,0,n+"  ")}return(H.substr(0,8)=="68747470"||e.x509ExtName==="subjectAltName"&&ee==2)&&(H=Oe(H)),q=n+"["+ee+"] "+H+`
`}return n+"UNKNOWN("+T+") "+g(F,r)+`
`},se.isContextTag=function(t,e){var r,n;t=t.toLowerCase();try{r=parseInt(t,16)}catch{return-1}if(e===void 0)return(192&r)==128;try{return e.match(/^\[[0-9]+\]$/)!=null&&!((n=parseInt(e.substr(1,e.length-1),10))>31)&&(192&r)==128&&(31&r)==n}catch{return!1}},se.isASN1HEX=function(t){var e=se;if(t.length%2==1)return!1;var r=e.getVblen(t,0),n=t.substr(0,2),a=e.getL(t,0);return t.length-n.length-a.length==2*r},se.checkStrictDER=function(t,e,r,n,a){var g=se;if(r===void 0){if(typeof t!="string")throw new Error("not hex string");if(t=t.toLowerCase(),!E.lang.String.isHex(t))throw new Error("not hex string");r=t.length,a=(n=t.length/2)<128?1:Math.ceil(n.toString(16))+1}if(g.getL(t,e).length>2*a)throw new Error("L of TLV too long: idx="+e);var _=g.getVblen(t,e);if(_>n)throw new Error("value of L too long than hex: idx="+e);var x=g.getTLV(t,e),F=x.length-2-g.getL(t,e).length;if(F!==2*_)throw new Error("V string length and L's value not the same:"+F+"/"+2*_);if(e===0&&t.length!=x.length)throw new Error("total length and TLV length unmatch:"+t.length+"!="+x.length);var A=t.substr(e,2);if(A==="02"){var T=g.getVidx(t,e);if(t.substr(T,2)=="00"&&t.charCodeAt(T+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(A,16)){for(var U=g.getVblen(t,e),H=0,q=g.getChildIdx(t,e),z=0;z<q.length;z++)H+=g.getTLV(t,q[z]).length,g.checkStrictDER(t,q[z],r,n,a);if(2*U!=H)throw new Error("sum of children's TLV length and L unmatch: "+2*U+"!="+H)}},se.oidname=function(t){var e=E.asn1;E.lang.String.isHex(t)&&(t=e.ASN1Util.oidHexToInt(t));var r=e.x509.OID.oid2name(t);return r===""&&(r=t),r},E!==void 0&&E||(o.KJUR=E={}),E.lang!==void 0&&E.lang||(E.lang={}),E.lang.String=function(){},typeof v=="function"?(o.utf8tob64u=Kt=function(e){return tr(v.from(e,"utf8").toString("base64"))},o.b64utoutf8=ft=function(e){return v.from(Vt(e),"base64").toString("utf8")}):(o.utf8tob64u=Kt=function(e){return Ne(rr(ir(e)))},o.b64utoutf8=ft=function(e){return decodeURIComponent(nr(Fe(e)))}),E.lang.String.isInteger=function(t){return!!t.match(/^[0-9]+$/)||!!t.match(/^-[0-9]+$/)},E.lang.String.isHex=function(t){return tn(t)},E.lang.String.isBase64=function(t){return!(!(t=t.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||t.length%4!=0)},E.lang.String.isBase64URL=function(t){return!t.match(/[+/=]/)&&(t=Vt(t),E.lang.String.isBase64(t))},E.lang.String.isIntegerArray=function(t){return!!(t=t.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},E.lang.String.isPrintable=function(t){return t.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},E.lang.String.isIA5=function(t){return t.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},E.lang.String.isMail=function(t){return t.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};var rn=function(e,r,n){return n==null&&(n="0"),e.length>=r?e:new Array(r-e.length+1).join(n)+e};function Ce(t,e){var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t,t.superclass=e.prototype,e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e)}E!==void 0&&E||(o.KJUR=E={}),E.crypto!==void 0&&E.crypto||(E.crypto={}),E.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:J.algo.MD5,sha1:J.algo.SHA1,sha224:J.algo.SHA224,sha256:J.algo.SHA256,sha384:J.algo.SHA384,sha512:J.algo.SHA512,ripemd160:J.algo.RIPEMD160},this.getDigestInfoHex=function(t,e){if(this.DIGESTINFOHEAD[e]===void 0)throw"alg not supported in Util.DIGESTINFOHEAD: "+e;return this.DIGESTINFOHEAD[e]+t},this.getPaddedDigestInfoHex=function(t,e,r){var n=this.getDigestInfoHex(t,e),a=r/4;if(n.length+22>a)throw"key is too short for SigAlg: keylen="+r+","+e;for(var g="0001",_="00"+n,x="",F=a-g.length-_.length,A=0;A<F;A+=2)x+="ff";return g+x+_},this.hashString=function(t,e){return new E.crypto.MessageDigest({alg:e}).digestString(t)},this.hashHex=function(t,e){return new E.crypto.MessageDigest({alg:e}).digestHex(t)},this.sha1=function(t){return this.hashString(t,"sha1")},this.sha256=function(t){return this.hashString(t,"sha256")},this.sha256Hex=function(t){return this.hashHex(t,"sha256")},this.sha512=function(t){return this.hashString(t,"sha512")},this.sha512Hex=function(t){return this.hashHex(t,"sha512")},this.isKey=function(t){return t instanceof he||t instanceof E.crypto.DSA||t instanceof E.crypto.ECDSA}},E.crypto.Util.md5=function(t){return new E.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(t)},E.crypto.Util.ripemd160=function(t){return new E.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(t)},E.crypto.Util.SECURERANDOMGEN=new we,E.crypto.Util.getRandomHexOfNbytes=function(t){var e=new Array(t);return E.crypto.Util.SECURERANDOMGEN.nextBytes(e),er(e)},E.crypto.Util.getRandomBigIntegerOfNbytes=function(t){return new M(E.crypto.Util.getRandomHexOfNbytes(t),16)},E.crypto.Util.getRandomHexOfNbits=function(t){var e=t%8,r=new Array((t-e)/8+1);return E.crypto.Util.SECURERANDOMGEN.nextBytes(r),r[0]=(255<<e&255^255)&r[0],er(r)},E.crypto.Util.getRandomBigIntegerOfNbits=function(t){return new M(E.crypto.Util.getRandomHexOfNbits(t),16)},E.crypto.Util.getRandomBigIntegerZeroToMax=function(t){for(var e=t.bitLength();;){var r=E.crypto.Util.getRandomBigIntegerOfNbits(e);if(t.compareTo(r)!=-1)return r}},E.crypto.Util.getRandomBigIntegerMinToMax=function(t,e){var r=t.compareTo(e);if(r==1)throw"biMin is greater than biMax";if(r==0)return t;var n=e.subtract(t);return E.crypto.Util.getRandomBigIntegerZeroToMax(n).add(t)},E.crypto.MessageDigest=function(t){this.setAlgAndProvider=function(e,r){if((e=E.crypto.MessageDigest.getCanonicalAlgName(e))!==null&&r===void 0&&(r=E.crypto.Util.DEFAULTPROVIDER[e]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(e)!=-1&&r=="cryptojs"){try{this.md=E.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[e].create()}catch(n){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+n}this.updateString=function(n){this.md.update(n)},this.updateHex=function(n){var a=J.enc.Hex.parse(n);this.md.update(a)},this.digest=function(){return this.md.finalize().toString(J.enc.Hex)},this.digestString=function(n){return this.updateString(n),this.digest()},this.digestHex=function(n){return this.updateHex(n),this.digest()}}if(":sha256:".indexOf(e)!=-1&&r=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(n){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+n}this.updateString=function(n){this.md.update(n)},this.updateHex=function(n){var a=sjcl.codec.hex.toBits(n);this.md.update(a)},this.digest=function(){var n=this.md.finalize();return sjcl.codec.hex.fromBits(n)},this.digestString=function(n){return this.updateString(n),this.digest()},this.digestHex=function(n){return this.updateHex(n),this.digest()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},t!==void 0&&t.alg!==void 0&&(this.algName=t.alg,t.prov===void 0&&(this.provName=E.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},E.crypto.MessageDigest.getCanonicalAlgName=function(t){return typeof t=="string"&&(t=(t=t.toLowerCase()).replace(/-/,"")),t},E.crypto.MessageDigest.getHashLength=function(t){var e=E.crypto.MessageDigest,r=e.getCanonicalAlgName(t);if(e.HASHLENGTH[r]===void 0)throw"not supported algorithm: "+t;return e.HASHLENGTH[r]},E.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},E.crypto.Mac=function(t){this.setAlgAndProvider=function(e,r){if((e=e.toLowerCase())==null&&(e="hmacsha1"),(e=e.toLowerCase()).substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+e;r===void 0&&(r=E.crypto.Util.DEFAULTPROVIDER[e]),this.algProv=e+"/"+r;var n=e.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(n)!=-1&&r=="cryptojs"){try{var a=E.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[n];this.mac=J.algo.HMAC.create(a,this.pass)}catch(g){throw"setAlgAndProvider hash alg set fail hashAlg="+n+"/"+g}this.updateString=function(g){this.mac.update(g)},this.updateHex=function(g){var _=J.enc.Hex.parse(g);this.mac.update(_)},this.doFinal=function(){return this.mac.finalize().toString(J.enc.Hex)},this.doFinalString=function(g){return this.updateString(g),this.doFinal()},this.doFinalHex=function(g){return this.updateHex(g),this.doFinal()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(e){if(typeof e=="string"){var r=e;return e.length%2!=1&&e.match(/^[0-9A-Fa-f]+$/)||(r=vt(e)),void(this.pass=J.enc.Hex.parse(r))}if((e===void 0?"undefined":k(e))!="object")throw"KJUR.crypto.Mac unsupported password type: "+e;if(r=null,e.hex!==void 0){if(e.hex.length%2!=0||!e.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+e.hex;r=e.hex}if(e.utf8!==void 0&&(r=pr(e.utf8)),e.rstr!==void 0&&(r=vt(e.rstr)),e.b64!==void 0&&(r=re(e.b64)),e.b64u!==void 0&&(r=Fe(e.b64u)),r==null)throw"KJUR.crypto.Mac unsupported password type: "+e;this.pass=J.enc.Hex.parse(r)},t!==void 0&&(t.pass!==void 0&&this.setPassword(t.pass),t.alg!==void 0&&(this.algName=t.alg,t.prov===void 0&&(this.provName=E.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},E.crypto.Signature=function(t){var e=null;if(this._setAlgNames=function(){var r=this.algName.match(/^(.+)with(.+)$/);r&&(this.mdAlgName=r[1].toLowerCase(),this.pubkeyAlgName=r[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(r,n){for(var a="",g=n/4-r.length,_=0;_<g;_++)a+="0";return a+r},this.setAlgAndProvider=function(r,n){if(this._setAlgNames(),n!="cryptojs/jsrsa")throw new Error("provider not supported: "+n);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new E.crypto.MessageDigest({alg:this.mdAlgName})}catch(a){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+a)}this.init=function(a,g){var _=null;try{_=g===void 0?De.getKey(a):De.getKey(a,g)}catch(x){throw"init failed:"+x}if(_.isPrivate===!0)this.prvKey=_,this.state="SIGN";else{if(_.isPublic!==!0)throw"init failed.:"+_;this.pubKey=_,this.state="VERIFY"}},this.updateString=function(a){this.md.updateString(a)},this.updateHex=function(a){this.md.updateHex(a)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&E.crypto.ECDSA!==void 0&&(this.prvKey=new E.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof he&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof he&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof E.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof E.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(a){return this.updateString(a),this.sign()},this.signHex=function(a){return this.updateHex(a),this.sign()},this.verify=function(a){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&E.crypto.ECDSA!==void 0&&(this.pubKey=new E.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof he&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,a,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof he&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,a);if(E.crypto.ECDSA!==void 0&&this.pubKey instanceof E.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,a);if(E.crypto.DSA!==void 0&&this.pubKey instanceof E.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,a);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(r,n){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(r){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(r){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(r){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(r){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(r){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=t,t!==void 0&&(t.alg!==void 0&&(this.algName=t.alg,t.prov===void 0?this.provName=E.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=t.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),t.psssaltlen!==void 0&&(this.pssSaltLen=t.psssaltlen),t.prvkeypem!==void 0)){if(t.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{e=De.getKey(t.prvkeypem),this.init(e)}catch(r){throw"fatal error to load pem private key: "+r}}},E.crypto.Cipher=function(t){},E.crypto.Cipher.encrypt=function(t,e,r){if(e instanceof he&&e.isPublic){var n=E.crypto.Cipher.getAlgByKeyAndName(e,r);if(n==="RSA")return e.encrypt(t);if(n==="RSAOAEP")return e.encryptOAEP(t,"sha1");var a=n.match(/^RSAOAEP(\d+)$/);if(a!==null)return e.encryptOAEP(t,"sha"+a[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+r}throw"Cipher.encrypt: unsupported key or algorithm"},E.crypto.Cipher.decrypt=function(t,e,r){if(e instanceof he&&e.isPrivate){var n=E.crypto.Cipher.getAlgByKeyAndName(e,r);if(n==="RSA")return e.decrypt(t);if(n==="RSAOAEP")return e.decryptOAEP(t,"sha1");var a=n.match(/^RSAOAEP(\d+)$/);if(a!==null)return e.decryptOAEP(t,"sha"+a[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+r}throw"Cipher.decrypt: unsupported key or algorithm"},E.crypto.Cipher.getAlgByKeyAndName=function(t,e){if(t instanceof he){if(":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(e)!=-1)return e;if(e==null)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+e}throw"getAlgByKeyAndName: not supported algorithm name: "+e},E.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},E!==void 0&&E||(o.KJUR=E={}),E.crypto!==void 0&&E.crypto||(E.crypto={}),E.crypto.ECDSA=function(t){var e=Error,r=M,n=pe,a=E.crypto.ECDSA,g=E.crypto.ECParameterDB,_=a.getName,x=se,F=x.getVbyListEx,A=x.isASN1HEX,T=new we;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(U){return new r(U.bitLength(),T).mod(U.subtract(r.ONE)).add(r.ONE)},this.setNamedCurve=function(U){this.ecparams=g.getByName(U),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=U},this.setPrivateKeyHex=function(U){this.isPrivate=!0,this.prvKeyHex=U},this.setPublicKeyHex=function(U){this.isPublic=!0,this.pubKeyHex=U},this.getPublicKeyXYHex=function(){var U=this.pubKeyHex;if(U.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var H=this.ecparams.keylen/4;if(U.length!==2+2*H)throw"malformed public key hex length";var q={};return q.x=U.substr(2,H),q.y=U.substr(2+H),q},this.getShortNISTPCurveName=function(){var U=this.curveName;return U==="secp256r1"||U==="NIST P-256"||U==="P-256"||U==="prime256v1"?"P-256":U==="secp384r1"||U==="NIST P-384"||U==="P-384"?"P-384":null},this.generateKeyPairHex=function(){var U=this.ecparams.n,H=this.getBigRandom(U),q=this.ecparams.G.multiply(H),z=q.getX().toBigInteger(),Q=q.getY().toBigInteger(),Z=this.ecparams.keylen/4,m=("0000000000"+H.toString(16)).slice(-Z),C="04"+("0000000000"+z.toString(16)).slice(-Z)+("0000000000"+Q.toString(16)).slice(-Z);return this.setPrivateKeyHex(m),this.setPublicKeyHex(C),{ecprvhex:m,ecpubhex:C}},this.signWithMessageHash=function(U){return this.signHex(U,this.prvKeyHex)},this.signHex=function(U,H){var q=new r(H,16),z=this.ecparams.n,Q=new r(U.substring(0,this.ecparams.keylen/4),16);do var Z=this.getBigRandom(z),m=this.ecparams.G.multiply(Z).getX().toBigInteger().mod(z);while(m.compareTo(r.ZERO)<=0);var C=Z.modInverse(z).multiply(Q.add(q.multiply(m))).mod(z);return a.biRSSigToASN1Sig(m,C)},this.sign=function(U,H){var q=H,z=this.ecparams.n,Q=r.fromByteArrayUnsigned(U);do var Z=this.getBigRandom(z),m=this.ecparams.G.multiply(Z).getX().toBigInteger().mod(z);while(m.compareTo(M.ZERO)<=0);var C=Z.modInverse(z).multiply(Q.add(q.multiply(m))).mod(z);return this.serializeSig(m,C)},this.verifyWithMessageHash=function(U,H){return this.verifyHex(U,H,this.pubKeyHex)},this.verifyHex=function(U,H,q){try{var z,Q,Z=a.parseSigHex(H);z=Z.r,Q=Z.s;var m=n.decodeFromHex(this.ecparams.curve,q),C=new r(U.substring(0,this.ecparams.keylen/4),16);return this.verifyRaw(C,z,Q,m)}catch{return!1}},this.verify=function(U,H,q){var z,Q,Z;if(Bitcoin.Util.isArray(H)){var m=this.parseSig(H);z=m.r,Q=m.s}else{if((H===void 0?"undefined":k(H))!=="object"||!H.r||!H.s)throw"Invalid value for signature";z=H.r,Q=H.s}if(q instanceof pe)Z=q;else{if(!Bitcoin.Util.isArray(q))throw"Invalid format for pubkey value, must be byte array or ECPointFp";Z=n.decodeFrom(this.ecparams.curve,q)}var C=r.fromByteArrayUnsigned(U);return this.verifyRaw(C,z,Q,Z)},this.verifyRaw=function(U,H,q,z){var Q=this.ecparams.n,Z=this.ecparams.G;if(H.compareTo(r.ONE)<0||H.compareTo(Q)>=0||q.compareTo(r.ONE)<0||q.compareTo(Q)>=0)return!1;var m=q.modInverse(Q),C=U.multiply(m).mod(Q),D=H.multiply(m).mod(Q);return Z.multiply(C).add(z.multiply(D)).getX().toBigInteger().mod(Q).equals(H)},this.serializeSig=function(U,H){var q=U.toByteArraySigned(),z=H.toByteArraySigned(),Q=[];return Q.push(2),Q.push(q.length),(Q=Q.concat(q)).push(2),Q.push(z.length),(Q=Q.concat(z)).unshift(Q.length),Q.unshift(48),Q},this.parseSig=function(U){var H;if(U[0]!=48)throw new Error("Signature not a valid DERSequence");if(U[H=2]!=2)throw new Error("First element in signature must be a DERInteger");var q=U.slice(H+2,H+2+U[H+1]);if(U[H+=2+U[H+1]]!=2)throw new Error("Second element in signature must be a DERInteger");var z=U.slice(H+2,H+2+U[H+1]);return H+=2+U[H+1],{r:r.fromByteArrayUnsigned(q),s:r.fromByteArrayUnsigned(z)}},this.parseSigCompact=function(U){if(U.length!==65)throw"Signature has the wrong length";var H=U[0]-27;if(H<0||H>7)throw"Invalid signature type";var q=this.ecparams.n;return{r:r.fromByteArrayUnsigned(U.slice(1,33)).mod(q),s:r.fromByteArrayUnsigned(U.slice(33,65)).mod(q),i:H}},this.readPKCS5PrvKeyHex=function(U){if(A(U)===!1)throw new Error("not ASN.1 hex string");var H,q,z;try{H=F(U,0,["[0]",0],"06"),q=F(U,0,[1],"04");try{z=F(U,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=_(H),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(z),this.setPrivateKeyHex(q),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(U){if(A(U)===!1)throw new e("not ASN.1 hex string");var H,q,z;try{F(U,0,[1,0],"06"),H=F(U,0,[1,1],"06"),q=F(U,0,[2,0,1],"04");try{z=F(U,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new e("malformed PKCS#8 plain ECC private key")}if(this.curveName=_(H),this.curveName===void 0)throw new e("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(z),this.setPrivateKeyHex(q),this.isPublic=!1},this.readPKCS8PubKeyHex=function(U){if(A(U)===!1)throw new e("not ASN.1 hex string");var H,q;try{F(U,0,[0,0],"06"),H=F(U,0,[0,1],"06"),q=F(U,0,[1],"03")}catch{throw new e("malformed PKCS#8 ECC public key")}if(this.curveName=_(H),this.curveName===null)throw new e("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(q)},this.readCertPubKeyHex=function(U,H){if(A(U)===!1)throw new e("not ASN.1 hex string");var q,z;try{q=F(U,0,[0,5,0,1],"06"),z=F(U,0,[0,5,1],"03")}catch{throw new e("malformed X.509 certificate ECC public key")}if(this.curveName=_(q),this.curveName===null)throw new e("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(z)},t!==void 0&&t.curve!==void 0&&(this.curveName=t.curve),this.curveName===void 0&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),t!==void 0&&(t.prv!==void 0&&this.setPrivateKeyHex(t.prv),t.pub!==void 0&&this.setPublicKeyHex(t.pub))},E.crypto.ECDSA.parseSigHex=function(t){var e=E.crypto.ECDSA.parseSigHexInHexRS(t);return{r:new M(e.r,16),s:new M(e.s,16)}},E.crypto.ECDSA.parseSigHexInHexRS=function(t){var e=se,r=e.getChildIdx,n=e.getV;if(e.checkStrictDER(t,0),t.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var a=r(t,0);if(a.length!=2)throw new Error("signature shall have two elements");var g=a[0],_=a[1];if(t.substr(g,2)!="02")throw new Error("1st item not ASN.1 integer");if(t.substr(_,2)!="02")throw new Error("2nd item not ASN.1 integer");return{r:n(t,g),s:n(t,_)}},E.crypto.ECDSA.asn1SigToConcatSig=function(t){var e=E.crypto.ECDSA.parseSigHexInHexRS(t),r=e.r,n=e.s;if(r.substr(0,2)=="00"&&r.length%32==2&&(r=r.substr(2)),n.substr(0,2)=="00"&&n.length%32==2&&(n=n.substr(2)),r.length%32==30&&(r="00"+r),n.length%32==30&&(n="00"+n),r.length%32!=0)throw"unknown ECDSA sig r length error";if(n.length%32!=0)throw"unknown ECDSA sig s length error";return r+n},E.crypto.ECDSA.concatSigToASN1Sig=function(t){if(t.length/2*8%128!=0)throw"unknown ECDSA concatinated r-s sig  length error";var e=t.substr(0,t.length/2),r=t.substr(t.length/2);return E.crypto.ECDSA.hexRSSigToASN1Sig(e,r)},E.crypto.ECDSA.hexRSSigToASN1Sig=function(t,e){var r=new M(t,16),n=new M(e,16);return E.crypto.ECDSA.biRSSigToASN1Sig(r,n)},E.crypto.ECDSA.biRSSigToASN1Sig=function(t,e){var r=E.asn1,n=new r.DERInteger({bigint:t}),a=new r.DERInteger({bigint:e});return new r.DERSequence({array:[n,a]}).getEncodedHex()},E.crypto.ECDSA.getName=function(t){return t==="2b8104001f"?"secp192k1":t==="2a8648ce3d030107"?"secp256r1":t==="2b8104000a"?"secp256k1":t==="2b81040021"?"secp224r1":t==="2b81040022"?"secp384r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(t)!==-1?"secp256r1":"|secp256k1|".indexOf(t)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(t)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(t)!==-1?"secp384r1":null},E!==void 0&&E||(o.KJUR=E={}),E.crypto!==void 0&&E.crypto||(E.crypto={}),E.crypto.ECParameterDB=new function(){var t={},e={};function r(n){return new M(n,16)}this.getByName=function(n){var a=n;if(e[a]!==void 0&&(a=e[n]),t[a]!==void 0)return t[a];throw"unregistered EC curve name: "+a},this.regist=function(n,a,g,_,x,F,A,T,U,H,q,z){t[n]={};var Q=r(g),Z=r(_),m=r(x),C=r(F),D=r(A),O=new ct(Q,Z,m),Y=O.decodePointHex("04"+T+U);t[n].name=n,t[n].keylen=a,t[n].curve=O,t[n].G=Y,t[n].n=C,t[n].h=D,t[n].oid=q,t[n].info=z;for(var ee=0;ee<H.length;ee++)e[H[ee]]=n}},E.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),E.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),E.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),E.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),E.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),E.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),E.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),E.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),E.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),E.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);var De=function(){var t=function(A,T,U){return e(J.AES,A,T,U)},e=function(A,T,U,H){var q=J.enc.Hex.parse(T),z=J.enc.Hex.parse(U),Q=J.enc.Hex.parse(H),Z={};Z.key=z,Z.iv=Q,Z.ciphertext=q;var m=A.decrypt(Z,z,{iv:Q});return J.enc.Hex.stringify(m)},r=function(A,T,U){return n(J.AES,A,T,U)},n=function(A,T,U,H){var q=J.enc.Hex.parse(T),z=J.enc.Hex.parse(U),Q=J.enc.Hex.parse(H),Z=A.encrypt(q,z,{iv:Q}),m=J.enc.Hex.parse(Z.toString());return J.enc.Base64.stringify(m)},a={"AES-256-CBC":{proc:t,eproc:r,keylen:32,ivlen:16},"AES-192-CBC":{proc:t,eproc:r,keylen:24,ivlen:16},"AES-128-CBC":{proc:t,eproc:r,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(A,T,U){return e(J.TripleDES,A,T,U)},eproc:function(A,T,U){return n(J.TripleDES,A,T,U)},keylen:24,ivlen:8},"DES-CBC":{proc:function(A,T,U){return e(J.DES,A,T,U)},eproc:function(A,T,U){return n(J.DES,A,T,U)},keylen:8,ivlen:8}},g=function(A){var T={},U=A.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));U&&(T.cipher=U[1],T.ivsalt=U[2]);var H=A.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));H&&(T.type=H[1]);var q=-1,z=0;A.indexOf(`\r
\r
`)!=-1&&(q=A.indexOf(`\r
\r
`),z=2),A.indexOf(`

`)!=-1&&(q=A.indexOf(`

`),z=1);var Q=A.indexOf("-----END");if(q!=-1&&Q!=-1){var Z=A.substring(q+2*z,Q-z);Z=Z.replace(/\s+/g,""),T.data=Z}return T},_=function(A,T,U){for(var H=U.substring(0,16),q=J.enc.Hex.parse(H),z=J.enc.Utf8.parse(T),Q=a[A].keylen+a[A].ivlen,Z="",m=null;;){var C=J.algo.MD5.create();if(m!=null&&C.update(m),C.update(z),C.update(q),m=C.finalize(),(Z+=J.enc.Hex.stringify(m)).length>=2*Q)break}var D={};return D.keyhex=Z.substr(0,2*a[A].keylen),D.ivhex=Z.substr(2*a[A].keylen,2*a[A].ivlen),D},x=function(A,T,U,H){var q=J.enc.Base64.parse(A),z=J.enc.Hex.stringify(q);return(0,a[T].proc)(z,U,H)};return{version:"1.0.0",parsePKCS5PEM:function(A){return g(A)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(A,T,U){return _(A,T,U)},decryptKeyB64:function(A,T,U,H){return x(A,T,U,H)},getDecryptedKeyHex:function(A,T){var U=g(A),H=U.cipher,q=U.ivsalt,z=U.data,Q=_(H,T,q).keyhex;return x(z,H,Q,q)},getEncryptedPKCS5PEMFromPrvKeyHex:function(A,T,U,H,q){var z="";if(H!==void 0&&H!=null||(H="AES-256-CBC"),a[H]===void 0)throw new Error("KEYUTIL unsupported algorithm: "+H);q!==void 0&&q!=null||(q=function(m){var C=J.lib.WordArray.random(m);return J.enc.Hex.stringify(C)}(a[H].ivlen).toUpperCase());var Q=function(m,C,D,O){return(0,a[C].eproc)(m,D,O)}(T,H,_(H,U,q).keyhex,q);return z="-----BEGIN "+A+` PRIVATE KEY-----\r
`,z+=`Proc-Type: 4,ENCRYPTED\r
`,z+="DEK-Info: "+H+","+q+`\r
`,z+=`\r
`,z+=Q.replace(/(.{64})/g,`$1\r
`),z+=`\r
-----END `+A+` PRIVATE KEY-----\r
`},parseHexOfEncryptedPKCS8:function(A){var T=se,U=T.getChildIdx,H=T.getV,q={},z=U(A,0);if(z.length!=2)throw new Error("malformed format: SEQUENCE(0).items != 2: "+z.length);q.ciphertext=H(A,z[1]);var Q=U(A,z[0]);if(Q.length!=2)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+Q.length);if(H(A,Q[0])!="2a864886f70d01050d")throw new Error("this only supports pkcs5PBES2");var Z=U(A,Q[1]);if(Q.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+Z.length);var m=U(A,Z[1]);if(m.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+m.length);if(H(A,m[0])!="2a864886f70d0307")throw"this only supports TripleDES";q.encryptionSchemeAlg="TripleDES",q.encryptionSchemeIV=H(A,m[1]);var C=U(A,Z[0]);if(C.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+C.length);if(H(A,C[0])!="2a864886f70d01050c")throw new Error("this only supports pkcs5PBKDF2");var D=U(A,C[1]);if(D.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+D.length);q.pbkdf2Salt=H(A,D[0]);var O=H(A,D[1]);try{q.pbkdf2Iter=parseInt(O,16)}catch{throw new Error("malformed format pbkdf2Iter: "+O)}return q},getPBKDF2KeyHexFromParam:function(A,T){var U=J.enc.Hex.parse(A.pbkdf2Salt),H=A.pbkdf2Iter,q=J.PBKDF2(T,U,{keySize:6,iterations:H});return J.enc.Hex.stringify(q)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(A,T){var U=mt(A,"ENCRYPTED PRIVATE KEY"),H=this.parseHexOfEncryptedPKCS8(U),q=De.getPBKDF2KeyHexFromParam(H,T),z={};z.ciphertext=J.enc.Hex.parse(H.ciphertext);var Q=J.enc.Hex.parse(q),Z=J.enc.Hex.parse(H.encryptionSchemeIV),m=J.TripleDES.decrypt(z,Q,{iv:Z});return J.enc.Hex.stringify(m)},getKeyFromEncryptedPKCS8PEM:function(A,T){var U=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(A,T);return this.getKeyFromPlainPrivatePKCS8Hex(U)},parsePlainPrivatePKCS8Hex:function(A){var T=se,U=T.getChildIdx,H=T.getV,q={algparam:null};if(A.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var z=U(A,0);if(z.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(A.substr(z[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var Q=U(A,z[1]);if(Q.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(A.substr(Q[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if(q.algoid=H(A,Q[0]),A.substr(Q[1],2)=="06"&&(q.algparam=H(A,Q[1])),A.substr(z[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return q.keyidx=T.getVidx(A,z[2]),q},getKeyFromPlainPrivatePKCS8PEM:function(A){var T=mt(A,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(T)},getKeyFromPlainPrivatePKCS8Hex:function(A){var T,U=this.parsePlainPrivatePKCS8Hex(A);if(U.algoid=="2a864886f70d010101")T=new he;else if(U.algoid=="2a8648ce380401")T=new E.crypto.DSA;else{if(U.algoid!="2a8648ce3d0201")throw new Error("unsupported private key algorithm");T=new E.crypto.ECDSA}return T.readPKCS8PrvKeyHex(A),T},_getKeyFromPublicPKCS8Hex:function(A){var T,U=se.getVbyList(A,0,[0,0],"06");if(U==="2a864886f70d010101")T=new he;else if(U==="2a8648ce380401")T=new E.crypto.DSA;else{if(U!=="2a8648ce3d0201")throw new Error("unsupported PKCS#8 public key hex");T=new E.crypto.ECDSA}return T.readPKCS8PubKeyHex(A),T},parsePublicRawRSAKeyHex:function(A){var T=se,U=T.getChildIdx,H=T.getV,q={};if(A.substr(0,2)!="30")throw new Error("malformed RSA key(code:001)");var z=U(A,0);if(z.length!=2)throw new Error("malformed RSA key(code:002)");if(A.substr(z[0],2)!="02")throw new Error("malformed RSA key(code:003)");if(q.n=H(A,z[0]),A.substr(z[1],2)!="02")throw new Error("malformed RSA key(code:004)");return q.e=H(A,z[1]),q},parsePublicPKCS8Hex:function(A){var T=se,U=T.getChildIdx,H=T.getV,q={algparam:null},z=U(A,0);if(z.length!=2)throw new Error("outer DERSequence shall have 2 elements: "+z.length);var Q=z[0];if(A.substr(Q,2)!="30")throw new Error("malformed PKCS8 public key(code:001)");var Z=U(A,Q);if(Z.length!=2)throw new Error("malformed PKCS8 public key(code:002)");if(A.substr(Z[0],2)!="06")throw new Error("malformed PKCS8 public key(code:003)");if(q.algoid=H(A,Z[0]),A.substr(Z[1],2)=="06"?q.algparam=H(A,Z[1]):A.substr(Z[1],2)=="30"&&(q.algparam={},q.algparam.p=T.getVbyList(A,Z[1],[0],"02"),q.algparam.q=T.getVbyList(A,Z[1],[1],"02"),q.algparam.g=T.getVbyList(A,Z[1],[2],"02")),A.substr(z[1],2)!="03")throw new Error("malformed PKCS8 public key(code:004)");return q.key=H(A,z[1]).substr(2),q}}}();De.getKey=function(t,e,r){var n=(Z=se).getChildIdx,a=(Z.getV,Z.getVbyList),g=E.crypto,_=g.ECDSA,x=g.DSA,F=he,A=mt,T=De;if(F!==void 0&&t instanceof F||_!==void 0&&t instanceof _||x!==void 0&&t instanceof x)return t;if(t.curve!==void 0&&t.xy!==void 0&&t.d===void 0)return new _({pub:t.xy,curve:t.curve});if(t.curve!==void 0&&t.d!==void 0)return new _({prv:t.d,curve:t.curve});if(t.kty===void 0&&t.n!==void 0&&t.e!==void 0&&t.d===void 0)return(le=new F).setPublic(t.n,t.e),le;if(t.kty===void 0&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0&&t.p!==void 0&&t.q!==void 0&&t.dp!==void 0&&t.dq!==void 0&&t.co!==void 0&&t.qi===void 0)return(le=new F).setPrivateEx(t.n,t.e,t.d,t.p,t.q,t.dp,t.dq,t.co),le;if(t.kty===void 0&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0&&t.p===void 0)return(le=new F).setPrivate(t.n,t.e,t.d),le;if(t.p!==void 0&&t.q!==void 0&&t.g!==void 0&&t.y!==void 0&&t.x===void 0)return(le=new x).setPublic(t.p,t.q,t.g,t.y),le;if(t.p!==void 0&&t.q!==void 0&&t.g!==void 0&&t.y!==void 0&&t.x!==void 0)return(le=new x).setPrivate(t.p,t.q,t.g,t.y,t.x),le;if(t.kty==="RSA"&&t.n!==void 0&&t.e!==void 0&&t.d===void 0)return(le=new F).setPublic(Fe(t.n),Fe(t.e)),le;if(t.kty==="RSA"&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0&&t.p!==void 0&&t.q!==void 0&&t.dp!==void 0&&t.dq!==void 0&&t.qi!==void 0)return(le=new F).setPrivateEx(Fe(t.n),Fe(t.e),Fe(t.d),Fe(t.p),Fe(t.q),Fe(t.dp),Fe(t.dq),Fe(t.qi)),le;if(t.kty==="RSA"&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0)return(le=new F).setPrivate(Fe(t.n),Fe(t.e),Fe(t.d)),le;if(t.kty==="EC"&&t.crv!==void 0&&t.x!==void 0&&t.y!==void 0&&t.d===void 0){var U=(ae=new _({curve:t.crv})).ecparams.keylen/4,H="04"+("0000000000"+Fe(t.x)).slice(-U)+("0000000000"+Fe(t.y)).slice(-U);return ae.setPublicKeyHex(H),ae}if(t.kty==="EC"&&t.crv!==void 0&&t.x!==void 0&&t.y!==void 0&&t.d!==void 0){U=(ae=new _({curve:t.crv})).ecparams.keylen/4,H="04"+("0000000000"+Fe(t.x)).slice(-U)+("0000000000"+Fe(t.y)).slice(-U);var q=("0000000000"+Fe(t.d)).slice(-U);return ae.setPublicKeyHex(H),ae.setPrivateKeyHex(q),ae}if(r==="pkcs5prv"){var z,Q=t,Z=se;if((z=n(Q,0)).length===9)(le=new F).readPKCS5PrvKeyHex(Q);else if(z.length===6)(le=new x).readPKCS5PrvKeyHex(Q);else{if(!(z.length>2&&Q.substr(z[1],2)==="04"))throw new Error("unsupported PKCS#1/5 hexadecimal key");(le=new _).readPKCS5PrvKeyHex(Q)}return le}if(r==="pkcs8prv")return le=T.getKeyFromPlainPrivatePKCS8Hex(t);if(r==="pkcs8pub")return T._getKeyFromPublicPKCS8Hex(t);if(r==="x509pub")return He.getPublicKeyFromCertHex(t);if(t.indexOf("-END CERTIFICATE-",0)!=-1||t.indexOf("-END X509 CERTIFICATE-",0)!=-1||t.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return He.getPublicKeyFromCertPEM(t);if(t.indexOf("-END PUBLIC KEY-")!=-1){var m=mt(t,"PUBLIC KEY");return T._getKeyFromPublicPKCS8Hex(m)}if(t.indexOf("-END RSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")==-1){var C=A(t,"RSA PRIVATE KEY");return T.getKey(C,null,"pkcs5prv")}if(t.indexOf("-END DSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")==-1){var D=a(Ae=A(t,"DSA PRIVATE KEY"),0,[1],"02"),O=a(Ae,0,[2],"02"),Y=a(Ae,0,[3],"02"),ee=a(Ae,0,[4],"02"),ue=a(Ae,0,[5],"02");return(le=new x).setPrivate(new M(D,16),new M(O,16),new M(Y,16),new M(ee,16),new M(ue,16)),le}if(t.indexOf("-END EC PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")==-1)return C=A(t,"EC PRIVATE KEY"),T.getKey(C,null,"pkcs5prv");if(t.indexOf("-END PRIVATE KEY-")!=-1)return T.getKeyFromPlainPrivatePKCS8PEM(t);if(t.indexOf("-END RSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")!=-1){var ne=T.getDecryptedKeyHex(t,e),ge=new he;return ge.readPKCS5PrvKeyHex(ne),ge}if(t.indexOf("-END EC PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")!=-1){var ae,le=a(Ae=T.getDecryptedKeyHex(t,e),0,[1],"04"),Ee=a(Ae,0,[2,0],"06"),Pe=a(Ae,0,[3,0],"03").substr(2);if(E.crypto.OID.oidhex2name[Ee]===void 0)throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+Ee);return(ae=new _({curve:E.crypto.OID.oidhex2name[Ee]})).setPublicKeyHex(Pe),ae.setPrivateKeyHex(le),ae.isPublic=!1,ae}if(t.indexOf("-END DSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")!=-1){var Ae;return D=a(Ae=T.getDecryptedKeyHex(t,e),0,[1],"02"),O=a(Ae,0,[2],"02"),Y=a(Ae,0,[3],"02"),ee=a(Ae,0,[4],"02"),ue=a(Ae,0,[5],"02"),(le=new x).setPrivate(new M(D,16),new M(O,16),new M(Y,16),new M(ee,16),new M(ue,16)),le}if(t.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return T.getKeyFromEncryptedPKCS8PEM(t,e);throw new Error("not supported argument")},De.generateKeypair=function(t,e){if(t=="RSA"){var r=e;(_=new he).generate(r,"10001"),_.isPrivate=!0,_.isPublic=!0;var n=new he,a=_.n.toString(16),g=_.e.toString(16);return n.setPublic(a,g),n.isPrivate=!1,n.isPublic=!0,(x={}).prvKeyObj=_,x.pubKeyObj=n,x}if(t=="EC"){var _,x,F=e,A=new E.crypto.ECDSA({curve:F}).generateKeyPairHex();return(_=new E.crypto.ECDSA({curve:F})).setPublicKeyHex(A.ecpubhex),_.setPrivateKeyHex(A.ecprvhex),_.isPrivate=!0,_.isPublic=!1,(n=new E.crypto.ECDSA({curve:F})).setPublicKeyHex(A.ecpubhex),n.isPrivate=!1,n.isPublic=!0,(x={}).prvKeyObj=_,x.pubKeyObj=n,x}throw new Error("unknown algorithm: "+t)},De.getPEM=function(t,e,r,n,a,g){var _=E,x=_.asn1,F=x.DERObjectIdentifier,A=x.DERInteger,T=x.ASN1Util.newObject,U=x.x509.SubjectPublicKeyInfo,H=_.crypto,q=H.DSA,z=H.ECDSA,Q=he;function Z(ae){return T({seq:[{int:0},{int:{bigint:ae.n}},{int:ae.e},{int:{bigint:ae.d}},{int:{bigint:ae.p}},{int:{bigint:ae.q}},{int:{bigint:ae.dmp1}},{int:{bigint:ae.dmq1}},{int:{bigint:ae.coeff}}]})}function m(ae){return T({seq:[{int:1},{octstr:{hex:ae.prvKeyHex}},{tag:["a0",!0,{oid:{name:ae.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+ae.pubKeyHex}}]}]})}function C(ae){return T({seq:[{int:0},{int:{bigint:ae.p}},{int:{bigint:ae.q}},{int:{bigint:ae.g}},{int:{bigint:ae.y}},{int:{bigint:ae.x}}]})}if((Q!==void 0&&t instanceof Q||q!==void 0&&t instanceof q||z!==void 0&&t instanceof z)&&t.isPublic==1&&(e===void 0||e=="PKCS8PUB"))return ot(ee=new U(t).getEncodedHex(),"PUBLIC KEY");if(e=="PKCS1PRV"&&Q!==void 0&&t instanceof Q&&(r===void 0||r==null)&&t.isPrivate==1)return ot(ee=Z(t).getEncodedHex(),"RSA PRIVATE KEY");if(e=="PKCS1PRV"&&z!==void 0&&t instanceof z&&(r===void 0||r==null)&&t.isPrivate==1){var D=new F({name:t.curveName}).getEncodedHex(),O=m(t).getEncodedHex(),Y="";return Y+=ot(D,"EC PARAMETERS"),Y+=ot(O,"EC PRIVATE KEY")}if(e=="PKCS1PRV"&&q!==void 0&&t instanceof q&&(r===void 0||r==null)&&t.isPrivate==1)return ot(ee=C(t).getEncodedHex(),"DSA PRIVATE KEY");if(e=="PKCS5PRV"&&Q!==void 0&&t instanceof Q&&r!==void 0&&r!=null&&t.isPrivate==1){var ee=Z(t).getEncodedHex();return n===void 0&&(n="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",ee,r,n,g)}if(e=="PKCS5PRV"&&z!==void 0&&t instanceof z&&r!==void 0&&r!=null&&t.isPrivate==1)return ee=m(t).getEncodedHex(),n===void 0&&(n="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",ee,r,n,g);if(e=="PKCS5PRV"&&q!==void 0&&t instanceof q&&r!==void 0&&r!=null&&t.isPrivate==1)return ee=C(t).getEncodedHex(),n===void 0&&(n="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",ee,r,n,g);var ue=function(le,Ee){var Pe=ne(le,Ee);return new T({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:Pe.pbkdf2Salt}},{int:Pe.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:Pe.encryptionSchemeIV}}]}]}]},{octstr:{hex:Pe.ciphertext}}]}).getEncodedHex()},ne=function(le,Ee){var Pe=J.lib.WordArray.random(8),Ae=J.lib.WordArray.random(8),st=J.PBKDF2(Ee,Pe,{keySize:6,iterations:100}),Qe=J.enc.Hex.parse(le),Ze=J.TripleDES.encrypt(Qe,st,{iv:Ae})+"",Ue={};return Ue.ciphertext=Ze,Ue.pbkdf2Salt=J.enc.Hex.stringify(Pe),Ue.pbkdf2Iter=100,Ue.encryptionSchemeAlg="DES-EDE3-CBC",Ue.encryptionSchemeIV=J.enc.Hex.stringify(Ae),Ue};if(e=="PKCS8PRV"&&Q!=null&&t instanceof Q&&t.isPrivate==1){var ge=Z(t).getEncodedHex();return ee=T({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:ge}}]}).getEncodedHex(),r===void 0||r==null?ot(ee,"PRIVATE KEY"):ot(O=ue(ee,r),"ENCRYPTED PRIVATE KEY")}if(e=="PKCS8PRV"&&z!==void 0&&t instanceof z&&t.isPrivate==1)return ge=new T({seq:[{int:1},{octstr:{hex:t.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+t.pubKeyHex}}]}]}).getEncodedHex(),ee=T({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:t.curveName}}]},{octstr:{hex:ge}}]}).getEncodedHex(),r===void 0||r==null?ot(ee,"PRIVATE KEY"):ot(O=ue(ee,r),"ENCRYPTED PRIVATE KEY");if(e=="PKCS8PRV"&&q!==void 0&&t instanceof q&&t.isPrivate==1)return ge=new A({bigint:t.x}).getEncodedHex(),ee=T({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:t.p}},{int:{bigint:t.q}},{int:{bigint:t.g}}]}]},{octstr:{hex:ge}}]}).getEncodedHex(),r===void 0||r==null?ot(ee,"PRIVATE KEY"):ot(O=ue(ee,r),"ENCRYPTED PRIVATE KEY");throw new Error("unsupported object nor format")},De.getKeyFromCSRPEM=function(t){var e=mt(t,"CERTIFICATE REQUEST");return De.getKeyFromCSRHex(e)},De.getKeyFromCSRHex=function(t){var e=De.parseCSRHex(t);return De.getKey(e.p8pubkeyhex,null,"pkcs8pub")},De.parseCSRHex=function(t){var e=se,r=e.getChildIdx,n=e.getTLV,a={},g=t;if(g.substr(0,2)!="30")throw new Error("malformed CSR(code:001)");var _=r(g,0);if(_.length<1)throw new Error("malformed CSR(code:002)");if(g.substr(_[0],2)!="30")throw new Error("malformed CSR(code:003)");var x=r(g,_[0]);if(x.length<3)throw new Error("malformed CSR(code:004)");return a.p8pubkeyhex=n(g,x[2]),a},De.getKeyID=function(t){var e=De,r=se;typeof t=="string"&&t.indexOf("BEGIN ")!=-1&&(t=e.getKey(t));var n=mt(e.getPEM(t)),a=r.getIdxbyList(n,0,[1]),g=r.getV(n,a).substring(2);return E.crypto.Util.hashHex(g,"sha1")},De.getJWKFromKey=function(t){var e={};if(t instanceof he&&t.isPrivate)return e.kty="RSA",e.n=Ne(t.n.toString(16)),e.e=Ne(t.e.toString(16)),e.d=Ne(t.d.toString(16)),e.p=Ne(t.p.toString(16)),e.q=Ne(t.q.toString(16)),e.dp=Ne(t.dmp1.toString(16)),e.dq=Ne(t.dmq1.toString(16)),e.qi=Ne(t.coeff.toString(16)),e;if(t instanceof he&&t.isPublic)return e.kty="RSA",e.n=Ne(t.n.toString(16)),e.e=Ne(t.e.toString(16)),e;if(t instanceof E.crypto.ECDSA&&t.isPrivate){if((n=t.getShortNISTPCurveName())!=="P-256"&&n!=="P-384")throw new Error("unsupported curve name for JWT: "+n);var r=t.getPublicKeyXYHex();return e.kty="EC",e.crv=n,e.x=Ne(r.x),e.y=Ne(r.y),e.d=Ne(t.prvKeyHex),e}if(t instanceof E.crypto.ECDSA&&t.isPublic){var n;if((n=t.getShortNISTPCurveName())!=="P-256"&&n!=="P-384")throw new Error("unsupported curve name for JWT: "+n);return r=t.getPublicKeyXYHex(),e.kty="EC",e.crv=n,e.x=Ne(r.x),e.y=Ne(r.y),e}throw new Error("not supported key object")},he.getPosArrayOfChildrenFromHex=function(t){return se.getChildIdx(t,0)},he.getHexValueArrayOfChildrenFromHex=function(t){var e,r=se.getV,n=r(t,(e=he.getPosArrayOfChildrenFromHex(t))[0]),a=r(t,e[1]),g=r(t,e[2]),_=r(t,e[3]),x=r(t,e[4]),F=r(t,e[5]),A=r(t,e[6]),T=r(t,e[7]),U=r(t,e[8]);return(e=new Array).push(n,a,g,_,x,F,A,T,U),e},he.prototype.readPrivateKeyFromPEMString=function(t){var e=mt(t),r=he.getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])},he.prototype.readPKCS5PrvKeyHex=function(t){var e=he.getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},he.prototype.readPKCS8PrvKeyHex=function(t){var e,r,n,a,g,_,x,F,A=se,T=A.getVbyListEx;if(A.isASN1HEX(t)===!1)throw new Error("not ASN.1 hex string");try{e=T(t,0,[2,0,1],"02"),r=T(t,0,[2,0,2],"02"),n=T(t,0,[2,0,3],"02"),a=T(t,0,[2,0,4],"02"),g=T(t,0,[2,0,5],"02"),_=T(t,0,[2,0,6],"02"),x=T(t,0,[2,0,7],"02"),F=T(t,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(e,r,n,a,g,_,x,F)},he.prototype.readPKCS5PubKeyHex=function(t){var e=se,r=e.getV;if(e.isASN1HEX(t)===!1)throw new Error("keyHex is not ASN.1 hex string");var n=e.getChildIdx(t,0);if(n.length!==2||t.substr(n[0],2)!=="02"||t.substr(n[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var a=r(t,n[0]),g=r(t,n[1]);this.setPublic(a,g)},he.prototype.readPKCS8PubKeyHex=function(t){var e=se;if(e.isASN1HEX(t)===!1)throw new Error("not ASN.1 hex string");if(e.getTLVbyListEx(t,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var r=e.getTLVbyListEx(t,0,[1,0]);this.readPKCS5PubKeyHex(r)},he.prototype.readCertPubKeyHex=function(t,e){var r,n;(r=new He).readCertHex(t),n=r.getPublicKeyHex(),this.readPKCS8PubKeyHex(n)};function nn(t,e){for(var r="",n=e/4-t.length,a=0;a<n;a++)r+="0";return r+t}function on(t,e,r){for(var n="",a=0;n.length<e;)n+=ht(r(vt(t+String.fromCharCode.apply(String,[(4278190080&a)>>24,(16711680&a)>>16,(65280&a)>>8,255&a])))),a+=1;return n}function sn(t){for(var e in E.crypto.Util.DIGESTINFOHEAD){var r=E.crypto.Util.DIGESTINFOHEAD[e],n=r.length;if(t.substring(0,n)==r)return[e,t.substring(n)]}return[]}function He(t){var e,r=se,n=r.getChildIdx,a=r.getV,g=r.getTLV,_=r.getVbyList,x=r.getVbyListEx,F=r.getTLVbyList,A=r.getTLVbyListEx,T=r.getIdxbyList,U=r.getIdxbyListEx,H=r.getVidx,q=r.getInt,z=r.oidname,Q=r.hextooidstr,Z=mt;try{e=E.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var m=F(this.hex,0,[0,0]);if(m.substr(0,2)=="a0"){var C=F(m,0,[0]),D=q(C,0);if(D<0||2<D)throw new Error("malformed version field");return this.version=D+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return x(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var m=A(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(m)},this.getAlgorithmIdentifierName=function(m){for(var C in e)if(m===e[C])return C;return z(x(m,0,[0],"06"))},this.getIssuer=function(){return this.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return F(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(){return this.getX500Name(this.getSubjectHex())},this.getSubjectHex=function(){return F(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var m=_(this.hex,0,[0,4+this.foffset,0]);return m=m.replace(/(..)/g,"%$1"),m=decodeURIComponent(m)},this.getNotAfter=function(){var m=_(this.hex,0,[0,4+this.foffset,1]);return m=m.replace(/(..)/g,"%$1"),m=decodeURIComponent(m)},this.getPublicKeyHex=function(){return r.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyIdx=function(){return T(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var m=this.getPublicKeyIdx();return T(this.hex,m,[1,0],"30")},this.getPublicKey=function(){return De.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var m=F(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(m)},this.getSignatureValueHex=function(){return _(this.hex,0,[2],"03",!0)},this.verifySignature=function(m){var C=this.getSignatureAlgorithmField(),D=this.getSignatureValueHex(),O=F(this.hex,0,[0],"30"),Y=new E.crypto.Signature({alg:C});return Y.init(m),Y.updateHex(O),Y.verify(D)},this.parseExt=function(m){var C,D,O;if(m===void 0){if(O=this.hex,this.version!==3)return-1;C=T(O,0,[0,7,0],"30"),D=n(O,C)}else{O=mt(m);var Y=T(O,0,[0,3,0,0],"06");if(a(O,Y)!="2a864886f70d01090e")return void(this.aExtInfo=new Array);C=T(O,0,[0,3,0,1,0],"30"),D=n(O,C),this.hex=O}this.aExtInfo=new Array;for(var ee=0;ee<D.length;ee++){var ue={critical:!1},ne=0;n(O,D[ee]).length===3&&(ue.critical=!0,ne=1),ue.oid=r.hextooidstr(_(O,D[ee],[0],"06"));var ge=T(O,D[ee],[1+ne]);ue.vidx=H(O,ge),this.aExtInfo.push(ue)}},this.getExtInfo=function(m){var C=this.aExtInfo,D=m;if(m.match(/^[0-9.]+$/)||(D=E.asn1.x509.OID.name2oid(m)),D!==""){for(var O=0;O<C.length;O++)if(C[O].oid===D)return C[O]}},this.getExtBasicConstraints=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("basicConstraints");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"basicConstraints"};if(C&&(O.critical=!0),m==="3000")return O;if(m==="30030101ff")return O.cA=!0,O;if(m.substr(0,12)==="30060101ff02"){var Y=a(m,10),ee=parseInt(Y,16);return O.cA=!0,O.pathLen=ee,O}throw new Error("hExtV parse error: "+m)},this.getExtKeyUsage=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("keyUsage");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"keyUsage"};return C&&(O.critical=!0),O.names=this.getExtKeyUsageString(m).split(","),O},this.getExtKeyUsageBin=function(m){if(m===void 0){var C=this.getExtInfo("keyUsage");if(C===void 0)return"";m=g(this.hex,C.vidx)}if(m.length!=8&&m.length!=10)throw new Error("malformed key usage value: "+m);var D="000000000000000"+parseInt(m.substr(6),16).toString(2);return m.length==8&&(D=D.slice(-8)),m.length==10&&(D=D.slice(-16)),(D=D.replace(/0+$/,""))==""&&(D="0"),D},this.getExtKeyUsageString=function(m){for(var C=this.getExtKeyUsageBin(m),D=new Array,O=0;O<C.length;O++)C.substr(O,1)=="1"&&D.push(He.KEYUSAGE_NAME[O]);return D.join(",")},this.getExtSubjectKeyIdentifier=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("subjectKeyIdentifier");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"subjectKeyIdentifier"};C&&(O.critical=!0);var Y=a(m,0);return O.kid={hex:Y},O},this.getExtAuthorityKeyIdentifier=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("authorityKeyIdentifier");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"authorityKeyIdentifier"};C&&(O.critical=!0);for(var Y=n(m,0),ee=0;ee<Y.length;ee++){var ue=m.substr(Y[ee],2);if(ue==="80"&&(O.kid={hex:a(m,Y[ee])}),ue==="a1"){var ne=g(m,Y[ee]),ge=this.getGeneralNames(ne);O.issuer=ge[0].dn}ue==="82"&&(O.sn={hex:a(m,Y[ee])})}return O},this.getExtExtKeyUsage=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("extKeyUsage");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"extKeyUsage",array:[]};C&&(O.critical=!0);for(var Y=n(m,0),ee=0;ee<Y.length;ee++)O.array.push(z(a(m,Y[ee])));return O},this.getExtExtKeyUsageName=function(){var m=this.getExtInfo("extKeyUsage");if(m===void 0)return m;var C=new Array,D=g(this.hex,m.vidx);if(D==="")return C;for(var O=n(D,0),Y=0;Y<O.length;Y++)C.push(z(a(D,O[Y])));return C},this.getExtSubjectAltName=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("subjectAltName");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"subjectAltName",array:[]};return C&&(O.critical=!0),O.array=this.getGeneralNames(m),O},this.getExtIssuerAltName=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("issuerAltName");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"issuerAltName",array:[]};return C&&(O.critical=!0),O.array=this.getGeneralNames(m),O},this.getGeneralNames=function(m){for(var C=n(m,0),D=[],O=0;O<C.length;O++){var Y=this.getGeneralName(g(m,C[O]));Y!==void 0&&D.push(Y)}return D},this.getGeneralName=function(m){var C=m.substr(0,2),D=a(m,0),O=ht(D);return C=="81"?{rfc822:O}:C=="82"?{dns:O}:C=="86"?{uri:O}:C=="87"?{ip:vr(D)}:C=="a4"?{dn:this.getX500Name(D)}:void 0},this.getExtSubjectAltName2=function(){var m,C,D,O=this.getExtInfo("subjectAltName");if(O===void 0)return O;for(var Y=new Array,ee=g(this.hex,O.vidx),ue=n(ee,0),ne=0;ne<ue.length;ne++)D=ee.substr(ue[ne],2),m=a(ee,ue[ne]),D==="81"&&(C=Oe(m),Y.push(["MAIL",C])),D==="82"&&(C=Oe(m),Y.push(["DNS",C])),D==="84"&&(C=He.hex2dn(m,0),Y.push(["DN",C])),D==="86"&&(C=Oe(m),Y.push(["URI",C])),D==="87"&&(C=vr(m),Y.push(["IP",C]));return Y},this.getExtCRLDistributionPoints=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("cRLDistributionPoints");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"cRLDistributionPoints",array:[]};C&&(O.critical=!0);for(var Y=n(m,0),ee=0;ee<Y.length;ee++){var ue=g(m,Y[ee]);O.array.push(this.getDistributionPoint(ue))}return O},this.getDistributionPoint=function(m){for(var C={},D=n(m,0),O=0;O<D.length;O++){var Y=m.substr(D[O],2),ee=g(m,D[O]);Y=="a0"&&(C.dpname=this.getDistributionPointName(ee))}return C},this.getDistributionPointName=function(m){for(var C={},D=n(m,0),O=0;O<D.length;O++){var Y=m.substr(D[O],2),ee=g(m,D[O]);Y=="a0"&&(C.full=this.getGeneralNames(ee))}return C},this.getExtCRLDistributionPointsURI=function(){var m=this.getExtInfo("cRLDistributionPoints");if(m===void 0)return m;for(var C=new Array,D=n(this.hex,m.vidx),O=0;O<D.length;O++)try{var Y=Oe(_(this.hex,D[O],[0,0,0],"86"));C.push(Y)}catch{}return C},this.getExtAIAInfo=function(){var m=this.getExtInfo("authorityInfoAccess");if(m===void 0)return m;for(var C={ocsp:[],caissuer:[]},D=n(this.hex,m.vidx),O=0;O<D.length;O++){var Y=_(this.hex,D[O],[0],"06"),ee=_(this.hex,D[O],[1],"86");Y==="2b06010505073001"&&C.ocsp.push(Oe(ee)),Y==="2b06010505073002"&&C.caissuer.push(Oe(ee))}return C},this.getExtAuthorityInfoAccess=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("authorityInfoAccess");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"authorityInfoAccess",array:[]};C&&(O.critical=!0);for(var Y=n(m,0),ee=0;ee<Y.length;ee++){var ue=x(m,Y[ee],[0],"06"),ne=Oe(_(m,Y[ee],[1],"86"));if(ue=="2b06010505073001")O.array.push({ocsp:ne});else{if(ue!="2b06010505073002")throw new Error("unknown method: "+ue);O.array.push({caissuer:ne})}}return O},this.getExtCertificatePolicies=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("certificatePolicies");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"certificatePolicies",array:[]};C&&(O.critical=!0);for(var Y=n(m,0),ee=0;ee<Y.length;ee++){var ue=g(m,Y[ee]),ne=this.getPolicyInformation(ue);O.array.push(ne)}return O},this.getPolicyInformation=function(m){var C={},D=_(m,0,[0],"06");C.policyoid=z(D);var O=U(m,0,[1],"30");if(O!=-1){C.array=[];for(var Y=n(m,O),ee=0;ee<Y.length;ee++){var ue=g(m,Y[ee]),ne=this.getPolicyQualifierInfo(ue);C.array.push(ne)}}return C},this.getPolicyQualifierInfo=function(m){var C={},D=_(m,0,[0],"06");if(D==="2b06010505070201"){var O=x(m,0,[1],"16");C.cps=ht(O)}else if(D==="2b06010505070202"){var Y=F(m,0,[1],"30");C.unotice=this.getUserNotice(Y)}return C},this.getUserNotice=function(m){for(var C={},D=n(m,0),O=0;O<D.length;O++){var Y=g(m,D[O]);Y.substr(0,2)!="30"&&(C.exptext=this.getDisplayText(Y))}return C},this.getDisplayText=function(m){var C={};return C.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[m.substr(0,2)],C.str=ht(a(m,0)),C},this.getExtCRLNumber=function(m,C){var D={extname:"cRLNumber"};if(C&&(D.critical=!0),m.substr(0,2)=="02")return D.num={hex:a(m,0)},D;throw new Error("hExtV parse error: "+m)},this.getExtCRLReason=function(m,C){var D={extname:"cRLReason"};if(C&&(D.critical=!0),m.substr(0,2)=="0a")return D.code=parseInt(a(m,0),16),D;throw new Error("hExtV parse error: "+m)},this.getExtOcspNonce=function(m,C){var D={extname:"ocspNonce"};C&&(D.critical=!0);var O=a(m,0);return D.hex=O,D},this.getExtOcspNoCheck=function(m,C){var D={extname:"ocspNoCheck"};return C&&(D.critical=!0),D},this.getExtAdobeTimeStamp=function(m,C){if(m===void 0&&C===void 0){var D=this.getExtInfo("adobeTimeStamp");if(D===void 0)return;m=g(this.hex,D.vidx),C=D.critical}var O={extname:"adobeTimeStamp"};C&&(O.critical=!0);var Y=n(m,0);if(Y.length>1){var ee=g(m,Y[1]),ue=this.getGeneralName(ee);ue.uri!=null&&(O.uri=ue.uri)}if(Y.length>2){var ne=g(m,Y[2]);ne=="0101ff"&&(O.reqauth=!0),ne=="010100"&&(O.reqauth=!1)}return O},this.getX500NameRule=function(m){for(var C=null,D=[],O=0;O<m.length;O++)for(var Y=m[O],ee=0;ee<Y.length;ee++)D.push(Y[ee]);for(O=0;O<D.length;O++){var ue=D[O],ne=ue.ds,ge=ue.value,ae=ue.type;if(ne!="prn"&&ne!="utf8"&&ne!="ia5")return"mixed";if(ne=="ia5"){if(ae!="CN")return"mixed";if(E.lang.String.isMail(ge))continue;return"mixed"}if(ae=="C"){if(ne=="prn")continue;return"mixed"}if(C==null)C=ne;else if(C!==ne)return"mixed"}return C??"prn"},this.getX500Name=function(m){var C=this.getX500NameArray(m);return{array:C,str:this.dnarraytostr(C)}},this.getX500NameArray=function(m){for(var C=[],D=n(m,0),O=0;O<D.length;O++)C.push(this.getRDN(g(m,D[O])));return C},this.getRDN=function(m){for(var C=[],D=n(m,0),O=0;O<D.length;O++)C.push(this.getAttrTypeAndValue(g(m,D[O])));return C},this.getAttrTypeAndValue=function(m){var C={type:null,value:null,ds:null},D=n(m,0),O=_(m,D[0],[],"06"),Y=_(m,D[1],[]),ee=E.asn1.ASN1Util.oidHexToInt(O);return C.type=E.asn1.x509.OID.oid2atype(ee),C.ds=this.HEX2STAG[m.substr(D[1],2)],C.ds!="bmp"?C.value=Oe(Y):C.value=en(Y),C},this.readCertPEM=function(m){this.readCertHex(Z(m))},this.readCertHex=function(m){this.hex=m,this.getVersion();try{T(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(){var m={};return m.version=this.getVersion(),m.serial={hex:this.getSerialNumberHex()},m.sigalg=this.getSignatureAlgorithmField(),m.issuer=this.getIssuer(),m.notbefore=this.getNotBefore(),m.notafter=this.getNotAfter(),m.subject=this.getSubject(),m.sbjpubkey=ot(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo.length>0&&(m.ext=this.getExtParamArray()),m.sighex=this.getSignatureValueHex(),m},this.getExtParamArray=function(m){m==null&&U(this.hex,0,[0,"[3]"])!=-1&&(m=A(this.hex,0,[0,"[3]",0],"30"));for(var C=[],D=n(m,0),O=0;O<D.length;O++){var Y=g(m,D[O]),ee=this.getExtParam(Y);ee!=null&&C.push(ee)}return C},this.getExtParam=function(m){var C=n(m,0).length;if(C!=2&&C!=3)throw new Error("wrong number elements in Extension: "+C+" "+m);var D=Q(_(m,0,[0],"06")),O=!1;C==3&&F(m,0,[1])=="0101ff"&&(O=!0);var Y=F(m,0,[C-1,0]),ee=void 0;if(D=="2.5.29.14"?ee=this.getExtSubjectKeyIdentifier(Y,O):D=="2.5.29.15"?ee=this.getExtKeyUsage(Y,O):D=="2.5.29.17"?ee=this.getExtSubjectAltName(Y,O):D=="2.5.29.18"?ee=this.getExtIssuerAltName(Y,O):D=="2.5.29.19"?ee=this.getExtBasicConstraints(Y,O):D=="2.5.29.31"?ee=this.getExtCRLDistributionPoints(Y,O):D=="2.5.29.32"?ee=this.getExtCertificatePolicies(Y,O):D=="2.5.29.35"?ee=this.getExtAuthorityKeyIdentifier(Y,O):D=="2.5.29.37"?ee=this.getExtExtKeyUsage(Y,O):D=="1.3.6.1.5.5.7.1.1"?ee=this.getExtAuthorityInfoAccess(Y,O):D=="2.5.29.20"?ee=this.getExtCRLNumber(Y,O):D=="2.5.29.21"?ee=this.getExtCRLReason(Y,O):D=="1.3.6.1.5.5.7.48.1.2"?ee=this.getExtOcspNonce(Y,O):D=="1.3.6.1.5.5.7.48.1.5"?ee=this.getExtOcspNoCheck(Y,O):D=="1.2.840.113583.1.1.9.1"&&(ee=this.getExtAdobeTimeStamp(Y,O)),ee!=null)return ee;var ue={extname:D,extn:Y};return O&&(ue.critical=!0),ue},this.findExt=function(m,C){for(var D=0;D<m.length;D++)if(m[D].extname==C)return m[D];return null},this.updateExtCDPFullURI=function(m,C){var D=this.findExt(m,"cRLDistributionPoints");if(D!=null&&D.array!=null){for(var O=D.array,Y=0;Y<O.length;Y++)if(O[Y].dpname!=null&&O[Y].dpname.full!=null)for(var ee=O[Y].dpname.full,ue=0;ue<ee.length;ue++){var ne=ee[Y];ne.uri!=null&&(ne.uri=C)}}},this.updateExtAIAOCSP=function(m,C){var D=this.findExt(m,"authorityInfoAccess");if(D!=null&&D.array!=null)for(var O=D.array,Y=0;Y<O.length;Y++)O[Y].ocsp!=null&&(O[Y].ocsp=C)},this.updateExtAIACAIssuer=function(m,C){var D=this.findExt(m,"authorityInfoAccess");if(D!=null&&D.array!=null)for(var O=D.array,Y=0;Y<O.length;Y++)O[Y].caissuer!=null&&(O[Y].caissuer=C)},this.dnarraytostr=function(m){return"/"+m.map(function(C){return function(O){return O.map(function(Y){return function(ue){return ue.type+"="+ue.value}(Y).replace(/\+/,"\\+")}).join("+")}(C).replace(/\//,"\\/")}).join("/")},this.getInfo=function(){var m,C,D,O=function(st){return JSON.stringify(st.array).replace(/[\[\]\{\}\"]/g,"")},Y=function(st){for(var Qe="",Ze=st.array,Ue=0;Ue<Ze.length;Ue++){var Be=Ze[Ue];if(Qe+="    policy oid: "+Be.policyoid+`
`,Be.array!==void 0)for(var Je=0;Je<Be.array.length;Je++){var et=Be.array[Je];et.cps!==void 0&&(Qe+="    cps: "+et.cps+`
`)}}return Qe},ee=function(st){for(var Qe="",Ze=st.array,Ue=0;Ue<Ze.length;Ue++){var Be=Ze[Ue];try{Be.dpname.full[0].uri!==void 0&&(Qe+="    "+Be.dpname.full[0].uri+`
`)}catch{}try{Be.dname.full[0].dn.hex!==void 0&&(Qe+="    "+He.hex2dn(Be.dpname.full[0].dn.hex)+`
`)}catch{}}return Qe},ue=function(st){for(var Qe="",Ze=st.array,Ue=0;Ue<Ze.length;Ue++){var Be=Ze[Ue];Be.caissuer!==void 0&&(Qe+="    caissuer: "+Be.caissuer+`
`),Be.ocsp!==void 0&&(Qe+="    ocsp: "+Be.ocsp+`
`)}return Qe};if(m=`Basic Fields
`,m+="  serial number: "+this.getSerialNumberHex()+`
`,m+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,m+="  issuer: "+this.getIssuerString()+`
`,m+="  notBefore: "+this.getNotBefore()+`
`,m+="  notAfter: "+this.getNotAfter()+`
`,m+="  subject: "+this.getSubjectString()+`
`,m+=`  subject public key info: 
`,m+="    key algorithm: "+(C=this.getPublicKey()).type+`
`,C.type==="RSA"&&(m+="    n="+mr(C.n.toString(16)).substr(0,16)+`...
`,m+="    e="+mr(C.e.toString(16))+`
`),(D=this.aExtInfo)!=null){m+=`X509v3 Extensions:
`;for(var ne=0;ne<D.length;ne++){var ge=D[ne],ae=E.asn1.x509.OID.oid2name(ge.oid);ae===""&&(ae=ge.oid);var le="";if(ge.critical===!0&&(le="CRITICAL"),m+="  "+ae+" "+le+`:
`,ae==="basicConstraints"){var Ee=this.getExtBasicConstraints();Ee.cA===void 0?m+=`    {}
`:(m+="    cA=true",Ee.pathLen!==void 0&&(m+=", pathLen="+Ee.pathLen),m+=`
`)}else if(ae==="keyUsage")m+="    "+this.getExtKeyUsageString()+`
`;else if(ae==="subjectKeyIdentifier")m+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(ae==="authorityKeyIdentifier"){var Pe=this.getExtAuthorityKeyIdentifier();Pe.kid!==void 0&&(m+="    kid="+Pe.kid.hex+`
`)}else ae==="extKeyUsage"?m+="    "+this.getExtExtKeyUsage().array.join(", ")+`
`:ae==="subjectAltName"?m+="    "+O(this.getExtSubjectAltName())+`
`:ae==="cRLDistributionPoints"?m+=ee(this.getExtCRLDistributionPoints()):ae==="authorityInfoAccess"?m+=ue(this.getExtAuthorityInfoAccess()):ae==="certificatePolicies"&&(m+=Y(this.getExtCertificatePolicies()))}}return m+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,m+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`},typeof t=="string"&&(t.indexOf("-----BEGIN")!=-1?this.readCertPEM(t):E.lang.String.isHex(t)&&this.readCertHex(t))}he.prototype.sign=function(t,e){var r=function(a){return E.crypto.Util.hashString(a,e)}(t);return this.signWithMessageHash(r,e)},he.prototype.signWithMessageHash=function(t,e){var r=it(E.crypto.Util.getPaddedDigestInfoHex(t,e,this.n.bitLength()),16);return nn(this.doPrivate(r).toString(16),this.n.bitLength())},he.prototype.signPSS=function(t,e,r){var n=function(g){return E.crypto.Util.hashHex(g,e)}(vt(t));return r===void 0&&(r=-1),this.signWithMessageHashPSS(n,e,r)},he.prototype.signWithMessageHashPSS=function(t,e,r){var n,a=ht(t),g=a.length,_=this.n.bitLength()-1,x=Math.ceil(_/8),F=function(m){return E.crypto.Util.hashHex(m,e)};if(r===-1||r===void 0)r=g;else if(r===-2)r=x-g-2;else if(r<-2)throw new Error("invalid salt length");if(x<g+r+2)throw new Error("data too long");var A="";r>0&&(A=new Array(r),new we().nextBytes(A),A=String.fromCharCode.apply(String,A));var T=ht(F(vt("\0\0\0\0\0\0\0\0"+a+A))),U=[];for(n=0;n<x-r-g-2;n+=1)U[n]=0;var H=String.fromCharCode.apply(String,U)+""+A,q=on(T,H.length,F),z=[];for(n=0;n<H.length;n+=1)z[n]=H.charCodeAt(n)^q.charCodeAt(n);var Q=65280>>8*x-_&255;for(z[0]&=~Q,n=0;n<g;n++)z.push(T.charCodeAt(n));return z.push(188),nn(this.doPrivate(new M(z)).toString(16),this.n.bitLength())},he.prototype.verify=function(t,e){if((e=e.toLowerCase()).match(/^[0-9a-f]+$/)==null)return!1;var r=it(e,16),n=this.n.bitLength();if(r.bitLength()>n)return!1;var a=this.doPublic(r).toString(16);if(a.length+3!=n/4)return!1;var g=sn(a.replace(/^1f+00/,""));if(g.length==0)return!1;var _=g[0];return g[1]==function(F){return E.crypto.Util.hashString(F,_)}(t)},he.prototype.verifyWithMessageHash=function(t,e){if(e.length!=Math.ceil(this.n.bitLength()/4))return!1;var r=it(e,16);if(r.bitLength()>this.n.bitLength())return 0;var n=sn(this.doPublic(r).toString(16).replace(/^1f+00/,""));return n.length==0?!1:(n[0],n[1]==t)},he.prototype.verifyPSS=function(t,e,r,n){var a=function(_){return E.crypto.Util.hashHex(_,r)}(vt(t));return n===void 0&&(n=-1),this.verifyWithMessageHashPSS(a,e,r,n)},he.prototype.verifyWithMessageHashPSS=function(t,e,r,n){if(e.length!=Math.ceil(this.n.bitLength()/4))return!1;var a,g=new M(e,16),_=function(D){return E.crypto.Util.hashHex(D,r)},x=ht(t),F=x.length,A=this.n.bitLength()-1,T=Math.ceil(A/8);if(n===-1||n===void 0)n=F;else if(n===-2)n=T-F-2;else if(n<-2)throw new Error("invalid salt length");if(T<F+n+2)throw new Error("data too long");var U=this.doPublic(g).toByteArray();for(a=0;a<U.length;a+=1)U[a]&=255;for(;U.length<T;)U.unshift(0);if(U[T-1]!==188)throw new Error("encoded message does not end in 0xbc");var H=(U=String.fromCharCode.apply(String,U)).substr(0,T-F-1),q=U.substr(H.length,F),z=65280>>8*T-A&255;if(H.charCodeAt(0)&z)throw new Error("bits beyond keysize not zero");var Q=on(q,H.length,_),Z=[];for(a=0;a<H.length;a+=1)Z[a]=H.charCodeAt(a)^Q.charCodeAt(a);Z[0]&=~z;var m=T-F-n-2;for(a=0;a<m;a+=1)if(Z[a]!==0)throw new Error("leftmost octets not zero");if(Z[m]!==1)throw new Error("0x01 marker not found");return q===ht(_(vt("\0\0\0\0\0\0\0\0"+x+String.fromCharCode.apply(String,Z.slice(-n)))))},he.SALT_LEN_HLEN=-1,he.SALT_LEN_MAX=-2,he.SALT_LEN_RECOVER=-2,He.hex2dn=function(t,e){e===void 0&&(e=0);var r=new He;return se.getTLV(t,e),r.getX500Name(t).str},He.hex2rdn=function(t,e){if(e===void 0&&(e=0),t.substr(e,2)!=="31")throw new Error("malformed RDN");for(var r=new Array,n=se.getChildIdx(t,e),a=0;a<n.length;a++)r.push(He.hex2attrTypeValue(t,n[a]));return(r=r.map(function(g){return g.replace("+","\\+")})).join("+")},He.hex2attrTypeValue=function(t,e){var r=se,n=r.getV;if(e===void 0&&(e=0),t.substr(e,2)!=="30")throw new Error("malformed attribute type and value");var a=r.getChildIdx(t,e);a.length!==2||t.substr(a[0],2);var g=n(t,a[0]),_=E.asn1.ASN1Util.oidHexToInt(g);return E.asn1.x509.OID.oid2atype(_)+"="+ht(n(t,a[1]))},He.getPublicKeyFromCertHex=function(t){var e=new He;return e.readCertHex(t),e.getPublicKey()},He.getPublicKeyFromCertPEM=function(t){var e=new He;return e.readCertPEM(t),e.getPublicKey()},He.getPublicKeyInfoPropOfCertPEM=function(t){var e,r,n=se.getVbyList,a={};return a.algparam=null,(e=new He).readCertPEM(t),r=e.getPublicKeyHex(),a.keyhex=n(r,0,[1],"03").substr(2),a.algoid=n(r,0,[0,0],"06"),a.algoid==="2a8648ce3d0201"&&(a.algparam=n(r,0,[0,1],"06")),a},He.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],E!==void 0&&E||(o.KJUR=E={}),E.jws!==void 0&&E.jws||(E.jws={}),E.jws.JWS=function(){var t=E.jws.JWS.isSafeJSONString;this.parseJWS=function(e,r){if(this.parsedJWS===void 0||!r&&this.parsedJWS.sigvalH===void 0){var n=e.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(n==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var a=n[1],g=n[2],_=n[3],x=a+"."+g;if(this.parsedJWS={},this.parsedJWS.headB64U=a,this.parsedJWS.payloadB64U=g,this.parsedJWS.sigvalB64U=_,this.parsedJWS.si=x,!r){var F=Fe(_),A=it(F,16);this.parsedJWS.sigvalH=F,this.parsedJWS.sigvalBI=A}var T=ft(a),U=ft(g);if(this.parsedJWS.headS=T,this.parsedJWS.payloadS=U,!t(T,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+T}}},E.jws.JWS.sign=function(t,e,r,n,a){var g,_,x,F=E,A=F.jws.JWS,T=A.readSafeJSONString,U=A.isSafeJSONString,H=F.crypto,q=(H.ECDSA,H.Mac),z=H.Signature,Q=JSON;if(typeof e!="string"&&(e===void 0?"undefined":k(e))!="object")throw"spHeader must be JSON string or object: "+e;if((e===void 0?"undefined":k(e))=="object"&&(_=e,g=Q.stringify(_)),typeof e=="string"){if(!U(g=e))throw"JWS Head is not safe JSON string: "+g;_=T(g)}if(x=r,(r===void 0?"undefined":k(r))=="object"&&(x=Q.stringify(r)),t!=""&&t!=null||_.alg===void 0||(t=_.alg),t!=""&&t!=null&&_.alg===void 0&&(_.alg=t,g=Q.stringify(_)),t!==_.alg)throw"alg and sHeader.alg doesn't match: "+t+"!="+_.alg;var Z=null;if(A.jwsalg2sigalg[t]===void 0)throw"unsupported alg name: "+t;Z=A.jwsalg2sigalg[t];var m=Kt(g)+"."+Kt(x),C="";if(Z.substr(0,4)=="Hmac"){if(n===void 0)throw"mac key shall be specified for HS* alg";var D=new q({alg:Z,prov:"cryptojs",pass:n});D.updateString(m),C=D.doFinal()}else if(Z.indexOf("withECDSA")!=-1){(Y=new z({alg:Z})).init(n,a),Y.updateString(m);var O=Y.sign();C=E.crypto.ECDSA.asn1SigToConcatSig(O)}else{var Y;Z!="none"&&((Y=new z({alg:Z})).init(n,a),Y.updateString(m),C=Y.sign())}return m+"."+Ne(C)},E.jws.JWS.verify=function(t,e,r){var n,a=E,g=a.jws.JWS,_=g.readSafeJSONString,x=a.crypto,F=x.ECDSA,A=x.Mac,T=x.Signature;k(he)!==void 0&&(n=he);var U=t.split(".");if(U.length!==3)return!1;var H=U[0]+"."+U[1],q=Fe(U[2]),z=_(ft(U[0])),Q=null,Z=null;if(z.alg===void 0)throw"algorithm not specified in header";if(Z=(Q=z.alg).substr(0,2),r!=null&&Object.prototype.toString.call(r)==="[object Array]"&&r.length>0&&(":"+r.join(":")+":").indexOf(":"+Q+":")==-1)throw"algorithm '"+Q+"' not accepted in the list";if(Q!="none"&&e===null)throw"key shall be specified to verify.";if(typeof e=="string"&&e.indexOf("-----BEGIN ")!=-1&&(e=De.getKey(e)),!(Z!="RS"&&Z!="PS"||e instanceof n))throw"key shall be a RSAKey obj for RS* and PS* algs";if(Z=="ES"&&!(e instanceof F))throw"key shall be a ECDSA obj for ES* algs";var m=null;if(g.jwsalg2sigalg[z.alg]===void 0)throw"unsupported alg name: "+Q;if((m=g.jwsalg2sigalg[Q])=="none")throw"not supported";if(m.substr(0,4)=="Hmac"){if(e===void 0)throw"hexadecimal key shall be specified for HMAC";var C=new A({alg:m,pass:e});return C.updateString(H),q==C.doFinal()}if(m.indexOf("withECDSA")!=-1){var D,O=null;try{O=F.concatSigToASN1Sig(q)}catch{return!1}return(D=new T({alg:m})).init(e),D.updateString(H),D.verify(O)}return(D=new T({alg:m})).init(e),D.updateString(H),D.verify(q)},E.jws.JWS.parse=function(t){var e,r,n,a=t.split("."),g={};if(a.length!=2&&a.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return e=a[0],r=a[1],a.length==3&&(n=a[2]),g.headerObj=E.jws.JWS.readSafeJSONString(ft(e)),g.payloadObj=E.jws.JWS.readSafeJSONString(ft(r)),g.headerPP=JSON.stringify(g.headerObj,null,"  "),g.payloadObj==null?g.payloadPP=ft(r):g.payloadPP=JSON.stringify(g.payloadObj,null,"  "),n!==void 0&&(g.sigHex=Fe(n)),g},E.jws.JWS.verifyJWT=function(t,e,r){var n=E.jws,a=n.JWS,g=a.readSafeJSONString,_=a.inArray,x=a.includedArray,F=t.split("."),A=F[0],T=F[1],U=(Fe(F[2]),g(ft(A))),H=g(ft(T));if(U.alg===void 0)return!1;if(r.alg===void 0)throw"acceptField.alg shall be specified";if(!_(U.alg,r.alg)||H.iss!==void 0&&k(r.iss)==="object"&&!_(H.iss,r.iss)||H.sub!==void 0&&k(r.sub)==="object"&&!_(H.sub,r.sub))return!1;if(H.aud!==void 0&&k(r.aud)==="object"){if(typeof H.aud=="string"){if(!_(H.aud,r.aud))return!1}else if(k(H.aud)=="object"&&!x(H.aud,r.aud))return!1}var q=n.IntDate.getNow();return r.verifyAt!==void 0&&typeof r.verifyAt=="number"&&(q=r.verifyAt),r.gracePeriod!==void 0&&typeof r.gracePeriod=="number"||(r.gracePeriod=0),!(H.exp!==void 0&&typeof H.exp=="number"&&H.exp+r.gracePeriod<q)&&!(H.nbf!==void 0&&typeof H.nbf=="number"&&q<H.nbf-r.gracePeriod)&&!(H.iat!==void 0&&typeof H.iat=="number"&&q<H.iat-r.gracePeriod)&&(H.jti===void 0||r.jti===void 0||H.jti===r.jti)&&!!a.verify(t,e,r.alg)},E.jws.JWS.includedArray=function(t,e){var r=E.jws.JWS.inArray;if(t===null||(t===void 0?"undefined":k(t))!=="object"||typeof t.length!="number")return!1;for(var n=0;n<t.length;n++)if(!r(t[n],e))return!1;return!0},E.jws.JWS.inArray=function(t,e){if(e===null||(e===void 0?"undefined":k(e))!=="object"||typeof e.length!="number")return!1;for(var r=0;r<e.length;r++)if(e[r]==t)return!0;return!1},E.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},E.jws.JWS.isSafeJSONString=function(t,e,r){var n=null;try{return((n=Wr(t))===void 0?"undefined":k(n))!="object"||n.constructor===Array?0:(e&&(e[r]=n),1)}catch{return 0}},E.jws.JWS.readSafeJSONString=function(t){var e=null;try{return((e=Wr(t))===void 0?"undefined":k(e))!="object"||e.constructor===Array?null:e}catch{return null}},E.jws.JWS.getEncodedSignatureValueFromJWS=function(t){var e=t.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(e==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return e[1]},E.jws.JWS.getJWKthumbprint=function(t){if(t.kty!=="RSA"&&t.kty!=="EC"&&t.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var e="{";if(t.kty==="RSA"){if(typeof t.n!="string"||typeof t.e!="string")throw"wrong n and e value for RSA key";e+='"e":"'+t.e+'",',e+='"kty":"'+t.kty+'",',e+='"n":"'+t.n+'"}'}else if(t.kty==="EC"){if(typeof t.crv!="string"||typeof t.x!="string"||typeof t.y!="string")throw"wrong crv, x and y value for EC key";e+='"crv":"'+t.crv+'",',e+='"kty":"'+t.kty+'",',e+='"x":"'+t.x+'",',e+='"y":"'+t.y+'"}'}else if(t.kty==="oct"){if(typeof t.k!="string")throw"wrong k value for oct(symmetric) key";e+='"kty":"'+t.kty+'",',e+='"k":"'+t.k+'"}'}var r=vt(e);return Ne(E.crypto.Util.hashHex(r,"sha256"))},E.jws.IntDate={},E.jws.IntDate.get=function(t){var e=E.jws.IntDate,r=e.getNow,n=e.getZulu;if(t=="now")return r();if(t=="now + 1hour")return r()+3600;if(t=="now + 1day")return r()+86400;if(t=="now + 1month")return r()+2592e3;if(t=="now + 1year")return r()+31536e3;if(t.match(/Z$/))return n(t);if(t.match(/^[0-9]+$/))return parseInt(t);throw"unsupported format: "+t},E.jws.IntDate.getZulu=function(t){return Xr(t)},E.jws.IntDate.getNow=function(){return~~(new Date/1e3)},E.jws.IntDate.intDate2UTCString=function(t){return new Date(1e3*t).toUTCString()},E.jws.IntDate.intDate2Zulu=function(t){var e=new Date(1e3*t);return("0000"+e.getUTCFullYear()).slice(-4)+("00"+(e.getUTCMonth()+1)).slice(-2)+("00"+e.getUTCDate()).slice(-2)+("00"+e.getUTCHours()).slice(-2)+("00"+e.getUTCMinutes()).slice(-2)+("00"+e.getUTCSeconds()).slice(-2)+"Z"},o.SecureRandom=we,o.rng_seed_time=X,o.BigInteger=M,o.RSAKey=he;var fi=E.crypto.EDSA;o.EDSA=fi;var gi=E.crypto.DSA;o.DSA=gi;var pi=E.crypto.Signature;o.Signature=pi;var yi=E.crypto.MessageDigest;o.MessageDigest=yi;var vi=E.crypto.Mac;o.Mac=vi;var mi=E.crypto.Cipher;o.Cipher=mi,o.KEYUTIL=De,o.ASN1HEX=se,o.X509=He,o.CryptoJS=J,o.b64tohex=re,o.b64toBA=ie,o.stoBA=qr,o.BAtos=$r,o.BAtohex=er,o.stohex=wt,o.stob64=function(e){return j(wt(e))},o.stob64u=function(e){return tr(j(wt(e)))},o.b64utos=function(e){return $r(ie(Vt(e)))},o.b64tob64u=tr,o.b64utob64=Vt,o.hex2b64=j,o.hextob64u=Ne,o.b64utohex=Fe,o.utf8tob64u=Kt,o.b64utoutf8=ft,o.utf8tob64=function(e){return j(rr(ir(e)))},o.b64toutf8=function(e){return decodeURIComponent(nr(re(e)))},o.utf8tohex=pr,o.hextoutf8=Oe,o.hextorstr=ht,o.rstrtohex=vt,o.hextob64=zr,o.hextob64nl=Gr,o.b64nltohex=Yr,o.hextopem=ot,o.pemtohex=mt,o.hextoArrayBuffer=function(e){if(e.length%2!=0)throw"input is not even length";if(e.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var r=new ArrayBuffer(e.length/2),n=new DataView(r),a=0;a<e.length/2;a++)n.setUint8(a,parseInt(e.substr(2*a,2),16));return r},o.ArrayBuffertohex=function(e){for(var r="",n=new DataView(e),a=0;a<e.byteLength;a++)r+=("00"+n.getUint8(a).toString(16)).slice(-2);return r},o.zulutomsec=yr,o.zulutosec=Xr,o.zulutodate=function(e){return new Date(yr(e))},o.datetozulu=function(e,r,n){var a,g=e.getUTCFullYear();if(r){if(g<1950||2049<g)throw"not proper year for UTCTime: "+g;a=(""+g).slice(-2)}else a=("000"+g).slice(-4);if(a+=("0"+(e.getUTCMonth()+1)).slice(-2),a+=("0"+e.getUTCDate()).slice(-2),a+=("0"+e.getUTCHours()).slice(-2),a+=("0"+e.getUTCMinutes()).slice(-2),a+=("0"+e.getUTCSeconds()).slice(-2),n){var _=e.getUTCMilliseconds();_!==0&&(a+="."+(_=(_=("00"+_).slice(-3)).replace(/0+$/g,"")))}return a+="Z"},o.uricmptohex=rr,o.hextouricmp=nr,o.ipv6tohex=Qr,o.hextoipv6=Zr,o.hextoip=vr,o.iptohex=function(e){var r="malformed IP address";if(!(e=e.toLowerCase(e)).match(/^[0-9.]+$/)){if(e.match(/^[0-9a-f:]+$/)&&e.indexOf(":")!==-1)return Qr(e);throw r}var n=e.split(".");if(n.length!==4)throw r;var a="";try{for(var g=0;g<4;g++)a+=("0"+parseInt(n[g]).toString(16)).slice(-2);return a}catch{throw r}},o.encodeURIComponentAll=ir,o.newline_toUnix=function(e){return e=e.replace(/\r\n/gm,`
`)},o.newline_toDos=function(e){return e=(e=e.replace(/\r\n/gm,`
`)).replace(/\n/gm,`\r
`)},o.hextoposhex=mr,o.intarystrtohex=function(e){e=(e=(e=e.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{return e.split(/,/).map(function(r,n,a){var g=parseInt(r);if(g<0||255<g)throw"integer not in range 0-255";return("00"+g.toString(16)).slice(-2)}).join("")}catch(r){throw"malformed integer array string: "+r}},o.strdiffidx=function(e,r){var n=e.length;e.length>r.length&&(n=r.length);for(var a=0;a<n;a++)if(e.charCodeAt(a)!=r.charCodeAt(a))return a;return e.length!=r.length?n:-1},o.KJUR=E;var _i=E.crypto;o.crypto=_i;var Si=E.asn1;o.asn1=Si;var wi=E.jws;o.jws=wi;var bi=E.lang;o.lang=bi}).call(this,d(28).Buffer)},function(u,o,d){(function(v){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var h=d(30),w=d(31),S=d(32);function l(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function f(V,p){if(l()<p)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(V=new Uint8Array(p)).__proto__=c.prototype:(V===null&&(V=new c(p)),V.length=p),V}function c(V,p,y){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(V,p,y);if(typeof V=="number"){if(typeof p=="string")throw new Error("If encoding is specified then the first argument must be a string");return P(this,V)}return b(this,V,p,y)}function b(V,p,y,N){if(typeof p=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&p instanceof ArrayBuffer?function(X,te,ce,de){if(te.byteLength,ce<0||te.byteLength<ce)throw new RangeError("'offset' is out of bounds");if(te.byteLength<ce+(de||0))throw new RangeError("'length' is out of bounds");return te=ce===void 0&&de===void 0?new Uint8Array(te):de===void 0?new Uint8Array(te,ce):new Uint8Array(te,ce,de),c.TYPED_ARRAY_SUPPORT?(X=te).__proto__=c.prototype:X=K(X,te),X}(V,p,y,N):typeof p=="string"?function(X,te,ce){if(typeof ce=="string"&&ce!==""||(ce="utf8"),!c.isEncoding(ce))throw new TypeError('"encoding" must be a valid string encoding');var de=0|k(te,ce),Se=(X=f(X,de)).write(te,ce);return Se!==de&&(X=X.slice(0,Se)),X}(V,p,y):function(X,te){if(c.isBuffer(te)){var ce=0|L(te.length);return(X=f(X,ce)).length===0||te.copy(X,0,0,ce),X}if(te){if(typeof ArrayBuffer<"u"&&te.buffer instanceof ArrayBuffer||"length"in te)return typeof te.length!="number"||function(Se){return Se!=Se}(te.length)?f(X,0):K(X,te);if(te.type==="Buffer"&&S(te.data))return K(X,te.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(V,p)}function I(V){if(typeof V!="number")throw new TypeError('"size" argument must be a number');if(V<0)throw new RangeError('"size" argument must not be negative')}function P(V,p){if(I(p),V=f(V,p<0?0:0|L(p)),!c.TYPED_ARRAY_SUPPORT)for(var y=0;y<p;++y)V[y]=0;return V}function K(V,p){var y=p.length<0?0:0|L(p.length);V=f(V,y);for(var N=0;N<y;N+=1)V[N]=255&p[N];return V}function L(V){if(V>=l())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+l().toString(16)+" bytes");return 0|V}function k(V,p){if(c.isBuffer(V))return V.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(V)||V instanceof ArrayBuffer))return V.byteLength;typeof V!="string"&&(V=""+V);var y=V.length;if(y===0)return 0;for(var N=!1;;)switch(p){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":case void 0:return nt(V).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*y;case"hex":return y>>>1;case"base64":return Ke(V).length;default:if(N)return nt(V).length;p=(""+p).toLowerCase(),N=!0}}function R(V,p,y){var N=!1;if((p===void 0||p<0)&&(p=0),p>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0)<=(p>>>=0))return"";for(V||(V="utf8");;)switch(V){case"hex":return Le(this,p,y);case"utf8":case"utf-8":return me(this,p,y);case"ascii":return Ie(this,p,y);case"latin1":case"binary":return ze(this,p,y);case"base64":return _e(this,p,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ge(this,p,y);default:if(N)throw new TypeError("Unknown encoding: "+V);V=(V+"").toLowerCase(),N=!0}}function B(V,p,y){var N=V[p];V[p]=V[y],V[y]=N}function J(V,p,y,N,W){if(V.length===0)return-1;if(typeof y=="string"?(N=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,isNaN(y)&&(y=W?0:V.length-1),y<0&&(y=V.length+y),y>=V.length){if(W)return-1;y=V.length-1}else if(y<0){if(!W)return-1;y=0}if(typeof p=="string"&&(p=c.from(p,N)),c.isBuffer(p))return p.length===0?-1:G(V,p,y,N,W);if(typeof p=="number")return p&=255,c.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?W?Uint8Array.prototype.indexOf.call(V,p,y):Uint8Array.prototype.lastIndexOf.call(V,p,y):G(V,[p],y,N,W);throw new TypeError("val must be string, number or Buffer")}function G(V,p,y,N,W){var X,te=1,ce=V.length,de=p.length;if(N!==void 0&&((N=String(N).toLowerCase())==="ucs2"||N==="ucs-2"||N==="utf16le"||N==="utf-16le")){if(V.length<2||p.length<2)return-1;te=2,ce/=2,de/=2,y/=2}function Se(dt,he){return te===1?dt[he]:dt.readUInt16BE(he*te)}if(W){var ve=-1;for(X=y;X<ce;X++)if(Se(V,X)===Se(p,ve===-1?0:X-ve)){if(ve===-1&&(ve=X),X-ve+1===de)return ve*te}else ve!==-1&&(X-=X-ve),ve=-1}else for(y+de>ce&&(y=ce-de),X=y;X>=0;X--){for(var we=!0,it=0;it<de;it++)if(Se(V,X+it)!==Se(p,it)){we=!1;break}if(we)return X}return-1}function $(V,p,y,N){y=Number(y)||0;var W=V.length-y;N?(N=Number(N))>W&&(N=W):N=W;var X=p.length;if(X%2!=0)throw new TypeError("Invalid hex string");N>X/2&&(N=X/2);for(var te=0;te<N;++te){var ce=parseInt(p.substr(2*te,2),16);if(isNaN(ce))return te;V[y+te]=ce}return te}function j(V,p,y,N){return xe(nt(p,V.length-y),V,y,N)}function re(V,p,y,N){return xe(function(X){for(var te=[],ce=0;ce<X.length;++ce)te.push(255&X.charCodeAt(ce));return te}(p),V,y,N)}function ie(V,p,y,N){return re(V,p,y,N)}function M(V,p,y,N){return xe(Ke(p),V,y,N)}function oe(V,p,y,N){return xe(function(X,te){for(var ce,de,Se,ve=[],we=0;we<X.length&&!((te-=2)<0);++we)de=(ce=X.charCodeAt(we))>>8,Se=ce%256,ve.push(Se),ve.push(de);return ve}(p,V.length-y),V,y,N)}function _e(V,p,y){return p===0&&y===V.length?h.fromByteArray(V):h.fromByteArray(V.slice(p,y))}function me(V,p,y){y=Math.min(V.length,y);for(var N=[],W=p;W<y;){var X,te,ce,de,Se=V[W],ve=null,we=Se>239?4:Se>223?3:Se>191?2:1;if(W+we<=y)switch(we){case 1:Se<128&&(ve=Se);break;case 2:(192&(X=V[W+1]))==128&&(de=(31&Se)<<6|63&X)>127&&(ve=de);break;case 3:X=V[W+1],te=V[W+2],(192&X)==128&&(192&te)==128&&(de=(15&Se)<<12|(63&X)<<6|63&te)>2047&&(de<55296||de>57343)&&(ve=de);break;case 4:X=V[W+1],te=V[W+2],ce=V[W+3],(192&X)==128&&(192&te)==128&&(192&ce)==128&&(de=(15&Se)<<18|(63&X)<<12|(63&te)<<6|63&ce)>65535&&de<1114112&&(ve=de)}ve===null?(ve=65533,we=1):ve>65535&&(ve-=65536,N.push(ve>>>10&1023|55296),ve=56320|1023&ve),N.push(ve),W+=we}return function(dt){var he=dt.length;if(he<=$e)return String.fromCharCode.apply(String,dt);for(var Te="",pe=0;pe<he;)Te+=String.fromCharCode.apply(String,dt.slice(pe,pe+=$e));return Te}(N)}o.Buffer=c,o.SlowBuffer=function(p){return+p!=p&&(p=0),c.alloc(+p)},o.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=v.TYPED_ARRAY_SUPPORT!==void 0?v.TYPED_ARRAY_SUPPORT:function(){try{var p=new Uint8Array(1);return p.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},p.foo()===42&&typeof p.subarray=="function"&&p.subarray(1,1).byteLength===0}catch{return!1}}(),o.kMaxLength=l(),c.poolSize=8192,c._augment=function(V){return V.__proto__=c.prototype,V},c.from=function(V,p,y){return b(null,V,p,y)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(V,p,y){return function(W,X,te,ce){return I(X),X<=0?f(W,X):te!==void 0?typeof ce=="string"?f(W,X).fill(te,ce):f(W,X).fill(te):f(W,X)}(null,V,p,y)},c.allocUnsafe=function(V){return P(null,V)},c.allocUnsafeSlow=function(V){return P(null,V)},c.isBuffer=function(p){return!(p==null||!p._isBuffer)},c.compare=function(p,y){if(!c.isBuffer(p)||!c.isBuffer(y))throw new TypeError("Arguments must be Buffers");if(p===y)return 0;for(var N=p.length,W=y.length,X=0,te=Math.min(N,W);X<te;++X)if(p[X]!==y[X]){N=p[X],W=y[X];break}return N<W?-1:W<N?1:0},c.isEncoding=function(p){switch(String(p).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(p,y){if(!S(p))throw new TypeError('"list" argument must be an Array of Buffers');if(p.length===0)return c.alloc(0);var N;if(y===void 0)for(y=0,N=0;N<p.length;++N)y+=p[N].length;var W=c.allocUnsafe(y),X=0;for(N=0;N<p.length;++N){var te=p[N];if(!c.isBuffer(te))throw new TypeError('"list" argument must be an Array of Buffers');te.copy(W,X),X+=te.length}return W},c.byteLength=k,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var p=this.length;if(p%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var y=0;y<p;y+=2)B(this,y,y+1);return this},c.prototype.swap32=function(){var p=this.length;if(p%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var y=0;y<p;y+=4)B(this,y,y+3),B(this,y+1,y+2);return this},c.prototype.swap64=function(){var p=this.length;if(p%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var y=0;y<p;y+=8)B(this,y,y+7),B(this,y+1,y+6),B(this,y+2,y+5),B(this,y+3,y+4);return this},c.prototype.toString=function(){var p=0|this.length;return p===0?"":arguments.length===0?me(this,0,p):R.apply(this,arguments)},c.prototype.equals=function(p){if(!c.isBuffer(p))throw new TypeError("Argument must be a Buffer");return this===p||c.compare(this,p)===0},c.prototype.inspect=function(){var p="",y=o.INSPECT_MAX_BYTES;return this.length>0&&(p=this.toString("hex",0,y).match(/.{2}/g).join(" "),this.length>y&&(p+=" ... ")),"<Buffer "+p+">"},c.prototype.compare=function(p,y,N,W,X){if(!c.isBuffer(p))throw new TypeError("Argument must be a Buffer");if(y===void 0&&(y=0),N===void 0&&(N=p?p.length:0),W===void 0&&(W=0),X===void 0&&(X=this.length),y<0||N>p.length||W<0||X>this.length)throw new RangeError("out of range index");if(W>=X&&y>=N)return 0;if(W>=X)return-1;if(y>=N)return 1;if(this===p)return 0;for(var te=(X>>>=0)-(W>>>=0),ce=(N>>>=0)-(y>>>=0),de=Math.min(te,ce),Se=this.slice(W,X),ve=p.slice(y,N),we=0;we<de;++we)if(Se[we]!==ve[we]){te=Se[we],ce=ve[we];break}return te<ce?-1:ce<te?1:0},c.prototype.includes=function(p,y,N){return this.indexOf(p,y,N)!==-1},c.prototype.indexOf=function(p,y,N){return J(this,p,y,N,!0)},c.prototype.lastIndexOf=function(p,y,N){return J(this,p,y,N,!1)},c.prototype.write=function(p,y,N,W){if(y===void 0)W="utf8",N=this.length,y=0;else if(N===void 0&&typeof y=="string")W=y,N=this.length,y=0;else{if(!isFinite(y))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");y|=0,isFinite(N)?(N|=0,W===void 0&&(W="utf8")):(W=N,N=void 0)}var X=this.length-y;if((N===void 0||N>X)&&(N=X),p.length>0&&(N<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");W||(W="utf8");for(var te=!1;;)switch(W){case"hex":return $(this,p,y,N);case"utf8":case"utf-8":return j(this,p,y,N);case"ascii":return re(this,p,y,N);case"latin1":case"binary":return ie(this,p,y,N);case"base64":return M(this,p,y,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return oe(this,p,y,N);default:if(te)throw new TypeError("Unknown encoding: "+W);W=(""+W).toLowerCase(),te=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $e=4096;function Ie(V,p,y){var N="";y=Math.min(V.length,y);for(var W=p;W<y;++W)N+=String.fromCharCode(127&V[W]);return N}function ze(V,p,y){var N="";y=Math.min(V.length,y);for(var W=p;W<y;++W)N+=String.fromCharCode(V[W]);return N}function Le(V,p,y){var N=V.length;(!p||p<0)&&(p=0),(!y||y<0||y>N)&&(y=N);for(var W="",X=p;X<y;++X)W+=Xe(V[X]);return W}function Ge(V,p,y){for(var N=V.slice(p,y),W="",X=0;X<N.length;X+=2)W+=String.fromCharCode(N[X]+256*N[X+1]);return W}function fe(V,p,y){if(V%1!=0||V<0)throw new RangeError("offset is not uint");if(V+p>y)throw new RangeError("Trying to access beyond buffer length")}function ye(V,p,y,N,W,X){if(!c.isBuffer(V))throw new TypeError('"buffer" argument must be a Buffer instance');if(p>W||p<X)throw new RangeError('"value" argument is out of bounds');if(y+N>V.length)throw new RangeError("Index out of range")}function Ve(V,p,y,N){p<0&&(p=65535+p+1);for(var W=0,X=Math.min(V.length-y,2);W<X;++W)V[y+W]=(p&255<<8*(N?W:1-W))>>>8*(N?W:1-W)}function Ye(V,p,y,N){p<0&&(p=4294967295+p+1);for(var W=0,X=Math.min(V.length-y,4);W<X;++W)V[y+W]=p>>>8*(N?W:3-W)&255}function tt(V,p,y,N,W,X){if(y+N>V.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function rt(V,p,y,N,W){return W||tt(V,0,y,4),w.write(V,p,y,N,23,4),y+4}function ut(V,p,y,N,W){return W||tt(V,0,y,8),w.write(V,p,y,N,52,8),y+8}c.prototype.slice=function(p,y){var N,W=this.length;if((p=~~p)<0?(p+=W)<0&&(p=0):p>W&&(p=W),(y=y===void 0?W:~~y)<0?(y+=W)<0&&(y=0):y>W&&(y=W),y<p&&(y=p),c.TYPED_ARRAY_SUPPORT)(N=this.subarray(p,y)).__proto__=c.prototype;else{var X=y-p;N=new c(X,void 0);for(var te=0;te<X;++te)N[te]=this[te+p]}return N},c.prototype.readUIntLE=function(p,y,N){p|=0,y|=0,N||fe(p,y,this.length);for(var W=this[p],X=1,te=0;++te<y&&(X*=256);)W+=this[p+te]*X;return W},c.prototype.readUIntBE=function(p,y,N){p|=0,y|=0,N||fe(p,y,this.length);for(var W=this[p+--y],X=1;y>0&&(X*=256);)W+=this[p+--y]*X;return W},c.prototype.readUInt8=function(p,y){return y||fe(p,1,this.length),this[p]},c.prototype.readUInt16LE=function(p,y){return y||fe(p,2,this.length),this[p]|this[p+1]<<8},c.prototype.readUInt16BE=function(p,y){return y||fe(p,2,this.length),this[p]<<8|this[p+1]},c.prototype.readUInt32LE=function(p,y){return y||fe(p,4,this.length),(this[p]|this[p+1]<<8|this[p+2]<<16)+16777216*this[p+3]},c.prototype.readUInt32BE=function(p,y){return y||fe(p,4,this.length),16777216*this[p]+(this[p+1]<<16|this[p+2]<<8|this[p+3])},c.prototype.readIntLE=function(p,y,N){p|=0,y|=0,N||fe(p,y,this.length);for(var W=this[p],X=1,te=0;++te<y&&(X*=256);)W+=this[p+te]*X;return W>=(X*=128)&&(W-=Math.pow(2,8*y)),W},c.prototype.readIntBE=function(p,y,N){p|=0,y|=0,N||fe(p,y,this.length);for(var W=y,X=1,te=this[p+--W];W>0&&(X*=256);)te+=this[p+--W]*X;return te>=(X*=128)&&(te-=Math.pow(2,8*y)),te},c.prototype.readInt8=function(p,y){return y||fe(p,1,this.length),128&this[p]?-1*(255-this[p]+1):this[p]},c.prototype.readInt16LE=function(p,y){y||fe(p,2,this.length);var N=this[p]|this[p+1]<<8;return 32768&N?4294901760|N:N},c.prototype.readInt16BE=function(p,y){y||fe(p,2,this.length);var N=this[p+1]|this[p]<<8;return 32768&N?4294901760|N:N},c.prototype.readInt32LE=function(p,y){return y||fe(p,4,this.length),this[p]|this[p+1]<<8|this[p+2]<<16|this[p+3]<<24},c.prototype.readInt32BE=function(p,y){return y||fe(p,4,this.length),this[p]<<24|this[p+1]<<16|this[p+2]<<8|this[p+3]},c.prototype.readFloatLE=function(p,y){return y||fe(p,4,this.length),w.read(this,p,!0,23,4)},c.prototype.readFloatBE=function(p,y){return y||fe(p,4,this.length),w.read(this,p,!1,23,4)},c.prototype.readDoubleLE=function(p,y){return y||fe(p,8,this.length),w.read(this,p,!0,52,8)},c.prototype.readDoubleBE=function(p,y){return y||fe(p,8,this.length),w.read(this,p,!1,52,8)},c.prototype.writeUIntLE=function(p,y,N,W){p=+p,y|=0,N|=0,W||ye(this,p,y,N,Math.pow(2,8*N)-1,0);var X=1,te=0;for(this[y]=255&p;++te<N&&(X*=256);)this[y+te]=p/X&255;return y+N},c.prototype.writeUIntBE=function(p,y,N,W){p=+p,y|=0,N|=0,W||ye(this,p,y,N,Math.pow(2,8*N)-1,0);var X=N-1,te=1;for(this[y+X]=255&p;--X>=0&&(te*=256);)this[y+X]=p/te&255;return y+N},c.prototype.writeUInt8=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,1,255,0),c.TYPED_ARRAY_SUPPORT||(p=Math.floor(p)),this[y]=255&p,y+1},c.prototype.writeUInt16LE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[y]=255&p,this[y+1]=p>>>8):Ve(this,p,y,!0),y+2},c.prototype.writeUInt16BE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[y]=p>>>8,this[y+1]=255&p):Ve(this,p,y,!1),y+2},c.prototype.writeUInt32LE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[y+3]=p>>>24,this[y+2]=p>>>16,this[y+1]=p>>>8,this[y]=255&p):Ye(this,p,y,!0),y+4},c.prototype.writeUInt32BE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[y]=p>>>24,this[y+1]=p>>>16,this[y+2]=p>>>8,this[y+3]=255&p):Ye(this,p,y,!1),y+4},c.prototype.writeIntLE=function(p,y,N,W){if(p=+p,y|=0,!W){var X=Math.pow(2,8*N-1);ye(this,p,y,N,X-1,-X)}var te=0,ce=1,de=0;for(this[y]=255&p;++te<N&&(ce*=256);)p<0&&de===0&&this[y+te-1]!==0&&(de=1),this[y+te]=(p/ce>>0)-de&255;return y+N},c.prototype.writeIntBE=function(p,y,N,W){if(p=+p,y|=0,!W){var X=Math.pow(2,8*N-1);ye(this,p,y,N,X-1,-X)}var te=N-1,ce=1,de=0;for(this[y+te]=255&p;--te>=0&&(ce*=256);)p<0&&de===0&&this[y+te+1]!==0&&(de=1),this[y+te]=(p/ce>>0)-de&255;return y+N},c.prototype.writeInt8=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,1,127,-128),c.TYPED_ARRAY_SUPPORT||(p=Math.floor(p)),p<0&&(p=255+p+1),this[y]=255&p,y+1},c.prototype.writeInt16LE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[y]=255&p,this[y+1]=p>>>8):Ve(this,p,y,!0),y+2},c.prototype.writeInt16BE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[y]=p>>>8,this[y+1]=255&p):Ve(this,p,y,!1),y+2},c.prototype.writeInt32LE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[y]=255&p,this[y+1]=p>>>8,this[y+2]=p>>>16,this[y+3]=p>>>24):Ye(this,p,y,!0),y+4},c.prototype.writeInt32BE=function(p,y,N){return p=+p,y|=0,N||ye(this,p,y,4,2147483647,-2147483648),p<0&&(p=4294967295+p+1),c.TYPED_ARRAY_SUPPORT?(this[y]=p>>>24,this[y+1]=p>>>16,this[y+2]=p>>>8,this[y+3]=255&p):Ye(this,p,y,!1),y+4},c.prototype.writeFloatLE=function(p,y,N){return rt(this,p,y,!0,N)},c.prototype.writeFloatBE=function(p,y,N){return rt(this,p,y,!1,N)},c.prototype.writeDoubleLE=function(p,y,N){return ut(this,p,y,!0,N)},c.prototype.writeDoubleBE=function(p,y,N){return ut(this,p,y,!1,N)},c.prototype.copy=function(p,y,N,W){if(N||(N=0),W||W===0||(W=this.length),y>=p.length&&(y=p.length),y||(y=0),W>0&&W<N&&(W=N),W===N||p.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(N<0||N>=this.length)throw new RangeError("sourceStart out of bounds");if(W<0)throw new RangeError("sourceEnd out of bounds");W>this.length&&(W=this.length),p.length-y<W-N&&(W=p.length-y+N);var X,te=W-N;if(this===p&&N<y&&y<W)for(X=te-1;X>=0;--X)p[X+y]=this[X+N];else if(te<1e3||!c.TYPED_ARRAY_SUPPORT)for(X=0;X<te;++X)p[X+y]=this[X+N];else Uint8Array.prototype.set.call(p,this.subarray(N,N+te),y);return te},c.prototype.fill=function(p,y,N,W){if(typeof p=="string"){if(typeof y=="string"?(W=y,y=0,N=this.length):typeof N=="string"&&(W=N,N=this.length),p.length===1){var X=p.charCodeAt(0);X<256&&(p=X)}if(W!==void 0&&typeof W!="string")throw new TypeError("encoding must be a string");if(typeof W=="string"&&!c.isEncoding(W))throw new TypeError("Unknown encoding: "+W)}else typeof p=="number"&&(p&=255);if(y<0||this.length<y||this.length<N)throw new RangeError("Out of range index");if(N<=y)return this;var te;if(y>>>=0,N=N===void 0?this.length:N>>>0,p||(p=0),typeof p=="number")for(te=y;te<N;++te)this[te]=p;else{var ce=c.isBuffer(p)?p:nt(new c(p,W).toString()),de=ce.length;for(te=0;te<N-y;++te)this[te+y]=ce[te%de]}return this};var St=/[^+\/0-9A-Za-z-_]/g;function Xe(V){return V<16?"0"+V.toString(16):V.toString(16)}function nt(V,p){var y;p=p||1/0;for(var N=V.length,W=null,X=[],te=0;te<N;++te){if((y=V.charCodeAt(te))>55295&&y<57344){if(!W){if(y>56319){(p-=3)>-1&&X.push(239,191,189);continue}if(te+1===N){(p-=3)>-1&&X.push(239,191,189);continue}W=y;continue}if(y<56320){(p-=3)>-1&&X.push(239,191,189),W=y;continue}y=65536+(W-55296<<10|y-56320)}else W&&(p-=3)>-1&&X.push(239,191,189);if(W=null,y<128){if((p-=1)<0)break;X.push(y)}else if(y<2048){if((p-=2)<0)break;X.push(y>>6|192,63&y|128)}else if(y<65536){if((p-=3)<0)break;X.push(y>>12|224,y>>6&63|128,63&y|128)}else{if(!(y<1114112))throw new Error("Invalid code point");if((p-=4)<0)break;X.push(y>>18|240,y>>12&63|128,y>>6&63|128,63&y|128)}}return X}function Ke(V){return h.toByteArray(function(y){if((y=function(W){return W.trim?W.trim():W.replace(/^\s+|\s+$/g,"")}(y).replace(St,"")).length<2)return"";for(;y.length%4!=0;)y+="=";return y}(V))}function xe(V,p,y,N){for(var W=0;W<N&&!(W+y>=p.length||W>=V.length);++W)p[W+y]=V[W];return W}}).call(this,d(29))},function(u,o){var d;d=function(){return this}();try{d=d||new Function("return this")()}catch{typeof window=="object"&&(d=window)}u.exports=d},function(u,o,d){o.byteLength=function(P){var K=c(P),L=K[0],k=K[1];return 3*(L+k)/4-k},o.toByteArray=function(P){var K,L,k=c(P),R=k[0],B=k[1],J=new w(function(re,ie,M){return 3*(ie+M)/4-M}(0,R,B)),G=0,$=B>0?R-4:R;for(L=0;L<$;L+=4)K=h[P.charCodeAt(L)]<<18|h[P.charCodeAt(L+1)]<<12|h[P.charCodeAt(L+2)]<<6|h[P.charCodeAt(L+3)],J[G++]=K>>16&255,J[G++]=K>>8&255,J[G++]=255&K;return B===2&&(K=h[P.charCodeAt(L)]<<2|h[P.charCodeAt(L+1)]>>4,J[G++]=255&K),B===1&&(K=h[P.charCodeAt(L)]<<10|h[P.charCodeAt(L+1)]<<4|h[P.charCodeAt(L+2)]>>2,J[G++]=K>>8&255,J[G++]=255&K),J},o.fromByteArray=function(P){for(var K,L=P.length,k=L%3,R=[],B=16383,J=0,G=L-k;J<G;J+=B)R.push(b(P,J,J+B>G?G:J+B));return k===1?(K=P[L-1],R.push(v[K>>2]+v[K<<4&63]+"==")):k===2&&(K=(P[L-2]<<8)+P[L-1],R.push(v[K>>10]+v[K>>4&63]+v[K<<2&63]+"=")),R.join("")};for(var v=[],h=[],w=typeof Uint8Array<"u"?Uint8Array:Array,S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,f=S.length;l<f;++l)v[l]=S[l],h[S.charCodeAt(l)]=l;function c(I){var P=I.length;if(P%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var K=I.indexOf("=");return K===-1&&(K=P),[K,K===P?0:4-K%4]}function b(I,P,K){for(var L,k,R=[],B=P;B<K;B+=3)L=(I[B]<<16&16711680)+(I[B+1]<<8&65280)+(255&I[B+2]),R.push(v[(k=L)>>18&63]+v[k>>12&63]+v[k>>6&63]+v[63&k]);return R.join("")}h["-".charCodeAt(0)]=62,h["_".charCodeAt(0)]=63},function(u,o){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */o.read=function(d,v,h,w,S){var l,f,c=8*S-w-1,b=(1<<c)-1,I=b>>1,P=-7,K=h?S-1:0,L=h?-1:1,k=d[v+K];for(K+=L,l=k&(1<<-P)-1,k>>=-P,P+=c;P>0;l=256*l+d[v+K],K+=L,P-=8);for(f=l&(1<<-P)-1,l>>=-P,P+=w;P>0;f=256*f+d[v+K],K+=L,P-=8);if(l===0)l=1-I;else{if(l===b)return f?NaN:1/0*(k?-1:1);f+=Math.pow(2,w),l-=I}return(k?-1:1)*f*Math.pow(2,l-w)},o.write=function(d,v,h,w,S,l){var f,c,b,I=8*l-S-1,P=(1<<I)-1,K=P>>1,L=S===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=w?0:l-1,R=w?1:-1,B=v<0||v===0&&1/v<0?1:0;for(v=Math.abs(v),isNaN(v)||v===1/0?(c=isNaN(v)?1:0,f=P):(f=Math.floor(Math.log(v)/Math.LN2),v*(b=Math.pow(2,-f))<1&&(f--,b*=2),(v+=f+K>=1?L/b:L*Math.pow(2,1-K))*b>=2&&(f++,b/=2),f+K>=P?(c=0,f=P):f+K>=1?(c=(v*b-1)*Math.pow(2,S),f+=K):(c=v*Math.pow(2,K-1)*Math.pow(2,S),f=0));S>=8;d[h+k]=255&c,k+=R,c/=256,S-=8);for(f=f<<S|c,I+=S;I>0;d[h+k]=255&f,k+=R,f/=256,I-=8);d[h+k-R]|=128*B}},function(u,o){var d={}.toString;u.exports=Array.isArray||function(v){return d.call(v)=="[object Array]"}},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(w){var S=w.jws,l=w.KeyUtil,f=w.X509,c=w.crypto,b=w.hextob64u,I=w.b64tohex,P=w.AllowedSigningAlgs;return function(){function K(){(function(k,R){if(!(k instanceof R))throw new TypeError("Cannot call a class as a function")})(this,K)}return K.parseJwt=function(k){v.Log.debug("JoseUtil.parseJwt");try{var R=S.JWS.parse(k);return{header:R.headerObj,payload:R.payloadObj}}catch(B){v.Log.error(B)}},K.validateJwt=function(k,R,B,J,G,$,j){v.Log.debug("JoseUtil.validateJwt");try{if(R.kty==="RSA")if(R.e&&R.n)R=l.getKey(R);else{if(!R.x5c||!R.x5c.length)return v.Log.error("JoseUtil.validateJwt: RSA key missing key material",R),Promise.reject(new Error("RSA key missing key material"));var re=I(R.x5c[0]);R=f.getPublicKeyFromCertHex(re)}else{if(R.kty!=="EC")return v.Log.error("JoseUtil.validateJwt: Unsupported key type",R&&R.kty),Promise.reject(new Error(R.kty));if(!(R.crv&&R.x&&R.y))return v.Log.error("JoseUtil.validateJwt: EC key missing key material",R),Promise.reject(new Error("EC key missing key material"));R=l.getKey(R)}return K._validateJwt(k,R,B,J,G,$,j)}catch(ie){return v.Log.error(ie&&ie.message||ie),Promise.reject("JWT validation failed")}},K.validateJwtAttributes=function(k,R,B,J,G,$){J||(J=0),G||(G=parseInt(Date.now()/1e3));var j=K.parseJwt(k).payload;if(!j.iss)return v.Log.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(j.iss!==R)return v.Log.error("JoseUtil._validateJwt: Invalid issuer in token",j.iss),Promise.reject(new Error("Invalid issuer in token: "+j.iss));if(!j.aud)return v.Log.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(j.aud===B||Array.isArray(j.aud)&&j.aud.indexOf(B)>=0))return v.Log.error("JoseUtil._validateJwt: Invalid audience in token",j.aud),Promise.reject(new Error("Invalid audience in token: "+j.aud));if(j.azp&&j.azp!==B)return v.Log.error("JoseUtil._validateJwt: Invalid azp in token",j.azp),Promise.reject(new Error("Invalid azp in token: "+j.azp));if(!$){var re=G+J,ie=G-J;if(!j.iat)return v.Log.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(new Error("iat was not provided"));if(re<j.iat)return v.Log.error("JoseUtil._validateJwt: iat is in the future",j.iat),Promise.reject(new Error("iat is in the future: "+j.iat));if(j.nbf&&re<j.nbf)return v.Log.error("JoseUtil._validateJwt: nbf is in the future",j.nbf),Promise.reject(new Error("nbf is in the future: "+j.nbf));if(!j.exp)return v.Log.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(new Error("exp was not provided"));if(j.exp<ie)return v.Log.error("JoseUtil._validateJwt: exp is in the past",j.exp),Promise.reject(new Error("exp is in the past:"+j.exp))}return Promise.resolve(j)},K._validateJwt=function(k,R,B,J,G,$,j){return K.validateJwtAttributes(k,B,J,G,$,j).then(function(re){try{return S.JWS.verify(k,R,P)?re:(v.Log.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(new Error("signature validation failed")))}catch(ie){return v.Log.error(ie&&ie.message||ie),Promise.reject(new Error("signature validation failed"))}})},K.hashString=function(k,R){try{return c.Util.hashString(k,R)}catch(B){v.Log.error(B)}},K.hexToBase64Url=function(k){try{return b(k)}catch(R){v.Log.error(R)}},K}()};var v=d(0);u.exports=o.default},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.SigninResponse=void 0;var v=function(){function S(l,f){for(var c=0;c<f.length;c++){var b=f[c];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(l,b.key,b)}}return function(l,f,c){return f&&S(l.prototype,f),c&&S(l,c),l}}(),h=d(3);function w(S,l){if(!(S instanceof l))throw new TypeError("Cannot call a class as a function")}o.SigninResponse=function(){function S(l){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#";w(this,S);var c=h.UrlUtility.parseUrlFragment(l,f);this.error=c.error,this.error_description=c.error_description,this.error_uri=c.error_uri,this.code=c.code,this.state=c.state,this.id_token=c.id_token,this.session_state=c.session_state,this.access_token=c.access_token,this.token_type=c.token_type,this.scope=c.scope,this.profile=void 0,this.expires_in=c.expires_in}return v(S,[{key:"expires_in",get:function(){if(this.expires_at){var f=parseInt(Date.now()/1e3);return this.expires_at-f}},set:function(f){var c=parseInt(f);if(typeof c=="number"&&c>0){var b=parseInt(Date.now()/1e3);this.expires_at=b+c}}},{key:"expired",get:function(){var f=this.expires_in;if(f!==void 0)return f<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function(){return this.scopes.indexOf("openid")>=0||!!this.id_token}}]),S}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.SignoutRequest=void 0;var v=d(0),h=d(3),w=d(9);o.SignoutRequest=function S(l){var f=l.url,c=l.id_token_hint,b=l.post_logout_redirect_uri,I=l.data,P=l.extraQueryParams,K=l.request_type;if(function(R,B){if(!(R instanceof B))throw new TypeError("Cannot call a class as a function")}(this,S),!f)throw v.Log.error("SignoutRequest.ctor: No url passed"),new Error("url");for(var L in c&&(f=h.UrlUtility.addQueryParam(f,"id_token_hint",c)),b&&(f=h.UrlUtility.addQueryParam(f,"post_logout_redirect_uri",b),I&&(this.state=new w.State({data:I,request_type:K}),f=h.UrlUtility.addQueryParam(f,"state",this.state.id))),P)f=h.UrlUtility.addQueryParam(f,L,P[L]);this.url=f}},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.SignoutResponse=void 0;var v=d(3);o.SignoutResponse=function h(w){(function(f,c){if(!(f instanceof c))throw new TypeError("Cannot call a class as a function")})(this,h);var S=v.UrlUtility.parseUrlFragment(w,"?");this.error=S.error,this.error_description=S.error_description,this.error_uri=S.error_uri,this.state=S.state}},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.InMemoryWebStorage=void 0;var v=function(){function w(S,l){for(var f=0;f<l.length;f++){var c=l[f];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(S,c.key,c)}}return function(S,l,f){return l&&w(S.prototype,l),f&&w(S,f),S}}(),h=d(0);o.InMemoryWebStorage=function(){function w(){(function(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")})(this,w),this._data={}}return w.prototype.getItem=function(l){return h.Log.debug("InMemoryWebStorage.getItem",l),this._data[l]},w.prototype.setItem=function(l,f){h.Log.debug("InMemoryWebStorage.setItem",l),this._data[l]=f},w.prototype.removeItem=function(l){h.Log.debug("InMemoryWebStorage.removeItem",l),delete this._data[l]},w.prototype.key=function(l){return Object.getOwnPropertyNames(this._data)[l]},v(w,[{key:"length",get:function(){return Object.getOwnPropertyNames(this._data).length}}]),w}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.UserManager=void 0;var v=function(){function B(J,G){for(var $=0;$<G.length;$++){var j=G[$];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(J,j.key,j)}}return function(J,G,$){return G&&B(J.prototype,G),$&&B(J,$),J}}(),h=d(0),w=d(10),S=d(39),l=d(15),f=d(45),c=d(47),b=d(18),I=d(8),P=d(20),K=d(11),L=d(4);function k(B,J){if(!(B instanceof J))throw new TypeError("Cannot call a class as a function")}function R(B,J){if(!B)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!J||typeof J!="object"&&typeof J!="function"?B:J}o.UserManager=function(B){function J(){var G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:c.SilentRenewService,j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:b.SessionMonitor,re=arguments.length>3&&arguments[3]!==void 0?arguments[3]:P.TokenRevocationClient,ie=arguments.length>4&&arguments[4]!==void 0?arguments[4]:K.TokenClient,M=arguments.length>5&&arguments[5]!==void 0?arguments[5]:L.JoseUtil;k(this,J),G instanceof S.UserManagerSettings||(G=new S.UserManagerSettings(G));var oe=R(this,B.call(this,G));return oe._events=new f.UserManagerEvents(G),oe._silentRenewService=new $(oe),oe.settings.automaticSilentRenew&&(h.Log.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),oe.startSilentRenew()),oe.settings.monitorSession&&(h.Log.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),oe._sessionMonitor=new j(oe)),oe._tokenRevocationClient=new re(oe._settings),oe._tokenClient=new ie(oe._settings),oe._joseUtil=M,oe}return function($,j){if(typeof j!="function"&&j!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof j);$.prototype=Object.create(j&&j.prototype,{constructor:{value:$,enumerable:!1,writable:!0,configurable:!0}}),j&&(Object.setPrototypeOf?Object.setPrototypeOf($,j):$.__proto__=j)}(J,B),J.prototype.getUser=function(){var $=this;return this._loadUser().then(function(j){return j?(h.Log.info("UserManager.getUser: user loaded"),$._events.load(j,!1),j):(h.Log.info("UserManager.getUser: user not found in storage"),null)})},J.prototype.removeUser=function(){var $=this;return this.storeUser(null).then(function(){h.Log.info("UserManager.removeUser: user removed from storage"),$._events.unload()})},J.prototype.signinRedirect=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};($=Object.assign({},$)).request_type="si:r";var j={useReplaceToNavigate:$.useReplaceToNavigate};return this._signinStart($,this._redirectNavigator,j).then(function(){h.Log.info("UserManager.signinRedirect: successful")})},J.prototype.signinRedirectCallback=function($){return this._signinEnd($||this._redirectNavigator.url).then(function(j){return j.profile&&j.profile.sub?h.Log.info("UserManager.signinRedirectCallback: successful, signed in sub: ",j.profile.sub):h.Log.info("UserManager.signinRedirectCallback: no sub"),j})},J.prototype.signinPopup=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};($=Object.assign({},$)).request_type="si:p";var j=$.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return j?($.redirect_uri=j,$.display="popup",this._signin($,this._popupNavigator,{startUrl:j,popupWindowFeatures:$.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:$.popupWindowTarget||this.settings.popupWindowTarget}).then(function(re){return re&&(re.profile&&re.profile.sub?h.Log.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",re.profile.sub):h.Log.info("UserManager.signinPopup: no sub")),re})):(h.Log.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))},J.prototype.signinPopupCallback=function($){return this._signinCallback($,this._popupNavigator).then(function(j){return j&&(j.profile&&j.profile.sub?h.Log.info("UserManager.signinPopupCallback: successful, signed in sub: ",j.profile.sub):h.Log.info("UserManager.signinPopupCallback: no sub")),j}).catch(function(j){h.Log.error(j.message)})},J.prototype.signinSilent=function(){var $=this,j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return j=Object.assign({},j),this._loadUser().then(function(re){return re&&re.refresh_token?(j.refresh_token=re.refresh_token,$._useRefreshToken(j)):(j.request_type="si:s",j.id_token_hint=j.id_token_hint||$.settings.includeIdTokenInSilentRenew&&re&&re.id_token,re&&$._settings.validateSubOnSilentRenew&&(h.Log.debug("UserManager.signinSilent, subject prior to silent renew: ",re.profile.sub),j.current_sub=re.profile.sub),$._signinSilentIframe(j))})},J.prototype._useRefreshToken=function(){var $=this,j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._tokenClient.exchangeRefreshToken(j).then(function(re){return re?re.access_token?$._loadUser().then(function(ie){if(ie){var M=Promise.resolve();return re.id_token&&(M=$._validateIdTokenFromTokenRefreshToken(ie.profile,re.id_token)),M.then(function(){return h.Log.debug("UserManager._useRefreshToken: refresh token response success"),ie.id_token=re.id_token||ie.id_token,ie.access_token=re.access_token,ie.refresh_token=re.refresh_token||ie.refresh_token,ie.expires_in=re.expires_in,$.storeUser(ie).then(function(){return $._events.load(ie),ie})})}return null}):(h.Log.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(h.Log.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint"))})},J.prototype._validateIdTokenFromTokenRefreshToken=function($,j){var re=this;return this._metadataService.getIssuer().then(function(ie){return re.settings.getEpochTime().then(function(M){return re._joseUtil.validateJwtAttributes(j,ie,re._settings.client_id,re._settings.clockSkew,M).then(function(oe){return oe?oe.sub!==$.sub?(h.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(new Error("sub in id_token does not match current sub"))):oe.auth_time&&oe.auth_time!==$.auth_time?(h.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(new Error("auth_time in id_token does not match original auth_time"))):oe.azp&&oe.azp!==$.azp?(h.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(new Error("azp in id_token does not match original azp"))):!oe.azp&&$.azp?(h.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(new Error("azp not in id_token, but present in original id_token"))):void 0:(h.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(new Error("Failed to validate id_token")))})})})},J.prototype._signinSilentIframe=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=$.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return j?($.redirect_uri=j,$.prompt=$.prompt||"none",this._signin($,this._iframeNavigator,{startUrl:j,silentRequestTimeout:$.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(re){return re&&(re.profile&&re.profile.sub?h.Log.info("UserManager.signinSilent: successful, signed in sub: ",re.profile.sub):h.Log.info("UserManager.signinSilent: no sub")),re})):(h.Log.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},J.prototype.signinSilentCallback=function($){return this._signinCallback($,this._iframeNavigator).then(function(j){return j&&(j.profile&&j.profile.sub?h.Log.info("UserManager.signinSilentCallback: successful, signed in sub: ",j.profile.sub):h.Log.info("UserManager.signinSilentCallback: no sub")),j})},J.prototype.signinCallback=function($){var j=this;return this.readSigninResponseState($).then(function(re){var ie=re.state;return re.response,ie.request_type==="si:r"?j.signinRedirectCallback($):ie.request_type==="si:p"?j.signinPopupCallback($):ie.request_type==="si:s"?j.signinSilentCallback($):Promise.reject(new Error("invalid response_type in state"))})},J.prototype.signoutCallback=function($,j){var re=this;return this.readSignoutResponseState($).then(function(ie){var M=ie.state,oe=ie.response;return M?M.request_type==="so:r"?re.signoutRedirectCallback($):M.request_type==="so:p"?re.signoutPopupCallback($,j):Promise.reject(new Error("invalid response_type in state")):oe})},J.prototype.querySessionStatus=function(){var $=this,j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(j=Object.assign({},j)).request_type="si:s";var re=j.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return re?(j.redirect_uri=re,j.prompt="none",j.response_type=j.response_type||this.settings.query_status_response_type,j.scope=j.scope||"openid",j.skipUserInfo=!0,this._signinStart(j,this._iframeNavigator,{startUrl:re,silentRequestTimeout:j.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(ie){return $.processSigninResponse(ie.url).then(function(M){if(h.Log.debug("UserManager.querySessionStatus: got signin response"),M.session_state&&M.profile.sub)return h.Log.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",M.profile.sub),{session_state:M.session_state,sub:M.profile.sub,sid:M.profile.sid};h.Log.info("querySessionStatus successful, user not authenticated")}).catch(function(M){if(M.session_state&&$.settings.monitorAnonymousSession&&(M.message=="login_required"||M.message=="consent_required"||M.message=="interaction_required"||M.message=="account_selection_required"))return h.Log.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:M.session_state};throw M})})):(h.Log.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},J.prototype._signin=function($,j){var re=this,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signinStart($,j,ie).then(function(M){return re._signinEnd(M.url,$)})},J.prototype._signinStart=function($,j){var re=this,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return j.prepare(ie).then(function(M){return h.Log.debug("UserManager._signinStart: got navigator window handle"),re.createSigninRequest($).then(function(oe){return h.Log.debug("UserManager._signinStart: got signin request"),ie.url=oe.url,ie.id=oe.state.id,M.navigate(ie)}).catch(function(oe){throw M.close&&(h.Log.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),M.close()),oe})})},J.prototype._signinEnd=function($){var j=this,re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.processSigninResponse($).then(function(ie){h.Log.debug("UserManager._signinEnd: got signin response");var M=new l.User(ie);if(re.current_sub){if(re.current_sub!==M.profile.sub)return h.Log.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",M.profile.sub),Promise.reject(new Error("login_required"));h.Log.debug("UserManager._signinEnd: current user matches user returned from signin")}return j.storeUser(M).then(function(){return h.Log.debug("UserManager._signinEnd: user stored"),j._events.load(M),M})})},J.prototype._signinCallback=function($,j){h.Log.debug("UserManager._signinCallback");var re=this._settings.response_mode==="query"||!this._settings.response_mode&&I.SigninRequest.isCode(this._settings.response_type)?"?":"#";return j.callback($,void 0,re)},J.prototype.signoutRedirect=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};($=Object.assign({},$)).request_type="so:r";var j=$.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;j&&($.post_logout_redirect_uri=j);var re={useReplaceToNavigate:$.useReplaceToNavigate};return this._signoutStart($,this._redirectNavigator,re).then(function(){h.Log.info("UserManager.signoutRedirect: successful")})},J.prototype.signoutRedirectCallback=function($){return this._signoutEnd($||this._redirectNavigator.url).then(function(j){return h.Log.info("UserManager.signoutRedirectCallback: successful"),j})},J.prototype.signoutPopup=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};($=Object.assign({},$)).request_type="so:p";var j=$.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return $.post_logout_redirect_uri=j,$.display="popup",$.post_logout_redirect_uri&&($.state=$.state||{}),this._signout($,this._popupNavigator,{startUrl:j,popupWindowFeatures:$.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:$.popupWindowTarget||this.settings.popupWindowTarget}).then(function(){h.Log.info("UserManager.signoutPopup: successful")})},J.prototype.signoutPopupCallback=function($,j){return j===void 0&&typeof $=="boolean"&&(j=$,$=null),this._popupNavigator.callback($,j,"?").then(function(){h.Log.info("UserManager.signoutPopupCallback: successful")})},J.prototype._signout=function($,j){var re=this,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signoutStart($,j,ie).then(function(M){return re._signoutEnd(M.url)})},J.prototype._signoutStart=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=this,re=arguments[1],ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return re.prepare(ie).then(function(M){return h.Log.debug("UserManager._signoutStart: got navigator window handle"),j._loadUser().then(function(oe){return h.Log.debug("UserManager._signoutStart: loaded current user from storage"),(j._settings.revokeAccessTokenOnSignout?j._revokeInternal(oe):Promise.resolve()).then(function(){var _e=$.id_token_hint||oe&&oe.id_token;return _e&&(h.Log.debug("UserManager._signoutStart: Setting id_token into signout request"),$.id_token_hint=_e),j.removeUser().then(function(){return h.Log.debug("UserManager._signoutStart: user removed, creating signout request"),j.createSignoutRequest($).then(function(me){return h.Log.debug("UserManager._signoutStart: got signout request"),ie.url=me.url,me.state&&(ie.id=me.state.id),M.navigate(ie)})})})}).catch(function(oe){throw M.close&&(h.Log.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),M.close()),oe})})},J.prototype._signoutEnd=function($){return this.processSignoutResponse($).then(function(j){return h.Log.debug("UserManager._signoutEnd: got signout response"),j})},J.prototype.revokeAccessToken=function(){var $=this;return this._loadUser().then(function(j){return $._revokeInternal(j,!0).then(function(re){if(re)return h.Log.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),j.access_token=null,j.refresh_token=null,j.expires_at=null,j.token_type=null,$.storeUser(j).then(function(){h.Log.debug("UserManager.revokeAccessToken: user stored"),$._events.load(j)})})}).then(function(){h.Log.info("UserManager.revokeAccessToken: access token revoked successfully")})},J.prototype._revokeInternal=function($,j){var re=this;if($){var ie=$.access_token,M=$.refresh_token;return this._revokeAccessTokenInternal(ie,j).then(function(oe){return re._revokeRefreshTokenInternal(M,j).then(function(_e){return oe||_e||h.Log.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),oe||_e})})}return Promise.resolve(!1)},J.prototype._revokeAccessTokenInternal=function($,j){return!$||$.indexOf(".")>=0?Promise.resolve(!1):this._tokenRevocationClient.revoke($,j).then(function(){return!0})},J.prototype._revokeRefreshTokenInternal=function($,j){return $?this._tokenRevocationClient.revoke($,j,"refresh_token").then(function(){return!0}):Promise.resolve(!1)},J.prototype.startSilentRenew=function(){this._silentRenewService.start()},J.prototype.stopSilentRenew=function(){this._silentRenewService.stop()},J.prototype._loadUser=function(){return this._userStore.get(this._userStoreKey).then(function($){return $?(h.Log.debug("UserManager._loadUser: user storageString loaded"),l.User.fromStorageString($)):(h.Log.debug("UserManager._loadUser: no user storageString"),null)})},J.prototype.storeUser=function($){if($){h.Log.debug("UserManager.storeUser: storing user");var j=$.toStorageString();return this._userStore.set(this._userStoreKey,j)}return h.Log.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)},v(J,[{key:"_redirectNavigator",get:function(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function(){return this.settings.iframeNavigator}},{key:"_userStore",get:function(){return this.settings.userStore}},{key:"events",get:function(){return this._events}},{key:"_userStoreKey",get:function(){return"user:"+this.settings.authority+":"+this.settings.client_id}}]),J}(w.OidcClient)},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.UserManagerSettings=void 0;var v=function(){function K(L,k){for(var R=0;R<k.length;R++){var B=k[R];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(L,B.key,B)}}return function(L,k,R){return k&&K(L.prototype,k),R&&K(L,R),L}}(),h=(d(0),d(5)),w=d(40),S=d(41),l=d(43),f=d(6),c=d(1),b=d(8);function I(K,L){if(!(K instanceof L))throw new TypeError("Cannot call a class as a function")}function P(K,L){if(!K)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!L||typeof L!="object"&&typeof L!="function"?K:L}o.UserManagerSettings=function(K){function L(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},R=k.popup_redirect_uri,B=k.popup_post_logout_redirect_uri,J=k.popupWindowFeatures,G=k.popupWindowTarget,$=k.silent_redirect_uri,j=k.silentRequestTimeout,re=k.automaticSilentRenew,ie=re!==void 0&&re,M=k.validateSubOnSilentRenew,oe=M!==void 0&&M,_e=k.includeIdTokenInSilentRenew,me=_e===void 0||_e,$e=k.monitorSession,Ie=$e===void 0||$e,ze=k.monitorAnonymousSession,Le=ze!==void 0&&ze,Ge=k.checkSessionInterval,fe=Ge===void 0?2e3:Ge,ye=k.stopCheckSessionOnError,Ve=ye===void 0||ye,Ye=k.query_status_response_type,tt=k.revokeAccessTokenOnSignout,rt=tt!==void 0&&tt,ut=k.accessTokenExpiringNotificationTime,St=ut===void 0?60:ut,Xe=k.redirectNavigator,nt=Xe===void 0?new w.RedirectNavigator:Xe,Ke=k.popupNavigator,xe=Ke===void 0?new S.PopupNavigator:Ke,V=k.iframeNavigator,p=V===void 0?new l.IFrameNavigator:V,y=k.userStore,N=y===void 0?new f.WebStorageStateStore({store:c.Global.sessionStorage}):y;I(this,L);var W=P(this,K.call(this,arguments[0]));return W._popup_redirect_uri=R,W._popup_post_logout_redirect_uri=B,W._popupWindowFeatures=J,W._popupWindowTarget=G,W._silent_redirect_uri=$,W._silentRequestTimeout=j,W._automaticSilentRenew=ie,W._validateSubOnSilentRenew=oe,W._includeIdTokenInSilentRenew=me,W._accessTokenExpiringNotificationTime=St,W._monitorSession=Ie,W._monitorAnonymousSession=Le,W._checkSessionInterval=fe,W._stopCheckSessionOnError=Ve,Ye?W._query_status_response_type=Ye:arguments[0]&&arguments[0].response_type?W._query_status_response_type=b.SigninRequest.isOidc(arguments[0].response_type)?"id_token":"code":W._query_status_response_type="id_token",W._revokeAccessTokenOnSignout=rt,W._redirectNavigator=nt,W._popupNavigator=xe,W._iframeNavigator=p,W._userStore=N,W}return function(R,B){if(typeof B!="function"&&B!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof B);R.prototype=Object.create(B&&B.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),B&&(Object.setPrototypeOf?Object.setPrototypeOf(R,B):R.__proto__=B)}(L,K),v(L,[{key:"popup_redirect_uri",get:function(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function(){return this._automaticSilentRenew}},{key:"validateSubOnSilentRenew",get:function(){return this._validateSubOnSilentRenew}},{key:"includeIdTokenInSilentRenew",get:function(){return this._includeIdTokenInSilentRenew}},{key:"accessTokenExpiringNotificationTime",get:function(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function(){return this._monitorSession}},{key:"monitorAnonymousSession",get:function(){return this._monitorAnonymousSession}},{key:"checkSessionInterval",get:function(){return this._checkSessionInterval}},{key:"stopCheckSessionOnError",get:function(){return this._stopCheckSessionOnError}},{key:"query_status_response_type",get:function(){return this._query_status_response_type}},{key:"revokeAccessTokenOnSignout",get:function(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function(){return this._redirectNavigator}},{key:"popupNavigator",get:function(){return this._popupNavigator}},{key:"iframeNavigator",get:function(){return this._iframeNavigator}},{key:"userStore",get:function(){return this._userStore}}]),L}(h.OidcClientSettings)},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.RedirectNavigator=void 0;var v=function(){function w(S,l){for(var f=0;f<l.length;f++){var c=l[f];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(S,c.key,c)}}return function(S,l,f){return l&&w(S.prototype,l),f&&w(S,f),S}}(),h=d(0);o.RedirectNavigator=function(){function w(){(function(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")})(this,w)}return w.prototype.prepare=function(){return Promise.resolve(this)},w.prototype.navigate=function(l){return l&&l.url?(l.useReplaceToNavigate?window.location.replace(l.url):window.location=l.url,Promise.resolve()):(h.Log.error("RedirectNavigator.navigate: No url provided"),Promise.reject(new Error("No url provided")))},v(w,[{key:"url",get:function(){return window.location.href}}]),w}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.PopupNavigator=void 0;var v=d(0),h=d(42);o.PopupNavigator=function(){function w(){(function(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")})(this,w)}return w.prototype.prepare=function(l){var f=new h.PopupWindow(l);return Promise.resolve(f)},w.prototype.callback=function(l,f,c){v.Log.debug("PopupNavigator.callback");try{return h.PopupWindow.notifyOpener(l,f,c),Promise.resolve()}catch(b){return Promise.reject(b)}},w}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.PopupWindow=void 0;var v=function(){function S(l,f){for(var c=0;c<f.length;c++){var b=f[c];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(l,b.key,b)}}return function(l,f,c){return f&&S(l.prototype,f),c&&S(l,c),l}}(),h=d(0),w=d(3);o.PopupWindow=function(){function S(l){var f=this;(function(P,K){if(!(P instanceof K))throw new TypeError("Cannot call a class as a function")})(this,S),this._promise=new Promise(function(I,P){f._resolve=I,f._reject=P});var c=l.popupWindowTarget||"_blank",b=l.popupWindowFeatures||"location=no,toolbar=no,width=500,height=500,left=100,top=100;";this._popup=window.open("",c,b),this._popup&&(h.Log.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),500))}return S.prototype.navigate=function(f){return this._popup?f&&f.url?(h.Log.debug("PopupWindow.navigate: Setting URL in popup"),this._id=f.id,this._id&&(window["popupCallback_"+f.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=f.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise},S.prototype._success=function(f){h.Log.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(f)},S.prototype._error=function(f){h.Log.error("PopupWindow.error: ",f),this._cleanup(),this._reject(new Error(f))},S.prototype.close=function(){this._cleanup(!1)},S.prototype._cleanup=function(f){h.Log.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!f&&this._popup.close(),this._popup=null},S.prototype._checkForPopupClosed=function(){this._popup&&!this._popup.closed||this._error("Popup window closed")},S.prototype._callback=function(f,c){this._cleanup(c),f?(h.Log.debug("PopupWindow.callback success"),this._success({url:f})):(h.Log.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))},S.notifyOpener=function(f,c,b){if(window.opener){if(f=f||window.location.href){var I=w.UrlUtility.parseUrlFragment(f,b);if(I.state){var P="popupCallback_"+I.state,K=window.opener[P];K?(h.Log.debug("PopupWindow.notifyOpener: passing url message to opener"),K(f,c)):h.Log.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else h.Log.warn("PopupWindow.notifyOpener: no state found in response url")}}else h.Log.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")},v(S,[{key:"promise",get:function(){return this._promise}}]),S}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.IFrameNavigator=void 0;var v=d(0),h=d(44);o.IFrameNavigator=function(){function w(){(function(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")})(this,w)}return w.prototype.prepare=function(l){var f=new h.IFrameWindow(l);return Promise.resolve(f)},w.prototype.callback=function(l){v.Log.debug("IFrameNavigator.callback");try{return h.IFrameWindow.notifyParent(l),Promise.resolve()}catch(f){return Promise.reject(f)}},w}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.IFrameWindow=void 0;var v=function(){function w(S,l){for(var f=0;f<l.length;f++){var c=l[f];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(S,c.key,c)}}return function(S,l,f){return l&&w(S.prototype,l),f&&w(S,f),S}}(),h=d(0);o.IFrameWindow=function(){function w(S){var l=this;(function(c,b){if(!(c instanceof b))throw new TypeError("Cannot call a class as a function")})(this,w),this._promise=new Promise(function(f,c){l._resolve=f,l._reject=c}),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.width=0,this._frame.height=0,window.document.body.appendChild(this._frame)}return w.prototype.navigate=function(l){if(l&&l.url){var f=l.silentRequestTimeout||1e4;h.Log.debug("IFrameWindow.navigate: Using timeout of:",f),this._timer=window.setTimeout(this._timeout.bind(this),f),this._frame.src=l.url}else this._error("No url provided");return this.promise},w.prototype._success=function(l){this._cleanup(),h.Log.debug("IFrameWindow: Successful response from frame window"),this._resolve(l)},w.prototype._error=function(l){this._cleanup(),h.Log.error(l),this._reject(new Error(l))},w.prototype.close=function(){this._cleanup()},w.prototype._cleanup=function(){this._frame&&(h.Log.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)},w.prototype._timeout=function(){h.Log.debug("IFrameWindow.timeout"),this._error("Frame window timed out")},w.prototype._message=function(l){if(h.Log.debug("IFrameWindow.message"),this._timer&&l.origin===this._origin&&l.source===this._frame.contentWindow&&typeof l.data=="string"&&(l.data.startsWith("http://")||l.data.startsWith("https://"))){var f=l.data;f?this._success({url:f}):this._error("Invalid response from frame")}},w.notifyParent=function(l){h.Log.debug("IFrameWindow.notifyParent"),(l=l||window.location.href)&&(h.Log.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(l,location.protocol+"//"+location.host))},v(w,[{key:"promise",get:function(){return this._promise}},{key:"_origin",get:function(){return location.protocol+"//"+location.host}}]),w}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.UserManagerEvents=void 0;var v=d(0),h=d(16),w=d(17);o.UserManagerEvents=function(S){function l(f){(function(I,P){if(!(I instanceof P))throw new TypeError("Cannot call a class as a function")})(this,l);var c=function(I,P){if(!I)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!P||typeof P!="object"&&typeof P!="function"?I:P}(this,S.call(this,f));return c._userLoaded=new w.Event("User loaded"),c._userUnloaded=new w.Event("User unloaded"),c._silentRenewError=new w.Event("Silent renew error"),c._userSignedIn=new w.Event("User signed in"),c._userSignedOut=new w.Event("User signed out"),c._userSessionChanged=new w.Event("User session changed"),c}return function(c,b){if(typeof b!="function"&&b!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof b);c.prototype=Object.create(b&&b.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(c,b):c.__proto__=b)}(l,S),l.prototype.load=function(c){var b=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];v.Log.debug("UserManagerEvents.load"),S.prototype.load.call(this,c),b&&this._userLoaded.raise(c)},l.prototype.unload=function(){v.Log.debug("UserManagerEvents.unload"),S.prototype.unload.call(this),this._userUnloaded.raise()},l.prototype.addUserLoaded=function(c){this._userLoaded.addHandler(c)},l.prototype.removeUserLoaded=function(c){this._userLoaded.removeHandler(c)},l.prototype.addUserUnloaded=function(c){this._userUnloaded.addHandler(c)},l.prototype.removeUserUnloaded=function(c){this._userUnloaded.removeHandler(c)},l.prototype.addSilentRenewError=function(c){this._silentRenewError.addHandler(c)},l.prototype.removeSilentRenewError=function(c){this._silentRenewError.removeHandler(c)},l.prototype._raiseSilentRenewError=function(c){v.Log.debug("UserManagerEvents._raiseSilentRenewError",c.message),this._silentRenewError.raise(c)},l.prototype.addUserSignedIn=function(c){this._userSignedIn.addHandler(c)},l.prototype.removeUserSignedIn=function(c){this._userSignedIn.removeHandler(c)},l.prototype._raiseUserSignedIn=function(){v.Log.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()},l.prototype.addUserSignedOut=function(c){this._userSignedOut.addHandler(c)},l.prototype.removeUserSignedOut=function(c){this._userSignedOut.removeHandler(c)},l.prototype._raiseUserSignedOut=function(){v.Log.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()},l.prototype.addUserSessionChanged=function(c){this._userSessionChanged.addHandler(c)},l.prototype.removeUserSessionChanged=function(c){this._userSessionChanged.removeHandler(c)},l.prototype._raiseUserSessionChanged=function(){v.Log.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()},l}(h.AccessTokenEvents)},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.Timer=void 0;var v=function(){function c(b,I){for(var P=0;P<I.length;P++){var K=I[P];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(b,K.key,K)}}return function(b,I,P){return I&&c(b.prototype,I),P&&c(b,P),b}}(),h=d(0),w=d(1),S=d(17);function l(c,b){if(!(c instanceof b))throw new TypeError("Cannot call a class as a function")}function f(c,b){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||typeof b!="object"&&typeof b!="function"?c:b}o.Timer=function(c){function b(I){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:w.Global.timer,K=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;l(this,b);var L=f(this,c.call(this,I));return L._timer=P,L._nowFunc=K||function(){return Date.now()/1e3},L}return function(P,K){if(typeof K!="function"&&K!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof K);P.prototype=Object.create(K&&K.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),K&&(Object.setPrototypeOf?Object.setPrototypeOf(P,K):P.__proto__=K)}(b,c),b.prototype.init=function(P){P<=0&&(P=1),P=parseInt(P);var K=this.now+P;if(this.expiration===K&&this._timerHandle)h.Log.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),h.Log.debug("Timer.init timer "+this._name+" for duration:",P),this._expiration=K;var L=5;P<L&&(L=P),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*L)}},b.prototype.cancel=function(){this._timerHandle&&(h.Log.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)},b.prototype._callback=function(){var P=this._expiration-this.now;h.Log.debug("Timer.callback; "+this._name+" timer expires in:",P),this._expiration<=this.now&&(this.cancel(),c.prototype.raise.call(this))},v(b,[{key:"now",get:function(){return parseInt(this._nowFunc())}},{key:"expiration",get:function(){return this._expiration}}]),b}(S.Event)},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.SilentRenewService=void 0;var v=d(0);o.SilentRenewService=function(){function h(w){(function(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")})(this,h),this._userManager=w}return h.prototype.start=function(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then(function(S){}).catch(function(S){v.Log.error("SilentRenewService.start: Error from getUser:",S.message)}))},h.prototype.stop=function(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)},h.prototype._tokenExpiring=function(){var S=this;this._userManager.signinSilent().then(function(l){v.Log.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")},function(l){v.Log.error("SilentRenewService._tokenExpiring: Error from signinSilent:",l.message),S._userManager.events._raiseSilentRenewError(l)})},h}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.CordovaPopupNavigator=void 0;var v=d(21);o.CordovaPopupNavigator=function(){function h(){(function(S,l){if(!(S instanceof l))throw new TypeError("Cannot call a class as a function")})(this,h)}return h.prototype.prepare=function(S){var l=new v.CordovaPopupWindow(S);return Promise.resolve(l)},h}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.CordovaIFrameNavigator=void 0;var v=d(21);o.CordovaIFrameNavigator=function(){function h(){(function(S,l){if(!(S instanceof l))throw new TypeError("Cannot call a class as a function")})(this,h)}return h.prototype.prepare=function(S){S.popupWindowFeatures="hidden=yes";var l=new v.CordovaPopupWindow(S);return Promise.resolve(l)},h}()},function(u,o,d){Object.defineProperty(o,"__esModule",{value:!0}),o.Version="1.11.6"}])})})(li);var Lr=li.exports;function ds(s,i){var u,o,d,v;throw s.error==="invalid_redirect_uri"?new Error(`Dynamic client registration failed: the provided redirect uri [${(u=i.redirectUrl)===null||u===void 0?void 0:u.toString()}] is invalid - ${(o=s.error_description)!==null&&o!==void 0?o:""}`):s.error==="invalid_client_metadata"?new Error(`Dynamic client registration failed: the provided client metadata ${JSON.stringify(i)} is invalid - ${(d=s.error_description)!==null&&d!==void 0?d:""}`):new Error(`Dynamic client registration failed: ${s.error} - ${(v=s.error_description)!==null&&v!==void 0?v:""}`)}function fs(s,i){if(s.client_id===void 0)throw new Error(`Dynamic client registration failed: no client_id has been found on ${JSON.stringify(s)}`);if(i.redirectUrl&&(s.redirect_uris===void 0||s.redirect_uris[0]!==i.redirectUrl.toString()))throw new Error(`Dynamic client registration failed: the returned redirect URIs ${JSON.stringify(s.redirect_uris)} don't match the provided ${JSON.stringify([i.redirectUrl.toString()])}`)}async function gs(s,i){var u;if(!i.registrationEndpoint)throw new Error("Dynamic Registration could not be completed because the issuer has no registration endpoint.");if(!Array.isArray(i.idTokenSigningAlgValuesSupported))throw new Error("The OIDC issuer discovery profile is missing the 'id_token_signing_alg_values_supported' value, which is mandatory.");const o=Ko(i.idTokenSigningAlgValuesSupported,dr),d={client_name:s.clientName,application_type:"web",redirect_uris:[(u=s.redirectUrl)===null||u===void 0?void 0:u.toString()],subject_type:"public",token_endpoint_auth_method:"client_secret_basic",id_token_signed_response_alg:o,grant_types:["authorization_code","refresh_token"]},v={"Content-Type":"application/json"},h=await fetch(i.registrationEndpoint.toString(),{method:"POST",headers:v,body:JSON.stringify(d)});if(h.ok){const w=await h.json();return fs(w,s),{clientId:w.client_id,clientSecret:w.client_secret,idTokenSignedResponseAlg:w.id_token_signed_response_alg,clientType:"dynamic"}}throw h.status===400&&ds(await h.json(),s),new Error(`Dynamic client registration failed: the server returned ${h.status} ${h.statusText} - ${await h.text()}`)}function ps(s){return s.error!==void 0&&typeof s.error=="string"}function mn(s){return s.error_description!==void 0&&typeof s.error_description=="string"}function ys(s){return s.error_uri!==void 0&&typeof s.error_uri=="string"}function vs(s){return s.access_token!==void 0&&typeof s.access_token=="string"}function ms(s){return s.id_token!==void 0&&typeof s.id_token=="string"}function _s(s){return s.refresh_token!==void 0&&typeof s.refresh_token=="string"}function Ss(s){return s.token_type!==void 0&&typeof s.token_type=="string"}function ws(s){return s.expires_in===void 0||typeof s.expires_in=="number"}function bs(s,i){if(i.grantType&&(!s.grantTypesSupported||!s.grantTypesSupported.includes(i.grantType)))throw new Error(`The issuer [${s.issuer}] does not support the [${i.grantType}] grant`);if(!s.tokenEndpoint)throw new Error(`This issuer [${s.issuer}] does not have a token endpoint`)}function di(s,i){if(ps(s))throw new ti(`Token endpoint returned error [${s.error}]${mn(s)?`: ${s.error_description}`:""}${ys(s)?` (see ${s.error_uri})`:""}`,s.error,mn(s)?s.error_description:void 0);if(!vs(s))throw new Yt(["access_token"]);if(!ms(s))throw new Yt(["id_token"]);if(!Ss(s))throw new Yt(["token_type"]);if(!ws(s))throw new Yt(["expires_in"]);if(!i&&s.token_type.toLowerCase()!=="bearer")throw new Error(`Invalid token endpoint response: requested a [Bearer] token, but got a 'token_type' value of [${s.token_type}].`);return s}async function Es(s,i,u,o){bs(s,u);const d={"content-type":"application/x-www-form-urlencoded"};let v;o&&(v=await Qo(),d.DPoP=await Kr(s.tokenEndpoint,"POST",v)),i.clientSecret&&(d.Authorization=`Basic ${btoa(`${i.clientId}:${i.clientSecret}`)}`);const h={grant_type:u.grantType,redirect_uri:u.redirectUrl,code:u.code,code_verifier:u.codeVerifier,client_id:i.clientId},w={method:"POST",headers:d,body:new URLSearchParams(h).toString()},l=await(await fetch(s.tokenEndpoint,w)).json(),f=di(l,o),{webId:c,clientId:b}=await zn(f.id_token,s.jwksUri,s.issuer,i.clientId);return{accessToken:f.access_token,idToken:f.id_token,refreshToken:_s(f)?f.refresh_token:void 0,webId:c,clientId:b,dpopKey:v,expiresIn:f.expires_in}}const Fs=s=>{try{return new URL(s),!0}catch{return!1}};async function As(s,i,u,o){if(u.clientId===void 0)throw new Error("No client ID available when trying to refresh the access token.");const d={grant_type:"refresh_token",refresh_token:s,scope:$n};let v={};o!==void 0&&(v={DPoP:await Kr(i.tokenEndpoint,"POST",o)});let h={};u.clientSecret!==void 0?h={Authorization:`Basic ${btoa(`${u.clientId}:${u.clientSecret}`)}`}:Fs(u.clientId)&&(d.client_id=u.clientId);const w=await fetch(i.tokenEndpoint,{method:"POST",body:new URLSearchParams(d).toString(),headers:{...v,...h,"Content-Type":"application/x-www-form-urlencoded"}});let S;try{S=await w.json()}catch{throw new Error(`The token endpoint of issuer ${i.issuer} returned a malformed response.`)}const l=di(S,o!==void 0),{webId:f}=await zn(l.id_token,i.jwksUri,i.issuer,u.clientId);return{accessToken:l.access_token,idToken:l.id_token,refreshToken:typeof l.refresh_token=="string"?l.refresh_token:void 0,webId:f,dpopKey:o,expiresIn:l.expires_in}}function xs(s){const i=Yn(s);return i.hash="",s.includes(`${i.origin}/`)?i.href:`${i.origin}${i.href.substring(i.origin.length+1)}`}async function Ps(){await new Lr.OidcClient({response_mode:"query"}).clearStaleState(new Lr.WebStorageStateStore({}));const i=window.localStorage,u=[];for(let o=0;o<=i.length;o+=1){const d=i.key(o);d&&(d.match(/^oidc\..+$/)||d.match(/^solidClientAuthenticationUser:.+$/))&&u.push(d)}u.forEach(o=>i.removeItem(o))}class ks extends Go{constructor(i,u){super(i,u)}}class Ts extends $o{constructor(){super(...arguments),this.login=async(i,u)=>{var o,d;await this.sessionInfoManager.clear(i.sessionId);const v=(o=i.redirectUrl)!==null&&o!==void 0?o:xs(window.location.href);if(!Gn(v))throw new Error(`${v} is not a valid redirect URL, it is either a malformed IRI, includes a hash fragment, or reserved query parameters ('code' or 'state').`);await this.loginHandler.handle({...i,redirectUrl:v,clientName:(d=i.clientName)!==null&&d!==void 0?d:i.clientId,eventEmitter:u})},this.validateCurrentSession=async i=>{const u=await this.sessionInfoManager.get(i);return u===void 0||u.clientAppId===void 0||u.issuer===void 0?null:u},this.handleIncomingRedirect=async(i,u)=>{try{const o=await this.redirectHandler.handle(i,u,void 0);return this.fetch=o.fetch.bind(window),this.boundLogout=o.getLogoutUrl,await this.cleanUrlAfterRedirect(i),{isLoggedIn:o.isLoggedIn,webId:o.webId,sessionId:o.sessionId,expirationDate:o.expirationDate,clientAppId:o.clientAppId}}catch(o){await this.cleanUrlAfterRedirect(i),u.emit(je.ERROR,"redirect",o);return}}}async cleanUrlAfterRedirect(i){const u=Yn(i).href;for(window.history.replaceState(null,"",u);window.location.href!==u;)await new Promise(o=>{setTimeout(()=>o(),1)})}}function _n(s){return typeof s.oidcIssuer=="string"}function Sn(s){return typeof s.redirectUrl=="string"}class Rs{constructor(i,u,o,d){this.storageUtility=i,this.oidcHandler=u,this.issuerConfigFetcher=o,this.clientRegistrar=d,this.storageUtility=i,this.oidcHandler=u,this.issuerConfigFetcher=o,this.clientRegistrar=d}async canHandle(i){return _n(i)&&Sn(i)}async handle(i){if(!_n(i))throw new Dr(`OidcLoginHandler requires an OIDC issuer: missing property 'oidcIssuer' in ${JSON.stringify(i)}`);if(!Sn(i))throw new Dr(`OidcLoginHandler requires a redirect URL: missing property 'redirectUrl' in ${JSON.stringify(i)}`);const u=await this.issuerConfigFetcher.fetchConfig(i.oidcIssuer),o=await qo(i,u,this.storageUtility,this.clientRegistrar),d={issuer:u.issuer,dpop:i.tokenType.toLowerCase()==="dpop",...i,issuerConfiguration:u,client:o};return this.oidcHandler.handle(d)}}class Cs extends Do{async handle(i){var u;const o={authority:i.issuer.toString(),client_id:i.client.clientId,client_secret:i.client.clientSecret,redirect_uri:i.redirectUrl,response_type:"code",scope:$n,filterProtocolClaims:!0,loadUserInfo:!1,code_verifier:!0,prompt:(u=i.prompt)!==null&&u!==void 0?u:"consent"},d=new Lr.OidcClient(o);try{const v=await d.createSigninRequest();return await this.handleRedirect({oidcLoginOptions:i,state:v.state._id,codeVerifier:v.state._code_verifier,targetUrl:v.url.toString()})}catch(v){console.error(v)}}}const Is=".well-known/openid-configuration",wn={issuer:{toKey:"issuer",convertToUrl:!0},authorization_endpoint:{toKey:"authorizationEndpoint",convertToUrl:!0},token_endpoint:{toKey:"tokenEndpoint",convertToUrl:!0},userinfo_endpoint:{toKey:"userinfoEndpoint",convertToUrl:!0},jwks_uri:{toKey:"jwksUri",convertToUrl:!0},registration_endpoint:{toKey:"registrationEndpoint",convertToUrl:!0},end_session_endpoint:{toKey:"endSessionEndpoint",convertToUrl:!0},scopes_supported:{toKey:"scopesSupported"},response_types_supported:{toKey:"responseTypesSupported"},response_modes_supported:{toKey:"responseModesSupported"},grant_types_supported:{toKey:"grantTypesSupported"},acr_values_supported:{toKey:"acrValuesSupported"},subject_types_supported:{toKey:"subjectTypesSupported"},id_token_signing_alg_values_supported:{toKey:"idTokenSigningAlgValuesSupported"},id_token_encryption_alg_values_supported:{toKey:"idTokenEncryptionAlgValuesSupported"},id_token_encryption_enc_values_supported:{toKey:"idTokenEncryptionEncValuesSupported"},userinfo_signing_alg_values_supported:{toKey:"userinfoSigningAlgValuesSupported"},userinfo_encryption_alg_values_supported:{toKey:"userinfoEncryptionAlgValuesSupported"},userinfo_encryption_enc_values_supported:{toKey:"userinfoEncryptionEncValuesSupported"},request_object_signing_alg_values_supported:{toKey:"requestObjectSigningAlgValuesSupported"},request_object_encryption_alg_values_supported:{toKey:"requestObjectEncryptionAlgValuesSupported"},request_object_encryption_enc_values_supported:{toKey:"requestObjectEncryptionEncValuesSupported"},token_endpoint_auth_methods_supported:{toKey:"tokenEndpointAuthMethodsSupported"},token_endpoint_auth_signing_alg_values_supported:{toKey:"tokenEndpointAuthSigningAlgValuesSupported"},display_values_supported:{toKey:"displayValuesSupported"},claim_types_supported:{toKey:"claimTypesSupported"},claims_supported:{toKey:"claimsSupported"},service_documentation:{toKey:"serviceDocumentation"},claims_locales_supported:{toKey:"claimsLocalesSupported"},ui_locales_supported:{toKey:"uiLocalesSupported"},claims_parameter_supported:{toKey:"claimsParameterSupported"},request_parameter_supported:{toKey:"requestParameterSupported"},request_uri_parameter_supported:{toKey:"requestUriParameterSupported"},require_request_uri_registration:{toKey:"requireRequestUriRegistration"},op_policy_uri:{toKey:"opPolicyUri",convertToUrl:!0},op_tos_uri:{toKey:"opTosUri",convertToUrl:!0}};function Us(s){const i={};return Object.keys(s).forEach(u=>{wn[u]&&(i[wn[u].toKey]=s[u])}),Array.isArray(i.scopesSupported)||(i.scopesSupported=["openid"]),i}class Jr{constructor(i){this.storageUtility=i,this.storageUtility=i}static getLocalStorageKey(i){return`issuerConfig:${i}`}async fetchConfig(i){let u;const o=new URL(Is,i.endsWith("/")?i:`${i}/`).href,d=await fetch(o);try{u=Us(await d.json())}catch(v){throw new Dr(`[${i.toString()}] has an invalid configuration: ${v.message}`)}return await this.storageUtility.set(Jr.getLocalStorageKey(i),JSON.stringify(u)),u}}async function Ds(s,i){await Qn(s,i),await Ps()}class Ls extends Ho{async get(i){const[u,o,d,v,h,w,S,l]=await Promise.all([this.storageUtility.getForUser(i,"isLoggedIn",{secure:!0}),this.storageUtility.getForUser(i,"webId",{secure:!0}),this.storageUtility.getForUser(i,"clientId",{secure:!1}),this.storageUtility.getForUser(i,"clientSecret",{secure:!1}),this.storageUtility.getForUser(i,"redirectUrl",{secure:!1}),this.storageUtility.getForUser(i,"refreshToken",{secure:!0}),this.storageUtility.getForUser(i,"issuer",{secure:!1}),this.storageUtility.getForUser(i,"tokenType",{secure:!1})]);if(typeof h=="string"&&!Gn(h)){await Promise.all([this.storageUtility.deleteAllUserData(i,{secure:!1}),this.storageUtility.deleteAllUserData(i,{secure:!0})]);return}if(l!==void 0&&!jo(l))throw new Error(`Tokens of type [${l}] are not supported.`);if(!(d===void 0&&u===void 0&&o===void 0&&w===void 0))return{sessionId:i,webId:o,isLoggedIn:u==="true",redirectUrl:h,refreshToken:w,issuer:S,clientAppId:d,clientAppSecret:v,tokenType:l??"DPoP"}}async clear(i){return Ds(i,this.storageUtility)}}class Ns{async canHandle(i){try{return new URL(i),!0}catch(u){throw new Error(`[${i}] is not a valid URL, and cannot be used as a redirect URL: ${u}`)}}async handle(i){return Xn()}}class Os{constructor(i,u,o,d,v){this.storageUtility=i,this.sessionInfoManager=u,this.issuerConfigFetcher=o,this.clientRegistrar=d,this.tokerRefresher=v,this.storageUtility=i,this.sessionInfoManager=u,this.issuerConfigFetcher=o,this.clientRegistrar=d,this.tokerRefresher=v}async canHandle(i){try{const u=new URL(i);return u.searchParams.get("code")!==null&&u.searchParams.get("state")!==null}catch(u){throw new Error(`[${i}] is not a valid URL, and cannot be used as a redirect URL: ${u}`)}}async handle(i,u){if(!await this.canHandle(i))throw new Error(`AuthCodeRedirectHandler cannot handle [${i}]: it is missing one of [code, state].`);const o=new URL(i),d=o.searchParams.get("state"),v=await this.storageUtility.getForUser(d,"sessionId",{errorIfNull:!0}),{issuerConfig:h,codeVerifier:w,redirectUrl:S,dpop:l}=await ei(v,this.storageUtility,this.issuerConfigFetcher),f=o.searchParams.get("iss");if(typeof f=="string"&&f!==h.issuer)throw new Error(`The value of the iss parameter (${f}) does not match the issuer identifier of the authorization server (${h.issuer}). See [rfc9207](https://www.rfc-editor.org/rfc/rfc9207.html#section-2.3-3.1.1)`);if(w===void 0)throw new Error(`The code verifier for session ${v} is missing from storage.`);if(S===void 0)throw new Error(`The redirect URL for session ${v} is missing from storage.`);const c=await this.clientRegistrar.getClient({sessionId:v},h),b=Date.now(),I=await Es(h,c,{grantType:"authorization_code",code:o.searchParams.get("code"),codeVerifier:w,redirectUrl:S},l);window.localStorage.removeItem(`oidc.${d}`);let P;I.refreshToken!==void 0&&(P={sessionId:v,refreshToken:I.refreshToken,tokenRefresher:this.tokerRefresher});const K=await ns(I.accessToken,{dpopKey:I.dpopKey,refreshOptions:P,eventEmitter:u,expiresIn:I.expiresIn});await zo(this.storageUtility,v,I.webId,I.clientId,"true",void 0,!0);const L=await this.sessionInfoManager.get(v);if(!L)throw new Error(`Could not retrieve session: [${v}].`);return Object.assign(L,{fetch:K,getLogoutUrl:Mo({idTokenHint:I.idToken,endSessionEndpoint:h.endSessionEndpoint}),expirationDate:typeof I.expiresIn=="number"?b+I.expiresIn*1e3:void 0})}}class Hs extends Io{constructor(i){super(i)}}class Bs{get storage(){return window.localStorage}async get(i){return this.storage.getItem(i)||void 0}async set(i,u){this.storage.setItem(i,u)}async delete(i){this.storage.removeItem(i)}}class Ms{redirect(i,u){u&&u.handleRedirect?u.handleRedirect(i):u&&u.redirectByReplacingState?window.history.replaceState({},"",i):window.location.href=i}}class js{constructor(i){this.storageUtility=i,this.storageUtility=i}async getClient(i,u){const[o,d,v,h]=await Promise.all([this.storageUtility.getForUser(i.sessionId,"clientId",{secure:!1}),this.storageUtility.getForUser(i.sessionId,"clientSecret",{secure:!1}),this.storageUtility.getForUser(i.sessionId,"clientName",{secure:!1}),this.storageUtility.getForUser(i.sessionId,"clientType",{secure:!1})]);if(o&&Wo(h))return{clientId:o,clientSecret:d,clientName:v,clientType:h};try{const w=await gs(i,u),S={clientId:w.clientId,clientType:"dynamic"};return w.clientSecret&&(S.clientSecret=w.clientSecret),w.idTokenSignedResponseAlg&&(S.idTokenSignedResponseAlg=w.idTokenSignedResponseAlg),await this.storageUtility.setForUser(i.sessionId,S,{secure:!1}),w}catch(w){throw new Error(`Client registration failed: [${w}]`)}}}class Ks{async canHandle(i){try{return new URL(i).searchParams.has("error")}catch(u){throw new Error(`[${i}] is not a valid URL, and cannot be used as a redirect URL: ${u}`)}}async handle(i,u){if(u!==void 0){const o=new URL(i),d=o.searchParams.get("error"),v=o.searchParams.get("error_description");u.emit(je.ERROR,d,v)}return Xn()}}class Vs{constructor(i,u,o){this.storageUtility=i,this.issuerConfigFetcher=u,this.clientRegistrar=o,this.storageUtility=i,this.issuerConfigFetcher=u,this.clientRegistrar=o}async refresh(i,u,o,d){const v=await ei(i,this.storageUtility,this.issuerConfigFetcher),h=await this.clientRegistrar.getClient({sessionId:i},v.issuerConfig);if(u===void 0)throw new Error(`Session [${i}] has no refresh token to allow it to refresh its access token.`);if(v.dpop&&o===void 0)throw new Error(`For session [${i}], the key bound to the DPoP access token must be provided to refresh said access token.`);const w=await As(u,v.issuerConfig,h,o);return w.refreshToken!==void 0&&(d==null||d.emit(je.NEW_REFRESH_TOKEN,w.refreshToken)),w}}function bn(s){const i=new Yo,u=s.secureStorage||i,o=s.insecureStorage||new Bs,d=new ks(u,o),v=new Jr(d),h=new js(d),w=new Ls(d),S=new Vs(d,v,h),l=new Ms,f=new Rs(d,new Cs(d,l),v,h),c=new Hs([new Ks,new Os(d,w,v,h,S),new Ns]);return new Ts(f,c,new Oo(w,l),w,v)}const Pr=`${qn}currentSession`,Nr=`${qn}currentUrl`;async function Js(s,i,u){var o;const d=await i.validateCurrentSession(s);return d!==null?(window.localStorage.setItem(Nr,window.location.href),await i.login({sessionId:s,prompt:"none",oidcIssuer:d.issuer,redirectUrl:d.redirectUrl,clientId:d.clientAppId,clientSecret:d.clientAppSecret,tokenType:(o=d.tokenType)!==null&&o!==void 0?o:"DPoP"},u.events),!0):!1}function Ws(s){return!!(s!=null&&s.isLoggedIn)}class qs{constructor(i={},u=void 0){this.tokenRequestInProgress=!1,this.login=async o=>{var d;return await this.clientAuthentication.login({sessionId:this.info.sessionId,...o,tokenType:(d=o.tokenType)!==null&&d!==void 0?d:"DPoP"},this.events),new Promise(()=>{})},this.fetch=(o,d)=>this.clientAuthentication.fetch(o,d),this.internalLogout=async(o,d)=>{window.localStorage.removeItem(Pr),await this.clientAuthentication.logout(this.info.sessionId,d),this.info.isLoggedIn=!1,o&&this.events.emit(je.LOGOUT)},this.logout=async o=>this.internalLogout(!0,o),this.handleIncomingRedirect=async(o={})=>{var d;if(this.info.isLoggedIn)return this.info;if(this.tokenRequestInProgress)return;const v=typeof o=="string"?{url:o}:o,h=(d=v.url)!==null&&d!==void 0?d:window.location.href;this.tokenRequestInProgress=!0;const w=await this.clientAuthentication.handleIncomingRedirect(h,this.events);if(Ws(w)){this.setSessionInfo(w);const S=window.localStorage.getItem(Nr);S===null?this.events.emit(je.LOGIN):(window.localStorage.removeItem(Nr),this.events.emit(je.SESSION_RESTORED,S))}else if(v.restorePreviousSession===!0){const S=window.localStorage.getItem(Pr);if(S!==null&&await Js(S,this.clientAuthentication,this))return new Promise(()=>{})}return this.tokenRequestInProgress=!1,w},this.events=new ls,i.clientAuthentication?this.clientAuthentication=i.clientAuthentication:i.secureStorage&&i.insecureStorage?this.clientAuthentication=bn({secureStorage:i.secureStorage,insecureStorage:i.insecureStorage}):this.clientAuthentication=bn({}),i.sessionInfo?this.info={sessionId:i.sessionInfo.sessionId,isLoggedIn:!1,webId:i.sessionInfo.webId,clientAppId:i.sessionInfo.clientAppId}:this.info={sessionId:u??jr(),isLoggedIn:!1},this.events.on(je.LOGIN,()=>window.localStorage.setItem(Pr,this.info.sessionId)),this.events.on(je.SESSION_EXPIRED,()=>this.internalLogout(!1)),this.events.on(je.ERROR,()=>this.internalLogout(!1))}setSessionInfo(i){this.info.isLoggedIn=i.isLoggedIn,this.info.webId=i.webId,this.info.sessionId=i.sessionId,this.info.clientAppId=i.clientAppId,this.info.expirationDate=i.expirationDate,this.events.on(je.SESSION_EXTENDED,u=>{this.info.expirationDate=Date.now()+u*1e3})}}let kr;function Zt(){return typeof kr>"u"&&(kr=new qs),kr}const Gs=(...s)=>Zt().fetch(...s),Ys=(...s)=>Zt().login(...s),Xs=(...s)=>Zt().logout(...s),Qs=(...s)=>Zt().handleIncomingRedirect(...s),Zs=()=>Zt().events;export{Zs as events,Gs as fetch,Qs as handleIncomingRedirect,Ys as login,Xs as logout};
